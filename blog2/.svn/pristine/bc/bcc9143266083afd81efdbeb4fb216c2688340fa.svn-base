incaseformat 病毒 分析 愚人节 病毒 不同于 熊猫 烧香 彩虹 猫 之前 的 钉 钉 病毒 年月 号 incaseformat 蠕虫 病毒 来袭 会 自动 复制到 windows 目 录下 并 写入 注册表 重启 电 脑后 病毒 会 遍历 除了 系统盘 外 的 所有 磁盘 进行 删除 病毒 检出 率 病毒 行为 分析 peid 分析 使用 编写 先 查看 字符串 信息 进行 定位 危险 函数 相关 代码 writefsdword unsignedint ampv systemparamstr v systemparamstr v vunknownlibname v systemparamstr v ampv if unsignedint systemparamstr v systemparamstr v unknownlibname v systemparamstr v ampv ampvvvampstr v constchar v shellexecutea v if unsignedint constint systemparamstr v constchar v copyfilea v dworde vx lobyte v v constint v v v writefsdword unsignedint ampv systemparamstr v constchar v copyfilea writefsdword v writefsdword unsignedint ampv v dworde vx lobyte v v constint v v writefsdword v systemparamstr v constint vv if v writefsdword unsignedint ampv systemparamstr v constchar v copyfilea writefsdword v vshellexecutea cwindowsttryexe v systemparamstr v constint vv if v v writefsdword v writefsdword unsignedint v ampv 其中 copyfilea 与 copyfilea writefsdword v vshellexecutea cwindowsttryexe 会 先 进行 判断 文件 是否 存在 将其 写入 注册表 设置 为 开机 自 启 并将 程序 拷贝到 c 盘 windows 下 shellexecutea 函数 是 windows 的 api 函数 功能 是 执行 可执行文件 exe 或 任何 关联 文件 doctxtxls 等 shellexecute 是 异步 执行 的 不管 执行 的 程序 是否 成功 运行 运行 的 时间 是 长 是 短 shellexecute 函数 都会 立即 返回 即 执行 ttryexe 程序 之后 定位 下一个 函数 writefsdword unsignedint ampv unknownlibname dword a writefsdword unsignedint ampv lobyte v v systemtobject unknownlibname sysutilsnow double char asubec ampv constint unsignedint char if loword systemtdatetime gtxdu if vgtu if vvvv v int void dword v if vgt vdo void fastcall dword v vvampv subec v vvwhile v v vvwritefsdword v v int amplocefblobyte v unknownlibname dword v v vvv vvv writefsdword v v int ampv 着重 关注 判断 语句 if loword systemtdatetime gtu 获 取到 系统 时间 如果 年份 大于 if vgtu 如果 月份 大于 if vvvv 如果 日期 等于 或 等于 或 等于 或 等于 就会 触发 subec 但是 这段 代码 上方 会 通过 获 取到 当前 时间 之后 通过 decodedate 对时间 进行 处理 具体 算法 如下 v unsignedint double ampa if vgt avvvfor ivgti vunknownlibname ampv if v ampv ampv if v v vvv char ampunkdc unsignedint vfor jj v word ampv unsignedint jif vltv 导致 算法 执行 后 的 结构 与 预期 不符 原本 会是 年月 号 愚人节 启动 缺 阴差阳错 的 成了 年月 号 执行 那么 下次 就是 月 和 月 号 具体 原因是 这个 函数 中 出现 了 变量 异常 signedint afltc if shidword v gt vv unsignedint dwordvv unsignedint v signedint vlodword v vhidword v hidword v dword v vv unsignedint dwordv signedint v unsignedint dword resultv dword vv dword v 这里 的 dword 按照 设计者 最初 的 设想 其 时间 戳 转 日 的 值 应该是 ms 而 这里是 导致 计算出 的 数值 错误 接下 来看 程序 对 硬盘 的 操作 inta unknownlibname writefsdword unsignedint ampv writefsdword unsignedint ampv vunknownlibname v if byte vv ampvampstr ampvvampstr if vampfattime vampstr if v vampstr if v if vampx ampvvv if unsignedint subec v ampvvv v while ampfattime ampfattime v v unsignedint v writefsdword v writefsdword v v int ampv ampv ampv returnv 函数 的 主要功能 是 根据 前缀 路径 匹配 所有 的 文件 循环 删除 遇到 文件夹 会 进行 递归 删除 目前 某 招聘 网站 已被 感染 网站 存在 文件 上传 漏洞 已经有 病毒 样 本年 已被 爆出 但 目前 依然 可以 下载 下载 后 的 样本 与 原 病毒 样本 对比 使用 ida 进行 查看 可以 确 定为 同一 病毒 其 病毒 行为 与 原 病毒 行为 一样 程序 的 图标 同 windows 的 文件夹 错误 点击 后 可能会 弹窗 报错 windows 测试 未 报错 电脑 重启 前 重启 后 发现 e 盘 占用 空间 依然 有 但是 文件 以及 没有 了 windows 下 出现 的 一些问题 pchunter 打开 能 看到 其 运行 的 进程 原有 执行 文件 已经 消失 这个 病毒 对 我 没有 危害 因为 我 windows 只有 c 盘 个人感觉 固态 硬盘分区 的 意义 好像 不大 最后 一张 图 收尾 以前 阅读 量 不到 k 现在 目前 阅读 量 已经 k 了 奥 利 给 