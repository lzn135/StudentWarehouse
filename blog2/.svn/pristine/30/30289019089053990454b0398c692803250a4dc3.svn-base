译 apt 分析 报告 05.turla 新型 水坑 攻击 后门 netflash 和 pyflash 这是 作者 新开 的 一个 专栏 主要 翻译 国外 知名 的 安全 厂商 apt 报告 文章 了解 它们 的 安全 技术 学习 它们 溯源 apt 组织 的 方法 希望 对 您 有所 帮助 前文 分享 了 一种 新型 无 文件 apt 攻击 kraken 它会 利用 windows 错误报告 服务 逃避 检测 这篇 文章 将 介绍 turla 新型 水坑 攻击 后门 netflash 和 pyflash 研究人员 发现 turla 对 armenian 的 知名 网站 发起 水坑 攻击 通过 伪造 adobeflash 更新 欺骗 受害者 下载 两个 新型 恶意 软件 netflash 和 pyflash 从而 实现 恶意 攻击 整个 攻击 的 ttp 基本 没有 变化 但 turla 第一次 使 用了 python 后门 程序 原文 标题 原文 链接 文章 作者 matthieufaou 发布 时间 年月日 文章 来源 推荐 文章 文章 目录 一 什么 是 水坑 攻击 二 turla 组织 三 目标 网站 四 指纹识别 和 传播 链 五 恶意 软件 年月 之前 skipper 从 年月 开始 netflash 和 pyflash 六 结论 一 什么 是 水坑 攻击 水坑 攻击 wateringhole 是 黑客 攻击方式 之一 它是 在 受害者 必经之路 设置 了 一个 水坑 陷阱 最常 见 的 做法 是 黑客 分析攻击 目标 的 上网 活动 规律 寻找 攻击 目标 经常 访问 网站 的 弱点 先 将此 网站 攻破 并 植入 攻击 代码 一旦 攻击 目标 访问 该 网站 就会 中招 由于 此种 攻击 借助 了 目标 团体 所 信任 的 网站 攻击 成功率 很高 即便是 那些 对 鱼叉 攻击 或 其他 形式 的 钓鱼 攻击 具有 防护 能力 的 团体 也 容易 受骗 水坑 攻击 属于 apt 攻击 的 一种 与 钓鱼 攻击 相比 黑客 无需 耗费 精力 制作 钓鱼 网站 而是 利用 合法 网站 的 弱点 隐蔽性 比 较强 在 人们 安全意识 不断加强 的 今天 黑客 处心积虑 地 制作 钓鱼 网站 却被 有心人 轻易 识破 而 水坑 攻击 则 利 用了 被 攻击者 对 网站 的 信任 水坑 攻击 利用 网站 的 弱点 在 其中 植入 攻击 代码 攻击 代码 利用 浏览器 的 缺陷 被 攻击者 访问 网站 时 终端 会被 植入 恶意程序 或者 直接 被 盗取 个人 重要 信息 水坑 攻击 相对于 通过 社会 工程 方式 引诱 目标 用户 访问 恶意 网站 更具 欺骗性 效率 也 更高 水坑 方法 主 要被 用于 有 针对性 的 攻击 而 adobereaderjava 运行时 环境 jreflash 和 ie 中 的 day 漏洞 被 用于 安装 恶意 软件 下图 展示 了 水坑 攻击 的 基本 流程 水坑 攻击 广泛 应用于 apt 组织 发起 的 攻击 中 比如 海 莲花 图拉 aptc 等 主要 呈现出 两个 特征 多 属于 apt 攻击 目标 多为 是 大型 重要 企业 的 员工 或 网站 多 利用 day 漏洞 如 adobeflash 高危 漏洞 cve 年底 美国 外交关系 委员会 的 网站 遭遇 水坑 攻击 年初 苹果 微软 纽约时报 facebooktwitter 等 知名 大 流量 网站 相继 中招 国内 网站 也 难以 幸免 年 西藏 zf 网站 遭遇 水坑 攻击 年 百度 阿里 等 国内 知名 网站 也 因为 jsonp 漏洞 而 遭受 水坑 攻击 推荐 文章 apt 之 水坑 攻击 洛 米 唯 熊 那么 如何 防御 水坑 攻击 呢 针对 这类 攻击 重要 的 一点 也是 对 用户 进行教育 让 他们 意识到 这类 攻击 及其 危害性 遇到 点击 链接 的 要求 时 越 谨慎 越好 其次 企业 组织 本身 也要 提高 警惕 采取 更 高级 的 手段 检测 并 对抗 攻击 同时 安装 必要 的 安全 软件能 有效 识别 恶意 伪装 软件 二 turla 组织 turla 也 称为 和 uroboros 是 迄今为止 最为 高级 的 威胁 组织 之 一并 被 认为 隶属于 俄罗斯 zf 该 组织 成员 均 说 俄语 虽然 该 组织 被 认为 至少 在年 就 已经 成立 但 直到 年 它 才 被 卡巴 斯基 实验室 发现 这 主要 是因为 该 组织 被 证实 能够 利用 卫星通信 中固 有的 安全漏洞 来 隐藏 其 campc 服务器 的 位置 和 控制中心 我们 都 知道 一旦 campc 服务器 的 位置 暴露 幕后 的 操作者 就会 很 容易 被发 现 因此 turla 组织 具备 的 这种 能力 使得 它 能够 很好 地 隐藏 自己 的 位置 和 实施 jd 活动 卡巴 斯基 实验室 在年 进行 的 一项 调查 显示 相比 于 年 turla 组织 已经 将其 卫星 cc 注册 数量 增加了 至少 十倍 年代 著名 网络 间谍 组织 月光 迷宫 moonlightmaze 就是 今天 turlaapt 的 前身 它们 都 具有 大量 相同 的 技术手段 且 都与 俄罗斯 zf 黑客 相关 年月日 美国 科罗拉多 矿业大学 网络 遭 黑客 入侵 攻击者 通过 sunos 操作 系统漏洞 入侵 了 该校 布朗 大 楼内 一台 昵 称为 babydoe 的 电脑 他们 以 这台 电脑 为 中转 陆续 入侵 了 美国 国家 航空 航天局 美国 hai 军 和 kong 军 总部 及 遍及 全美 的 高校 和 军事 机构 在 美国 多 部门 共同 调查 下 发现 入侵者 获 取了 从 头盔 设计 到 大气 数据 等 大量 美国 jm 信息 数量 打 印成 稿 的 高度 可 堪 比 华盛顿 纪念碑 随着 调查 继续 深入 最终 溯源 为 俄罗斯 tg 行为 由于 其 入侵 活动 多在 夜间 进行 且 鉴于 其 行为 复杂性 故 命名为 月光 迷宫 该 网络 入侵 行为 是 历史上 第一个 已知 的 网络 apt 攻击 从那时起 人们 也 意识到 网络 jd 和 网络 z 不仅 只是 好莱坞 电影 中 的 把戏 而是 种 真实 存在 月光 迷宫 开启 了 网络 jd 的 篇章 也 成 为了 很多 黑客 书籍 中 的 经典 案例 在 网络 入侵 活动 中 黑客 一般 会 利用 中转 或 跳 板机 作为 攻击 代理 防止 溯源 调查 而 月光 迷宫 入侵者 也是 最早 采用 该 技术 的 攻击者 他们 利用 很多 国家 的 一系列 大学图书馆 等 存在 系统漏洞 的 机构 电脑 作为 中转 跳板 存储 攻击 工具 发起 网络 攻击 以此 迷惑 调查 行为 自 年 以来 turla 组织 一直 处于 活跃 状态 并 制造 了 许多 影响 一时 的 大事件 比如 在年 被 指 攻击 了 美国 zyslb 部 即 buckshotyankee 事件 通过 u盘 将 一种 名为 agentbtz 的 恶意 软件 上传 到了 wu 角 大楼 的 jun 事 网络系统 之中 另一 起 事件 发生 在年 也 就是 对 瑞士 jg 企业 ruag 集团 的 大规模 网络 攻击 在这 起 攻 击中 turla 使 用了 网络 jd 软件 epicturlaturla 软件 家族 的 一个 分支 被称为 史上 最 复杂 的 apt 间谍 软件 木马程序 以及 rootkit 恶意 软件 的 组合 此外 被 turla 攻击 过 的 组织 远不止 于此 这 包括 乌克兰 欧盟 各国 政府 以及 各国 大使馆 研究 和 教育 组织 以及 制药 军工企业 根据 卡巴 斯基 实验室 的 说法 turla 这些年来 主要 使 用了 以下 几种 攻击 工具 icedcoffeer 和 从 年 起 turla 就 已经 开始 通过 多种 方式 利用 这 包括 恶意 软件 的 下载 和 安装 以及 完整 后门 的 实现 在被 vba 宏代码 解密 后 whiteatlas 框架 通常会 使用 一个 小型 的 javascript 脚 本来 执行 恶意 软件 dropper 有效载荷 然后再 删除 dropper 以 擦除 痕迹 对于 释放 由 turla 开发 的 firefox 扩展 后门 whiteatlas 框架 使 用了 一种 更加 复杂 和 高度 混淆 的 javascript 脚 本该 脚本 仍然 负责 写入 extensionjson 扩展 配置文件 然后再 删除 自己 那么 如何 溯源 apt 组织 呢 这里 简单 补充 下 turlaapt 和 早期 的 蠕虫 病毒 agentbtz 高度 相关 年 的 virusbulletin 会议 上 卡巴 斯基 研究人员 kurtbaumgartner 表示 turlaapt 和 早期 的 蠕虫 病毒 agentbtz 高度 相关 并且 agentbtz 样本 文件 包 含了 对 卫星 基础设施 的 劫持 攻击 与 后期 的 turla 极为 相似 turla 日志 会 生成 与 agentbtz 相同 的 文件名 和 wmcachenld 并 保存 在被 入侵 的 系统 中 turla 还 使 用了 和 agentbtz 如出一辙 的 xor 密 匙 为 其 日志 文件 加密 这篇 文章 的 水坑 攻击 与 过去 几年 turla 的 水坑 攻击 非常 相似 尤其是 操作 方式 类似于 在年 发现 的 一个 攻击 事件 那里 使用 的 各种 javascript 片段 几乎 与此 攻 击中 的 相同 但 目标 和 有效 负载 不同 kopiluwak 脚本 通过 宏代码 进行 解码 这与 icedcoffee 非常 相似 在 年月 卡巴 斯基 实验室 观察 到了 新一轮 的 武器 化 宏 文档 这些 宏 文档 释 放了 一个 新 的 高度 混淆 的 javascript 有效载荷 即 kopiluwak 这种 新 的 攻击 工具 所 针对 的 目标 与 turla 之 前所 针对 的 目标 是 一致 的 即 针对 欧洲各国 zf 但它 的 部署 比 icedcoffee 更具 针对性 月光 迷宫 攻击者 由于 其 低级 的 英语水平 和 俄语 倾向 攻击者 犯了 一些 细微 的 错误 比 如在 一个 程序 的 逆向 过程中 发现了 其 pdb 程序 路径 中 包 含了 可能是 攻击 程序 开发 成员 的 maxiron 和 rinat 尽管 这些 程序 有 可能是 在 受害者 机器 上 进行 编译 开发 的 但 这三个 名字 还在 myprgmytdn 和 exploits 路径 下 都 存在 其中 值得注意 的 是 名为 iron 的 成员 涉及 开 发了 loki 后门 早期 的 客户端 程序 cli 另 外在 一个 两次 调用 的 进程 pid 信息 中 可以 发现 一个 名为 grandchild 或 grandson 的 俄语 单词 vnuk 参考文献 卡巴 斯基 深度 揭露 俄罗斯 apt 组织 turla 卡巴 斯基 揭秘 turlaapt 的 转世 前身 三 目标 网站 此次 攻击 事件 中 turla 至少 破 坏了 四个 armenian 的 网站 其中 包括 两个 属于 zf 的 网站 因此 其 攻击 目标 可能 包括 政府官员 和 政客 以下 网站 遭到 入侵 armconsulru 俄罗斯 亚美尼亚 大 s 馆 领事 处 mnpnkramartsakh 自然保护 和 自然 资源部 aiisaam 亚美尼亚 国际 和 安全 事务 研究所 adgfam 亚美尼亚 存款 担保 基金 eset 研究 迹象 表明 这些 网站 至少 从 年初 以 来就 遭 到了 入侵 我们 在 发布 前 通知 armenian 国家 cert 并与 他们 分享 了 我们 的 分析 结果 turla 利用 非法 访问 向 网站 中 插入 恶意 javascript 代码 例如 对于 mnpnkram 在 常见 的 javascript 库 的 末尾 附 加了 混淆 的 代码 如 下图 所示 此 代码 从 加载 外部 的 javascript 我们 将在 下一 部分 中 分析 此 代码 自 年 月底 以来 我们 注意到 不再 传播 该 恶意 脚本 可能是 turla 黑客 人员 已 中止 了 该 水坑 攻击 作业 四 指纹识别 和 传播 链 访问 受 感染 的 网页 后 会 植入 第二阶段 的 恶意 javascript 并为 访问者 的 浏览器 添加 指纹 下图 显示 了 此 脚 脚本 的 主要功能 第一次 执行 脚本 如果 这是 用户 浏览器 第一次 执行 该 脚本 它将 添加 一个 evercookie 该 cookie 具有 由 服务器 提供 的 随机 md 值 该 值 在 每次 执行 脚本 时 都 不同 evercookie 是 基于 github 代码 实现 的 它 使用 多个 存储 位置 如 本地 数据库 本地 共享 对象 存储 等 来 存储 cookie 值 与 常规 cookie 相 比它 的 持久性 更高 因为 如果 用户 只是 删 除了 浏览器 的 cookie 它是 不会 被 删除 的 第二次 访问 受 感染 网站 该 evercookie 将 用于 识别 用户 是否 再次 访 问了 受 感染 的 网站 当 用户 第二次 访问 时 先前 存储 的 md 值 可以 用来 识别 第二次 访问 的 行为 然后 它会 收集 浏览器 插件 列表 屏幕 分辨率 和 各种 操作系统 信息 由 post 发送到 cc 服务器 如果有 答复 则 认为 它是 javascript 代码 并 使用 eval 函数 执行 如果 攻击者 对 感染 目标 感兴趣 则 服务器 会用 一段 创建 iframe 的 javascript 代码 进行 答复 来自 eset 研究 的 数据 表明 此次 活动 中 turla 只对 非常 有限 的 访问 网站 感兴趣 之后 该 iframe 会 向 用户 显示 虚假 的 adobeflash 更新 警告 目的 是 诱使 他们 下载 恶意 的 flash 安装 程序 下图 展示 了 伪造 的 adobeflash 更新 iframe 该 安全 研究 组 没有 观察到 任何 浏览器 漏洞 的 利用 技术 此次 活动 仅 依靠 社会 工程 技巧 从 与 iframe 的 javascript 相同 的 服务器 上 下载 恶意 可执行文件 如果 用户 手动 启 动了 该 可执行文件 则会 安装 turla 恶意 软件 以及 合法 的 adobeflash 程序 下图 是 从 最初 访问 受 感染 的 亚美尼亚 网站 后 恶意 负载 的 传输 过程 整个 流程 比较 清晰 访问 受 感染 的 网页 后 会 植入 恶意 javascript 并为 访问者 的 浏览器 添加 指纹 接着 通过 水坑 攻击 诱导 受害者 点击 adobeflash 更新 然后 加载 turla 恶意 软件 和 合法 的 flash 程序 从事 实施 后续 的 攻击 五 恶意 软件 当 用户 执 行了 伪造 的 安装 程序 它将 同时 执行 turla 恶意 软件 和 合法 的 adobeflash 安装 程序 因此 用户 可能 认为 更新 警告 是 合法 的 年月 之前 skipper 在年 月 结束 之前 受害人 将 收到 一个 rarsfx 存档 其中 包含 一个 合法 的 adobeflashv 安装 程序 和 另一个 rarsfx 存档 后者 包含 后门 的 各种 组件 即 skipper 先前 已 归因于 turla 它是 由 bitdefender 的 研究人员 在年 记录 的 而 最新版 本是 由 telsy 在 年月 记录 的 鉴于 文档 版本 和 最新 版本 之间 只有 很小 的 变化 因此 我们 在这里 将不 提供 详细 的 分析 一个 有趣 的 变化 是 skipper 通信 模块 使用 托管 该 活动 的 远程 javascript 和 恶意 二进制 文件 的 服务器 为 其 cc 服务器 特别是 从 年月 开始 netflash 和 pyflash 在年 月底 我们 注意到 交付 的 有效 负载 发 生了 变化 netflashnet 下载 器 年 月末 发现了 新 的 恶意 负载 新 的 恶意 负载 是 一个 net 程序 它在 tempadobeexe 中 删 除了 adobeflashv 的 安装 程序 在 tempwinhostexe 中 删 除了 netflashnet 下载 程序 根据 其 编译 时间 戳 分析 该 恶意 样 本是 在年 月底 和 年 月初 编译 的 然后 再上 传到 水坑 攻击 的 cc 服务器 netflash 从 硬 编码 url 下载 其 第二阶段 恶意 软件 并 使用 windows 计划任务 为 新 后门 建立 持久性 下图 显示 了 netflash 的 主要功能 该 功能 可 下载 名为 pyflash 的 第二阶段 恶意 软件 我们 还 发现 另一个 netflash 样 本该 样本 可能 在年 月底 编译 具有 不同 的 硬 编码 cc 服务器 pyflash 第二阶段 后门 是 pyexe 可执行文件 pyexe 是 一个 python 扩展 用于 将 python 脚本 转 换为 独立 的 windows 可执行文件 据 我们 所知 这是 turla 开发人员 第一次 在 后门 使用 python 语言 后门 通过 http 与 硬 编码 的 cc 服务器 通信 在 脚本 的 开头 指定 了 ccurl 以及 用于 加密 所有 网络通信 的 其他 参数 如 aes 密钥 和 iv 如 下图 所示 展示 了 pyflashpython 脚本 中 的 全局变量 该 脚本 的 主要功能 如 下图 所示 将 有关 计算机 的 信息 发送到 cc 服务器 还 包括 与 os 相关 的 命令 和 与 网络 相关 的 命令 的 输出 结果 下图 展示 了 pyflash 的 主要功能 cc 服务器 还 可以 以 json 格式 发送 后门 命令 在此 版本 的 pyflash 中 实现 的 命令 是 从 给定 的 http s 链接 下载 其他 文件 使用 python 函数 subprocesspopen 执行 windows 命令 更改 执行 延迟 定期 修改 每 x 分钟 默 认为 分钟 启动 恶意 软件 的 windows 任务 卸载 恶意 软件 为了 确认 该 指令 恶意 软件 使用 以下 字符串 将 post 请求 发送到 cc 服务器 然后 命令 的 输出 通过 post 请求 发 送回 操作员 并用 aes 加密 六 结论 turla 仍将 水坑 攻击 作为 其 初始 入侵 目标 的 策略 之一 此 攻击 依赖 社交 工程学 技巧 利用 虚假 的 adobeflash 更新 警告 来 诱使 用户 下载 并 安装 恶意 软件 另一方面 有效载荷 发 生了 变化 可能 是为了 逃避 检测 恶意 负载 payload 为 netflash 并 安装 名为 pyflash 的 后门 该 后门 是 使用 python 语言 开发 的 我们 将 继续 监视 turla 的 新 活动 并 将在 我们 的 博客 上 发布 相关 信息 如有 任何 疑问请 通过 与 我们 联系 也 可以 在 我们 的 github 存储 库 中找到 iocs 遭到 破坏 的 网站 cc 服务器 样本 mitreattampck 框架 技术 后续 作者 会 分享 一篇 文章 详细 介绍 attampck 框 架在 apt 组织 中 的 应用 最后 希望 这篇 文章 对 您 有所 帮助 感觉 python 后门 和 水坑 攻击 挺有 意思 的 后续 不忙 可以 尝试 复现 相关 的 功能 今天是 还是 挺 喜欢 一年前 我 与 csdn 这 十年 这篇 文章 的 人生 又有 多少个 十年 啊 最近 实验室 忙 疯了 今天 最 终于 可以 回家 陪 女神 路漫漫其修远兮 继续 加油 珍惜 当下 准备 回家 喽 这篇 文章 是 在 高 铁 g 上 写 的 加油 前文 分享 译 apt 分析 报告 linux 系统 下 针对性 的 apt 攻击 概述 译 apt 分析 报告 钓鱼 邮件 网址 混淆 url 逃避 检测 译 apt 分析 报告 opblueraven 揭露 apt 组织 fincarbanak 上 tirion 恶意 软件 译 apt 分析 报告 kraken 新型 无 文件 apt 攻击 利用 windows 错误报告 服务 逃避 检测 译 apt 分析 报告 turla 新型 水坑 攻击 后门 netflash 和 pyflash 年月 新开 的 娜 璋 ai 安全 之家 主要 围绕 python 大数 据分析 网络空间 安全 逆向 分析 apt 分析 报告 人工智能 web 渗透 及 攻防 技术 进行 讲解 同时 分享 ccfsci 南 核 北 核 论文 的 算法 实现 娜 璋 之家 会 更加 系统 并 重构 作者 的 所有 文章 从 零 讲解 python 和 安全 写了 近十年 文章 真心 想把 自己 所学 所 感 所做 分享 出来 还请 各位 多多指教 真诚 邀 请您 的 关注 谢谢 byeastmount 星期 六晚 上点 写 于 高 铁 