cobalt strike 简单 使用 cobaltstrike 简单 使用 我 在 最没有 能力 的 年纪 碰 见了 最想 照顾 一生 的人 概述 cobaltstrike 是 一款 内网 渗透 测试 神器 一个 服务端 多个 客户端 这样 最大 好处 就是 可以 团队 合作 cobaltstrike 集 成了 很多 工具 如 多 模式 监听 dnssmb 等 多种 代理 转发 自定义 脚本 以及 生成 各种 版本 木马 各种 病毒 各种 payload 进行 网站 克隆 钓鱼 攻击 等等 更 方便 快速 的 获取 权限 进行 权限 维持 横向 攻击 等等 启动 服务端 首先在 vps 进行 搭建 启动 teamservervpsip 密码 客户端 输入 vpsip 密码 即可 登陆 基本 操作 首先 介绍 监听 listeners 模块 主要有 个 不同 服务 的 监听 分 两个 大块 beacon 和 foreignbeacon 主要 就是 给 cs 自己 反弹 shell 的 foreign 主 要是 给 外部 msfmeterpreter 反弹 一个 shell 以 便于 内网 攻击 内部 就是 生成 payload 直接 反弹 即可 cs 结合 msf 互传 cs 传给 msfmsf 监听 cs 中 添加 forgein 监听 然后 cs 中 spawn 即可 msf 传 cs 利用 payloadinject 模块 msf 下 即可 各有 各 优点 dns 隐秘性 好 https 加密 通信 smb 在 内网 使用 配合 一台 主机 作为 中转 器 配合 无 状态 木马 使用 向 另外 一台 无法访问 到 的 内网 主机 进行 反弹 shell 等等 监 听完 即可 生成 payload 去 攻击 cs 提供 很多 生成 hta 木马 文件 msofficemacro 生成 office 宏病毒 文件 生成 各种 语言 版本 的 生成 利用 自动播放 运行 的 木马 文件 windowsdropper 把 木马 捆绑 到 文件 上 点击 即可 反弹 生成 可执行 exedll 木马 s 生成 可执行 exedll 木马 powershell 等 拿到 shell 就可以 继续 搞 主要 介绍 以下 几个 模块 interactbeacon 命令行 shellcmd 命令 需要 用到 的 命令 直接 help 即可 进程 参数 欺骗 blockdlls 在 子 进程 中 阻止 非 microsoft 的 dlls 文件 browserpivot 注入 受害者 浏览器 进程 bypassuac 绕过 uaccancel 取消 正在进行 的 下载 cd 切换 目录 checkin 强制 让 被控 端 回 连 一次 clear 清除 beacon 内部 的 任务 队列 connect 通过 tcp 连 接到 beaconcovertvpn 部署 covertvpn 客户端 cp 复制 文件 dcsync 从 dc 中 提取 密码 哈希 desktop 远程 vncdllinject 反射 dll 注入 进程 dllload 使用 loadlibrary 将 dll 加 载到 进程 中 download 下载 文件 downloads 列出 正在进行 的 文件 下载 drives 列出 目标 盘符 elevate 尝试 提 权 execute 在 目 标上 执行 程序 无 输出 executeassembly 在 目 标上 内存 中 执行 本地 net 程序 exit 退出 beacongetprivs 对 当前 令牌 启用 系统 权限 getsystem 尝试 获取 system 权限 getuid 获取 用户 idhashdump 转 储 密码 哈希 值 help 帮助 inject 在 特定 进程 中 生成 会话 jobkill 杀死 一个 后台任务 jobs 列出 后台任务 从 ccache 文件 中 导入 票据 应用 于此 会话 清除 当前 会话 的 票据 从 ticket 文件 中 导入 票据 应用 于此 会话 keylogger 键盘记录 kill 结束 进程 link 通过 命名 管道 连 接到 使用 mimikatz 转 储 凭据 和 哈希 值 ls 列出 文件 maketoken 创建 令牌 以 传递 凭据 mimikatz 运行 mimikatzmkdir 创建 一个 目录 modedns 使用 dnsa 作为 通信 通道 仅限 dnsbeacon modednstxt 使用 dnstxt 作为 通信 通道 仅限 dbeacon modedns 使用 dnsaaaa 作为 通信 通道 仅限 dnsbeacon modehttp 使用 http 作为 通信 通道 mv 移动 文件 netnet 命令 note 给 当前 目标 机器 备注 portscan 进行 端口扫描 powerpick 通过 执行命令 powershell 通过 powershellexe 执行命令 导入 powershell 脚本 ppid 为 生成 的 postex 任务 设置 父 pidps 显示 进程 列表 psexec 使用 服务 在 主 机上 生成 会话 psexecpsh 使用 powershell 在 主 机上 生成 会话 psinject 在 特定 进程 中 执行 powershell 命令 pth 使用 mimikatz 进行 传递 哈希 pwd 当前 目录 位置 reg 查询 注册表 revself 恢复 原始 令牌 rm 删除 文件 或 文件夹 rportfwd 端口 转发 run 在 目 标上 执行 程序 返回 输出 runas 以 另一个 用户 权限 执行 程序 runasadmin 在 高 权限 下 执行 程序 runu 在 另一个 pid 下 执行 程序 screenshot 屏幕 截图 setenv 设置 环境变量 shellcmd 执行命令 shinject 将 shellcode 注入 进程 shspawn 生成 进程 并将 shellcode 注入 其中 sleep 设置 睡眠 延迟时间 socks 启动 socks 代理 socksstop 停止 socksspawn 生成 一个 会话 spawnas 以其 他 用户 身份 生成 会话 spawnto 将可 执行 程序 注入 进程 spawnu 在 另一个 pid 下 生成 会话 ssh 使用 ssh 连接 远程 主机 sshkey 使用 密钥 连接 远程 主机 stealtoken 从 进程 中 窃取 令牌 timestomp 将 一个 文件 时间 戳 应用到 另一个 文件 unlink 断开 与 beacon 的 连接 upload 上传 文件 wdigest 使用 mimikatz 转 储 明文 凭据 winrm 使用 winrm 在 主 机上 生成 会话 wmi 使用 wmi 在 主 机上 生成 会话 获取 hash 即可 碰撞 mdelevate 一键 提 权 内置 很多 可 上传 如 cve 或 beacon 利用 powershell 提 权 等 goldenticket 生成 黄金 票据 注入 当前 会话 maketoken 凭证 转换 抓取 windows 明文 密码 spawnas 分享 给 队友 劫持 浏览器 进行 代理 desktop vnc 开启 桌面 交互 filebrowser 文件 管理 上传 等等 netview 查询 信息 portscan 端口扫描 arpicmp 等 扫描 processlist 查看 进程 可以 注入 进行 获取 新 shell 监听 键盘 等 screenshot 截图 开启 socks 代理 服务 listener 反向 端口 转发 deployvpn 部署 vpnspawn 新 的 通讯 模式 并 生成 会话 session 会话 管理 删除 心跳 时间 退出 备注 拿到 权限 后 权限 维持 很重 要比 如常 见 的 注册表 设置 启动项 计划任务 设置 服务 dll 劫持 等 进而 进行 横向 移动 横扫 内网 比如 扫描 其他 主机 端口 弱 口令 中间件 漏洞 等等 也 可以 利用 psexec 选择 凭证 进行 攻击 或者 进程 中 stealtoken 窃取 或者 可以 上传 插件 利用 其他 漏洞 如 最常 见 msms 以及 ie 双 杀 漏洞 等等 余生 很长 请 多 指教 