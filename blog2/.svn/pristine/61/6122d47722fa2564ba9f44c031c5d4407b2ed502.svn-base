译 apt 分析 报告 07. 拉 撒 路 lazarus 使用 的 两款 恶意 软件 分析 这是 作者 新开 的 一个 专栏 主要 翻译 国外 知名 安全 厂商 的 apt 报告 了解 它们 的 安全 技术 学习 它们 溯源 apt 组织 的 方法 希望 对 您 有所 帮助 前文 分享 了 rampantkitten 攻击 活动 包括 windows 信息 窃取 程序 android 后门 和 电报 网络 钓鱼 页面 这篇 文章 将 介绍 apt 组织 拉 撒 路 lazarus 使用 的 两款 恶意 软件 并 进行 详细分析 个人感觉 这篇 文章 应该是 韩国 或 日本 安全 人员 撰写 整体 分析 的 深度 距 安全 大厂 fireeye 卡巴 斯基 的 apt 分析 报告 还有 差距 但 文章内容 也 值得 我们 学习 原文 标题 原文 链接 文章 作者 朝 長 秀 誠 shuseitomonaga 发布 时间 年月日 文章 来源 jpcertcceyes 相关 文章 文章 目录 一 网络 入侵 后 的 恶意 软件 恶意 软件 概述 配置 configuration 混淆 obfuscationcc 服务器 通信 下载 模块 横向 移动 二 恶意 软件 概述 配置 configuration 混淆 obfuscationcc 服务器 通信 指令 三 总结 一 网络 入侵 后 的 恶意 软件 jpcertcc 观察到 lazarus 也 称为 隐藏 眼镜蛇 针对 日本 组织 的 攻击 活动 入侵 前后 使 用了 不同 类型 的 恶意 软件 第一款 工具 将 介绍 网络 入侵 后 使用 的 一种 恶意 软件 lazarustapt 组织 是 来自 朝鲜 的 apt 组织 该 组织 长期 对 韩国 美国 进行 渗透 攻击 此外 还对 全球 的 金融机构 进行 攻击 堪称 全球 金融机构 的 最大 威胁 该 组织 最早 的 攻击 活动 可以 追溯到 年 据 国外 安全 公司 的 调查 显示 lazarus 组织 与 年 索尼 影业 遭 黑客 攻击 事件 年 孟加拉国 银行 数据 泄露 事件 年 美国 gf 承包商 美国能源 部门 及 英国 韩国 等 比特 币 交易所 被 攻击 等 事件 有关 而 年 席卷 全球 的 最 臭名昭著 的 安全 事件 wannacry 勒索 病毒 也 被 怀 疑是 该 组织 所为 恶意 软件 概述 该 恶意 软件 下载 及 执行 模块 如下 它以 drv 文件 的 形式 保 存在 cwindowssystem 文件夹 中 并 作为 服务 运行 使用 vmprotect 将其 混淆 文件 末尾 包含 一些 不必要 的 数据 使 文件 大小 增加到 约 mb 图 显示 了 恶意 软件 运 行前 的 事件 流 以下 各部分 将 说明 有关 恶意 软件 的 详细信息 包括 配置 通信 格式 和 模块 配置 configuration 恶意 软件 的 配置 大小 xde 被 加密 并 存储 在 注册 表项 中 并在 执 行时 加载 在此 分析 中 已 确认 配置 存储 在 以下 目录 中 图 是 一个 解码 配置 示例 它 包含 一个 加密 密钥 以及 cc 服务器 的 信息 详见 附录 a 混淆 obfuscation 恶意 软件 中 的 所有 字符串 均 使用 aes 加密 加密 密钥 被 硬 编码 在 恶意 软件 中 图 是 加密 密钥 的 示例 由于 恶意 软件 将 个 字母 的 字符串 转 换为 宽 字符 个 字节 因此 只有 前个 字节 被 用作 密钥 windowsapi 名称 也 经过 aes 加密 在 解密 api 字符串 后 将 解析 由 loadlibrary 和 getprocaddress 调用 的 api 的 地址 cc 服务器 通信 以下 是 恶意 软件 首先 发送 的 httppost 请求 示例 post 数据 的 参数 param 是 从 以下 随机 选择 的 数据 中 的 值 是 以下 数据 的 base 编码 的 字符串 如果 从 cc 服务器 返回 一个 与 cookiebase 编码 中 的 位 认证 密钥 相同 的 值 作为 响应 则 该 恶意 软件 将 发送 以下 信息 第二次 通信 后 恶意 软件 发送 以下 httppost 请求 post 数据 的 参数 是 从 上述 列表 中 随机 选择 的 post 数据 包含 两条 信息 data 包含 命令 而 data 包含 命令 执行 的 结果 和 其他 附加 数据 详细信息 请 参见 附录 b 响应 数据 的 格式 与 请求 相同 但 缺少 参数 响应 数据 经过 aes 加密 然后 像 post 数据 一样 进行 base 编码 区别 在于 号 被 一个 空格 代替 图 是 从 与 cc 服务器 通信 开始 到 下载 模块 的 通信 流程 在 第二次 通 信中 恶意 软件 发送 一个 新 的 aes 密钥 该 密钥 对 随后 的 通信 进行 加密 在 第三次 通讯 时 将 下载 一个 模块 module 以下 是 下载 模块 时 来自 cc 服务器 的 响应 示例 下载 模块 模块 下载 成功 后 它将 执行 如从 cc 服务器 接收 命令 的 主要功能 恶意 软件 提供 了 包括 cc 服务器 和加 密 密钥 的 信息 作为 参数 下载 的 模块 经过 upx 加密 如图所示 通信 以 与 前面 提到 的 几乎 相同 的 格式 执 行经 确认 该 模块 具有 以下 功能 对 文件 的 操作 创建 列表 删除 复制 修改 创建 的 时间 对 进程 的 操作 创建 列表 执行 终止 上传下载 文件 创建 并 上传 任意 目录 的 zip 文件 执行 任意 shell 命令 获取 磁盘 信息 修改 系统 时间 横向 移动 为了 横向 移动 在 通过 pyinstaller 将其 转 换为 windowspe 文件 后 使 用了 smbmap 这个 python 工具 该 工具 允许 通过 smb 访问 远程 主机 攻击者 通过 利用 事先 获得 的 帐户 信息 来 横向 传播 感染 的 活动 已经 被 许多 不同 的 组织 都 报告 过 并且在 多个 国家 都发 生了 攻击 在 日本 也有 可能 继续 观察到 类似 的 情况 二 恶意 软件 blindingcan 在上 一部分 我们 介绍 了 lazarus 在 网络 入侵 后 使用 的 一种 恶意 软件 可以 肯定 的 是 该 组织 使 用了 多种 类型 的 恶意 软件 其中 包括 cisa 最近 在其 报告 中 引入 的 blindingcan 接下来 我们 分析 blindingcan 的 攻击 流程 cisa 恶意 软件 分析 报告 arablindingcan 概述 当 加载 程序 加载 dll 文件 时 恶意 软件 就会 运行图 显示 了 blindingcan 运行 之前 的 事件 流 jpcertcc 已 确认 dll 文件 已在 某些 示例 中 编码 这 需 要在 执 行前 由 加载 程序 进行 解码 blindingcan 与 上述 恶意 软件 有 一些 相似之处 包括 其 功能 和 通信 编码 算法 下面 的 部分 将 解释 它 的 配置 和 通信协议 配置 的 配置 大小 xa 主要 存储 在 以下 位置 中 硬 编码 在 恶意 软件 本身 中 存储 在 注册 表项 中保 存为 文件 如果 将其 保存为 文件 则 将其 存储 在 blindingcan 所在 的 文件夹 中 我们 已经 确认 如果 配置 存储 在 注册 表项 中 则 使用 以下 目录 配置 使用 xor 编码 aes 或 rc 进行 加密 加密 密钥 是 固定 的 也 可以 根据 受 感染 设备 的 环境 生成 jpcertcc 已 确认 以下 加密 密钥 模式 下图 显示 了 解码 配置 的 示例 这 包括 代理 信息 以及 cc 服务器 信息 详细信息 请参阅 附录 混淆 中 的 某些 代码 部分 使用 rc 进行了 混淆 下图 是 混淆 代码 的 示例 rc 加密 密钥 在 示例 本身 中进 行了 硬 编码 cc 服务器 通信 下面 是 blindingcan 最初 发送 的 httppost 请求 数据 示例 数据格式 如下 除了 rc 密钥 所有 值 都是 rc 加密 和 base 编码 的 第一个 httppost 请求 中 的 param 是 字符串 tbdae 的 编码 值 post 数据 中 的 参数 paramparamparam 是 从 以下内容 中 随机 选择 的 此处 使用 的 rc 加密 与 常规 加密 不同 它有 一个 进程 来 将 密钥流 移动 ch 以下 是 用 python 编写 的 rc 加密 过程 它不 适用于 使用 常规 rc 的 param 下图 是 从 与 cc 服务器 通信 开始 到 接收 命令 的 通信 流程 如果 服务器 收到 一个 base 编码 的 param 值 上 图中 的 随机 二进制 数据 作为 对 第一个 请求 的 响应 则 恶意 软件 将 发送 另一个 请求 下一 数据 是 用 param 中 的 空 param 和 一个 命令 请求 上 图中 的 命令 请求 x 发送 的 param 中 的 数据 是 异 或 编码 rc 加密 然后 base 编码 此后 blindingcan 从 cc 服务器 接收 命令 响应 数据 也 经过 xor 编码 rc 加密 和 base 编码 唯一 的 区 别是 号 被 空格 代替 指令 blindingcan 执行 多种 功能 具体 如下 对 文件 的 操作 创建 列表 删除 移动 修改 时间 戳 复制 对 进程 的 操作 创建 列表 执行 终止 上传下载 文件 获取 磁盘 信息 获取 服务 列表 执行 任意 的 shell 命令 到目前为止 我们 已经 介绍 了 lazarus 使用 的 两种 恶意 软件 但是 已知 它们 也 使用 其他 类型 的 恶意 软件 如果 发现 任何 新型 恶意 软件 我们 将 提供 更新 三 总结 lazarusapt 是 来自 朝鲜 的 apt 组织 挺 厉害 和 出名 的 一个 攻击 组织 该 组织 擅长 使用 邮件 钓鱼 进行 鱼叉 攻击 同时 武器库 强大 具有 使用 day 发起 攻击 的 能力 而 从 披露 的 该 组织 的 活动 来看 该 组织 发起 攻击 的 规模 都 巨大 虽然 该 组织 的 攻击 活动 被 不断 的 披露 但是 该 组织 从未 停止 攻击 活动 的 脚步 相反 攻击 活动 还 更加 的 活跃 同时 还把 攻击 目标 不断扩大 从 能源 js 政企 等 部门 到 专项 金融机构 尤其是 数字 货币 交易所 等 因此 我们 提醒 政企 等 广大 用户 切勿 随意 打开 来历不明 的 邮件附件 同时 时 安装 安全 软件 最后 希望 这篇 文章 对 您 有所 帮助 更 推荐 大家 阅读 原文 前文 分享 译 apt 分析 报告 linux 系统 下 针对性 的 apt 攻击 概述 译 apt 分析 报告 钓鱼 邮件 网址 混淆 url 逃避 检测 译 apt 分析 报告 opblueraven 揭露 apt 组织 fincarbanak 上 tirion 恶意 软件 译 apt 分析 报告 kraken 新型 无 文件 apt 攻击 利用 windows 错误报告 服务 逃避 检测 译 apt 分析 报告 turla 新型 水坑 攻击 后门 netflash 和 pyflash 译 apt 分析 报告 猖獗 的 小猫 针对 伊朗 的 apt 攻击 活动 详 解译 apt 分析 报告 拉 撒 路 lazarus 使用 的 两款 恶意 软件 分析 年月 新开 的 娜 璋 ai 安全 之家 主要 围绕 python 大数 据分析 网络空间 安全 逆向 分析 apt 分析 报告 人工智能 web 渗透 及 攻防 技术 进行 讲解 同时 分享 ccfsci 南 核 北 核 论文 的 算法 实现 娜 璋 之家 会 更加 系统 并 重构 作者 的 所有 文章 从 零 讲解 python 和 安全 写了 近十年 文章 真心 想把 自己 所学 所 感 所做 分享 出来 还请 各位 多多指教 真诚 邀 请您 的 关注 谢谢 byeastmount 星期 四晚 上点 写 于 贵阳 