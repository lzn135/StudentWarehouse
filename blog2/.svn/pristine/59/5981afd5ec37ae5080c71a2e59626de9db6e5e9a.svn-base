mysql mgr 看着 很美 却又 为什么 不 敢用 前言 是什么 原因 不 敢上 mysqlmgr 什么 是 mysqlmgr 当我 在 群 里 说起 mysqlmgr 时 的确 还有 人 不知道 这是 啥 东东 有 群友 打趣 说 这是 美国人 卖狗肉 蒙古 人我 只 能说 你们 真的 都是 天才 言归正传 mysqlmgr 是 mysql 组 复制 的 简称 mgr 是 一种 基于 sharednothing 的 更 方便 实现 数据一致性 及 高 可用 集群 方案 此外 它还 支持 故障 自动检测 及 多 节点 并行 写 等 特性 它 由 一组 mysql 实例 构成 每个 实例 都有 一份 完整 的 数据 实例 间 通过 组 通讯 消息 系统 gcs 交互 通信 协同 gcs 可 保证 消息 的 原子 性 和 消息 在所 有 组成员 的 整体 顺序 一致 mgr 是 mysql 自带 的 一个 插件 plugin 可以 灵活 部署 它 要求 组 内 每个 mysql 实例 都要 基于 row 格式 的 binlog 并 开启 gtidmgr 架构图 如下 所示 主 要是 apis 层 组件 层 复制 协议 模块 层 和 gcsapipaxos 引擎 层 构成 事务 从 server 层 经过 mgr 的 apis 接口 层 分 发到 组件 层 组件 层 去 capture 事务 相关 信息 然后 经过 复制 协议 层 进行 事务 传输 最后 经过 gcsapipaxos 引擎 层 保证 事务 在 各个 节点 数据 最终 一致性 mgr 具备 以下 技术 特点 mgr 是 基于 paxos 协 议和 原生 复制 的 分布式 集群 多数 节点 同意 即可以 通过 事务 提议 proposed 实现 数据一致性 具备 高 可用 自动 故障 检测 功能 可 自动 切换 可 弹性 扩展 集群 自动 的 新增 和 移除 节点 集群 最多 接入 个 节点 有 单 主和 多 主模式 支持 多 节点 写入 具备 冲突 检测 机制 可以 适应 多种 应用 场景 需求 mysqlmgr 是 在年 就 已经 首次 出现在 mysql 版本 中 至今已有 多年 仍在 不断 成熟 完善 中一 个 反 直觉 的 事 实是 其实 国内 已有 数个 大中型 银行 上线 mysqlmgr 当然 了 现阶段 还 不是 应用在 非常 核心 的 系统 上 此外 亦有 不少 其他 传统 企业 也 在 尝试 使用 mgr 更 别 说是 互联网 企业 了 更是 走在 尝鲜 的 的 前列 哦 对了 oracle 公有 云 上 的 mysql 高 可用 版本 据称 也是 用 mgr 架构 的 为什么 不 敢上 mgr 虽然 知道 mgr 有 这么多 好处 而且 也有 大胆 的 同 行在 使 用了 但 还有 不少人 表示 不放心 不太 敢 正式 上线 大家 到底在 担心 什么 呢 从 平时 和 大家 交流 的 反馈 来看 大家 主要 关切 的 有 以下几点 第一 需求 不 强烈 对于 已经 用 惯了 mysql 传统 异步 复制 以及 后来 的 半 同步 复制 增强 半 同步 复制 再 配合 其他 第三方 的 高 可用 工具 套件 已经 可以 满足 绝大多数 场景 下 的 需求 所以 大家 并不 急着 用上 mgr 还想 继续 观望 第二 对 新事物 的 恐惧 虽说 mgr 也 发布 数年 了 但 相对于 上述 提到 的 传统 复制 功能 其 架构 的 复杂性 以及 现存 bug 的 数量 都说 明了 mgr 还是 不够 成熟 起码 还 没到 足以 让 大家 安心 上线 的 阶段 此外 由于 mgr 的 架构 复杂性 也 使得 大家 在 使用过程中 遇到问题 时 如果 想 要向 官方 报告 却 苦于 难以 复现 问题 场景 等 客观因素 也 打击 了 用户 的 信心 我们 从 mysql 官方 bug 库 搜到 关于 mgr 的 bug 数量 居然 只有 区区 个 很难说 是不是 因为 复现 太难 导致 无法 报告 另外 这 其中 只有 个 是 active 状态 个人认为 这个 数据 是 不太 可信 的 我 也 查 找了 innodb 和 传统 复制 的 bug 数 作为 参照 第三 生态 不成熟 上面 我们 说到 之所以 大家 还在 坚守 传统 复制 是因为 已有 大量 第三方 工具 打 配合 就可以 满足 大部分 业务 需求 了 而 可以 和 mgr 配合 的 第三方 工具 生态 还 不够 完善 除了 mysql 官方 的 innodbcluster 套件 之外 几乎没有 随手 拿来 就能 用于 构建 整套 高 可用 架构 的 解决方案 想要 线上 更大 规模 使用 mgr 还需 要有 足够 的 生态建设 才 行 第四 mgr 还 不够 可靠 从 各方面 多个 渠道 反馈 的 情况 来看 大家 在 测试 及 使用 mgr 的 过程中 或多或少 都 出现异常 宕机 事务 挂起 节点 异常 退出 性能 抖动 等 大大 小小的 问题 mgr 现阶段 给 大家 的 感觉 还是 不那么 可靠 令人 放心 不过 我们 参考 并行复制 的 进程 也是 一开始 从 database 级别 并行 再到 事务 级别 并行 现在 又 支持 writeset 并行 都有 个 先 从到 再 从到 的 过程 这些 都是 必经之路 mgr 还有 一段路 需 要走 写在 后面 任何 新事物 被 大众 所 接受 都要 有 个 过程 大多数人 也 会 习惯性 批判 新事物 因为 能看懂 的 毕竟 还是 少数 是 时候 再 温习 下 mysql 官方 的 产品 计划 路线图 了 以此 加强对 mgr 的 信心 此外 最近 业界 发布 的 greatsql 也 给了我 们 更多 上线 起码 进一步 试用 mgr 的 信心 greatsql 是 源于 perconaserver 的 分支 版本 除了 perconaserver 已有 的 稳定 可靠 高效 管理 更 方便 等 优势 外 特别是 进一步 提 升了 的 性 能及 可靠性 以及 众多 bug 修复 还有 我 也 想 趁 这个 机会 了解 大家 在 使用 mgr 过程中 遇到 哪些 问题 痛 点 或者 希望 mgr 在 哪些方面 做出 改善 可以 识别 下方 二维码 或 点击 文末 阅读 原文 链接 填写 问卷 延伸 阅读 greatsql 打造 更好 的 mgr 生态 greatsqlmgr 优化 参考 