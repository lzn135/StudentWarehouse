系统安全 二十三 逆向 分析 之 ollydbg 动态 调试 复习 及 traceme 案例 分析 您 可能 之前 看到过 我 写 的 类似 文章 为什么 还要 重复 撰写 呢 只是 想 更好 地 帮助 初学者 了解 病毒 逆向 分析 和 系统安全 更加 成 体系 且不 破坏 之前 的 系列 因此 我 重新 开 设了 这个 专栏 准备 系统 整理 和 深入 学习 系统安全 逆向 分析 和 恶意代码 检测 系统安全 系列 文章 会 更加 聚焦 更加 系统 更加 深入 也是 作者 的 慢慢 成长史 换 专业 确实 挺 难 的 逆向 分析 也是 块 硬骨头 但我 也 试试 看看 自己 未来 四年 究竟 能 将它 学到 什么 程度 漫漫 长征路 偏向虎山行 享受 过程 一起 加油 作者 前文 介绍 了 微软 证书 漏洞 cve 并 讲解 ecc 算法 windows 验证 机制 复现 可执行文件 签名 证书 的 例子 这篇 文章 将 详细 讲解 逆向 分析 ollydbg 动态 调试 工具 的 基本 用法 包括 界面 介绍 常用 快捷键 和 traceme 案例 分析 这些 基础 性知识 不仅 和 系统安全 相关 同样 与 我们 身边 常用 的 软件 文档 操作系统 紧密联系 希望 这些 知识 对 您 有所 帮助 更 希望 大家 提高 安全意识 安全 保障 任重道远 本文 参考 了 b 站 漏洞 银行 安全 网站 和 参考文献 中 的 文章 详见 参考文献 并 结合 自己 的 经验 和 实践 进行 撰写 在此 感谢 这些 大佬 们 文章 目录 一 ollydbg 界面 介绍 和 配置 二 常用 快捷键 三 ollydbg 动态 爆破 软件 演示 四 总结 从 年月 开始 我 来 到了 一个 陌生 的 专业 网络空间 安全 初 入 安全 领域 是 非常 痛苦 和 难受 的 要 学 的 东西 太多 涉及面 太 广 但 好在 自己 通过 分享 篇 网络安全 自学 系列 文章 艰难 前行 着 感恩 这一 年 相识 相知 相 趣 的 安全 大佬 和 朋友们 如果 写得 不好 或 不足之处 还请 大家 海涵 接下来 我 将 开启 新 的 安全 系列 叫 系统安全 也是 免费 的 篇文章 作者 将 更加 深入 的 去 研究 恶意 样本 分析 逆向 分析 内网 渗透 网络 攻防 实战 等 也 将 通过 在线 笔记 和 实践 操作 的 形式 分享 与 博 友 们 学习 希望 能与 您 一起 进步 加油 推荐 前文 网络安全 自学 篇 系列 篇 作者 的 github 资源 逆向 分析 网络安全 前文 分析 系统安全 一 什么 是 逆向 分析 逆向 分析 基础 及 经典 扫雷 游戏 逆向 系统安全 二 如何 学好 逆向 分析 及 吕布 传 游戏 逆向 案例 系统安全 三 idapro 反汇编 工具 初识 及 逆向 工程 解密 实战 系统安全 四 ollydbg 动态 分析 工具 基础 用法 及 crakeme 逆向 系统安全 五 ollydbg 和 cheatengine 工具 逆向 分析 植物 大战 僵尸 游戏 系统安全 六 逆向 分析 之 条件 语句 和 循环 语句 源码 还原 及 流程 控制 系统安全 七 逆向 分析 之 pe 病毒 原理 c 实现 文件 加解密 及 ollydbg 逆向 系统安全 八 windows 漏洞 利 用之 cve 复现 及 蓝屏 攻击 系统安全 九 windows 漏洞 利 用之 ms 远程 代码 执行 漏洞 复现 及 深度 提 权 系统安全 十 windows 漏洞 利 用之 smbv 服务 远程 代码 执行 漏洞 cve 复现 系统安全 十一 那些 年 的 熊猫 烧香 及 pe 病毒 行为 机理 分析 系统安全 十二 熊猫 烧香 病毒 ida 和 od 逆向 分析 上 病毒 初始化 系统安全 十三 熊猫 烧香 病毒 ida 和 od 逆向 分析 中 病毒 释放 机理 系统安全 十四 熊猫 烧香 病毒 ida 和 od 逆向 分析 病毒 释放 过程 下 系统安全 十五 chrome 浏览器 保留 密码 功能 渗透 解析 蓝屏 漏洞 及 某 音乐 软件 漏洞 复现 系统安全 十六 pe 文件 逆向 基础知识 pe 解析 pe 编辑 工具 和 pe 修改 系统安全 十七 windowspe 病毒 概念 分类 及 感染 方式 详解 系统安全 十八 病毒 攻防 机理 及 winrar 恶意 劫持 漏洞 脚本 病毒 自启动 定时 关机 蓝屏 攻击 系统安全 十九 宏病毒 之 入门 基础 防御 措施 自发 邮件 及 apt 宏 样本 分析 系统安全 二十 pe 数字签名 之 上 什么 是 数字签名 及 signtool 签名 工具 详解 系统安全 二十一 pe 数字签名 之 中 工具 用法 系统安全 二十二 pe 数字签名 之 下 微软 证书 漏洞 cve 复现 及 windows 验证 机制 分析 系统安全 二十三 逆向 分析 之 ollydbg 动态 调试 复习 及 traceme 案例 分析 声明 本人 坚决 反对 利用 教学方法 进行 犯罪 的 行为 一切 犯罪行为 必将 受到 严惩 绿色 网络 需要 我们 共同 维护 更 推荐 大家 了解 它们 背后 的 原理 更好 地 进行 防护 该 样本 不会 分享 给 大家 分析 工具 会 分享 参考文献 见 后 一 ollydbg 界面 介绍 和 配置 ollydbg 是 一个 动态 追踪 工具 将 ida 与 softice 结合起来 的 思想 ring 级 调试器 非常 容易 上手 是 当今 最为 流行 的 调试 解密 工具 之一 它还 支持 插件 扩展 功能 是 目前 最 强大 的 调试 工具 之一 od 和 ida 可以说是 逆向 分析 的 倚 天和 屠龙 一个 动态 分析 一个 静态 分析 该 系列 文章 参考 b 站 漏洞 游戏 逆向 交流 大佬 的 视频 主要内容 包括 ollydbg 界面 介绍 和 配置 常用 快捷键 ollydbg 基本 操作 常用 断点 int 断点 原理 解析 int 断点 的 反 调试 与 反反 调试 常用 断点 之 硬件 断点 原理 解析 常用 断点 之 内存 断点 原理 解析 常用 断点 之 消息 断点 原理 解析 常用 断点 之 条件 断点 原理 解析 内存 访问 一次性 断点 和 条件 记录 断点 插件 runtrace 和 hittrace 调试 符号 ollydbg 的 常见问题 推荐 大家 学习 参考 网址 是 逆向 分析 常用 的 调试 工具 打开 主 界面 如 下图 所示 包括 反汇编 窗口 寄存器 窗口 信息 窗口 数据 窗口 堆栈 窗口 常见 动态 调试 工具 常用 静态 调试 工具 ida 如果 我们 打开 的 界面 很乱 像 下图 一样 可以 点击 顶部 快捷键 c 然 后主 窗口 最大化 即可 优化 布局 接着 随便 打开 一个 exe 程序 显示 如 下图 所示 下面 先 讲解 各个 窗口 的 含义 反汇编 窗口 显示 被 调试程序 的 反汇编 代码 包括 地址 hex 数据 反汇编 注释 寄存器 窗口 显示 当前 所选 线程 的 cpu 寄存器 内容 点击 标签 可 切换 显示 寄存器 的 方式 信息 窗口 显示 反汇编 窗口 中 选中 的 第一个 命令 的 参数 及 跳转 目标 地址 字符 等 数据 窗口 显示 内存 或 文件 的 内容 右键 菜单 可 切换 显示 方式 堆栈 窗口 显示 当前 线程 的 堆栈 记录 传递 的 参数 或 局部变量 子 窗口 的 快捷方式 接着 补充 界面 选项 知识点 点击 选项 gt 界面 设置 udd 路径 和 插件 路径 udd 路径 用于 保存 我们 调试 的 信息 插件 路径 包 含了 各种 插件 并且 可以 直接 使用 如果 你想 选中 一个 exe 文件 右键 直接 能 够用 ollydbg 打开 怎么 设置 呢 点击 选项 gt 添加到 浏览器 添加 ollydbg 到 系统资源 管理器 菜单 如果 我们 每次 运行 od 都 提示 管理员 权限 运行 则 可以 进行 快捷键 简单 的 设置 设置 方式 如下 兼容性 中 选择 以 管理员 身份 运行 此 程序 二 常用 快捷键 下面 简单 讲解 常用 的 快捷键 调试 方式 f 设置 断点 设置 断点 只 要在 光标 定位 的 位置 按 下 f 键 即可 再按 一次 f 键 会 删除 断点 如 下图 所示 的 红色 位置 程序 运行 到 此处 会 暂停 f 运行 按 下 f 键 运行 程序 如果 没有 设置 相应 的 断点 被 调试 的 程序 直接 开始 运行 f 单 步步 过 单 步步 过 每 按 一次 这个 按键 将 执行 反汇编 窗 口中 的 一条 指令 遇到 call 等子 程序 不 进入 其 代码 f 单步 步入 单步 步入 功能 通 单 步步 过 f 类似 区 别是 遇到 call 等子 程序 时会 进入 其中 进入 后 首先 停留在 子程序 的 第一条 指令 上 如 下图 进入 call 子程序 call 表示 进入 函数 retn 表示 返回 f 运行 到 选定 位置 运行 到 选定 位置 作用 就是 直接 运行 到 光标 所在位置 处 暂停 比如 光标 在 x 位置 我们 接着 从 x 运行 这会 直接 跳 转到 光标 处 当 我们 调试 过程中 遇到 循环 可以 调至 光标 跳过 循环 ctrlf 执行 到 返回 执行 到 返回 按 下 此键 会 执行 到 一个 返回 指令 时 暂停 常 用于 从 系统 领空 返回 到 我们 调试 的 程序 领 空在 调试程序 时 按 下 ctrlf 会 一直 运行 程序 直到 一个 return 返回 比如 我们 进入 下图 所示 的 子程序 会 运 行至 retn 再在 retn 位置 按 下 f 则会 返回 如 下图 所示 的 位置 执行 完 call 函数 进入 下一 句 ctrlf 重新开始 当 程序 想 重新 调试 时 按 下 ctrlf 即可 altf 执行 到 用户 代码 执行 到 用户 代码 从 系统 领空 快速 返回 我们 调试 的 程序 领空 三 ollydbg 动态 爆破 软件 演示 下面 以 加密 与 解密 的 tracemeexe 程序 为 例 程序 下载 地址 当 我们 输入 错误 的 用户名 和 序列号 点击 check 按钮 会 显示 输入 错误 接下来 我们 需要用 od 爆破 该 程序 的 基本 流程 如 下图 所示 只有 输入 正确 的 用户名 和 序列号 才能 显示 正确 对话框 接着 通过 od 打开 该 程序 它会 自动 定位 到 模块 入口 点 xa 位置 作者 github 资源 提供 了 各种 od 版本 供 读者 使用 第一步 首 先按 下 f 程序 就会 运行 起来 并且 弹出 对话框 第二步 我们 需要 知道 输入 对话框 输入 值 的 函数 都有 哪些 点击 api 断点 设置 工具 gt 常用 断点 设置 勾 选 获取 对话框 的 输入 值 的 两个 函数 getwindowtexta 和 getdlgitemtexta 这 意味着 给 这两个 函数 下 断点 当 程序 运行 到 某个 函数 即 会 停止 如果 读者 不确定 对应 的 函数 可以 勾 选 所有 的 函数 第三步 输入 用户名 和 序列号 并 点击 check 按钮 此时 程序 进入 xca 位置 并且 显示 调用 getdlgitemtexta 函数 我们 先按 下 f 将 断点 去掉 再按 下 f 执行 代码 可以 看到 序列号 错误 再来 一次 的 弹 框 从而 证明 我们 刚才 的 断点 是 有 效果 的 getdlgitemtexta 的 四个 参数 对话框 句柄 控件 标识 id 号 缓冲区 指针 缓冲区 最大 字符 数 参考 winapi 手册 接着 我们 再 勾 选 getdlgitemtexta 函数 再 点击 check 按钮 它会 继续 定位 到 xca 位置 如 下图 所示 第四步 接着 按 下 ctrlf 执行 到 返回 位置 此时 显示 地址 xcac 第五步 再按 下 f 键 执行 返回 此时 我们 看到了 getdlgitemtexea 函数 执行 的 位置 它会 返回 调用 函数 的 下一 行 代码 注意 是 下一 行 我们 程序 是 有 两个 对话框 值 所以 会有 两个 getdlgitemtexea 函数 的 调用 接着 我们 继续 按 f 往下走 这两个 值 获取 完成 接下来 应该 会是 计算 序列 的 过程 再 进行 判断 是否 正确 继续 往下走 来到 xe 位置 我们 可以 看到 右上角 edx 和 eax 的 值 就是 我们 输入 的 eastmount 和 同时 右下角 显示 两个 值 都 已经 压到 栈 里面 了 eaxedxeastmount 第六步 访问 traceme 函数 我们 可以 猜测 调用 的 calltraceme 函数 是 做 判断 并 添加 如下 注释 但也 可能 不是 我们 在 进行 软件 逆向 分析 或 爆破 时 通常 需要 依靠 逻辑 能力 和 编程 能力 来 推测 按 下 f 进入 该 程序 位置 x 再按 f 执行 可以 发现 这里 存在 一个 循环 判断 输入 的 值 是否 与它 原始 的 值 一致 循环 完 之后 继续 执行 可以 看到 一些 序列号 的 判断 信息 最终 终 它会 返回 一个 值 放到 eax 中 该 值 等于 然后 继续 执行 返回 该 值 返回值 就是 然后 继续 执行 第七步 跳转 函数 分析 如果 这个 函数 就是 判断 函数 的话 那么 下面 这个 跳转 很可能 就是 关键 跳转 就是 我们 需要 修改 的 跳转 利用 其 来 进行 爆破 位置 xf 增加 断点 接着 按 f 继续 运行 发现 其 直接 跳 转至 xe 然后 提示 序列号 错误 再来 一次 再按 下 f 运行 后面 果然 弹出 错误 对话框 从而 确定 上面 为 关键 跳转 第八 步 按 下 ctrlf 重新 运行 程序 接着 按 f 执行 程序 在 弹出 的 对话框 中 输入 内容 点击 check 继续 按 下 f 运行 程序 跳转 到 我们 刚刚 下 断点 的 关键 跳转 位置 关键步骤 修改 汇编 代码 je 是 实现 跳转 修 改为 jnz 不 跳转 继续 按 f 执行 或者 直接 按 下 f 可以 提示 恭喜 你 成功 的 对话框 这 就是 爆破 的 基本 流程 第九步 保存 爆破 软件 选择 修改 的 几行 内容 然后 右键 鼠标 点击 复制到 可执行文件 选择 tracemeexe 文件 右键 保存 文件 如 tracemepoexe 保存 成功 后 随便 输入 用户名 和 序列号 都 提示 成功 同时 该 程序 输入 长度 还有 一个 判断 我们 也 可以 尝试 进行 爆破 但 其 原理 是什么 呢 后续 的 文章 我们 会 继续 介绍 四 总结 写到 这里 这篇 文章 就 介绍 完毕 希望 您 喜欢 ollydbg 界面 介绍 和 配置 常用 快捷键 ollydbg 动态 爆破 软件 演示 这篇 文章 中 如果 存在 一些 不足 还请 海涵 作者 作为 网络安全 初学者 的 慢慢 成长 路 吧 希望 未来 能 更 透彻 撰写 相关 文章 同时 非常感谢 参考文献 中 的 安全 大佬 们 的 文章 分享 感谢 师傅 师兄 师弟 师姐 师妹 们 的 教导 深知 自己 很菜 得 努力 前行 欢迎 大家 讨论 是否 觉得 这 系列 文章 帮助 到 您 任何 建议 都可以 评论 告知 读者 共勉 逆向 分析 网络安全 年月 新开 的 娜 璋 ai 安全 之家 主要 围绕 python 大数 据分析 网络空间 安全 人工智能 web 渗透 及 攻防 技术 进行 讲解 同时 分享 ccfsci 南 核 北 核 论文 的 算法 实现 娜 璋 之家 会 更加 系统 并 重构 作者 的 所有 文章 从 零 讲解 python 和 安全 写了 近十年 文章 真心 想把 自己 所学 所 感 所做 分享 出来 还请 各位 多多指教 真诚 邀 请您 的 关注 谢谢 byeastmount 中午 点 写 于 武汉 参考资料 动态 调试 工具 之 ollydbg od 教程 b 站 yxfzedu 逆向 笔记 od 工具 使用 逆向 tracemeexebdw 随手 笔记 加密 与 解密 段 钢 等 著 ollydbg 入门教程 看 雪 学院 ccdebuger 个 crackme 鬼 手 大佬 