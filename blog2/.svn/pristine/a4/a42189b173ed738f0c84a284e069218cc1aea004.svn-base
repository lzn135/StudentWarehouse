第 十 一章 sql server2019 数据库 之 多表 连接 目录 一 知识点 补充 空 值 null 判断 二 内 连接 三 外 连接 四 其他 连接 五 组合 查询 学前 必备 知识 第一章 sqlserver 数据库 环境 搭建 与 使用 第二章 sqlserver 数据库 的 基本 使 用之 图形化 界面 操作 第三章 sqlserver 数据库 之 开启 sql 语言 之旅 第四章 sqlserver 数据库 之 综合 案例 练习 使用 sql 语句 插入 数据 更 新和 删除 数据 第五章 sqlserver 数据库 之 综合 案例 练习 开启 select 语句 之旅 第六章 sqlserver 数据库 之 select 语句 的 深入 使用 第七章 sqlserver 数据库 之 单 表 查询 综合 练习 及 select 语句 的 进阶 使用 第八章 sqlserver 数据库 之 分组 统计 groupby 第九章 sqlserver 数据库 之 简 单子 查询 第十章 sqlserver 数据库 之 多行 子 查询 sql 最 强大 的 功能 之一 就是在 查询 数据 时 能够 连接 多个 表 在 sql 查询 语 句中 连接 是 非常重要 的 操作 通过 连接 可以 实现 更多 更 复杂 的 查询 本章 将 会对 sql 中 的 多表 连接 和 组合 查询 进行 介绍 其中 主要 包括 内 连接 外 连接 自 连接 和 组合 查询 等 通过 对 本章 的 学习 读者 将会 对 比较复杂 的 数据 查询 有 更 深入 的 了解 本章 需要 的 数据库文件 下载 地址 如下 数据库 源文件 及 日志 文件 一 知识点 补充 空 值 null 判断 空 值 从技术上 来说 就是 未知 的 值 但 空 值 并不 包括 零一个 或者 多个 空格 组成 的 字符串 以及 零 长度 的 字符串 在 实际 应用 中空 值 说明 还没有 向 数据库 中 输入 相应 的 数据 或者 某个 特定 的 记录 行 不需要 使用 该 列 在 实际 的 操作 中 下列 几种 情况 可使 一列 成为 空 值 其 值 未知 例如 课程表 中 不明确 具体 的 课程内容 其 值 不存在 例如 在学生 表 中 某个 学生 由于 没有 参加考试 所以 该 学生 的 考试成绩 为 空 值 列 对表 行 不可用 本节 将 对空 值 的 查询 转 换为 有效值 等 操作 进行 详细 的 介绍 查询 空 值 isnull 在 表 中有 可能会 出现 空 值 由于 空 值 是 未知 的 值 在对 其 进行 查询 时 不可以 像 查询 其他 值 那样 使用 比较 或 运算 等 例 如在 查询 某 列 是否 存在 空 值 时 不可以 使用 where 列名 null 这种 写法 这种 写法 是 不正确 的 此时 可以 使用 isnull 操作符 对空 值 进行 查询 isnull 操作符 可以 查询 出 某 列 中所 有的 空 值 示例 在 users 用户 信息 表 中 查询 出 昵称 nickname 为 空 值 的 用户 id userid 注册 邮箱 email 和 昵称 nickname sql 语句 如下 查询 结果 如 下图 所示 查询 非 空 值 notnull 在 查询 空 值 时 可以 使用 isnull 操作符 而在 查询 非 空 值 时 可以 使用 isnotnull 操作符 来 实现 示例 在 users 用户 信息 表 中 查询 出 昵称 nickname 不为 空 值 的 用户 id userid 注册 邮箱 email 和 昵称 nickname sql 语句 如下 查询 结果 如 下图 所示 对空 值 进行 处理 在 实际使用 数据表 中 的 数据 时 通常 需 要将 空 值 转 换为 一个 有效 的 值 以 便于 对 数据 的 理解 或者 防止 表达式 出错 sql 提供 了 几个 专门 用来 处理 空 值 的 函数 isnull 函数 可以 将 空 值 转 换为 有效 的 值 而 nullif 函数 可以 根据 指定 的 条件 来 生成 空 值 下面 通过 几个 示例 演示 如何 对空 值 进行 处理 示例 在 零 基础 系列 图书 信息 表 中 查询 所有 图书 名称 bookname 图书 作者 writer 并将 新书 newbook 列 中 的 所 有空 值 转 换为 有效值 sql 语句 如下 newbook 示例 在 user 用户 信息 表 中 查询 所有 的 用户 id userid 注册 邮箱 email 和 昵称 nickname 并将 昵称 列 中 的 andy 转 换为 nullsql 语句 如下 nicknameandy 数据库 练习 查询 学生 选 课表 stucou 中 随机数 为 空 的 课程 信息 二 内 连接 内 连接 就是 使用 比较 运算符 进行 表 与 表 之间 列 数据 的 比较 操作 并 列出 这些 表 中 与 连接 条件 相匹配 的 数据 行内 连接 可以 用来 组合 两个 或者 多个 表 中 的 数据 如 下图 所示 在内 连接 中 根据 使用 的 比较 方式 不同 可以 将 内 连接 分为 以 下种 等值 连 接在 连接 条件 中 使用 等于 运算符 比较 被 连接 的 列 不 等值 连 接在 连接 条件 中 使用 除了 等于 运算符 以外 的 其他 比较 运算符 比较 被 连接 的 列 自然 连接 它是 等值 连接 的 一种 特殊情况 用来 把 目标 中 重复 的 属性 列 去掉 等值 连接 等值 连接 是 指在 连接 条件 中 使用 运算符 比较 被 连接 的 列 在 连接 条件 中 的 各个 连接 列 的 类型 必须 是 可比 的 但不 一 定是 相同 的 例如 可以 都是 字符 型 或者 都是 日期 型 也 可以 一个是 整型 一个是 实型 因为 它们 都是 数值 型 虽然 连接 条件 中 各 列 的 类型 可以 不同 但是在 应用 中 最好 还是 使用 相同 的 类型 因为 系统 在 进行 类型 转换 时 要花费 很多 时间 示例 在 goods 商品信息 表 和 goodstype 商品 类型 表 中 通过 等值 连接 查询 每个 商品 的 商品 id goodsid 商品名称 goodsname 和 商品 所属 类型 name sql 语句 如下 查询 结果 如 下图 所示 说明 where 子句 作为 过滤 条件 是 非常重要 的 在 关系 数据库 中表 就是 一个 联合 当 从 两个 或 多个 表 中 查询 数据 时 如果 没有 指定 条件 那么 这种 查询 结果 就是 笛卡尔 乘积 笛卡尔 乘积 就是 从 多个 表 中 提取 数据 时 在 where 子 句中 没有 指定 多个 表 的 公共关系 例如 a 表 中有 m 条 记录 b 表 中有 n 条 记录 其 笛卡儿 乘积 是 mn 条 记录 显然 这不是 我们 想要 的 因此 要 保证 所有 连接 都有 where 子句 对于 等值 连接 还可 以 使用 一种 特定 的 语法 明确 指定 连接 的 类型 具体 语法 如下 参数 说明 fieldlist 要 查询 的 列 将 table 表 与 table 表 进行 内部 连接 表 中 与 table 表 中被 连接 的 列 例如 下面 的 select 语句 返回 与 示例 完全相同 的 数据 sql 语句 如下 在 使用 这种 语法 时 连接 条件 用 特定 的 on 子句 而 不是 where 子句 传 递给 on 的 连接 条件 和 传 递给 where 的 连接 条件 相同 不 等值 连 接在 sql 中 既 支持 等值 连接 也 支持 不 等值 连接 不 等值 连接 是 指在 连接 条件 中 使用 除了 等于 运算符 以外 的 其他 比较 运算符 比较 被 连接 的 列 值 可以 使用 的 运算符 包括 gtgtltltgtlt 和 ltgt 示例 在 goods 商品信息 表 和 goodstype 商品 类型 表 中 通过 不 等值 连接 查询 商品 类型 不是 平板 电脑 的 商品 id goodsid 和 商品名称 goodsname sql 语句 如下 平板 电脑 自然 连接 自然 连接 是 等值 连接 的 一种 特殊 形式 如果是 按照 两个 表 中 的 相同 属性 进行 等值 连接 且 目标 中 去除 重复 的 列 保留 所有 不 重复 的 列 则 可以 称之为 自然 连接 自然 连接 只有 在 两个 表 中有 相同 名称 的 列 且 列 的 含义 相似 时 才能 使用 示例 在 users 用户 信息 表 和 useraddress 用户 地址 表 中 通过 自然 连接 查询 用户 的 用户 id userid 用户 地址 address 和 最后 登录 时间 lastlogin sql 语句 如下 varchar lastlogin 查询 结果 如 下图 所示 使用 带 聚合 函数 的 内 连接 聚合 函数 用来 汇总 数据 前面 使用 聚合 函数 的 例子 都是 从一 个 表 中汇 总 数据 但是 这些 函数 也 可以 和 连接 一起 使用 示例 在 goodscategory 商品 分类 和 goods 商品信息 表 中 通过 内 连接 查询 商品 分类 id id 商品 分类 名称 name 和 对应 商品 的 数量 sql 语句 如下 bcatid 查询 结果 如 下图 所示 连接 多个 表 sql 不会 限制 一条 select 查询 语 句中 可以 连接 的 表 的 数量 在 创建 多个 表 的 连接 查询 时 首先 定义 要 查询 的 列 然后 通过 各个 表 之间 的 关系 定义 连接 条件 示例 在 goods 商品信息 表 brand 商品 品牌 表 和 goodstype 商品 类型 表 中 通过 内 连接 查询 商品 的 商品 id goodsid 商品名称 goodsname 商品 品牌 name 和 商品 类型 name sql 语句 如下 查询 结果 如下 注 意在 使用 中 如果 为 表 指定 了 别名 那么 在 该 sql 语 句中 对 该 表 的 所有 显 式 引用 都必须 使用 别名 而 不能 使用 表 名 如果 连接 中 的 多个 表 中有 相同 名称 的 列 存在 要求 必须 使用 表 名 或 别名 来 限定 列名 表 名 列名 三 外 连接 通过 内 连接 可以 返回 所有 满足 连接 条件 的 记录 而 有时 则 需要 显示 表 中 的 所有 记录 包括 那些 不符合 连接 条件 的 记录 此时 就需要 使用 外 连接 使用 外 连接 可以 方便地 在 连接 结果 中 包含 某个 表 中 的 其他 记录 外 连接 的 查询 结果是 内 连接 查询 结果 的 扩展 外 连接 一个 显著 的 特点 就是 将 某些 不满足 连接 条件 的 数据 也 在 连接 结果 中 输 出外 连接 以 指定 的 数据表 为 主体 将 主 体表 中 不满足 连接 条件 的 数据 也 一并 输出 根据 外 连接 保存 下来 的 行 的 不同 可以 将 外 连接 接 分为 以 下种 连接 左 外 连接 表示 在 结果 中 包括 左 表 中 不满足 条件 的 数据 右 外 连接 表示 在 结果 中 包括 右 表 中 不满足 条件 的 数据 全 外 连接 表示 在 结果 中 包括 左 表 和 右 表 中 不满足 条件 的 数据 在 连接 语 句中 join 关键字 左边 的 表示 左 表 右边 的 表示 右 表 左 外 连接 左 外 连接 保 留了 第一个 表 的 所有 行 但 只 包含 第二个 表 与 第一个 表 匹配 的 行 第二个 表 的 相应 空行 被 放入 null 值 左 外 连接 的 语法 如下 示例 在 goods 商品信息 表 和 goodstype 商品 类型 表 中 通过 左 外 连接 查询 每个 商品 的 商品 id goodsid 商品名称 goodsname 和 商品 所属 类型 name sql 语句 如下 查询 结果 如 下图 所示 右 外 连接 右 外 连接 保 留了 第二个 表 的 所有 行 但 只 包含 第一个 表 与 第二个 表 匹配 的 行 第一个 表 的 相应 空行 被 放入 null 值 右 外 连接 的 语法 如下 示例 在 goods 商品信息 表 和 goodstype 商品 类型 表 中 通过 右 外 连接 查询 每个 商品 的 商品 id goodsid 商品名称 goodsname 和 商品 所属 类型 name sql 语句 如下 查询 结果 如 下图 所示 说明 左 外 连接 和 右 外 连接 之间 唯一 的 区别 就是 所 关联 的 表 的 顺序 换句话说 通过 调整 from 子句 中表 的 顺序 就可 以使 左 外 连接 转 换为 右 外 连接 因此 这两种 外 连接 可以 互换 使用 全 外 连接 全 外 连接 是 将 两个 表 所有 的 行都 显示 在 结果 中 返回 的 结果 除 内 连接 的 数据 外 还 包括 两个 表 中 不符合 条件 的 数据 并在 左 表 或 右 表 的 相 应列 中 放入 null 值 全 外 连接 的 语法 如下 示例 在 goods 商品信息 表 和 goodstype 商品 类型 表 中 通过 全 外 连接 查询 每个 商品 的 商品 id goodsid 商品名称 goodsname 和 商品 所属 类型 name sql 语句 如下 查询 结果 如 下图 所示 通过 外 连接 进行 多表 联合 查询 示例 通过 左 外 连接 查询 多个 表 中 的 数据 信息 将 goods 商品信息 表 brand 商品 品牌 表 和 goodstype 商品 类型 表 中 的 数据 通过 左 外 连接 汇总 显示出来 其中 使 用了 两次 左 外 连接 查询 即 商品信息 表 与 商品 品牌 表 进行 左 外 连接 后 再与 商品 类型 表 进行 左 外 连接 将 商品信息 表 中 的 商品 id goodsid 商品名称 goodsname 和 商品 品牌 表 中 的 商品 品牌 name 以及 商品 类型 表 中 的 商品 所属 类型 name 全部 显示出来 sql 语句 如下 查询 结果 如 下图 所示 四 其他 连接 自 连接 自 连接 是 指 一个 表 同 自身 进行 连接 为了 更好 地 理解 自 连接 可以 把 一个 表 想象 成 两个 独立 的 表 而在 from 子句 中表 被 列 出了 两次 为了 区别 必须 给 每个 表 提供 一个 别名 来 区别 这两个 副本 示例 在 brand 商品 品牌 表 中 通过 自 连接 查询 与 oppo 是 同一 品牌 分类 的 所有 品牌 id id 品牌 名称 name 和 品牌 分类 名称 catname sql 语句 如下 查询 结果 如 下图 所示 在 上述 sql 语 句中 首先 找出 品牌 名 称为 oppo 所在 的 品牌 分类 然后再 找出 该 分类 下 的 所有 品牌 名称 交叉 连接 交叉 连接 是 两个 表 的 笛卡儿 乘积 的 另一个 名称 交叉 连接 会将 第一个 表 的 每 一行 与 第二个 表 的 每 一行 相匹配 这 导致 了 所有 可能 的 合并在 交叉 连接 中 的 列 是 原 表 中 列 的 数量 的 总和 相加 交叉 连接 中 的 行 是 原 表 中 的 行数 的 积 相乘 交叉 连接 的 操作 通过 crossjoin 关键字 来 完成 并且 忽略 on 条件 交叉 连接 的 语法 如下 示例 在 brand 商品 品牌 表 和 goods 商品信息 表 中 通过 交叉 连接 查询 品牌 名称 name 品牌 分类 名称 catname 和 商品名称 goodsname sql 语句 如下 五 组合 查询 组合 查询 通过 union 操作符 来 完成 使用 union 操作符 可以 执行 多个 select 查询 语句 并将 多个 查询 的 结果 作为 一个 查询 结果 集 返回 在 使用 union 操作符 时 应 注意 以下几点 使用 union 操作符 进行 组合 查询 必 须由 两个 或 两个 以上 的 select 语句 组成 语句 之间 用 union 关键字 分隔 要求 每个 select 语 句中 列 的 数目 必须 相同 而且 对应 位置 上 的 列 的 数据类型 必须 相同 或者 兼容 最后 结果 集中 的 列名 是 由 第一个 select 语 句中 的 列名 决定 的 说明 在 使用 union 进行 组合 查询 时 可 以对 一个 表 进行 多个 查询 也 可 以对 不同 的 表 进行 多个 查询 通过 union 合并 多个 结果 集 使用 union 操作符 进行 组合 查询 很简单 只需要 给出 每个 select 语句 并在 各个 语句 之间 加上 关键字 union 示例 在 goods 商品信息 表 中 首先 查询 商品 分类 id catid 为 和 的 所有 商品信息 然后 查询 商品名称 goodsname 包含 华为 的 所有 商品信息 并 对 两个 查询 结果 进行 合并 sql 语句 如下 华为 查询 结果 如 下图 所示 示例 在 bookinfo 图书 信息 表 中 查询 图书 价格 price 为 元 的 图书 信息 在 零 基础 系列 图书 信息 表 中 查询 图书 价格 price 为 元 的 图书 信息 并 对 两个 查询 结果 进行 合并 sql 语句 如下 查询 结果 如 下图 所示 通过 unionall 返回 重复 的 行在 示例 中 第一个 select 语句 的 查询 结果 返回 行 商品信息 第二个 select 语句 的 查询 结果 返回 行 商品信息 而在 应用 union 操作符 组合 查询 后 只 返回 行 商品信息 由此可见 使用 union 操作符 会 从 最后 的 结果 集中 自动 去除 重复 的 行 如果 希望 返回 重复 的 行 需要 使用 unionall 而 不是 union 示例 在 零 基础 系列 图书 信息 表 中 查询 图书 价格 price 为 元 和 出版日期 pdate 为 年月 的 所有 图书 信息 并 使用 unionall 对 两个 查询 结果 进行 合并 sql 语句 如下 年月 查询 结果 如 下图 所示 对 组合 查询 结果 进行 排序 在 使用 union 操作符 进行 组合 查询 时 查询 结果 将对 select 列表 中 的 列 按照 从左到右 的 顺序 自动 排序 在 使用 union 操作符 进行 组合 查询 时 只能 使用 一个 orderby 子句 而且 该 子句 必须 放在 最后 一个 select 语句 之后 所 使用 的 排序 列名 必须 是 第一个 select 语 句中 的 列名 示例 对 示例 中 返回 的 组合 查询 结果 按照 商品 的 本店 价格 shopprice 进行 排序 sql 语句 如下 华为 查询 结果 如 下图 所示 使用 xk 数据库 练习 查询 学生 表 student 和 班级 表 class 的 信息 使用 交叉 连接 查询 练习 查询 学生 基本信息 和 所在 班级 的 信息 练习 查询 学生 基本信息 和 学生 所在 班级 名称 练习 查询 学生 的 选课 信息 要求 显示 学号 姓名 课程 编号 课程名称 志愿 号 并按 照 学号 升序 排 列当 学号 相 同时 则 按照 志愿 号 升序 排列 练习 查询 学生 报名 计算机 应用 工程系 开设 的 选修 课程 情况 显示 信息 包括 学生 姓名 课程名称 和 教师 名 练习 查询 每个 班级 可以 选修 的 不是 自己 所在 部门 开设 的 选修 课程 的 信息 显示 信息 包括 班级 课程 名 课程 类别 学分 老师上课 时间 和 报名 人数 练习 查询 课程 类别 相同 但 开课 部门 不同 的 课程 信息 要求 显示 课程 编号 课程名称 课程 类别 和 部门 编号 并 按照 课程 编号 降序 排列 查询 结果 使用 student 数据库 练习 把 student 表 和 grade 表 左 外 连接 第 个 表 student 有 不满足 连接 条件 的 练习 把 grade 表 和 course 表 右 外 连接 第 个 表 course 有 不满足 连接 条件 的 行 练习 把 grade 表 和 course 表 实现 全 连接 两个 表 都有 不满足 连接 条件 的 本章 主要 介绍 了 sql 查询 语 句中 多表 连接 和 组合 查询 的 操作 通过 本章 的 学习 读者 可以 对内 连接 外 连接 自 连接 和 组合 查询 等 有 一定 的 了解 可以 实现 一些 更加 复杂 的 查询 操作 