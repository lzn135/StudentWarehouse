第十章 sql server2019 数据库 之 多行 子 查询 目录 一 使用 innotin 操作符 的 多行 子 查询 二 exists 子 查询 与 notexists 子 查询 三 通过 量词 实现 多行 子 查询 使用 量词 实现 多行 查询 使用 all 操作符 的 多行 子 查询 使用 anysome 操作符 的 多行 子 查询 学前 必备 知识 第一章 sqlserver 数据库 环境 搭建 与 使用 第二章 sqlserver 数据库 的 基本 使 用之 图形化 界面 操作 第三章 sqlserver 数据库 之 开启 sql 语言 之旅 第四章 sqlserver 数据库 之 综合 案例 练习 使用 sql 语句 插入 数据 更 新和 删除 数据 第五章 sqlserver 数据库 之 综合 案例 练习 开启 select 语句 之旅 第六章 sqlserver 数据库 之 select 语句 的 深入 使用 第七章 sqlserver 数据库 之 单 表 查询 综合 练习 及 select 语句 的 进阶 使用 第八章 sqlserver 数据库 之 分组 统计 groupby 第九章 sqlserver 数据库 之 简 单子 查询 多行 子 查询 通过 多行 比较 操作符 来 实现 其 返回值 为 多行 常用 的 多行 比较 操作符 包括 in 和 notinall 和 anysomeexists 和 notexists 操作符 本文 主要 介绍 这 几种 多行 比较 操作符 的 应用 一 使用 innotin 操作符 的 多行 子 查询 in 子 查询 是 指在 外层 查询 和 子 查询 之间 用 in 进行 连接 判断 某个 属性 列 是否 在 子 查询 的 结果 中 其 返回 的 结果 中 可以 包含 零个 或者 多个 值 在 in 子句 中子 查询 和 输入 多个 运算符 的 数据 的 区别 在于 使用 多个 运算符 输 入时 一般 都会 输入 两个 或者 两个 以上 的 数值 而 使用 子 查询 时 不能 确定 其 返回 结果 的 数量 但是 即使 子 查询 返回 的 结果 为 空语句 也 能 正常 运行 由于 在 子 查询 中 查询 的 结果 往往是 一个 集合 所以 in 子 查询 是 子 查询 中最 常用 的 in 子 查询 语句 的 操作 步骤 可以 分成 两步 执行 内部 子 查询 根据 子 查询 的 结果 再 执行 外层 查询 in 子 查询 返回 列表 中 的 每个 值 并 显示 任何 相等 的 数据 行 示例 获取 tbbook 图书 表 和 tbbookauthor 作者 表 中 具有 相同 部门 的 作者 所写 的 图书 信息 sql 语句 如下 查询 结果 如 下图 所示 子 查询 还可 以 用在 外层 查询 的 notin 子 句中 以 产生 notin 使用 的 清单 如果 外层 查询 中用 来 比较 的 数据 被 查询 出 与 子 查询 产生 的 结果 集中 的 所有 值 都不 匹配 那么 notin 子句 返回 true 然后 将该 记录 指定 列 的 值 输入 到 最终 的 结果 集中 示例 查询 在 tbbook 图书 表 中 列出 而在 tbbookauthor 作者 表 中 没有 列出 的 作者 所在 部门 的 图书 信息 sql 语句 如下 查询 结果 如 下图 所示 小结 tbbookauthor 作者 表 中 的 作者 部门 有 php 和 vc 通过 与 tbbook 图书 表 的 对比 发现 asp 和 sql 数据库 这两个 部门 在 tbbook 图书 表 中 列出 而在 tbbookauthor 作者 表 中 没有 列出 使用 notin 子 查询 的 查询 速度 很慢 在对 sql 语句 的 性能 有所 要求 的 时候 就要 使用性能 更好 的 语句 来 替代 notin 例如 可以 使用 外 连接 的 方式 替换 notin 以 提高 语句 的 执行 速度 一般来说 使用 notin 和 子 查询 的 语句 结构 更 容易 理解 和 编写 所以 只 在对 sql 语句 的 性能 有 要求 时 才 使用 外 连 接来 替换 notin 和 子 查询 联用 的 结果 练习 在 course 和 grade 表 中 查询 没有 学生 参加考试 的 课程 信息 练习 在 student 表 中 查询 课程 成绩 大于 分 的 学生 信息 二 exists 子 查询 与 notexists 子 查询 exists 子 查询 的 功能 是 判断 子 查询 的 返回 结果 中 是否 有 数据 行 如 果子 查询 返回 的 结果是 空集 则 判断 为 不存 在即 exists 失败 notexists 成功 如 果子 查询 返回 至少 一行 的 数据 记录 则 判断 存 在即 exists 成功 notexists 失败 由于 exists 子 查询 中 不需要 返回 具体 值 所以 该 子 查询 的 选择 列表 常用 select 格式 其 外层 的 where 子 句中 也 不需要 指定 列名 exists 通常 都 和 相 关子 查询 一起 使 用在 使用 相 关子 查询 时 对 外表 中 的 每 一行 子 查询 都要 运行 一遍 该行 的 值 也 要在 子 查询 的 where 子句 中被 使用 这样 通过 exists 子句 就 能将 外层 表 中 的 各行 数据 依次 与 子 查询 处理 的 内层 表 中 的 数据 进行 存在 性 比较 得到 需要 的 结果 关键字 exists 引入 子 查询 的 语法 特点 如下 关键字 exists 一般 直接 跟在 外层 查询 的 where 子句 后面 它 的 前面 没有 列名 常量 或者 表达式 关键字 exists 引入 的 子 查询 的 select 列表 清单 可以 而且 通常 都是 由 组成 的 因为 只是 测试 满足 子 查询 的 数据 行 的 存在 性 所以在 子 查询 的 select 列表 清单 中加 入 列名 没有 实际意义 比较 使用 exists 和 in 的 查询 exists 子 查询 和 in 操作符 可以 实现 同一个 功能 但是 两者之间 是 有 区别 的 第 个 查询 使用 exists 而 第 个 查询 使用 in 注意 两个 查询 返回 相同 的 信息 使用 谓词 exists 的 sql 语句 如下 索尼 sony 使用 谓词 in 的 sql 语句 如下 索尼 sony 这两种 方法 返回 相同 的 查询 结果 如 下图 所示 比较 使用 exists 和 any 的 查询 通过 orderform 订单 表 与 useraddress 用户 地址 表 查找 两个 表 中 相同 国家 的 收货人 姓名 通过 两种 查询方法 使用 exists 的 sql 语句 如下 使用 any 的 sql 语句 如下 这两种 方法 返回 相同 的 查询 结果 示例 获取 tbbook 图书 表 和 tbbookauthor 作者 表 中 具有 相同 部门 的 作者 所写 的 图书 信息 sql 语句 如下 查询 结果 如 下图 所示 一些 带 exists 或者 notexists 的 子 查询 不能 被 其他 形式 的 子 查询 等价交换 但 所有 带 inanyall 和 比较 运算符 的 子 查询 都 能用 带 exists 的 子 查询 等价 替换 notexists 子 查询 实现 两个 表 的 差 集 与 exists 相 对应 的 是 notexists 使用 notexists 后 如 果子 查询 的 结果 为 空 则 外层 的 where 子句 返回 true 示例 获取 tbbook 图书 表 与 tbbookauthor 作者 表 中 相同 部门 以外 的 图书 信息 sql 语句 如下 练习 查询 没 参加考试 的 学生 信息 练习 查询 报名 人数 大于 平均 报名 人数 的 课程 信息 练习 查询 学生 选 课表 stucou 中报 名 状态 为 报名 的 课程 名 练习 查询 已经 报名 选修 课程 的 学生 信息 要求 显示 学号 和 姓名 三 通过 量词 实现 多行 子 查询 使用 量词 实现 多行 查询 allsome 和 any 是 量词 允许 将 比较 运算符 左边 的 单 值 与 生成 单列 但 多行 结果 集 的 子 查询 在 比较 运算符 的 右边 相比较 如果 where 子 句中 的 子 查询 生成 多个 值 的 单列 结果 将 终止 以下 形式 的 查询 下面 通过 几个 例子 来 了解 如何 使用 量词 实现 多行 子 查询 在 goods 商品信息 表 中 查询 同类 商品 中 售价 高于 平均 售价 的 商品信息 sql 语句 如下 selectavg shopprice 执行 sql 语句 如 下图 所示 如果 通过 使用 个 量词 allsomeany 或 其他 之一 引入 子 查询 而将 查询 语句 改写 如下 如 果子 查询 的 单列 结果 表 有 不止 一行 的 数据 此时 将 不会 终止 查询 而是 将 ltexpressiongt 比较 运算符 左边 的 值 与 比较 运算符 右边 的 子 查询 返回 的 每个 值 进行 比较 改写 上面 的 sql 语句 加入 量词 some 再次 执行 查询 语句 就不会 出现 错误信息 sql 语句 如下 selectavg shopprice 查询 结果 如 下图 所示 如果 使用 all 量词 ltexpressiongt 值 与 ltsubquerygt 每一个 值 的 比较 都必须 求值 为 true 才 能使 where 子句 求值 为 true 另一方面 只要 至少 ltexpressiongt 与 ltsubquerygt 返回值 之一 的 比较 求值 为 truesome 和 any 量词 就使 where 子句 求值 为 true 使用 all 操作符 的 多行 子 查询 all 操作符 比较 子 查询 返回 列表 中 的 每一个 值 ltall 为 小于 最小 的 gtall 为 大于 最大 的 而 all 则没 有 返回值 因为 在 等于 子 查询 的 情况下 返回 列表 中 的 所有 值 是 不符合 逻辑 的 all 允许 将 比较 运算符 前面 的 单 值 与 比较 运算符 后面 的 子 查询 返回值 的 集合 中 的 每一个 值 相比较 另外 仅 当 所有 all 的 比较 运算符 左边 的 单 值 与 子 查询 返回值 的 集合 中 的 每一个 值 的 比较 都 求值 为 true 时 比较 判 式 以及 where 子句 才 求值 为 true 示例 获取 所有 商品 售价 低于 本身 品牌 的 平均 售价 的 商品信息 sql 语句 如下 selectavg shopprice 查询 结果 如下 使用 anysome 操作符 的 多行 子 查询 any 操作符 比较 子 查询 返回 列表 中 的 每一个 值 ltany 为 小于 最大 的 gtany 为 大于 最小 的 而 any 为 等于 inany 允许 将 比较 运算符 前面 的 单 值 与 比较 运算符 后面 的 子 查询 返回值 的 集合 中 的 每一个 值 相比较 另外 仅 当 所有 any 的 比较 运算符 左边 的 单 值 与 子 查询 返回值 的 集合 中 的 一个 值 的 比较 求值 为 true 时 比较 判 式 以及 where 子句 的 求值 就为 true 示例 获取 商品 的 售价 比 平均 售 价高 的 商品信息 并按 商品 品牌 进行 划分 sql 语句 如下 selectavg shopprice 查询 结果 如 下图 所示 量词 some 和 any 是 同义 的 它们 都 允许 将 比较 运算符 前面 的 单 值 与 比较 运算符 后面 的 子 查询 返回 的 结果 集中 的 每个 值 进行 比较 如果 比较 运算符 前面 的 单 值 与 比较 运算符 后面 的 子 查询 返回 的 结果 集中 的 每个 值 之间 的 任何 any 比较 求值 为 true 那么 判 式 以及 where 子句 求值 为 true 总结 本章 主要 介绍 了 多行 子 查询 多行 子 查询 通过 多行 比较 操作符 来 实现 比较 常用 的 多行 比较 操作符 包括 in 和 notinall 和 anysomeexists 和 notexists 操作符 