系统安全 四 ollydbg 动态 分析 工具 基础 用法 及 crakeme 逆向 破解 您 可能 之前 看到过 我 写 的 类似 文章 为什么 还要 重复 撰写 呢 只是 想 更好 地 帮助 初学者 了解 病毒 逆向 分析 和 系统安全 更加 成 体系 且不 破坏 之前 的 系列 因此 我 重新 开 设了 这个 专栏 准备 系统 整理 和 深入 学习 系统安全 逆向 分析 和 恶意代码 检测 系统安全 系列 文章 会 更加 聚焦 更加 系统 更加 深入 也是 作者 的 慢慢 成长史 换 专业 确实 挺 难 的 逆向 分析 也是 块 硬骨头 但我 也 试试 看看 自己 未来 四年 究竟 能 将它 学到 什么 程度 漫漫 长征路 偏向虎山行 享受 过程 一起 加油 系统安全 系列 作者 将 深入研究 恶意 样本 分析 逆向 分析 攻防 实 战和 windows 漏洞 利用 等 通过 在线 笔记 和 实践 操作 的 形式 分享 与 博 友 们 学习 希望 能与 您 一起 进步 前文 普及 了 idapro 反汇编 工具 的 基础 用法 并 简单 讲解 一个 exe 逆向 工程 解密 实战 方法 这篇 文章 将 详细 介绍 ollydbg 的 基础 用法 和 crakeme 案例 逆向 分析 的 倚天 屠龙 希望 对 入门 的 同学 有 帮助 话 不 多说 让我们 开始 新 的 征程 吧 您 的 点 赞 评论 收藏 将是 对 我 最大 的 支持 感恩 安全 路上 一路 前行 如果有 写得 不好 的 地方 可以 联系 我 修改 基础性 文章 希望 对 您 有所 帮助 作者 的 目的 是 与 安 全人 共同进步 加油 文章 目录 一 ollydbg 工具 简介 二 ollydbg 分析 crakeme 示例 三 ollydbg 分析 crakeme 示例 四 总结 作者 的 github 资源 系统安全 网络安全 前文 分析 系统安全 一 什么 是 逆向 分析 逆向 分析 基础 及 经典 扫雷 游戏 逆向 系统安全 二 如何 学好 逆向 分析 及 吕布 传 游戏 逆向 案例 系统安全 三 idapro 反汇编 工具 初识 及 逆向 工程 解密 实战 系统安全 四 ollydbg 动态 分析 工具 基础 用法 及 crakeme 逆向 破解 声明 本人 坚决 反对 利用 教学方法 进行 犯罪 的 行为 一切 犯罪行为 必将 受到 严惩 绿色 网络 需要 我们 共同 维护 更 推荐 大家 了解 它们 背后 的 原理 更好 地 进行 防护 一 ollydbg 工具 简介 ollydbg 是 一个 新 的 动态 追踪 工具 将 ida 与 softice 结合起来 的 思想 ring 级 调试器 非常 容易 上手 是 当今 最为 流行 的 调试 解密 工具 之一 它还 支持 插件 扩展 功能 是 目前 最 强大 的 调试 工具 之一 ollydbg 打开 如 下图 所示 包括 反汇编 窗口 寄存器 窗口 信息 窗口 数据 窗口 堆栈 窗口 反汇编 窗口 显示 被 调试程序 的 反汇编 代码 包括 地址 hex 数据 反汇编 注释 寄存器 窗口 显示 当前 所选 线程 的 cpu 寄存器 内容 点击 标签 可 切换 显示 寄存器 的 方式 信息 窗口 显示 反汇编 窗口 中 选中 的 第一个 命令 的 参数 及 跳转 目标 地址 字符 等 数据 窗口 显示 内存 或 文件 的 内容 右键 菜单 可 切换 显示 方式 堆栈 窗口 显示 当前 线程 的 堆栈 下图 是 打开 exe 后 显示 的 界面 下面 简单 讲解 常用 的 快捷键 调试 方式 f 设置 断点 如 下图 所示 的 红色 位置 程序 运行 到 此处 会 暂停 再按 一次 f 键 会 删除 断点 f 按 下 这个 键 运行 程序 如果 没有 设置 相应 的 点 被 调试 的 程序 直接 开始 运行 f 单 步步 过 每 按 一次 这个 按键 将 执行 反汇编 窗 口中 的 一条 指令 遇到 call 等子 程序 不 进入 其 代码 f 单步 步入 功能 通 单 步步 过 f 类似 区 别是 遇到 call 等子 程序 时会 进入 其中 进入 后 首先 停留在 子程序 的 第一条 指令 上 如 下图 进入 call 子程序 f 运行 到 选定 位置 即 运行 到 光标 所在位置 处 暂停 ctrlf 执行 到 返回 按 下 此键 会 执行 到 一个 返回 指令 时 暂停 常 用于 从 系统 领空 返回 到 我们 调试 的 程序 领空 altf 执行 到 用户 代码 从 系统 领空 快速 返回 我们 调试 的 程序 领空 二 ollydbg 分析 crakeme 示例 第一个 案例 是 加密 与 解密 书中 crakemev 的 文件 需要 解密 用户名 和 序列号 点击 registernow 按钮 会有 输入 错误 相关 的 提示 如 下图 所示 ollydbg 动态 分析 的 基本 流程 如下 通常 拿到 一个 软件 先 试着 运行 软件 如果有 帮助 文档 查阅 帮助 文档 熟悉 软件 的 基本 用法 接着 尝试 输入 错误 的 注册码 观察 错误 提示 如果 没有 输入 注册码 的 地方 要 考虑 是否 是 读取 注册表 或 key 文件 程序 读取 一个 文件 中 的 内容 判断 是否 注册 这些 可以用 其他 工具 来 辅助 分析 如果 都不是 原程序 只是 一个 功能 不全 的 试用版 那要 注册 为 正式版 需要 手动 写 代码 完善 如果 需要 输入 注册码 如上图 所示 则 调用 查 壳 软件 检查程序 是否 加 壳 如 peidfi 有壳 的 需要 脱壳 之后 再 调用 ollydbg 分析 调试 无 壳 的 直接 调用 工具 调试 下面 开始 正式 的 分析 第一步 调用 peid 检测 程序 是否 加 壳 反馈 结果 为 borlanddelphi 无 壳 delphi 编写 的 文件 第二步 运行 crakemev 文件 并 点击 registernow 提示 错误信息 对话框 提示 错误信息 第三步 启动 ollydbg 软件 选择 菜单 文件 打开 crackme 文件 此时 文件 会停 留在 如下 位置 双击 注释 位置 能 添加 自定义 注释 第四步 在 反汇编 窗口 右键 鼠标 选择 查找 gt 所有 参考 文本 字串 弹出 如 下图 所示 的 对话框 第五步 右键 选择 查找 文本 输入 wrong 定位 位置 如 下图 所示 定位 到 wrongserial 位置 第六步 接着 右键 鼠标 点击 反汇编 窗口 中 跟随 接着 定位 到 如 下图 所示 位置 第七步 选中 该 语句 右键 查找 参考 选定 地址 快捷键 ctrlr 弹出 如 下图 所示 的 参考 页面 第八 步 双机 上面 的 两个 地址 ff 去到 对应 的 位置 在 反汇编 窗 口中 向上 滚动 窗口 可以 看到 核心 代码 第九步 通过 查看 跳 转到 字符串 的 指令 可以 查询 相应 的 程序 在 调试 选项 gtcpugt 勾 选 显示 跳转 路径 及 如 跳转 未 实现 则 显示 灰色 路径 和 显示 跳 转到 选定 命令 的 路径 如 下图 所示 第 十步 详细分析 反汇编 代码 在下 图中 地址 fc 处 按 下 f 键 设置 断点 接着 按 f 运行 程序 输入 test 和 gfxier 点击 registernow 显示 结果 如 下图 所示 程序 会在 断点 处 停止 同时 提示 刚才 输入 的 内容 输出 内容 如下 所示 其中 内存地址 ce 中 输 入了 刚才 的 test 第 十 一步 左击 右键 选择 数据 窗口 中 跟随 数值 会在 数据 窗口 中 看到 输入 的 内容 eax 表示 输入 内容 的 长度 为 个字符 第 十二 步 调用 f 按键 和 f 按键 一步步 分析 代码 回到 下面 fc 这 部分 代码 按 下 f 一步步 运行 注意 下面 的 核心 代码 输入 的 内容 送到 eax 即 关键 点 用 按 f 进入 子程序 fjnzxcrackmefc 调 走到 这里 就 错误 wrongserial 第 十 三步 当 f 运行 到 时 按 下 f 进入 call 子程序 此时 光标 停留在 如下 所示 位置 bc 这里 的 pushebxpushesi 等 都是 调用 子程序 保存 堆栈 时 使用 的 命令 按 f 一步步 运行 代码 其 核心 解释 如下 是 基础 的 汇编语言 参考 看 雪 ccdebuger 大神 的 ollydbg 入门教程 重点 程序 运行 到 如 下图 所示 界面 时 可以 看到 test 和 registereduser 的 比较 通过 上面 图片 的 分析 我们 知道 用户名 必须 为 registereduser 第十四 步 接着 按 f 键 运行 程序 出现 错误 对话框 点击 确定 重新 在 编辑框 中 输入 registereduser 再次 点击 registernow 按钮 分析 调试程序 注意 f 键 为 暂停 核心 代码 如下 其中 地址 f 的 call 已经 分析 清楚 继续 f 执行 下一步 知道 第二个 关键 地方 即 f 按 下 f 进入 子程序 注意 注释 内容 的 提示 不一定 存在 需要 动态 调试程序 到 寄存器 查看 对应 的 注册码 才是 正确 的 做法 上面 两句 代码 可以 看到 用户名 和 注册码 都是 调用 同一 子程序 这个 call 分析 方法 和 上面 一样 第 十五 步 按 f 调试 该 子程序 发现 cmp 比较 两个 值 是否 相等 其中 c 为 注册码 内容 第 十 六步 按 f 暂停 再按 f 重新 运行 输入 正确 的 用户名 和 密码 解密 成功 难点 调试程序 时 如何 核心 代码 比如 这里 的 cmp 比较 同时 汇编 代码 也 比较 晦涩 三 ollydbg 分析 crakeme 示例 这个 案例 是 破解 crakeme 中 的 afkayasexe 这是 典型 的 字符串 序列 破解 程序 根据 name 的 值 推出 serial 第一步 通过 peid 检查 它 无 壳 vb 编写 的 第二步 ollydbg 工具 打开 afkayasexe 文件 如 下图 所示 第三步 反汇编 区域 右键 鼠标 选择 查找 gt 所有 参考 文本 字串 第四步 在 弹出 的 对话框 中找到 失败 的 提示 字符 yougetwrong 右键 反汇编 窗口 中 跟随 此 时会 回到 代码 区 可以 看到 失败 和 成果 的 字符串 第五步 通常 成功 和 失败 的 反馈 字符串 相隔 不远 需 要在 之前 判断 如果 输入 的 serial 正确 则 成功 否则 失败 接着 向上 找到 调用 字符串 比较 函数 的 入口 点 注意 这一步 比较 关键 但 个人 觉得 需要 长时间 的 经验 和 实践 才能 准确 定位 汇编 调用 函数 之前 会 先把 参数 入 栈 然 后用 call 指令 调用 函数 在 字符串 比较 函数 之前 有 一句 pusheax 指令 可以 推测 这里 的 eax 就是 字符串 的 首 地址 第六步 在 比较 函数 处 按 下 f 键 设置 断点 接着 按 f 键 执行 此时 会弹 出 运行 界面 我们 输入 eastmount 和 然后 点击 ok 按钮 此时 程序 停留在 断点 处 右下角 堆栈 区 显示 了 提示 的 正确 serial 第七步 输入 正确 的 用户名 和 serial 成果 注册 eastmountaka 下面 结合 鬼 手 大神 和 海天一色 大神 的 博 文 简单 分析 加密 的 基本 逻辑 同时 强烈推荐 大家 阅读 他们 的 文章 参见 前面 的 参考文献 这些 逆向 的 经验 真不是 一朝一夕 就能 获取 的 深知 自己 要 学习 和 经历 的 东西 太多 你我 一起 加油 基本 流程 如下 serialaka 逆序 itoa strlen name xcfbname 求 出了 用户名 的 长度 将用 户名 长度 乘以 xcfb 得到 结果 如果 溢出 则 跳转 将 结果 再加上 用户名 的 第一 个字符 的 ascii 将 结果 转为 十进制 将 结果 和 aka 进行 拼接 得到 最后 的 序列号 下面 分享 一段 python 的 解密 代码 获取 用户名 长度 namelenlen name print u 获取 用户名 长度 print namelen 用户名 长度 乘以 xcfb 得到 结果 u 用户名 长度 乘以 xcfb print res 将 结果 加上 用户名 的 第一 个字符 的 asciiprint nameord name resresord name print u 结果 加上 用户名 第一 个字符 的 ascii print res 转 换为 十进制 省略 拼接 序列号 keykeystr res print u 最终 结果 print key 定义 不同 的 用户名 可以 得到 对应 的 serial 四 总结 写到 这里 这篇 基础性 文章 就 叙述 完毕 网络安全 要 学习 的 知识 真的 很多 涉及面 很广 包括 汇编 网络 操作系统 加密 解密 ccpython 等 希望 自己 能 慢慢 进步 科研 与 实践 并重 也 希望 读者 喜欢 这 系列 总结 笔记 不 喜 勿 喷 与 你 同行 今天 刚好 csdn 粉丝 破 十万 真心 感谢 大家 这些年来 的 陪伴 和 支持 感恩 认识 您也 希望 未来 能 继续 分享 更高 质量 的 文章 帮助 更 多人 入门 和 解决 为 题 寓教于乐 共勉 年月 新开 的 娜 璋 ai 安全 之家 主要 围绕 python 大数 据分析 网络空间 安全 人工智能 web 渗透 及 攻防 技术 进行 讲解 同时 分享 论文 的 算法 实现 娜 璋 之家 会 更加 系统 并 重构 作者 的 所有 文章 从 零 讲解 python 和 安全 写了 近十年 文章 真心 想把 自己 所学 所 感 所做 分享 出来 还请 各位 多多指教 真诚 邀 请您 的 关注 谢谢 byeastmount 星期 二晚 上点 写 于 武汉 