系统安全 十八 病毒 攻防 机理 及 winrar 恶意 劫持 漏洞 bat 病毒 自启动 定时 关机 蓝屏 攻击 您 可能 之前 看到过 我 写 的 类似 文章 为什么 还要 重复 撰写 呢 只是 想 更好 地 帮助 初学者 了解 病毒 逆向 分析 和 系统安全 更加 成 体系 且不 破坏 之前 的 系列 因此 我 重新 开 设了 这个 专栏 准备 系统 整理 和 深入 学习 系统安全 逆向 分析 和 恶意代码 检测 系统安全 系列 文章 会 更加 聚焦 更加 系统 更加 深入 也是 作者 的 慢慢 成长史 换 专业 确实 挺 难 的 逆向 分析 也是 块 硬骨头 但我 也 试试 看看 自己 未来 四年 究竟 能 将它 学到 什么 程度 漫漫 长征路 偏向虎山行 享受 过程 一起 加油 作者 前文 介绍 了 windowspe 病毒 包括 pe 病毒 原理 分类 及 感染 方式 详解 这篇 文章 将 讲解 简单 的 病毒 原理 和 防御 知识 并 通过 批处理 代码 和 漏洞 cve 利用 让 大家 感受 下 病毒 攻击 的 过程 提 出了 安全 相关 建议 包括 自动 启 修改 密码 定时 关机 蓝屏 进程 关闭 等功能 这些 基础 性知识 不仅 和 系统安全 相关 同样 与 我们 身边 常用 的 软件 操作系统 紧密联系 希望 这些 知识 对 您 有所 帮助 更 希望 大家 提高 安全意识 安全 保障 任重道远 本文 参考 了 参考文献 中 的 文章 尤其 感谢 千 峰 教育 史密斯 老师 峰 哥 并 结合 自己 的 经验 和 实践 进行 撰写 也 推荐 大家 阅读 参考文献 文章 目录 一批 处理 病毒 机理 关机 bat 脚本 修改 密码 和 定时 关机 脚本 脚本 病毒 防御 二 自启动 恶意 攻击 机理 bat 脚本 实现 自启动 winrar 恶意 劫持 自启动 cve 恶意 自启动 防御 三 进程 关闭 脚本 四 蓝屏 攻击 机理 bat 脚本 实现 蓝屏 攻击 最新 漏洞 chrome 致 win 蓝屏 复现 五 简单 的 扩展名 修改 恶意 攻击 六 总结 从 年月 开始 我 来 到了 一个 陌生 的 专业 网络空间 安全 初 入 安全 领域 是 非常 痛苦 和 难受 的 要 学 的 东西 太多 涉及面 太 广 但 好在 自己 通过 分享 篇 网络安全 自学 系列 文章 艰难 前行 着 感恩 这一 年 相识 相知 相 趣 的 安全 大佬 和 朋友们 如果 写得 不好 或 不足之处 还请 大家 海涵 接下来 我 将 开启 新 的 安全 系列 叫 系统安全 也是 免费 的 篇文章 作者 将 更加 深入 的 去 研究 恶意 样本 分析 逆向 分析 内网 渗透 网络 攻防 实战 等 也 将 通过 在线 笔记 和 实践 操作 的 形式 分享 与 博 友 们 学习 希望 能与 您 一起 进步 加油 推荐 前文 网络安全 自学 篇 系列 篇 作者 的 github 资源 逆向 分析 网络安全 前文 分析 系统安全 一 什么 是 逆向 分析 逆向 分析 基础 及 经典 扫雷 游戏 逆向 系统安全 二 如何 学好 逆向 分析 及 吕布 传 游戏 逆向 案例 系统安全 三 idapro 反汇编 工具 初识 及 逆向 工程 解密 实战 系统安全 四 ollydbg 动态 分析 工具 基础 用法 及 crakeme 逆向 系统安全 五 ollydbg 和 cheatengine 工具 逆向 分析 植物 大战 僵尸 游戏 系统安全 六 逆向 分析 之 条件 语句 和 循环 语句 源码 还原 及 流程 控制 系统安全 七 逆向 分析 之 pe 病毒 原理 c 实现 文件 加解密 及 ollydbg 逆向 系统安全 八 windows 漏洞 利 用之 cve 复现 及 蓝屏 攻击 系统安全 九 windows 漏洞 利 用之 ms 远程 代码 执行 漏洞 复现 及 深度 提 权 系统安全 十 windows 漏洞 利 用之 smbv 服务 远程 代码 执行 漏洞 cve 复现 系统安全 十一 那些 年 的 熊猫 烧香 及 pe 病毒 行为 机理 分析 系统安全 十二 熊猫 烧香 病毒 ida 和 od 逆向 分析 上 病毒 初始化 系统安全 十三 熊猫 烧香 病毒 ida 和 od 逆向 分析 中 病毒 释放 机理 系统安全 十四 熊猫 烧香 病毒 ida 和 od 逆向 分析 病毒 释放 过程 下 系统安全 十五 chrome 浏览器 保留 密码 功能 渗透 解析 蓝屏 漏洞 及 某 音乐 软件 漏洞 复现 系统安全 十六 pe 文件 逆向 基础知识 pe 解析 pe 编辑 工具 和 pe 修改 系统安全 十七 windowspe 病毒 概念 分类 及 感染 方式 详解 系统安全 十八 病毒 攻防 机理 及 winrar 恶意 劫持 漏洞 脚本 病毒 自启动 定时 关机 蓝屏 攻击 声明 本人 坚决 反对 利用 教学方法 进行 犯罪 的 行为 一切 犯罪行为 必将 受到 严惩 绿色 网络 需要 我们 共同 维护 更 推荐 大家 了解 它们 背后 的 原理 更好 地 进行 防护 该 样本 不会 分享 给 大家 分析 工具 会 分享 参考文献 见 后 一批 处理 病毒 机理 计算机病毒 computervirus 是 编制 者 在 计算机 程序 中 插入 的 破坏 计算机 功能 或者 数据 的 代码 能 影响 计算机 使用 能 自我 复制 的 一组 计算机 指令 或者 程序代码 计算机病毒 具有 传播 性 隐蔽性 感染性 潜伏性 可 激 发性 表现性 或 破坏性 计算机病毒 的 生命周期 开发 期 传染期 潜伏期 发作 期 发 现期 消化 期 消亡 期 计算机病毒 是 一个 程序 一段 可执行 码 就像 生物 病毒 一样 具有 自我 繁殖 互相 传染 以及 激活 再生 等 生物 病毒 特征 计算机病毒 有 独特 的 复制 能力 它们 能够 快速 蔓延 又 常常 难以根除 它们 能把 自身 附着 在 各种类型 的 文件 上当 文件 被 复制 或 从一 个 用户 传 送到 另一个 用户 时 它们 就 随同 文件 一起 蔓延 开来 常见 病毒 如 爱虫 病毒 cih 病毒 木马病毒 trojan 脚本 病毒 宏病毒 等等 本文 首先 通过 批处理 bat 文件 模拟 简单 的 病毒 功 能让 大家 简单 感受 下 病毒 的 某些 功能 包括 自动关机 修改 密码 定时 关机 bat 文件 是 dos 下 的 批处理文件 批处理文件 是 无 格式 的 文本文件 它 包含 一条 或 多条 命令 它 的 文件 扩展 名为 bat 或 cmd 在 命令 提示 下 输入 批处理文件 的 名称 或者 双击 该 批处理文件 系统 就会 调用 cmdexe 按照 该 文件 中 各个 命令 出现 的 顺序 来 逐个 运行 它们 使用 批处理文件 或 脚本 可以 简化 日常 或 重复性 任务 入侵者 常常 通过 批处理文件 的 编 写来 实现 多 工具 的 组合 入侵 自动 入侵 及 结果 提取 等功能 注意 再次 强调 本文 仅仅是 普及 安全 知识 和 病毒 背后 的 机理 让 大家 更好 进行 防御 工作 如果 需要 复现 样本 一 定在 自己 的 虚拟机 中 完成 一切 犯罪行为 必将 受到 严惩 关机 bat 脚本 下面 讲解 第一个 批处理 脚本 主 要是 调用 shutdown 实现 关机 该 批处理 脚本 能让 我们 最快 的 熟悉 脚本 的 恶意 功能 其 基本 步骤 如下 新建 文本文档 输入 shutdownst 把 txt 改成 bat 如 下图 所示 运行 cmd 可以 查看 shutdown 命令 的 基本 用法 基本 命令 为 shutdownst 现在 让 系统 秒 之后 关机 shutdowna 终止 关闭 计算机 运行 结果 如 下图 所示 新建 testbat 并 填写 shutdownst 某些 系统 需 要在 文件夹 选项 中 显示 隐藏 已知 文件 类型 的 扩展名 双击 bat 文件 即 运行 关机 如果 需要 取消 还是 在 cmd 黑 框 中 输入 shutdowna 命令 修改 密码 和 定时 关机 脚本 接下来 分享 一个 比较 完整 的 bat 脚本 制作 过程 这些 代码 对 批处理 功能 熟悉 和 脚本 病毒 逆向 分析 都有 帮助 第一步 新建 gamebat 文件 程序 编写 如下 所示 其中 echooff 表示 关闭 回 显 colora 表示 设置 颜色 程序 echoecho 菜单 echo 修改 管理员 密码 echo 定时 关机 echo 退出 本 程序 echopause 运行 结果 如 下图 所示 可以 看到 标 题为 eastmount 程序 并且 包含 相关内容 这 就是 批处理文件 执行 过程 第二步 做一个 选择 判断 该 程序 需 要和 用户 进行 互动 核心 代码 为 setpnum 您 的 选择 是 其 表示 设置 变量 nump 表示 暂停 并 等待 用户 输入 用户 最终 输入 的 值 赋 为 程序 echoecho 菜单 echo 修改 管理员 密码 echo 定时 关机 echo 退出 本 程序 echosetpnum 您 的 选择 是 pause 输出 结果 如 下图 所示 第三步 补充 修改 管理员 密码 定时 关机 退出 等 命令 病毒 常用 功能 修改 管理员 密码 的 命令 是 微软 所有 系统 的 通用 命令 下述 代码 是 修改 当前 管理员 密码 为 第二个 选项 是 关机 命令 如下 shutdownst 第三个 选项 是 退出 本 程序 exit 接着 编写 判断 和 跳转 批处理 代码 代码 如下 所示 gtnul 表示 不输 出 运行 提示 信息 虽然 goto 语句 不 提倡 使用 但 某些 情况下 还是 挺 便捷 的 程序 menuechoecho 菜单 echo 修改 管理员 密码 echo 定时 关机 echo 退出 本 程序 echosetpnum 您 的 选择 是 您 的 密码 已经 设置 成功 此时 输 入会 提示 系统 错误 如 下图 所示 同时 杀毒软件 也 会 提示 黑客 修改 电脑 点击 允许 操作 即可 继续 完善 脚本 增加 cls 命令 清屏 为了 避免 输入 数字 会 从头 执行 到尾 补充 一个 提示 信息 最后 补充 设置 的 用户名 和 新密码 关机 时间 等 程序 menuclsechoecho 菜单 echo 修改 管理员 密码 echo 定时 关机 echo 退出 本 程序 echosetpnum 您 的 选择 是 您 好请 输入 正确 的 数字 请 输入 用户名 setpp 请 输入 新密码 您 的 密码 已经 设置 成功 请 输入 时间 以 管理员 身份 运行 后 成功 修改 xxxxx 用户 的 开机 密码 为 输入 可以 设置 关机 时间 这里 就 不再 赘述 批处理 脚本 实现 某些 恶意 功能 的 过程 已经 详细 讲解 脚本 病毒 防御 上面 主要 介绍 了 批处理 bat 脚本 实现 关机 和 修改 管理员 密码 的 功能 但在 真正 的 网络 攻防 过程中 脚本 病毒 和 宏病毒 更 常见 这里 分享 下 它们 的 防御 方法 脚本 病毒 是 主要 采用 脚本语言 设计 的 计算机病毒 现在 流行 的 脚本 病毒 大都是 利用 javascript 和 vbscript 脚本语言 编写 实际上 在 早期 的 系统 中 病毒 就 己 经 开始 利用 脚本 进行 传播 和 破坏 不过 专门 的 脚本 型 病毒 并不 常见 但是在 脚本 应用 无所不在 的 今天 脚本 病毒 却 成为 危害 大 传播 广 的 病毒 特别是 当 它们 和 一些 传统 的 进行 恶性 破坏 的 病毒 如 cih 相结合 时 其 危害 就 更为严重 了 随着 计算机 系统软件 技术 的 发展 新 的 病毒 技术 也 应运而生 特别是 结合 脚本 技术 的 病毒 更让人 防不胜防 比 如在 apt 中 鱼叉 式 钓鱼 邮件 结合 宏病毒 office 文档 就很 常见 由于 脚本语言 的 易用性 并且 脚本 在 现有 应用 系统 中 特别是 internet 应用 中 占据 了 重要 地位 脚本 病毒 也 成为 互联网 病毒 中 最为 流行 的 网络 病毒 之一 常见 脚本 文件 后缀 vbsvbejsbatcmd 常见 的 防御 措施 包括 防范 脚本 病毒 比如 禁用 文件 系统 对象 re egsvrscrrundllu 在 浏览器 设置 中将 activex 插件 和 控件 以及 js 相关 功能 禁止 掉 这样 可以 避免 一些 恶意代码 的 攻击 不过 也 会 限制 一些 制作 精美 的 动态 网页 及时 升级 系统 和 浏览器 补丁 选择 一款 好 的 防病毒 软件 并 做好 及时 升级 防止 鱼叉 式 钓鱼 邮件 攻击 不要 轻易 去 浏览 或 点击 一些 来历不明 的 网站 邮件 文件 这样 大部分 的 恶意代码 都会 被 我们 拒 之 机 外 小心 处理 office 文档 除非 确认 文档 来源 可靠 充分 了解 打开文档 的 后果 否则 务必 不要 开启 office 启用 宏代码 使用 云 沙箱 和 本地 安全 软件 对 可疑 文件 进行 检测 提升 安全意识 尤其 内部人员 的 安全意识 二 自启动 恶意 攻击机 理上 一篇 文章 我们 介绍 了 pe 病毒 控制权 获取 的 常用 方法 当 计算机 重启 后 病毒 自启动 是 一个 重要 的 功能 常用 方法 包括 病毒 融合 autoruns 自启动 机制 下图 展示 了 autoruns 软件 查看 windows 操作系统 的 自启动 选项 如果 病毒 本身 能 很好 地 结合 这套 机制 它 可以 做的 事情 非常 多 并且 具有 很好 的 隐蔽性 利用 系统 自动播放 机制 autoruninf 比如 u盘 病毒 或 光盘 病毒 就是 利用 u盘 或 光盘 的 自动播放 功能 目前 也有 一些 u盘 插入 之后 不需 要你 去 双击 这个 u 盘里 面的 程序 就会 自启动 在其 他 可执行文件 嵌入 少量 触发 代码 修改 引入 函 数节 启动 dll 病毒 文件 添加 相应 结构 初始化 代码 触 发在 特定 pe 文件 代码 段 插入 触发 代码 等 只需 定位 可执行 程序 并 运行 dll 劫持 替换 已有 dll 文件 很多 应用程序 或 操作系统 执 行时 都 会去 执行 dll 文件 如果 病毒 将 自身 做成 一个 dll 文件 同时 将 系统 dll 文件 替换 可想而知 系统 启动时 它是 根据 文件名 启动 的 此时 病毒 dll 文件 就会 拿到 控制权 如果 拿到 控制权 之后 再进 一步 装载 原始 dll 文件 这样 系统 的 本身 机制 也 不会 受到影响 隐蔽性 更强 该 方法 非常 常见 甚至有 一些 病毒 程序 将 反病毒软件 可 依赖 的 dll 文件 替换 利用 day 或 day 漏洞 实现 自启动 接着 我们 将 详细 介绍 winrar 恶意 劫持 漏洞 复现 cve 注意 后续 windows 黑客 编程 文章 作者 也 会 详细 介绍 各种 自启动 的 代码 cpython 实现 方法 bat 脚本 实现 自启动 接着 编写 一个 伪装成 系统 垃圾 清理 的 代码 它 其实是 一个 导致 系统 死机 的 代码 也 不能 算是 病毒 更 多是 一个 恶作剧 程序 但它 能让 我们 了解 脚本 病毒 的 某些 功能 其 原理 是 不断 打开 cmd 程序 占用 系统资源 从而 导致 死机 并且 每次 开机 都会 自动 启 ps 这里 强调 一句 建议 大家 在 虚拟机 中 运行 该 代码 我们 作为 安全 工程师 希望 您们 去 了解 漏洞 背后 的 原理 更好 地 进行 防御 绿色 网络 需要 我们 共同 维护 杜绝 一切 违法行为 第一步 在 cwindows 目 录下 创建 文件 windowsbat 一个 gt 表示 覆盖 文件 内容 两个 gtgt 表示 追加 一句话 至 文件 末尾 用户 打开 这个 程序 之后 程序 就会 不断 打开 cmd 占用 系统资源 导致 系统 瘫痪 是 再次 执行 该 程序 的 意思 但是 这样 只 能让 用户 死机 一次 重启 系统 以后 不再 打开 这个 文件 以后 就不 再会 中 招了 第二步 将 这个 恶意 脚本 放到 开机 菜单 中 每次 开机 都 自动 启动 运行 并 导致 电脑 死机 errorlevel 为 预 定义 变量 随着 系统 变化 而 变化 如果 为 表示 上 一条 命令 执行 成功 如果 非 表示 上 一条 命令 执行 失败 它 不是 win 系统 而 执行 下面 这条 命令 xp 系统 系统 代码 echo 表示 空行 比如 代码 输出 结果 如 下图 所示 第三步 接着 编写 next 区域 代码 完整 代码 如下 所示 echoofftitle 系统 垃圾 清理 colorfecho 若有 杀毒软件 恶意 拦截 请 选择 允许 程序 的 所有 操作 开始菜单 程序 启动 垃圾 清理 中 请 不要 关闭 窗口 垃圾 清理 完毕 共 清理 垃圾 mechoechoecho 建议 立即 重启 电脑 程序 运行 失败 请使用 管理员 权限 重新 运行 echopause 注意 我 注释 了 重复 操作 代码 否则 开机 自启动 很 麻烦 接着 运行 代码 如 下图 所示 需要 右键 以 管理员 身份 运行 代码 会在 cwindwos 目 录下 创建 批处理文件 windowsbat 同时 在 我 的 win 系统 开机 自 动动 目 录下 也有 该 文件 目录 打开 该 文件 可以 看到 写入 的 startcmd 代码 表示 打开 cmd 双击 该 windowsbat 文件 运行 结果 如 下图 所示 总结 该 部分 编 写了 一个 系统 清理 工具 其实是 把 这个 windowsbat 写到 用户 的 开机 自启动 目录 下 达到 用户 每次 开机 都会 运行 该 程序 的 目的 重复 调用 cmd 占用 资源 如果 中了 该 病毒 用户 可以 使用 pe 到 开启 启动 目录 把 windowsbat 文件 删除 或者 重装系统 再次 建议 大家 别让 它 重复 运行 winrar 恶意 劫持 自启动 cvewinrar 漏洞 cve 是 checkpoint 团队 于 年月 爆出 的 严重 安全漏洞 该 漏洞 已 存在于 winrar 中年 是 apt 攻击 中 非常 经典 的 漏洞 由于 winrar 使 用了 一个 陈旧 的 unacevdll 动态 链接库 造成 的当 我们 解压 任意 ace 文件 时 由于 没有 对 文件名 进行 充分 过滤 导致 其 可 实现 目录 穿越 将 恶意 软件 写入 操作 系统启动 startup 文件夹 并且 电脑 重启 时会 自动 运行 该 程序 从而 造成 恶意 软件 劫持 通过 该 漏洞 可以获得 受害者 计算机 的 控制 安全 专家 表示 全球 有 超过 亿 用户 受到 winrar 漏洞 影响 下面 我们 先来 复现 该 漏洞 该 漏洞 会对 多种 压缩软件 造成 影响 版本 如下 好 压 压缩 lt 压缩 lt 第一步 安装 winrar 的 版本 后续 升级 弥 补了 该 漏洞 作者 的 电脑 是 win 操作系统 安装 之后 可以 看到 本地 存在 的 unacevdll 动态 链接库 它 就是 被 利用 的 入口 第二步 从 github 中 下载 漏洞 利用 程序 如 下图 所示 hellotxt 和 worldtxt 是 需要 压缩 的 文件 calcexe 是 计算器 可以 替换成 恶意 软件 它 会被 定向 植入 系统启动 目录 exppy 是 运行 的 python 代码 它 会将 hellotxt 和 worldtxt 压缩 并 隐藏 恶意 软件 acefilepy 是 利用 unacevdll 漏洞 的 代码 共 多行 下载 地址 我们 尝试 打开 exppy 文件 代码 如下 其中 恶意 软件 为 calcexe 压缩包 名 称为 testrar 需要 压缩 的 文件 为 hellotxt 和 worldtxt 隐藏 的 路径 为 windows 系统 开机 启动 的 目录 并 命名为 hiexe 读者 也 可以 尝试 修改 名称 自定义 需要 压缩 的 文件 及 恶意 软件 selfbufb selfstateiflen buf selfbuf bufselfstate returnselfdefeq selfother selfformatspec formatspec defstr self self buf returnacecrc buf sumdefgetacecrc filename withopen filenamerb asfreturnacecrc fread filename filename respread righthdrcrcx struct res returnhexraw righthdrcrc defmodifyhdrcrc filename hdrcrcraw hexvalue whilelen hexvalue hexvalue whilelen hexvalue filename withopen filenamerb asfreturnstr binasciihexlify fread str hex len targetfilename str hex ospathgetsize filename str hex getacecrc filename str hex len targetfilename filenamerawjoin xformat ord c filename withopen filenamewb asffwrite binasciiabhex shellcodeupper defbuildfileadd withopen filenameab asffwrite binasciiabhex shellcodeupper buildfileadd rarfilename upper buildfile shellcodeupper replace filename rarfilename ifnamemainprint rarfilename foriinrange len filenamelist buildfileonce filenamelisti buildfileonce print rarfilename 第三步 打开 python 运行 exppy 代码 将 自动 生成 testrar 压缩包 注意 如果 未 安装 python 或 相关 包 需要 进行 安装 同时 不能 双击 exppy 需要 python 来 运行 代码 第四步 此时 在当 前文 件 夹生 成了 testrar 文件 将该 压缩包 发送给 其他用户 如果 目标 电脑 存在 winrar 漏洞 则会 造成 影响 注意 qq 和 win 防火墙 已经 能 识 别出 该 cve 漏洞 号 如 下图 所示 第五步 当 目标 用户 在 桌面 解压 该 文件夹 则 会在 电脑 启动 目录 放入 我们 的 木马 文件 命名为 hiexewin 路径 这里 演示 的 是 计算器 而 如果 植入 恶意 软件 则 每次 目标 开机 运行 就会 自启动 该 恶意代码 注意 当 目标 用户 解压 我们 文件 时 其 解压 目录 必须 是 cusers 当前 用户 目 录下 也 就是 必须 是 在 下面 这些 目录 中 解压 的 该 文件 压缩包 中 隐藏 了 深层次 的 路径 xp 系统 自启动 路径 可能 不同 恶意 自启动 防御 这里 补充 手动 查杀 病毒 的 基本 流程 它在 一定 程 度上 能 有效 防止 病毒 的 恶意 功能 排查 可疑 进程 因为 病毒 往往会 创建 出来 一个 或者 多个 进程 因此 需要 分 辨出 哪些 进程 是 由 病毒 所 创建 然后 删除 可疑 进程 检查 启动项 病毒 为了 实现 自启动 会 采用 一些 方法 将 自己 添加到 启动项 中 从而 实现 自启动 所以 我们 需 要把 启动项 中 的 病毒 清除 删除 病毒 在上 一步 的 检查 启动项 中 我们 就 能够 确定 病毒 主体 的 位置 这样 就可以 顺藤摸瓜 从根本上 删除 病毒 文件 修复 被 病毒 破坏 的 文件 这一步 一般来说 无法 直接 通过 纯手工 完成 需 利用 相应 的 杀毒软件 就 自启动 来说 我们 首先 需要 检测 启动项 创建 的 位置 及 键值 如 下图 熊猫 烧香 病毒 取消 勾 选 spoclsv 启动项 点击 确定 同时 打开 注册表 查看 对应 的 值 发现 创 建了 一个 svcshare 的 值 它 也是 自启动 对应 exe 程序 因此 需要 删除 注册表 某些 自启动 键值 还有 计划任务 系统 服务 dll 劫持 自动播放 机制 autoruninf 都 需要 进行 恶意 自动 启 检查 比 如在 win 自启动 目录 删除 指定 的 恶意程序 三 进程 关闭 脚本 再看 一个 伪装 的 批处理 代码 该 命令 执行 杀死 进程 功能 imexplorerexe 表示 要 杀死 的 进程 名称 如 关闭 桌面 f 表示 强制 杀死 gtnul 表示 在 屏幕 上 不要 输出 任何 信息 完整 代码 如下 所示 其中 表示 继续 开启 桌面 pingngtnul 用于 消耗 时间 echoofftitle 系统 垃圾 清理 colorfecho 若有 杀毒软件 恶意 拦截 请 选择 允许 程序 的 所有 操作 垃圾 清理 中 请 不要 关闭 窗口 拐了 你 的 系统 已经 废了 已经 修复 好 是不是 吓 坏了 o opause 运行 该 批处理 程序 桌 面会 消失 如 下图 所示 过 一会 桌面 又会 恢复 由于 作者 桌面 东西 太 乱 这里 仅 显示 壁纸 展示 四 蓝屏 攻击 机理 蓝屏 死机 称为 也是 常见 的 攻击行为 尤其是 某些 cve 漏洞 复现 过程 在 进行 提 权 尝试 前 都会 先 实现 蓝屏 攻击 功能 其 危害 极大 bat 脚本 实现 蓝屏 攻击 基本 步骤 如下 新建 文本文档 输入 表示 强制 杀死 进程 后缀 txt 修 改为 bat 开始 gt 程序 gt 启动 打开 gamebat 文件 黑客 很少 攻击 个人 一般 攻击 服务器 该 命令 对 的 服务器 特别 有 杀伤力 双击 之后 服务器 直接 蓝屏 显示 并 重启 ntsd 从 windows 开始 就是 系统 自带 的 进程 调试 工具 在 system 目 录下 ntsd 的 功能 非常 的 强大 用法 也 比较复杂 但 如果 只 用来 结束 一些 进程 那就 比较简单 了 在 windows 中 只有 systemsmssexe 和 csrssexe 不能 杀 前 两个 是 纯 内核 态 的 最后 那个 是 win 子系统 ntsd 本身 需要 它 lsassexe 也 不要 杀掉 它是 负责 本地 账户 安全 的 被 调试器 附着 的 进程 会 随 调试器 一起 退出 所以 可以 用来 在 命令行 下 终止 进程 打开 cmd 后 输入 以下 命令 就可以 结束 进程 方法 一 利用 进程 的 pid 结束 进程 命令 格式 ntsdcqppid 命令 范例 ntsdcqp 结束 explorerexe 进程 范例 详解 explorerexe 的 pid 为 但是 如何 获取 进程 的 pid 呢 在 cmd 下 输入 tasklist 就可以 获取 当前任务 管理器 所有 进程 的 pid 或者 打开 任务 管理器 在 菜单栏 选择 查看 gt 选择 列 在 打开 的 选择项 窗口 中将 pid 进程 标识符 项 选择 钩上 这样 任务 管理器 的 进程 中 就会 多出 pid 一项 了 pid 的 分配 并不 固 定是 在 进程 启动 是 由 系统 随机 分配 的 所以 进程 每次 启动 的 进程 一般 都不会 一样 方法 二 利用 进程 名 结束 进程 命令 格式 为 进程 名 exe 不能 省 命令 范例 另外 的 能 结束 进程 的 dos 命令 还有 taskkill 和 tskill 命令 最新 漏洞 chrome 致 win 蓝屏 复现 接着 补充 一个 年初 大家 会 遇到 的 chrome 浏览器 导致 win 蓝屏 的 漏洞 第一步 在 win 谷歌 浏览器 建议 使用 虚拟机 测试 中 输入 命令 第二步 我们 的 计算机 就会 自动 蓝屏 重启 该 漏洞 请勿 轻易 测试 个人 虚拟机 测试 前先 保存 好 资料 漏洞 可 用于 拒绝服务 攻击 并且 微软 还未 修复 该 漏洞 微软 edge 浏览器 也 具有 相同 的 效果 第三步 分析 漏洞 原因 参考 网站 该 windows 中 的 错误 是 通过 在 浏览器 的 地址栏 中 打开 特定 路径 或 使用 其他 windows 命令 即 可使 操作系统 崩溃 并 显示 蓝屏 死机 据 了解 这是 windows 安全 研究人员 在 twitter 上 披露 的 两个 错误 攻击者 可以 在 各种 攻 击中 滥用 这些 错误 第一个 错误 允许 无 特权 的 用户 或 程序 输入 单个 命令 该 命令 会 导致 ntfs 卷 被 标 记为 已损坏 该 测试 表明 该 命令 导致 硬盘驱动器 损坏 从而 导致 windows 无法 启动 第二个 漏洞 是 windows 通过 尝试 打开 一条 异常 路径 而 导致 eath 蓝屏 死机 崩溃 致使 电脑 蓝屏 重启 自 去 年月 以来 windows 安全 研究员 jonaslykkegaard 已经 多次 在 推 特 上 发布 了 一个 路径 当 输入 到 chrome 浏览器 地址栏 时 该 路径 会 立即 导致 windows 崩溃 并 显示 bsod 蓝屏 死机 当 开发人员 想要 直接 与 windows 设备 进行 交互 时 他们 可以 将 win 设备 命名 空间 路径 作为 参数 传 递给 windows 编程 函数 例如 允许 应用程序 直接 与 物理 磁盘 进行 交互 而 无需 通过 文件 系统 lykkegaard 告诉 他 发现了 以下 控制台 多路 复用器 驱动程序 的 win 设备 命名 空间 路径 他 认为 该 路径 用于 内核 用户 模式 ipc 当 以 各种方式 打开 该 路径 时 即使是 低 权限 用户 也 会 导致 windows 崩溃 当 连 接到 该 设备 时 开发人员 应 传递 attach 扩展 属性 以 与 该 设备 正确 通信 如果 你 试图 在 没有 传递 属性 的 情况下 由于 错误 检查 不当 而 连 接到 该 路径 它将 导致 一个 异常 最终 导致 win 出现 bsod 崩溃 更 糟糕 的 是 特权 低 的 windows 用户 可以 尝试 使用 此 路径 连 接到 设备 从 而使 计算 机上 执行 的 任何 程序 都很 容易 让 windows 崩溃 在 测试 中 已经 确认 此 错误 在 windows 版 及 以后 的 版本 中 存在 五 简单 的 扩展名 修改 恶意 攻击 将 文件 格式 修改 或 文档 加密 都是 常见 的 病毒 比如 永恒 之 蓝 勒索 病毒 等 它们 就是 将 电脑 内 的 所有 资料 文档 加密 当你 要 打开 文件 时 需要 密码 此时 通过 比特 币 付费 进行 勒索 下面 这个 小 操作 是 将 exe 文件 修 改为 txt 文档 当 遇到 可执行 的 exe 文件 会 认为 它是 一个 txt 文档 用 记事本 打开 导致 可执行 程序 运行 不 起来 这是 就是 这个 病毒 的 原理 新建 文本文档 增加 代码 修 改为 bat 开始 gt 程序 gt 启动 打开 bat 文件 双击 运行 bat 文件 之后 我们 的 可执行文件 就 变 成了 txt 文件 此时 系统 认为 exe 就是 txt 程序 把 系统 的 关联 搞 混乱 了 它 恢复起来 很 麻烦 exe 程序 打开 如 下图 所示 甚至 打开 cmd 都是 txt 文本文件 接着 需要 执行 下面 的 命令 还原 exe 文件 assocexeexefile 还原 的 代码 及 效果 如 下图 所示 其他 所有 文件 格式 都 转 换为 txt 文件 如下 所示 此时 如果 隐藏 文件 扩展名 甚至 可以 修改 图标 伪装成 目标 应用 当 用户 点击 时会 执行 这些 破坏 但由于 不知道 目标 是否 有 隐藏 文件 扩展名 还是 不 建议 这种 笨 方法 解决方法 如果您 不幸 中了 该 病毒 怎么 解决 呢 如 下图 所示 还原 所有 正确 关联 即可 当然 还有 一些 恶意 功能 比如 vbs 脚本 网页 弹窗 网站 钓鱼 等 这里 不再 讲解 如果把 病毒 程序 放到 启动项 每次 开机 都会 自动 执行 六 总结 写到 这里 这篇 文章 就 介绍 结束 了 希望 对 您 有所 帮助 尤其是 想 成为 白 帽子 和 安全 防御 人员 这些 基础知识 都 将对 你 系统安全 入门 有 一定 作用 这里 再次 感谢 参考文献 的 各位 大佬 也 推荐 大家 阅读 参考文献 的 文 章和 视频 文章 存在 一些 不足 作者 没有 深入 理解 其 原理 也是 作为 网络安全 初学者 的 慢慢 成长 路 吧 希望 未来 能 更 透彻 撰写 相关 文章 一批 处理 病毒 机理 bat 脚本 实现 关机 修改 密码 和 定时 关机 脚本 脚本 病毒 防御 二 自启动 恶意 攻击 机理 bat 脚本 实现 自启动 winrar 恶意 劫持 自启动 cve 恶意 自启动 防御 三 进程 关闭 脚本 四 蓝屏 攻击 机理 bat 脚本 实现 蓝屏 攻击 最新 漏洞 chrome 致 win 蓝屏 复现 五 简单 的 扩展名 修改 恶意 攻击 学 安全 一年 认识了 很多 安全 大佬 和 朋友 希望 大家 一起 进步 这篇 文章 中 如果 存在 一些 不足 还请 海涵 作者 作为 网络安全 和 系统安全 初学者 的 慢慢 成长 路 吧 希望 未来 能 更 透彻 撰写 相关 文章 同时 非常感谢 参考文献 中 的 安全 大佬 们 的 文章 分享 感谢 师傅 实验室 小伙伴 的 教导 深知 自己 很菜 得 努力 前行 编程 没有 捷径 逆向 也没有 捷径 它们 都是 搬 砖 活 少 琢磨 技 巧干 就 对了 什么时候 你 把 攻击 对手 按在 地上 摩擦 你 就 赢了 也 会 慢慢 形 成了 自己 的 安全 经验 和 技巧 加油 吧 少年 希望 这个 路线 对 你 有所 帮助 共勉 欢迎 大家 讨论 是否 觉得 这 系列 文章 帮助 到 您 如果 存在 不足之处 还请 海涵 任何 建议 都可以 评论 告知 读者 共勉 逆向 分析 网络安全 年月 新开 的 娜 璋 ai 安全 之家 主要 围绕 python 大数 据分析 网络空间 安全 人工智能 web 渗透 及 攻防 技术 进行 讲解 同时 分享 ccfsci 南 核 北 核 论文 的 算法 实现 娜 璋 之家 会 更加 系统 并 重构 作者 的 所有 文章 从 零 讲解 python 和 安全 写了 近十年 文章 真心 想把 自己 所学 所 感 所做 分享 出来 还请 各位 多多指教 真诚 邀 请您 的 关注 谢谢 byeastmount 星期三 凌晨 夜 于 贵阳 参考文献 黑客 入门 基础 windows 网络安全 精 讲 b 站 千 峰 教育 史密斯 老师 网络安全 自学 篇 二十五 web 安全 学习 路线 及 木马病毒 和 防御 初探 b 站 白 帽 黑客 教程 b 站 hack 学习 网络安全 黑客 基础 课程 新手入门 必看 