系统安全 十二 熊猫 烧香 病毒 ida 和 od 逆向 分析 上 病毒 初始化 您 可能 之前 看到过 我 写 的 类似 文章 为什么 还要 重复 撰写 呢 只是 想 更好 地 帮助 初学者 了解 病毒 逆向 分析 和 系统安全 更加 成 体系 且不 破坏 之前 的 系列 因此 我 重新 开 设了 这个 专栏 准备 系统 整理 和 深入 学习 系统安全 逆向 分析 和 恶意代码 检测 系统安全 系列 文章 会 更加 聚焦 更加 系统 更加 深入 也是 作者 的 慢慢 成长史 换 专业 确实 挺 难 的 逆向 分析 也是 块 硬骨头 但我 也 试试 看看 自己 未来 四年 究竟 能 将它 学到 什么 程度 漫漫 长征路 偏向虎山行 享受 过程 一起 加油 如果 你想 成为 一名 逆向 分析 或 恶意代码 检测 工程师 或者 对 系统安全 非常 感兴趣 就必须 要 认真 分析 一些 恶意 样本 熊猫 烧香 病毒 就是 一款 非常 具有 代表性 的 病毒 当年 造成了 非常大 的 影响 并且 也有 一定 技术手段 本文 将 详细 讲解 熊猫 烧香 的 行为 机理 并 通过 软件 对 其 功能 行为 进行 分析 这将 有助于 我们 学习 逆向 分析 和 反病毒 工作 后续 作者 还 将对 其 进行 逆向 调试 以及 wannacry 勒索 蠕虫 各种 恶意 样本 及 木马 的 分析 基础性 文章 希望 您 喜欢 ida 和 od 作为 逆向 分析 的 倚天剑 和 屠龙刀 学好 它们 的 基本 用法 至关重要 本文 重点 分析 熊猫 烧香 病毒 的 功能 函数 大家 掌握 这些 技巧 后 才能 更好 地 分析 更多 的 代码 同时 本文 部分 实验 参考 姜 晔 老师 的 视频 分析 真的 非常 佩服 和 值得 去 学习 的 一位 老师 技术 路上 哪有 享乐 为了 提升 安全 能力 别 抱怨 干 就 对了 从 年月 开始 我 来 到了 一个 陌生 的 专业 网络空间 安全 初 入 安全 领域 是 非常 痛苦 和 难受 的 要 学 的 东西 太多 涉及面 太 广 但 好在 自己 通过 分享 篇 网络安全 自学 系列 文章 艰难 前行 着 感恩 这一 年 相识 相知 相 趣 的 安全 大佬 和 朋友们 如果 写得 不好 或 不足之处 还请 大家 海涵 接下来 我 将 开启 新 的 安全 系列 叫 系统安全 也是 免费 的 篇文章 作者 将 更加 深入 的 去 研究 恶意 样本 分析 逆向 分析 网络 攻防 实战 等 也 将 通过 在线 笔记 和 实践 操作 的 形式 分享 与 博 友 们 学习 希望 能与 您 一起 进步 加油 推荐 前文 网络安全 自学 篇 系列 篇 话 不 多说 让我们 开始 新 的 征程 吧 您 的 点 赞 评论 收藏 将是 对 我 最大 的 支持 感恩 安全 路上 一路 前行 如果有 写得 不好 或 侵权 的 地方 可以 联系 我 删除 基础性 文章 希望 对 您 有所 帮助 作者 目的 是 与 安 全人 共同进步 加油 文章 目录 一 实验 背景 二 peid 加 壳 检查 三 ida 静态 分析 和 od 动态 分析 四 总结 作者 的 github 资源 逆向 分析 网络安全 前文 分析 系统安全 一 什么 是 逆向 分析 逆向 分析 基础 及 经典 扫雷 游戏 逆向 系统安全 二 如何 学好 逆向 分析 及 吕布 传 游戏 逆向 案例 系统安全 三 idapro 反汇编 工具 初识 及 逆向 工程 解密 实战 系统安全 四 ollydbg 动态 分析 工具 基础 用法 及 crakeme 逆向 破解 系统安全 五 ollydbg 和 cheatengine 工具 逆向 分析 植物 大战 僵尸 游戏 系统安全 六 逆向 分析 之 条件 语句 和 循环 语句 源码 还原 及 流程 控制 系统安全 七 逆向 分析 之 pe 病毒 原理 c 实现 文件 加解密 及 ollydbg 逆向 系统安全 八 windows 漏洞 利 用之 cve 复现 及 蓝屏 攻击 系统安全 九 windows 漏洞 利 用之 ms 远程 代码 执行 漏洞 复现 及 深度 提 权 系统安全 十 windows 漏洞 利 用之 smbv 服务 远程 代码 执行 漏洞 cve 复现 系统安全 十一 那些 年 的 熊猫 烧香 及 pe 病毒 行为 机理 分析 系统安全 十二 熊猫 烧香 病毒 ida 和 od 逆向 分析 上 病毒 初始化 声明 本人 坚决 反对 利用 教学方法 进行 犯罪 的 行为 一切 犯罪行为 必将 受到 严惩 绿色 网络 需要 我们 共同 维护 更 推荐 大家 了解 它们 背后 的 原理 更好 地 进行 防护 该 样本 不会 分享 给 大家 分析 工具 会 分享 参考文献 见 后 一 实验 背景 对 病毒 进行 逆向 分析 可以 彻底 弄清楚 病毒 的 行为 从而 采取 更 有效 的 针对 手段 为了 节省 篇幅 在这里 我 不 打算 将 熊猫 烧香 进行 彻底 的 分析 只会 讲解 一些 比较 重要 的 部分 大家 只要 掌握 了 这些 思想 那么 就可以 处理 很多 的 恶意程序 了 这里 主要 使用 的 工具 包括 peid 病毒 加 壳 脱壳 基础性 分析 idapro 静态 分析 ollydbg 动态 分析 实验 文件 setupexe 熊猫 烧香 病毒 基本 流程 利用 查 壳 工具 检查 病毒 是否 带 壳 利用 od 动态 分析 病毒 利用 ida 静态 分析 病毒 注意 由于 od 工具 会将 程序 运行 起来 所以 我们 在 进行 恶意代码 分析 时 尽量 在 搭 建好 的 虚拟机 中 操作 如果 病毒 传播 性 较强 如 wannacry 建议 断开 网络 和 断开 共享 分析 二 peid 加 壳 检查 我们 在 分析 病毒 之前 首先 需要 调用 工具 检查 是否 带 壳 如果 病毒 还需要 先 进行 脱壳 操作 这次 研究 的 熊猫 烧香 程序 并没 有加 壳 但 后续 的 文章 我会 详细 分享 加 壳 与 脱壳 的 内容 更好 地 帮助 大家 理解 病毒 分析 及 保护措施 首先 打开 peid 工具 人 然后 将 熊猫 烧香 病毒 拖进去 会 发现 病毒 的 基本信息 分析 信息 如下 该 程序 并没 有加 壳 采用 编写 注意 这里 补充 姜 老师 对 delphi 编写 代码 和 vc 编写 代码 的 理解 区别 delphi 在 函数 调 用时 参数 的 传递 不完全 用 栈 主 要用 寄存器 而 c 程序 函数 调用 前 会 使用 push 语句 将 参数 入 栈 然后再 进行 calldelphi 一般 将 第一个 参数 放入 eax 寄存器 第二个 参数 放入 edx 第三个 参数 放入 ecx 寄存器 其余 参数 按照 与 vc 程序 类似 的 方式 压 栈 总之 delphi 编译器 默认 以 register 方式 传递函数 参数 这一点 与 vc 编译 的 程序 完全 不同 提示 栈 上 给 局部变量 分配 空间 的 时候 栈 是 向下 增长 的 而 栈 上 的 数组 字符串 结构 体 等 却是 向上 增长 的 理解 这一点 可以 帮助 识别 栈 上 的 变量 三 ida 静态 分析 和 od 动态 分析 当 我们 完成 病毒 样本 的 检测 后接 下来 就需要 使用 反汇编 工具 进行 分析 了 基本 载入 第一步 使用 idapro 载入 病毒 样本 下 图为 delphi 自己 生产 的 内容 并不是 我们 关心 的 重点 我们 更 关心 病毒 程度 的 功能 代码 本文 主要 讲解 病毒 的 关键 函数 第二步 定位 到 xcbe 位置 发现 这两个 call 是 调 用了 同一个 函数 subcxcbesubc 注意 某些 病毒 在 ida 中会 自动 分析 出 字符串 感谢 艾玛 并且是 在 调用 subc 函数 之前 我们 可以 推测 上面 那个 函数 也 传 递了 一个 字符串 接着 可以 通过 od 动态 调试 获取 字符串 对应 的 值 但是 我 目前 的 ida 并没有 自动 解析 出 字符串 的 值 只能 通过 经验 进行 分析 或 od 动态 调试 我们 发现 ebp 是 堆栈 基址 接近 着 两次 调用 subc 函数 前面 的 mov 赋值 经过 是 参数 传递 的 工作 从而 猜测出 它 的 功能 是 参数 传 递给 函数 调用 subc 函数 分析 第三步 调用 od 进行 动态 分析 查看 subc 函数 调用 前 传递 的 参数 xcbsubc 打开 od 如上图 所示 我们 需要 定位 到 xcb 位置 直接 按 f 执行 代码 单 步步 过当 执行 到 xcb 位置 可以 看到 对应 的 值 为 武汉 男生 感染 下载者 当然 某些 od 不会 显示 该 值 只会 显示 ccsetupcc 此时 需要 我们 进一步 在 数据 窗口 跟随 数据 窗口 右键 gt 转到 gt 表达式 接着 输入 cc 查找 传递 参数 对应 的 值 显示 结果 如 下图 所示 可以 看到 武汉 男生 感染 下载者 包括 艾玛 这 就是 病毒 作者 的 信息 早些 年 病毒 作者 处于 炫耀 目的 都会 加入 一些 自己 的 特征 同样 现在 apt 攻击 溯源 也 会 通过 文件 路径 等 获取 病毒 作者 的 信息 xcc 第四步 分析 病毒 程序 利用 c 函数 做了 什么 callc 接着 在这 个 位置 xcbe 按 下 f 增加 断点 然后按 f 执行 过来 按 下 f 进入 call 函数 进入 的 函数 如 下图 所示 接着 按 f 执行 遇到 calld 继续 按 下 f 进入 再 进入 call 继续 进入 当 进入 call 函数 后 我们 分析 这里 的 两个 api 函数 它是 对 互斥 空间 进行 初始化 我们 继续 按 下 f 单 步步 过 执行 往下 分析 发 现在 xb 位置 调用 localalloc 函数 该 函数 用于 内存 分配 它会 分配 大小 为 ff 的 空间 flags 为 lmemfixed 表示 分配 一个 固定 的 内存 该 函数 执行 结果 会 返回 一个 指向 新 分配 的 内存 对象 的 句柄 localalloc 写到 这里 基 本就 确定 了 这个 calld 的 功能 即 分配 一定 大小 的 内存空间 我们 已经 进 入了 好 几层 call 那 怎么 返回 的 呢 接下来 我们 再回到 ida 进行 分析 第五步 打开 ida 进入 subc 函数 xcbecallsubc 整个 subc 函数 由 两个 函数 组成 刚才 我们 所 进入 的 是 第一个 callsubd 的 位置 并且 分析 了 其 功能 是 分配 一定 大小 的 空间 接着 我们 尝试 分析 下一个 函数 subxcbcallsub 接着 记住 这个 地址 cb 我们 回到 od 进行 动态 调试 分析 其 功能 转到 gt 表达式 gt 输入 cb 显示 结果 如 下图 所示 然后 我们 按 下 f 增加 断点 再按 f 执行 程序 至 此处 继续 按 下 f 单步 进入 该 函数 第六步 分析 sub 函数 的 功能上 一步 最终 显示 结果 如 下图 所示 需要 注意 的 是 rep 位置 按 下 f 单 步步 过 执 行至 xd 位置 注意 该 rep 是 将 esi 指向 地址 的 值 以 字节 方式 拷贝到 edi 指向 的 地址 中 下图 展示 了 esi 和 edi 重 执行 ecx 次 每次 执行 后 esiediecxod 中 在 这段 代码 中下 断后 按 f 单步 步入 就可以 观察到 这个 寄存器 的 变化 ecx 十进制 我们 先 看看 它 复制 的 内容 是什么 选择 esi 右键 数据 窗口 钟 跟随 地址 esi 显示 武汉 男生 信息 所要 复制 的 空间 是 edi 为 空白 空间 按 下 f 运行 后 发现该 空间 被 赋值 武汉 男生 写到 这里 基本 确定 了 sub 函数 功能 就是 字符串 的 复制 总结 subc 主要 包括 两个 函数 其 对应 功能 如下 subd 分配 内存空间 sub 字符串 拷贝 功能 同时 我们 可以 在 ida 中 对 subc 进行 重命名 操作 命名为 重命名 能将 整个 程序 中 该 函数 进行 修改 便于 我们 理解 及 分析 整个 病毒 subc 函数 有 两个 参数 由于 采用 的 是 delphi 编译器 因此在 反汇编 中 第一个 参数 保 存在 eax 中 第二个 参数 保 存在 edx 中 这个 函数 首先 完 成堆 空间 的 申请 然后 将 edx 中 保存 的 字符串 复制到 新 申请 的 空 间中 这个 函数 在 最初 赋值 的 时候 eax 的 值 均为 而在 执行 后 eax 中 保存 的 就是 新 申请 的 堆 空间 中所 复制 的 字符串 的 首 地址 为了 易于 观察 我 把 idapro 中 的 subc 重 命名为 下面 补充 一段 姜 老师 的 注释 对 大家 逆向 分析 和 汇编 理解 很有 帮助 codecsub 对 edx 进行 验证 这里 的 test 相当于 and 不同 的 是 test 只 进行 比较 而 不 会将 结果 保 存在 edx 中 由于 edx 保存 的 是 病毒 作者 所 编写 的 一段 字符串 因此 这里 的 结果 一定 是非 的 由于 上 一条 语句 的 结果 是非 的 因此 这条 跳转 语句 并不会 被执行 到 codeccmovecxedx 利用 od 进行 动态 分析 可知 edx 是 将 edx 这个 地址 中 的 值 取出来 赋 给 ecx 那么 赋 值完 以后 ecx 的 值 为 自 增 那么 ecx 的 值 就 变 为了 x 注意 这个 自 增 的 运算 会 使得 zf 的 值 变为 这里 的 jg 表明 不大于 则 跳转 或者 更 准确 地 说 其 跳转 条件 是 sfof 且 zf 由于 经 过上 一步 的 运算 zf 因此 本 跳转 不成立 经过 赋值 后 eax 中 保存 的 值 为 xcodecacallsubd 结合 od 在 虚拟机 中进 行 动态 分析 进入 一层 又一 层 的 调用 可以 得知 这个 call 主 要是 调 用了 localalloc 函数 它从 堆 中 分配 大小 为 xff 的 空间 函数 参数 uflags 即 lmemfixed 意思 是 分配 固定 内存 返回值 是 指向 一个 内存 对象 的 指针 localalloc 函数 如果 执行 成功 则 返回 一个 指向 新 分配 的 内存 对象 的 句柄 结合 od 在 虚拟机 中进 行 动态 分析 这个 call 的 主要功能 是 将 之前 保 存在 edx 中 的 字符串 病毒 信息 与 作者 感言 拷贝到 上面 所分 分配 的 堆 空 间中 如图所示 函数 分析 第七步 继续 从 xcb 位置 往下 分析 将该 地址 复制到 od 中 动态 调试 操作 如下 转到 gt 表达式 gt 输入 cb 按 下 f 增加 断 点按 下 f 执 行将 代码 调试 到 该 位置 然后按 f 单步 执行 可以 看到 xcba 存储 的 值 某些 情况 还需 要去 数据 窗口 跟随 数据 窗口 右键 gt 转到 gt 表达式 gt 输入 cca 可以 发 现在 cca 位置 保存 了 一段 字符串 它 可能是 一段 乱码 目前 无法 分析 它 的 含义 继续 按 下 f 执行 到 xcbf 按 下 f 进入 函数 xcbfcall 进入 后 先 简单 浏览 下 这个 函数 发现 后续 有 一个 粗线 循环 我们 在 xcc 下个 断点 跳 转到 这个 循环 处 并 进入 循环 f 按 下在 xcc 处 增加 断点 f 执行 到 循环 处 f 进入 循环 按 下 f 单步 执行 代码 此时 发现 字符串 xboy 我们 暂时 不知道 它是 做什么 的 接着 继续 按 下 f 调试 发现 它将 字母 b 赋值 给 了 eax 我们 怀疑 它 跟 xboy 有关 接下来 的 代码 分析 如下 movecxxa 将 常量 a 赋值 给 ecx 通常 存在 两种 可能性 一种 可能是 ecx 作为 循环 的 此时 即 可能 循环 a 次 另一种 可能是 exc 作为 一个 运算 的 除数 xoredxedx 异 或 操作 将 自身 清空 divecx 可以 发现 它是 一个 除法 操作 除数 即为 ecx 结果 显示 如 下图 所示 除法 的 商 eax 为 余数 edx 为 通常 除法 有 两种 可能 要么 获取 eax 的 商 值 要么 获取 余数 edx 的 内容 那么 这个 程序 究竟 需要 哪一个 值 呢 该 语句 将 值 赋 给 eax 所以 上述 程序 做 除法 的 目的 是 获取 edx 这个 值 接着 在 数据 窗口 中跟 随 地址 查看 这个 值 保存 的 是什么 内容 输出 结果 如 下图 所示 它是 刚才 我们 发现 的 乱码 暂时 还不 知道 它 的 具体 作用 继续 按 下 f 执行 程序 xoredxeaxedx 和 eax 异 或 操作 其 值 保 存在 edx 中 即 除法 的 余数 edx 和 乱码 eax 进行 异 或 操作 继续 按 下 f 单步 走在 x 处 出现 了 个 地址 我们 在 数据 窗口 中 跟随 数值 发现 这个 结果是 a 该 值 正式 刚才 异 或 出来 的 edx 结果 接着 我们 尝试 在 下列 两个 位置 增加 断点 xex 接着 按 下 f 运行 查看 输出 的 结果 分析 如下 将 xboy 的 第三个 字母 o 取出 解密 数据 窗口 新增 很多 内容 完成 字符串 拷贝 反复 继续 按 f 调试 发现 它 依次 获取 xboy 中 的 值 再 进行 异 或 操作 小结 最终 解密 的 值 如 下图 所示 武汉 男生 感染 下载者 逐渐 出现 sub 函数 我们 在 ida 中 重 命名为 decodestring 即 解密 字符串 补充 汇编 代码 每次 循环 逐 字节 取出 xboy 中 的 字符 进行 运算 注意 这里 首先 取出 的 是 bcodeedmovecxah 将 ecx 赋值 为 xa 作为 接下来 除法 运算 的 除数 codefxoredxedx 清空 edxcodefdivecx 做 除法 运算 商 保 存在 eax 中 余数 保 存在 edx 中 这里 由于 给 eax 重新 赋值 说明 程序 实际 想 使用 的 是 edx 中 的 余数 每次 循环 逐 字节 取出 乱码 中 的 字符 赋值 给 eax 进行 接下来 的 运算 codefexoredxeax 异 或 运算 结果 保 存在 edx 中 也 就是 通过 运算 最终 得出 的 字符 函数 分析 第八 步 继续 分析 sub 函数 的 功能 记住 地址 xcba 复制到 od 中 进行 调试 首先 取消 刚才 解密 的 两个 断点 然后 跟随 表达式 cba 在 该 位置 按 下 f 增加 断点 然后 f 执行 过来 首先 看到 两条 赋值 语句 将 值 赋 给 edx 和 eax 中 由于 这个 程序 是 使用 delphi 编写 所以在 call 之前 会将 参数 放到 寄存器 中 我们 首先 看看 edx 中 的 内容 在 数据 窗口 中 跟随 数值 发现 它们 都是 武汉 男生 感染 下载者 注意 第 一个是 我们 刚才 解密 出来 的 内容 接着 按 下 f 执行 再按 f 进入 call 函数 大致 浏览 该 函数 后 发 现又 存在 一个 循环 我们 的 重点 就是 分析 该 循环 按 下 f 增加 断点 再按 f 执行 过来 x 在 数据 窗口 中 跟随 发现 ecx 和 ebx 就是 刚才 所说 的 两个 参数 一个是 原始 的 武汉 男生 感染 下载者 另外 一个是 解密 之后 的 武汉 男生 感染 下载者 再按 f 发现 这个 函数 比较 两个 字符串 是否 相同 的 操作 cmpecxebx 总结 回到 ida 我们 将 函数 sub 重 命名为 字符串 比较 函数 功能分析 第九步 分析 loccbbc 功能 继续 往下 看 发现 只要 cmpstring 两个 字符串 相同 就会 跳 转到 loccbbc 的 位置 继续 分析 发现 这里 同样 存在 字符串 解密 和 字符串 比较 的 操作 并且 解密 字符 编程 了 武汉 男孩 whboy 这里 不再 进行 解读 解密 比较 成功 之后 继续 跳 转到 loccbe 的 位置 这里 看到了 三个 call 函数 它们 又是 什么 功能 呢 这三个 call 是 熊猫 烧香 病毒 最 重要 的 功能 我们 下一 篇 论文 继续 分析 四 总结 写到 这里 熊猫 烧香 病毒 起始 阶段 的 逆向 分析 就 介绍 完毕 简单 总结 如下 xcbecallsubc 重 命名为 分配 内存空间 sub 字符串 拷贝 功能 xcbfcallsub 重 命名为 decodestringxcc 循环 入口 点 xe 获取 xboy 解密 字符 x 完成 异 或 解密 操作 xcbaccallsub 重 命名为 cmpstringx 循环 入口 点 功能 字符串 比较 武汉 男生 感染 下载者 xcbccloccbbc 功能 字符串 解密 和 比较 操作 解密 字符 后续 会 继续 分析 熊猫 烧香 病毒 的 核心 功能 三个 函数 正如 姜 老师 所说 由于 反汇编 代码 总会 出现 各种 调用 与 跳转 所以 分析 时会 显得 很是 凌乱 可能会 打消 大家 的 积极性 但也 可以 看见 逆向 分析 工作需要 各位 读者 的 耐心 与 细致 需要 大家 沉得住气 不断 跟踪 每一个 可疑 的 call 需要 大家 时刻 留意 寄存器 中 的 内容 才能够 找到 我们 需要 的 信息 当然 经验 也是 非常重要 的 再次 感谢 姜 老师 的 分享 真的 受益匪浅 也 希望 自己 不断深入 真正 能在 逆向 分析 和 恶意代码 中 学到 东西 加油 学 安全 一年 认识了 很多 安全 大佬 和 朋友 希望 大家 一起 进步 这篇 文章 中 如果 存在 一些 不足 还请 海涵 作者 作为 网络安全 和 系统安全 初学者 的 慢慢 成长 路 吧 希望 未来 能 更 透彻 撰写 相关 文章 同时 非常感谢 参考文献 中 的 安全 大佬 们 的 文章 分享 深知 自己 很菜 得 努力 前行 编程 没有 捷径 逆向 也没有 捷径 它们 都是 搬 砖 活 少 琢磨 技 巧干 就 对了 什么时候 你 把 攻击 对手 按在 地上 摩擦 你 就 赢了 也 会 慢慢 形 成了 自己 的 安全 经验 和 技巧 加油 吧 少年 希望 这个 路线 对 你 有所 帮助 共勉 年月 新开 的 娜 璋 ai 安全 之家 主要 围绕 python 大数 据分析 网络空间 安全 人工智能 web 渗透 及 攻防 技术 进行 讲解 同时 分享 ccfsci 南 核 北 核 论文 的 算法 实现 娜 璋 之家 会 更加 系统 并 重构 作者 的 所有 文章 从 零 讲解 python 和 安全 写了 近十年 文章 真心 想把 自己 所学 所 感 所做 分享 出来 还请 各位 多多指教 真诚 邀 请您 的 关注 谢谢 前文 参考 byeastmount 星期 二晚 上点 写 于 武汉 参考文献 姜 晔 老师 真的 非常 佩服 和 值得 去 学习 希望 自己 和 大家 的 技术 能 不断 提升 加油 网络安全 自学 篇 木马 原理 详解 远程 服务器 ipc 漏洞 及 木马 植入 实验 姜 晔 老师 的 技术 空间 目录 csdn 腾讯 安全 联合 实验室 知 乎 文章 网络安全 自学 篇 七十九 windowspe 病毒 原理 分类 及 感染 方式 详解 姜 晔 老师 技术 分享 b 站 网络安全 自学 篇 四十九 procmon 软件 基本 用法 及 文件 进程 注册表 查看 安全 攻防 进阶篇 八 那些 年 的 熊猫 烧香 及 pe 病毒 行为 机理 分析 网络安全 自学 篇 七十三 wannacry 勒索 病毒 复现 及 分析 四 蠕虫 传播 机制 源码 详解 