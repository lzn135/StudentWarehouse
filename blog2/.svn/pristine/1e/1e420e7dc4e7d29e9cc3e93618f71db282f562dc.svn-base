java 的 synchronized 同步 方法 使用 场景 举例 解读 前言 线程 同步 是 指 多个 线程 同时 访问 某一个 共享资源 保证 在 同一时间 只能 有 一个 线程 访问 该 资源 java 一般 用 synchronized 关键字 来 做 线程 同步 简单 实用 下面 直 接给 个 例子 说明 一 下一 举个 买票 的 例子 一般 大家 也 会用 这个 来 举例 很 常见 也 便于 理解 首先 创建 一个 ticket 类 用于 表述 车票 如下 车票 类 intticketnum 这里 先 注销 这个 同步 关键字 voidbuyticket intamount 当前 可 售 票数 ticketnum if 目前 剩余 票数 ticketnum 购票 amount 可 售 票数 不足 购票 amount 剩余 票数 ticketnum if ticketnumlt 票 售罄 创建 一个 客户端 类 buyticketclient 用于 提供 买票 服务 购票 服务端 ticketbuyticket amount 模拟 多人 购票 模拟 多人 购票 stringargs ticket ticket ticket buyticketclient buyticketclient buyticketclient threadstart threadstart threadstart 运行 看一下 结果 每次 运行 结果 可能 都不 同 当前 可 售 票数 当前 可 售 票数 当前 可 售票 数 目前 剩余 票数 购票 可 售 票数 不足 购票 剩余 票数 购票 剩余 票数 票 售罄 票 售罄 会 发现 输出 结果 完全 对不上 主要 原因是 多线程 执行 顺序 不 可控 票 数量 ticketnum 字段 修改 是 混乱 的 加 synchronized 字段 做 同步 步骤 代码 中 buyticket 方法 加 synchronized 字段 如下 车票 类 intticketnum intamount 当前 可 售 票数 ticketnum if 目前 剩余 票数 ticketnum 购票 amount 可 售 票数 不足 购票 amount 剩余 票数 ticketnum if ticketnumlt 票 售罄 再次 运行 步骤 的 代码 结果 如下 每次 运行 结果 可能 不同 当前 可 售 票数 购票 剩余 票数 当前 可 售 票数 购票 剩余 票数 当前 可 售票 数 目前 剩余 票数 购票 可 售 票数 不足 显示 结果是 合理 的 二 synchronized 使用说明 synchronized 一般 涉及 三种 使用 场景 修饰 实例 方法 作用于 当前 对象 实例 进入 同步 代码 前 要 获得 当前 实例 的 锁 上述 买票 例子 就是 对 实例 方法 buyticket 加锁 另外 一个 线程 正在 访问 一个 对象 实例 的 synchronized 实例 方法 那么 其他 线程 不能 访问 该 对象 实例 的 其他 synchronized 方法 毕竟 一个 对象 实例 只有 一把 锁 当 一个 线程 获 取了 该 对象 实例 的 锁 之后 其他 线程 无法 获取 该 对象 实例 的 锁 所以 无法访问 该 对象 实例 的 其他 synchronized 实例 方法 修饰 代码 块 作用于 对象 实例 进入 同步 代码 前 要 获得 当前 实例 的 锁 上述 ticket 类 改 一下 就是 如下 intticketnum intamount synchronized ticketnum 当前 可 售 票数 ticketnum if 目前 剩余 票数 ticketnum 购票 amount 可 售 票数 不足 购票 amount 剩余 票数 ticketnum if ticketnumlt 票 售罄 上述 代码 是 对 integer 类型 的 ticketnum 对象 实例 加锁 大多 时候 推荐 使用 this 替换 ticketnumthis 表示 对 当前 实例 加锁 到 这里 和 实例 方法 加锁 是 一样 的 含义 同时 还 可以 把 ticketnum 换成 ticketclass 类 锁 这个 在 下面 细说 修饰 静态 方法 作用 当前 类 进入 同步 代码 库 前 要 获得 给定 类 的 锁 就是 中 说的 类 锁 这个 很有 意思 举个 例子 说明 一下 和 实例 方法 加锁 的 区别 synchronized ipublicvoidrun for intjjltj increase increasestatic increaseclass 测试 stringargs syntwomethod syntwomethod threadstart threadstart threadjoin threadjoin syntwomethodi increase 方法 是 实例 方法 加锁 increasestatic 是 静态 方法 加锁 increaseclass 是 通过 代码 块 对 对象 加锁 测试 方法 生 成了 同一 对象 的 不同 实例 在 run 方法 里 分别 执行 三种 方法 会 发现 increase 得到 的 结果是 小于 increasestatic 和 increaseclass 得到 的 结果 都是 结论 存在 类 锁 的 类 无论 生成 多少个 实例 在 执行 加锁 方法 时 都会 单一 执行 而 实例 加锁 只对 同一个 实例 有效 