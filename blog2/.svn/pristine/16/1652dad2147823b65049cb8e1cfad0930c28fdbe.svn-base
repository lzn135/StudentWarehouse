系统安全 二十四 逆向 分析 之 ollydbg 调试 int3 断点 反 调试 硬件 断点 与 内存 断点 您 可能 之前 看到过 我 写 的 类似 文章 为什么 还要 重复 撰写 呢 只是 想 更好 地 帮助 初学者 了解 病毒 逆向 分析 和 系统安全 更加 成 体系 且不 破坏 之前 的 系列 因此 我 重新 开 设了 这个 专栏 准备 系统 整理 和 深入 学习 系统安全 逆向 分析 和 恶意代码 检测 系统安全 系列 文章 会 更加 聚焦 更加 系统 更加 深入 也是 作者 的 慢慢 成长史 换 专业 确实 挺 难 的 逆向 分析 也是 块 硬骨头 但我 也 试试 看看 自己 未来 四年 究竟 能 将它 学到 什么 程度 漫漫 长征路 偏向虎山行 享受 过程 一起 加油 作者 前文 介绍 了 ollydbg 动态 调试 工具 的 基本 用法 包括 界面 介绍 常用 快捷键 和 traceme 案例 分析 这篇 文章 将 讲解 逆向 分析 之 ollydbg 动态 调试 工具 包括 int 断点 反 调试 硬件 断点 和 内存 断点 这些 基础 性知识 不仅 和 系统安全 相关 同样 与 我们 身边 常用 的 软件 文档 操作系统 紧密联系 希望 这些 知识 对 您 有所 帮助 更 希望 大家 提高 安全意识 安全 保障 任重道远 本文 参考 了 b 站 yxfzedu 安全 网站 和 参考文献 中 的 文章 并 结合 自己 的 经验 和 实践 进行 撰写 在此 感谢 这些 大佬 们 文章 目录 一 常用 断点 之 int 断点 查看 int 断点 int 原理 int 例子 二 int 断点 的 反 调试 与 反反 调试 三 常用 断点 之 硬件 断点 原理 解析 四 常用 断点 之 内存 断点 原理 解析 五 总结 作者 的 github 资源 软件 安全 其他 工具 逆向 分析 文章 目录 一 常用 断点 之 int 断点 查看 int 断点 int 原理 int 例子 二 int 断点 的 反 调试 与 反反 调试 三 常用 断点 之 硬件 断点 原理 解析 四 常用 断点 之 内存 断点 原理 解析 五 总结 从 年月 开始 我 来 到了 一个 陌生 的 专业 网络空间 安全 初 入 安全 领域 是 非常 痛苦 和 难受 的 要 学 的 东西 太多 涉及面 太 广 但 好在 自己 通过 分享 篇 网络安全 自学 系列 文章 艰难 前行 着 感恩 这一 年 相识 相知 相 趣 的 安全 大佬 和 朋友们 如果 写得 不好 或 不足之处 还请 大家 海涵 接下来 我 将 开启 新 的 安全 系列 叫 系统安全 也是 免费 的 篇文章 作者 将 更加 深入 的 去 研究 恶意 样本 分析 逆向 分析 内网 渗透 网络 攻防 实战 等 也 将 通过 在线 笔记 和 实践 操作 的 形式 分享 与 博 友 们 学习 希望 能与 您 一起 进步 加油 推荐 前文 网络安全 自学 篇 系列 篇 作者 的 github 资源 逆向 分析 网络安全 前文 分析 系统安全 一 什么 是 逆向 分析 逆向 分析 基础 及 经典 扫雷 游戏 逆向 系统安全 二 如何 学好 逆向 分析 及 吕布 传 游戏 逆向 案例 系统安全 三 idapro 反汇编 工具 初识 及 逆向 工程 解密 实战 系统安全 四 ollydbg 动态 分析 工具 基础 用法 及 crakeme 逆向 系统安全 五 ollydbg 和 cheatengine 工具 逆向 分析 植物 大战 僵尸 游戏 系统安全 六 逆向 分析 之 条件 语句 和 循环 语句 源码 还原 及 流程 控制 系统安全 七 逆向 分析 之 pe 病毒 原理 c 实现 文件 加解密 及 ollydbg 逆向 系统安全 八 windows 漏洞 利 用之 cve 复现 及 蓝屏 攻击 系统安全 九 windows 漏洞 利 用之 ms 远程 代码 执行 漏洞 复现 及 深度 提 权 系统安全 十 windows 漏洞 利 用之 smbv 服务 远程 代码 执行 漏洞 cve 复现 系统安全 十一 那些 年 的 熊猫 烧香 及 pe 病毒 行为 机理 分析 系统安全 十二 熊猫 烧香 病毒 ida 和 od 逆向 分析 上 病毒 初始化 系统安全 十三 熊猫 烧香 病毒 ida 和 od 逆向 分析 中 病毒 释放 机理 系统安全 十四 熊猫 烧香 病毒 ida 和 od 逆向 分析 病毒 释放 过程 下 系统安全 十五 chrome 浏览器 保留 密码 功能 渗透 解析 蓝屏 漏洞 及 某 音乐 软件 漏洞 复现 系统安全 十六 pe 文件 逆向 基础知识 pe 解析 pe 编辑 工具 和 pe 修改 系统安全 十七 windowspe 病毒 概念 分类 及 感染 方式 详解 系统安全 十八 病毒 攻防 机理 及 winrar 恶意 劫持 漏洞 脚本 病毒 自启动 定时 关机 蓝屏 攻击 系统安全 十九 宏病毒 之 入门 基础 防御 措施 自发 邮件 及 apt 宏 样本 分析 系统安全 二十 pe 数字签名 之 上 什么 是 数字签名 及 signtool 签名 工具 详解 系统安全 二十一 pe 数字签名 之 中 工具 用法 系统安全 二十二 pe 数字签名 之 下 微软 证书 漏洞 cve 复现 及 windows 验证 机制 分析 系统安全 二十三 逆向 分析 之 ollydbg 动态 调试 复习 及 traceme 案例 分析 系统安全 二十四 逆向 分析 之 ollydbg 调试 int 断点 反 调试 硬件 断点 与 内存 断点 声明 本人 坚决 反对 利用 教学方法 进行 犯罪 的 行为 一切 犯罪行为 必将 受到 严惩 绿色 网络 需要 我们 共同 维护 更 推荐 大家 了解 它们 背后 的 原理 更好 地 进行 防护 该 样本 不会 分享 给 大家 分析 工具 会 分享 参考文献 见 后 一 常用 断点 之 int 断点 查看 int 断点 int 断点 对应 od 中 的 f 断点 有时 也 称为 cc 断点 为什么 叫 cc 断点 呢 因为 转换成 硬 编码 之后 就是 cc 我们 来 查看 cc 断点 首先 我们 用 od 打开 程序 tracemeexe 打开 之 后会 自动 定位 至 a 接着 再下 一行 增加 断 点按 f 即 int 断点 但 od 中 并没有 显示 cc 我们 打开 cheatengine 软件 然后 在 od 按 下 f 运行 弹出 如 下图 对话框 接着 在 ce 中 选择 该 程序 traceme 打开 然后 点击 手动 加入 地址 输入 地址 a 接着 选中 数据 并 右键 点击 显示 未 十六进制 由于 采用 小 端 存储 故 ffaeccc 是 从 右 往左 数 的如 下图 所示 如果 我们 选择 字节 点击 然后 选择 byte 可以 转换成 个 字节 因为 cc 就 占用 一个 字节 我们 主 要是 观察 它 的 为什么 od 不 显示 cc 呢 其实 od 是为了 不 破坏 源代码 的 完整性 默认 隐藏 掉了 int 原理 接着 我们 分析 int 的 原理 程序 运行 中 od 会 检查 汇编 指令 有没有 int 即 机器码 有没有 cc 指令 如果 存在 就会 引发 并 捕获 这个 异常 程序 就 中断 在 此处 然后 od 会 删除 int 还原 原来 的 代码 接着 继续 运行 我们 的 程序 执行 流程 的 原理 可 归纳 为 替换 指令 换成 int 指令 或 cc 硬 编码 od 检 测到 int 指令 之 后会 引发 一个 异常 并且 捕获 它 这时候 程序 就会 中断 删除 int 指令 还原 之前 的 指令 优点 可以 无限 的 下 int 断点 缺点 很 容易 被 检测 为什么 要 详细 介绍 断点 的 原理 呢 只有 了解 每个 断点 的 原理 之后 以后 做 爆破 才 知道 应 该下 什么样 的 断点 合适 int 例子 接下来 我们 举个 int 断点 的 例子 使用 od 打开 tracemeexe 程序 设置 api 断点 这里 勾 选 getdlgitemtexta 函数 接着 输入 用户名 和 序列号 按 f 运行 程序代码 会 停在 f 位置 我们 接着 用 ce 看看 它是 不是 cc 断点 接着 以 十六进制 显示 并 只显示 一 字节 发现 的 确是 cc 断点 所以 cc 断点 很 容易 被 检测 出来 二 int 断点 的 反 调试 与 反反 调试 我们 编写 的 软件 被 爆破 时 总 会被 下 int 断点 我们 能不能 写个 程序 防止 别 人下 cc 断点 从而 保护 我们 的 程序 呢 这个 就叫 反 调试 而 反反 调试 是 绕过 保护 过程 反 调试 保护 这个 程序 反反 调试 爆破 这个 程序 基础知识 farproc 结构 体 getprocaddress 函数 它是 一个 计算机 函数 功能 是 检索 指定 的 动态 链接库 dll 中 的 输出 库函数 地址 loadlibrary 函数 将 指定 的 模块 加 载到 调用 进程 的 地址 空 间中 接着 我们 用 vs 编写 代码 讲解 loadlibrary 函数 会 返回 一个 句柄 然后 调用 getprocaddress 函数 getprocaddress 返回值 包括 如果 函数 调用 成功 返回值 是 dll 中 的 输出 函数 地址 如果 函数 调用 失败 返回值 是 null 得到 进一步 的 错误信息 调用 函数 模块 句柄 函 数名 第一步 我们 打开 vs 编写 c 代码 下列 代码 是 获取 messageboxa 函数 的 首 地址 并 判断 是否 为 cc 断点 获取 messageboxa 的 首 地址 loadlibrary luserdll messageboxa 仅 获取 首 地址 的 第一个 字节 bytebyteaddr byte addr 弹 框 messageboxa null 内容 标题 mbok 判断 地址 if byteaddrxcc 检 测到 有 人在 调试 我们 的 程序 退出 程序 printf 检 测到 非法 调试 elseprintf 代码 正常 getchar 在 vs 中 输入 上述 代码 第二步 运 行前 需要 简单 设置 设置 release 设置 属性 禁用 spectre 缓解 设置 随机 基址 否 第三步 接着 运行 代码 运行 结果 如 下图 所示 显示 代码 正常 执行 第四步 使用 od 调试程序 接下来 我们 尝试 调试 这个 exe 程序 用 od 打开 打开 如 下图 所示 然后 点击 插件 gtapi 断点 设置 工具 gt 常用 断点 设置 给 messageboxa 下 断点 运行 od 断点 位于 ef 位置 对应 usermessageboxa 继续 运行 代码 查看 调试 信息 发现 检 测到 非法 调试 也 表明 我们 的 判断 没有问题 第五步 删除 断点 对比 执行 结果 接着 按 下 b 删除 断点 继续 运行 代码 发现 代码 正常 运行 这 就是 一个 int 断点 的 反调 试 过程 那么 怎么 进行 反反 调试 呢 我们 又 怎么 下 int 断点 呢 我们 进入 函数 之后 可以 将 断点 下到 中 间或 尾部 即可 od 重新 打开 程序 并 找到 messageboxa 的 位置 我们 在 中间 位置 下 断点 如 下图 所示 ef 处 接着 f 运行 程序 发现 此时 输出 代码 正常 该 断点 并没有 被 检测 出来 这 就是 所谓 的 反反 调试 三 常用 断点 之 硬件 断点 原理 解析 硬件 断点 和 调试 寄存器 有关 共有 个 调试 寄存器 drdrdrdr 保存 断点 地址 由于 只有 个 硬件 断点 寄存器 所以 同时 最多 只能 设置 个 硬件 断点 drdr 系统 保留 dr 状态 寄存器 显示 哪个 硬件 调试 寄存器 引发 的 断点 如果是 drdr 的话 相应 位 会被 置 如果是 dr 引发 的 断点 则 dr 的 第 位 被 置 如果是 dr 引发 的 断点 则 dr 的 第 位 被 置 依次 类推 因为 硬件 断点 同时 只会 触发 一个 所以 dr 的 低位 最多 只有 一位 被 置 所以在 进入 单步 后 我们 可以 通过 检测 dr 的 低位 是否 有的 位 就可以 判断 该 单步 是否 是因为 硬件 断点 被 断 下 的 如果是 硬件 断点 被 断 下 的 进而 而 可以 通过 dr 的 哪一位 为 来 判断 是 由 drdr 中 的 哪个 断点 断 下 的 dr 控制 寄存器 设置 相应 控制 位 用于 控制 断点 的 方式 原理 drdr 保存 我们 断点 的 地址 dr 寄存器 设置 相 对应 的 控制 位 程序 执行 到 该 地址 时 cpu 会 向 od 发送 异常 信息 程序 会 执行 中断 操作 等待 用户 操作 优点 速度快 比 int 快 因为 int 需要 改 汇编 代码 而 硬件 断点 使用 寄存器 不容易 被 检测 缺点 最多 只能 下个 硬件 断点 接着 我们 继续 用 od 分析 tracemeexe 为 例 打开 之后 定位 至 a 位置 选择 b 位置 右键 断点 gt 硬件 执行 这样 就 增加了 一个 硬件 断点 当 cpu 运行 到 该 地址 会 发送 一场 信息 中断 如何 查看 硬件 断点 呢 点击 调试 gt 硬件 断点 可以 查看 刚 打的 硬件 断点 接着 按 下 f 运行 程序 它会 停在 硬件 断点 位置 四 常用 断点 之 内存 断点 原理 解析 在 介绍 内存 断点 之前 首先 需要 知道 什么 是 内存 属性 内存 属性 包括 的 组合 即 可读 可写 可执行 比如 函数 可以 改 变在 特定 进程 中 内存 区域 的 保护 属性 内存 断点 就是 根据 内存 属性 来 实现 的 比如 想 对 一个 地址 打个 内存 访问 断点 就是 把 这个 地址 的 内存 属性 改为 不可 访问 不可 读写 执 行当 程序 运行 到 此处 时 就会 产生 一个 异 常被 od 捕获 从而 中断 程序 原理 设置 完 内存 断点 之后 它 就是 对 这个 地址 赋予 了 不 可读 不 可写 不可 执行 的 属性 程序 运行 到 这里 之 后会 产生 一个 异常 od 捕获 这个 异常 然后 程序 中断 实现 了 一个 内存 断点 优点 没有 改变 汇编 代码 改变 的 是 内存 属性 游戏 爆破 时 如果 常规 断点 没 效果 可以 尝试 内存 断点 接下来 我们 想在 d 位置 代码 增加 内存 断点 对应 代码 该 代码 就是 一个 写 操作 edx 往 dsx 中 写入 一个 值 选择 数据 窗口 中 跟随 然后再 数据 窗口 中 选择 个 字节 右键 断点 gt 内存 写入 或 内存 访问 然后按 下 f 运行 此时 断 到了 此处 证明 我们 内存 写入 断点 已经 生效 接下来 补充 内存 读写 断点 和 硬件 读写 断点 的 区别 以 刚才 的 代码 为 例 我们 先 删除 刚才 的 内存 断点 接着 od 重新 打开 exe 程序 数据 窗口 跟 随到 选中 字节 设置 其为 硬件 写入 断点 运行 代码 此时 硬件 断点 断 在 了 下一 行 位置 d 至此 内存 断点 和 硬件 断点 介绍 完毕 五 总结 写到 这里 这篇 文章 就 介绍 完毕 希望 您 喜欢 常用 断点 之 int 断点 查看 int 断点 int 原理 int 例子 int 断点 的 反 调试 与 反反 调试 常用 断点 之 硬件 断点 原理 解析 常用 断点 之 内存 断点 原理 解析 这篇 文章 中 如果 存在 一些 不足 还请 海涵 作者 作为 网络安全 初学者 的 慢慢 成长 路 吧 希望 未来 能 更 透彻 撰写 相关 文章 同时 非常感谢 参考文献 中 的 安全 大佬 们 的 文章 分享 感谢 师傅 师兄 师弟 师姐 师妹 们 的 教导 深知 自己 很菜 得 努力 前行 欢迎 大家 讨论 是否 觉得 这 系列 文章 帮助 到 您 任何 建议 都可以 评论 告知 读者 共勉 逆向 分析 网络安全 年月 新开 的 娜 璋 ai 安全 之家 主要 围绕 python 大数 据分析 网络空间 安全 人工智能 web 渗透 及 攻防 技术 进行 讲解 同时 分享 ccfsci 南 核 北 核 论文 的 算法 实现 娜 璋 之家 会 更加 系统 并 重构 作者 的 所有 文章 从 零 讲解 python 和 安全 写了 近十年 文章 真心 想把 自己 所学 所 感 所做 分享 出来 还请 各位 多多指教 真诚 邀 请您 的 关注 谢谢 byeastmount 夜 于 武汉 参考 文章 动态 调试 工具 之 ollydbg od 教程 b 站 yxfzedu 逆向 笔记 od 工具 使用 逆向 tracemeexebdw 随手 笔记 加密 与 解密 段 钢 等 著 ollydbg 入门教程 看 雪 学院 ccdebuger 个 crackme 鬼 手 大佬 调试 逆向 硬件 断点 的 原理 与 实现 基本 用法 thomasblog 