my 面试 这里 写 自定义 目录 标题 集合 一 list 和 set 常用 的 二 map 线程 一 线程 的 创建 种 方式 死锁 多线程 三大 特性 volatile 线程 池 线程 池 的 作用 及 原理 常见 四种 线程 池 jvmjvm 组成 类 加载 器 子系统 执行 过程 双亲 委派 机制 运行时 数据 区 堆 区域 是 怎么 划分 的 元 空间 执行 引擎 jvm 垃圾 回收 常用 垃圾 回收 算法 选择 垃圾 收集 的 时间 gc 的 基本原理 常见 垃圾 收集器 jvm 的 优化 jit 优化 jvm 内存 分区 优化 调 优 工具 调 优 经验 常用 jvm 参数 参考 设置 jvm 参数 的 几种 方式 数据库 优化 sqlin 和 exists 的 区别 索引 失效 单机 优化 建 表 三 范式 单机 优化 关系 型 数据库 的 优化 技术 定位 慢 查询 找出 执行 效率 低 sql 分析 慢 查询 索引 经常 作为 查询 或者 排序 条件 的 字段 建立 索引 唯一性 太差 的 字段 不适合 创建 索引 比如 性别 频繁 更新 修改 的 字段 不适合 创建 索引 因为 每次 修改 都 需要 重新 维护 索引 结构 导致 大量 的 io 单列 只 在 一个 字段 创建 多 列 复合 索引 由 多个 字段 共同 组成 索引 dnameloc 修改 存储 引擎 分 表 分区 sql 优化 小 技巧 多 机 优化 主流 方案 主从 同步 测试 环境 spring 什么 是 框架 spring 是 一个 di 注入 轻量级 控制 反转 ioc 和 面向 切面 编程 aop 的 容器 框架 springmvc 默认 单利 线程 安全 一 全 注解 实例 化 bean 的 注解 请求 注解 接收 请求 参数 的 三种 实现 执行 流程 二 返回 技术 特点 常用 注解 springdatajpa 查询 query 的 使用 重要 querymodifying 注解 完成 修改 删除 操作 重要 嵌套 查询 和 嵌套 结果 缓存 面试题 mybatis 相较 于 jdbc 的 优点 mybatis 事务 和 区别 符号 转义 mybatis 的 sql 可以用 xml 和 注解 的 方式 leftjoin 和 joinspringboot 启动 流程 分为 两步 注解 配置文件 种 springcloud 五大 组件 服务 熔断 服务 降级 熔断 vs 降级 redis 集群 主从 和 哨兵 的 集合体 主从复制 主 数据库 master 和 从 数据库 slave 哨兵 是 监控 redis 集群 的 运行状况 持久 化 在于 数据 备份 和 故障 恢复 缓存 雪崩 穿透 击穿 elasticsearch 基本概念 为 什么用 es 特点 和 优势 倒排 索引 fastdfsfastdfs 是以 c 语言 开发 的 一项 开源 轻量级 分布式 文件 系统 他 对 文件 进行 管理 主要功能 有 文件 存储 文件 同步 文件 访问 文件 上传下载 特别 适合 以 文件 为 载体 的 在线 服务 如图 片 网站 视频 网站 等 fastdfs 由 跟踪 服务器 trackerserver 存储 服务器 storageserver 和 客户端 client 构成 trackerserver 追踪 服务器 storageserver 储存 服务器 客户端 clientrabbitmq 基本概念 rabbitmq 使用 场景 外 链 图片 转存 失败 源 站 可能有 防盗链 机制 建议 将 图片 保存 下来 直接 上传 imgwelezpp imagespng 常见 的 消息 队列 exchange 分类 如何 避免 消息 丢失 手动 签收 持久 化 常用 的 设计 模式 工厂 模式 抽象 模式 单利 模式 适配器 模式 代理 模式 装饰 者 模式 观察者 模式 restful 风格 restful 架构 三次 握手 和 四次 挥手 tcp 和 udp 数据结构 栈 队列 ajax 异步 的 js 和 xml 获取 ajax 对象 ajax 没有 标准化 需要 区分 浏览器 发 快递 使用 ajax 发送 get 请求 使用 ajax 发送 post 请求 ie 缓冲 问题 事务 本地 分布式 事务 acid 四种 隔离 级别 设置 事务 的 传播 机制 注解 方式 分布式 事务 io 同步 阻塞 nio 异步 阻塞 同步 阻塞 io 用户 线程 在 内核 进行 io 操作 时 被 阻塞 同步 非 阻塞 io 是 在 同步 阻塞 io 的 基础 上将 socket 设置 为 nio nonblock 拦截器 和 过滤器 拦截器 过滤器 过滤器 和 拦截器 的 区别 抽象类 和 接口 git 和 svn 反射 io 和 nio 讲讲 你 理解 的 nio 和 bio 的 区 别是 啥 谈谈 reactor 模型 同步 和 异步 同步 异步 深 拷贝 和 浅 拷贝 欢迎 使用 markdown 编辑器 新 的 改变 功能 快捷键 合理 的 创建 标题 有助于 目录 的 生成 如何 改变 文本 的 样式 插入 链接 与 图片 如何 插入 一段 漂亮 的 代码 片 生成 一个 适合 你 的 列表 创建 一个 表格 设定 内容 居中 居 左 居 右 smartypants 创建 一个 自定义 列表 如何 创建 一个 注脚 注释 也是 必不可少 的 katex 数学公式 新 的 甘特图 功能 丰富 你 的 文章 uml 图表 flowchart 流程图 导出 与 导入 导出 导入 面试 大全 集合 一类 是 继承 自 collection 接口 这类 集合 包含 listset 和 queue 等 集合 类 另一类 是 继承 自 map 接口 这 主要 包 含了 哈希 表 相关 的 集合 类 一 list 和 set 外 链 图片 转存 失败 源 站 可能有 防盗链 机制 建议 将 图片 保存 下来 直接 上传 imglqwdyp imagesimagepng 图中 的 绿色 的 虚线 代表 实现 绿色 实线 代表 接口 之间 的 继承 蓝色 实线 代表 类 之间 的 继承 list 元素 有序 可 重复 addset 元素 无序 不可 重复 list 有序 可 重复 arraylist 优点 底层 数据结构 是 数组 查询 快 增删 慢 缺点 线程 不安全 效率高 vector 优点 底层 数据结构 是 数组 查询 快 增删 慢 缺点 线程 安全 效率 低 linkedlist 优点 底层 数据结构 是 链表 查询 慢 增删 快 缺点 线程 不安全 效率高 set 无序 唯一 hashset 底层 采用 hashmap 来 保存 元素 底层 数据结构 是 哈希 表 无序 唯一 相关 hashset 的 操作 基本上 都是 直接 调用 底层 hashmap 的 相关 方法来 完成 我们 应 该为 保 存到 hashset 中 的 对象 覆盖 hashcode 和 equals 如 何来 保证 元素 唯一性 依赖 两个 方法 hashcode 和 equals linkedhashset 底层 数据结构 是 链表 和 哈希 表 fifo 插入 有序 唯一 由 链表 保证 元素 有序 由 哈希 表 保证 元素 唯一 treeset 底层 数据结构 是 红 黑 树 唯一 有序 如何 保证 元素 排序 的 呢 自然 排序 比较 器 排序 如何 保证 元素 唯一性 的 呢 根据 比较 的 返回值 是否 是 来 决定 版权 声明 本文 为 csdn 博 主 游走 的 大千世界 的 烤 腰子 的 原创 文章 遵循 ccbysa 版权 协议 转载 请 附上 原文 出处 链接 及 本 声明 原文 链接 常用 的 的 区别 相同点 都是 实现 了 list 接口 都可以 存储 任意 类型 多个 数据 arraylist 底层 是 基于 数组 实现 的 具有 查询 快 的 特点 因为 可以 通过 索引 直接 定位 到 数据 查询 效率高 添加 数据 慢 数组 长度 确定 后 不能 修改 如果 扩容 会 重新 创建 数组 复制 数据 损耗 性能 linkedlist 底层 基于 链表 实现 的 具有 添 加快 的 特点 因为 添加 的 时候 直接 创建 一个 节点 就行 不会 涉及 扩容 效率高 查询 较慢 需 遍历 链表 效率 低 linkedlist 比 arraylist 更 占 内存 因为 linkedlist 为 每一个 节点 存储 了 两个 引用 一个 指 向前 一个 元素 一个 指向 下一个 元素 treesethashset 的 区别 相同点 都是 set 接口 实现 类 都可以 存储 任意 类型 任意 多个 数据 treeset 此类 保证 排序 后 的 set 按照 升序 排列 元素 根据 使用 的 构造 方法 不同 可能会 按照 元素 的 自然 顺序 进行 排序 或 按 照在 创建 set 时 所 提供 的 比较 器 进行 排序 是 一个 有序 集合 元素 中 按 升序 排序 缺省 是 按照 自然 顺序 进行 排序 意味着 treeset 中 元素 要 实现 comparable 接口 我们 可以 构造 treeset 对象 时 传递 实现 了 comparator 接口 的 比较 器 对象 treeset 可 以对 set 集合 中 的 元素 进行 排序 是 线程 不安全 的 唯一性 去 重 根据 比较 方法 的 返回 结果 是否 为 如果是 则是 相同 元素 不 保存 如果 不是 则是 不同 元素 存储 treeset 对 元素 进行 排序 的 方式 种 元素 自身 具备 比较 功能 自然 排序 需要 实现 comparable 接口 并 覆盖 其 compareto 方法 元素 自身 不具备 比较 功能 定制 排序 则 需要 实现 comparator 接口 并 覆盖 其 compare 方法 hashset 内部 的 数据结构 是 哈希 表 是 线程 不安全 的 唯一性 去 重 通过 对象 的 hashcode 和 equals 方法来 完成 对象 唯一性 的 判断 添加 时 用 equals 判断 hashcode 值 是否 相同 不同 就 保存 注意 如果 元素 要 存储 到 hashcode 中 必须 覆盖 hashcode 方法 和 equals 方法 总结 comparato 方法 和 comparator 方法 的 区别 comparato 方法 只需要 传递 一个 参数 对象 与 本类 对象 进行 比较 它是 元素 的 比较 方法 comparator 方法 是 集合 的 比较 方法 强行 对 某个 对象 collection 进行 整体 排序 的 比较 函数 二 map 那么 哈希 冲突 如何 解决 呢 计算 哈希 值 时 得 到了 同一个 地址 哈希 冲突 的 解决方案 有 多种 开放 定址法 发生冲突 继续 寻找 下一 块 未被 占用 的 存储 地址 再 散 列 函数 法 链 地址 法 而 hashmap 即是 采 用了 链 地址 法 也 就是 数组 链表 的 方式 常用 的 hashmap 不安全 hashtable 安全 安全 properties 三者 之间 的 区别 相同点 都是 map 接口 实现 都是 以 键值 对 形式 存储 值 hashmap 线程 不安全 可以 以 null 作为 键 或 值 效率 较高 hashtable 线程 安全 不可以 以 null 作为 键 或 值 效率 较低 线程 安全 不可以 以 null 作为 键 或 值 效率 相对 较高 properties 它是 继承 了 hashtable 类 以 map 的 形式 进行 放置 值 put keyvalue get key key 不能 重复 load 加载 方法 store 保存 方法 hashmap 底层 put 方法 在 jdk 之后 是 采用 数组 链表 红 黑 树 的 结构 长度 之前 初始化 之后 长度 为 当 调用 put 方法 时会 创建 一个 数组 根据 key 的 hashcode 计算出 hash 值 return keynull hkeyhashcode hgtgtgt 然后再 根据 该 hash 值 得到 这个 元素 在 数组 中 的 位置 得到 该 hash 值 所 对应 table 中 索引 的 方法 intiindexfor hashtablelength 即 下标 用 equals 判断 key 如果 该 位置 上 没有 元素 就 直接 将该 元素 放 到此 数组 中 的 该 位置 上 判断 当前 链表 长度 是否 gt 满足 就 变成 红 黑 树 不满足 就 直接 添加 如果有 元素 hash 冲突 判断 key 的 hash 值 和 要 添加 元素 的 hash 值 是否 相等 相等 就 返回 覆盖 的 值 判断 当前 链表 长度 是否 gt 满足 就 变成 红 黑 树 不满足 就 直接 添加 最后 判断 是否 需要 扩容 超过 就 自动 扩容 没有 就 结束 hashmap 底层 get 方法 首先 计算 key 的 hash 值 取得 所 定位 的 桶 桶 entry 存储 keyvalue 如果 桶 为 空 则 直接 返回 null 否则 判断 桶 的 第一个 位置 有 可能是 链表 红 黑 树 的 key 是否 为 查询 的 key 是 就 直接 返回 value 如果 第一个 不 匹配 则 判断 它 的 下 一个是 红 黑 树 还是 链表 红 黑 树 就 按照 树 的 查找 方式 返回值 不然 就 按照 链表 的 方式 遍历 匹配 返回值 从这 两个 核心 方法 getput 可以 看出 中 对 大 链表 做了 优化 修 改为 红 黑 树 之后 查询 效率 直接 提高 到了 o logn hashmap 遍历 hashmap 的 遍历 方式 主要 通过 获取 keyset 和 entryset 然后 使用 迭代 器 和 foreachhashmap 是以 键值 对 形式 存储 值 线程 安全 其实 和 hashmap 结构 类似 当 链表 节 点数 超过 指定 阈值 的话 也是 会 转换成 红 黑 树 的 大体 结构 也是 一样 的 那么 它 到底是 如何 实现 线程 安全 的 答案 其中 抛弃 了 原有 的 segment 分段 锁 而 采 用了 cassynchronized 来 保证 并发 安全性 put 过程 判断 node 数组 是否 初始化 没有 则 进行 初始化 操作 通过 hash 定位 数组 的 索引 坐标 是否 有 node 节点 如果 没有 则 使用 cas 进行 添加 链表 的 头 节点 添加 失败 则 进入 下次 循环 检 查到 内部 正在 扩容 就 帮助 它 一块 扩容 如果 fnull 则 使用 synchronized 锁住 f 元素 链表 红 黑 树 的 头 元素 如果是 node 链表 结构 则 执行 链表 的 添加 操作 如果是 treenode 树 型 结构 则 执 行树 添加 操作 判断 链表 长度 已经 达到 临界值 默认 值当 节点 超过 这个 值 就需要 把 链表 转 换为 树结构 如果 添加 成功 就 调用 addcount 方法 统计 size 并且 检查 是否 需要 扩容 是 一个 线程 安全 的 类 它 使用 synchronized 来 锁住 整 张 hash 表 来 实现 线程 安全 即 每次 锁住 整 张 表 让 线程 独占 相当于 所有 线程 进行 读写 时 都去 竞争 一把 锁 导致 效率 非常 低下 可以 做到 读取 数据 不 加锁 并且 其 内部 的 结构 可以 让 其 在 进行 写 操作 的 时候 能够 将 锁 的 粒度 保持 地 尽 量地 小 允许 多个 修改 操作 并发 进行 其 关键在于 使 用了 锁 分离 技术 它 使 用了 多个 锁 来 控制 对 hash 表 的 不同 部分 进行 的 修改 内部 使用 段 segment 来 表示 这些 不同 的 部分 每个 段 其实 就是 一个 小 的 hashtable 它们 有 自己 的 锁 只要 多个 修改 操作 发 生在 不同 的 段 上 它们 就可以 并发 进行 线程 一 线程 的 创建 种 方式 继承 thread 类 需要 实现 run 方法 并且 最后 也是 调用 start 方法来 启动 线程 实现 runnable 接口 实现 run 方法 通过 thread 调用 start 方法来 启动 线程 实现 callable 接口 使用 实现 有 返回 结果 的 多线程 与 runnable 相比 callable 可以 有 返回值 返回值 通过 futuretask 进行 封装 实现 runnable 和 callable 接口 的 类 只能 当做 一个 可以 在 线程 中 运行 的 任务 不是 真正 意义上 的 线程 因此 最后 还需要 通过 thread 来 调用 可以说 任务 是 通过 线程 驱动 从而 执行 的 实现 接口 vs 继承 thread 单 继承 多 实现 实现 接口 会 更好 一些 因为 java 不支持 多重 继承 因此 继承 了 thread 类 就 无法 继承 其它 类 但是 可以 实现 多个 接口 类 可能 只 要求 可执行 即可 继承 整个 thread 类 开销 会 过大 thread 和 runable 的 区别 和 联系 联系 thread 类 实现 了 runable 接口 都 需要 重写 里面 run 方法 不同 实现 runnable 的 类 更具 有 健壮性 避免了 单 继承 的 局限 runnable 更 容易 实现 资源共享 能 多个 线程 同时 处理 一个 资源 线程 的 状态 有 哪些 生命周期 线程 中 的 方法 有 哪些 状态 种 新建 状态 使用 new 关键字 和 thread 类 或 其 子类 建立 一个 线程 对象 后 该 线程 对象 就 处于 新建 状态 它 保持 这个 状态 直到 程序 start 这个 线程 就绪 状态 当 线程 对象 调 用了 start 方法 之后 该 线程 就 进入 就绪 状态 就绪 状态 的 线程 处于 就绪 队列 中 要 等待 jvm 里 线程 调度 器 的 调度 运行 状态 如果 就绪 状态 的 线程 获取 cpu 资源 就可以 执行 run 此时 线程 便 处于 运行 状态 处于 运行 状态 的 线程 最为 复杂 它 可以 变为 阻塞状态 就绪 状态 和 死亡 状态 死亡 状态 一个 运行 状态 的 线程 完成任务 或者 其他 终止 条件 发生 时 该 线程 就 切 换到 终止 状态 阻塞状态 如果 一个 线程 执 行了 sleep 睡眠 suspend 挂起 等 方法 失去 所 占用 资源 之后 该 线程 就从 运行 状态 进入 阻塞状态 在 睡眠 时间 已到 或 获得 设备 资源 后 可以 重新 进入 就绪 状态 可以 分为 三种 等待 阻塞 运行 状态 中 的 线程 执行 wait 方法 使 线程 进入到 等待 阻塞状态 同步 阻塞 线程 在 获取 synchronized 同步 锁 失败 因为 同步 锁 被 其他 线程 占用 其他 阻塞 通过 调用 线程 的 sleep 或 join 发 出了 io 请求 时 线程 就会 进入到 阻塞状态 当 sleep 状态 超时 join 等待 线程 终止 或 超时 或者 io 处理完毕 线程 重新 转入 就绪 状态 方法 start 启动 线程 并 执行 相应 的 run 方法 run 子 线程 要 执行 的 代码 放入 run 方法 yield 方法 使 当前 线程 从 执行 状态 变为 就绪 状态 sleep 方法 强制 当前 正在 执行 的 线程 休眠 当 睡眠 时间 到期 则 返 回到 可运 行 状态 不会 放弃 锁 资源 join 方法 通常 用于 在 main 主 线程 内 等待 其它 线程 完成 再 结束 main 主 线程 不会 放弃 锁 资源 deamon 守护 线程 deamon 是 程序 运行时 在 后台 提供 服务 的 线程 并不 属于 程序 中 不可或缺 的 部 分当 所有 非 后台 线程 结束时 程序 也就 终止 同 时会 杀死 所有 后台 线程 main 属于 非 后台 线程 使用 setdaemon 方法 将 一个 线程 设置 为 后台 线程 sleep 和 wait 的 区别 threadsleep 方法 进入 休眠 状态 不会 放弃 锁 资源 wait object 中方 法会 放弃 锁 资源 使 线程 挂起 直到 线程 得到 notify 或 notifyall 消息 或者 类 库 中 等价 的 signal 或 signalall 消息 线程 安 全当 多个 线程 访问 一个 对象 时 如果 不用 考虑 这些 线程 在运 行时 环境 下 的 调度 和 交替 执行 也 不需要 进行 额外 的 同步 或者 在 调用 方 进行 任何 其他 的 协调 操作 调用 这个 对象 的 行为 都可以 获得 正确 的 结果 那 这个 对 象是 线程 安全 的 线程 不安 全当 多个 线程 访问 同一个 资源 出现问题 如何 解决 线程 安全问题 互斥 同步 悲观 锁 synchronized 关键字 同步 是 指在 多个 线程 并发 访问共享 数据 时 保证 共享 数据 在 同一个 时刻 只 被 一个 或者是 一些 使用 信号量 的 时候 线程 使用 synchronizedjvm 管理 的 可以 锁 代码 块 方法 类 必须 上一个 线程 执行 完 才能 执行 下一个 线程 特点 同步 方法 效率 会 变低 没有 线程 安全问题 了 特点 同步 代码 块 把 业务 代码 放在 同步 代码 块 中 该 代码 块 中 的 代码 在 一个时间 点 只能 被 一个 线程 访问 其他 线程 需要 排队 等待 非 阻塞 同步 乐观 锁 实现 使用 lock 的 步骤 创建 lock 实现 类 的 对象 使用 lock 对象 的 lock 方法 加锁 使用 lock 对象 的 unlock 方法 解锁 注意 可把 unlock 方法 的 调用 放在 finally 代码 块 中 保证 一 定能 解锁 lock 乐观 锁 线程 安全 效率高 取出来 先 比较 出现 aba 问题 加 一个 版本 比较 version 创建 reentrantlock 对象 调用 lock 方法 加锁 代码 调用 unlock 方法 解锁 注意 可把 解锁 的 unlock 方法 的 调用 放在 finally 代码 块 中 保证 一 定能 解锁 synchronize 悲观 锁 与 lock 乐观 锁 的 区别 同步 方法 一个 方法 只有 一个 线程 执行 必须 上一个 线程 执行 完 才能 执行 下一个 线程 同步 代码 块 synchronized 被 加锁 的 对象 代码 线程 安全 在 相对于 arraylist 来说 vector 线程 是 安全 的 也就是说 是 同步 的 创 建了 一个 向量 类 的 对象 后 可 以往 其中 随意 地 插入 不同 的 类 的 对象 既 不需 顾及 类型 也 不需 预先 选定 向量 的 容量 并可 方便地 进行 查找 对于 预先 不知 或 不愿 预先 定义 数组 大小 并需 频繁 进行 查找 插入 和 删除 工作 的 情况 可以 考虑 使用 向量 类 向量 类 提供 了 三种 构造 方法 publicvector publicvector publicvector 死锁 同步 中 嵌套 同步 锁 没有 来得及 释放 一直 等待 就 导致 死锁 如果 线程 a 锁 住了 记录 并 等待 记录 而 线程 b 锁 住了 记录 并 等待 记录 这样 两个 线程 就 发 生了 死锁 现象 下面 这段 代码 多 运行 几次 就会 出现 死锁 思路 是 开启 两个 线程 让 这两个 线程 执行 的 代码 获取 的 锁 的 顺序 不同 第一个 线程 需要 先 获得 obj 对象 锁 然后再 获得 this 锁 才 可以 执行 代码 然后 释放 两把 锁 线程 需要 先 获得 this 锁 再 获取 obj 对象 锁 才 可执行 代码 然后 释放 两把 锁 但是 当 线程 获得了 obj 锁 之后 线程 获得了 this 锁 这时候 线程 需要 获得 this 锁 才 可执行 但是 线程 也 无法 获 取到 obj 对象 锁 执行 代码 并 释放 所以 两个 线程 都 拿着 一把 锁 不 释放 这就 产 生了 死锁 多线程 三大 特性 原子 性 原子 性 就是在 执行 一个 或者 多个 操作 的 过程中 要么 全部 执行 完 不被 任何 因素 打断 要么 不 执行 比如 银行 转账 a 账户 减去 元 b 账户 必须 增 加元 对 这两个 账户 的 操作 必须 保证 原子 性 才 不会 出现问题 还有 比如 ii 的 操作 需要 先 取出 i 然后 对 i 进行 操作 然后再 给 i 赋值 这个 式子 就不是 原子 性 的 需要 同步 来 实现 数据 的 安全 原子 性 就是 为了 保证 数据 一致 线程 安全 可 见性 当 多个 线程 访问 同一个 变量 时 一个 线程 修 改了 变量 的 值 其他 的 线程 能 立即 看到 这 就是 可 见性 这里 讲 一下 java 内 内存 模型 简称 jmm 决定 了 一个 线程 与 另一个 线程 是否 可见 包括 主 内存 存放 共享 的 全局变量 和 私有 本地 内存 存放 本地 线程 私有 变量 本地 私有 内存 存放 的 是 共享 变量 的 副本 线程 操作 共享 变量 首先 操作 的 是 自己 本地 内存 的 副 本当 同一 时刻 只有 一个 线程 操作 共享 变量 时 该 线程 操作 完毕 本地 内存 然 后会 刷 新到 主 内存 然 后主 内存 会 通知 另一个 线程 进而 更新 但是 如果 同一 时 刻有 多个 线程 操作 共享 变量 会来 不及 更 新主 内存 进而 通知 其他 线程 更新 变量 就会 出现 冲突 问题 有序性 就是 程序 的 执行 顺序 会 按照 代码 先后顺序 进行 执行 一般 情况下 处理器 由于 要 提高 执行 效率 对 代码 进行 重 排序 运行 的 顺序 可能 和 代码 先后顺序 不同 但是 结果 一样 单线程 下不 会 出现问题 多线程 就会 出现问题 了 volatile 保证 可 见性 但是 不 保证 原子 性 线程 池 定义 线程 池 就是 首先 创建 一些 线程 它们 的 集合 称为 线程 池 使用 线程 池 可以 很好 地 提高 性能 线程 池 在 系统 启动时 即 创建 大量 空闲 的 线程 程序 将 一个 任务 传给 线程 池 线程 池 就会 启动 一条 线程 来 执行 这个 任务 执行 结束 以后 该 线程 并不会 死亡 而是 再次 返回 线程 池中 成为 空闲 状态 等待 执行 下一个 任务 线程 池 的 作用 及 原理 创建 销毁 线程 伴随着 系统 开销 过于 频繁 的 创建 销毁 线程 会 很大 程度 上 影响 处理 效率 线程 复用 线程 并发 数量 过多 抢占 系统资源 从而 导致 阻塞 控制 并发 数量 对 线程 进行 一些 简单 的 管理 管理 线程 的 生命周期 线程 池 原理 线程 复用 实现 线程 复用 的 原理 应该 就是 要 保持 线程 处于 存活 状态 就绪 运行 或 阻塞 控制 并发 数量 核心 线程 和 最大 线程 数 控制 管理 线程 设置 线程 的 状态 线程 池 的 返回值 executorservice 简介 executorservice 是 java 提供 的 用于 管理 线程 池 的 类 该类 的 两个 作用 控制 线程 数量 和 重用 线程 常见 四种 线程 池 可 缓存 线程 池 根据 源码 可以 看出 这种 线程 池 内部 没有 核心 线程 线程 的 数量 是 有 限制 的 最大 是 integer 最大值 在 创建 任务 时 若有 空闲 的 线程 时 则 复用 空闲 的 线程 若 没有 则 新建 线程 没有 工作 的 线程 闲置 状态 在 超 过了 s 还不 做事 就会 销毁 适用 执行 很多 短期 异步 的 小 程序 或者 负载 较轻 的 服务器 fixedthreadpool intnthreads 定长 线程 池 根据 源码 可以 看出 该 线程 池 的 最大 线程 数 等于 核心 线程 数 所以在 默认 情况下 该 线程 池 的 线程 不会 因为 闲置 状态 超 时而 被 销毁 如果 当前 线程 数 小于 核心 线程 数 并且 也有 闲置 线程 的 时候 提 交了 任务 这时 也 不 会去 复用 之前 的 闲置 线程 会 创建 新 的 线程 去 执行任务 如果 当前 执行任务 数 大于 了 核心 线程 数 大于 的 部分 就会 进入 队列 等待 等着 有 闲置 的 线程 来 执行 这个 任务 适用 执行 长期 的 任务 性能好 很多 传入 线程 长度 写 死 intnthreads 单线程 池 根据 源码 可以 看出 该 线程 池 的 最大 线程 数 等于 核心 线程 数 所以在 默认 情况下 该 线程 池 的 线程 不会 因为 闲置 状态 超 时而 被 销毁 如果 当前 线程 数 小于 核心 线程 数 并且 也有 闲置 线程 的 时候 提 交了 任务 这时 也 不 会去 复用 之前 的 闲置 线程 会 创建 新 的 线程 去 执行任务 如果 当前 执行任务 数 大于 了 核心 线程 数 大于 的 部分 就会 进入 队列 等待 等着 有 闲置 的 线程 来 执行 这个 任务 适用 执行 长期 的 任务 性能好 很多 publicclasstest 传入 线程 长度 写 死 弹性 缓存 线程 池 外 链 图片 转存 失败 源 站 可能有 防盗链 机制 建议 将 图片 保存 下来 直接 上传 imgfdqldvt imagesimagepng 根据 源码 可以 看出 就是 默认 l 这里 就是 秒 这个 线程 池 有点 像是 和 fixedthreadpool 结合 了 一下 不仅 设置 了 核心 线程 数 最大 线程 数 也是 integermaxvalue 这个 线程 池 是 上述 个中 唯一 一个 有 延迟 执行 和 周期 执行任务 的 线程 池 适用 周期性 执行任务 的 场景 定期 的 同步 数据 总结 除了 的 内部 实现 特殊 一点 之外 其它 线程 池 内部 都是 基于 类 executor 的 子类 实现 的 自定义 线程 池 类 构造 器 语法 形式 方法 参数 corepoolsize 核心 线程 数 最小 存活 的 工作 线程 数量 maxpoolsize 最大 线程 数 keepalivetime 线程 存活 时间 在 情况下 有用 线程 的 空闲 时间 超过 keepalivetime 就会 销毁 timeunit 存活 时间 的 时间 单位 workqueue 阻塞 队列 用来 保存 等待 被执行 的 任务 这个 队列 比较 特殊 它 不会 保存 提交 的 任务 而是 将 直接 新建 一个 线程 来 执行 新来 的 任务 基于 链表 的 先进先出 队列 如果 创建 时 没有 指定 此 队列 大 小则 默 认为 基于 数组 的 先进先出 队列 此 队列 创建 时 必须 指定 大小 threadfactory 线程 工厂 主要 用来 创建 线程 handler 表示 当 拒绝 处理 任务 时 的 策略 丢弃 任务 并 抛出 异常 丢弃 任务 但是 不 抛出 异常 丢弃 队列 最前 面的 任务 然后 重新 尝试 执行任务 由 调用 线程 处 理该 任务 常见 的 方法 execute 方法 实际上 是 executor 中 声明 的 方法 在 进行了 具体 的 实现 这个 方法 是 的 核心 方法 通过 这个 方法 可以 向 线程 池 提交 一个 任务 交由 线程 池 去 执行 submit 方法 是 在 executorservice 中 声明 的 方法 在 就 已经有 了 具体 的 实 现在 中 并没有 对 其 进行 重写 这个 方法 也是 用 来向 线程 池 提交 任务 的 实际上 它 还是 调用 的 execute 方法 只不过 它 利 用了 future 来 获取 任务 执行 结果 shutdown 不会 立即 终止 线程 池 而是 要等 所有 任务 缓存 队列 中 的 任务 都 执行 完 后 才 终止 但 再也不会 接受 新 的 任务 shutdownnow 立即 终止 线程 池 并 尝试 打断 正在 执行 的 任务 并且 清空 任务 缓存 队列 返回 尚未 执行 的 任务 isterminated 方法 调用 方法 的 时候 线程 池 不再 接收 任何 新任务 但 此时 线程 池 并不会 立刻 退出 直到 添加到 线程 池中 的 任务 都 已经 处理 完成 才会 退 出在 调用 shutdown 方法 后 我们 可以 在 一个 死循环 里面 用 isterminated 方法 判断 是否 线程 池中 的 所有 线程 已经 执行 完毕 如 果子 线程 都 结束 了 我们 就可以 做 关闭 流 等 后续 操 作了 线程 池中 的 最大 线程 数 一般说来 线程 池 的 大小 经验值 应该 这样 设置 其中 n 为 cpu 的 个数 如果是 cpu 密集型 应用 则 线程 池 大小 设置 为 n 如果是 io 密集型 应用 则 线程 池 大小 设置 为 n 如果 一台 服务器 上 只 部署 这一个 应用 并且 只有 这一个 线程 池 那么 这种 估算 或许 合理 具体 还需 自行 测试 验证 但是 io 优化 中 这样 的 估算 公式 可能 更适合 最佳 线程 数目 线程 等待时间 线程 cpu 时间 线程 cpu 时间 cpu 数目 因为 很显然 线程 等待时间 所占 比例 越高 需要 越多 线程 线程 cpu 时间 所占 比例 越高 需要 越少 线程 创建 线程 的 个数 是 还要 考虑 内存 资源 是否 足够 装下 相当 的 线程 下面 举个 例子 比如 平均 每个 线程 cpu 运行 时间 为 s 而 线程 等待时间 非 cpu 运行时 间 比如 io 为 scpu 核 心数 为 那么 根据 上面 这个 公式 估算 得到 四种 线程 池 拒绝 策略 当 线程 池 的 任务 缓存 队列 已满 并且 线程 池中 的 线程 数目 达到 maximumpoolsize 时 如果 还有 任务 到来 就会 采取 任务 拒绝 策略 通常 有 以下 四种 策略 丢弃 任务 并 抛出 异常 这是 线程 池 默认 的 拒绝 策略 在 任务 不能 再 提交 的 时候 抛出 异常 及时 反馈 程序 运行 状态 如果是 比较 关键 的 业务 推荐 使用 此 拒绝 策略 这 样子 在 系统 不能 承载 更大 的 并发 量 的 时候 能够 及时 的 通过 异常 发现 丢弃 任务 但是 不 抛出 异常 如果 线程 队列 已满 则 后续 提交 的 任务 都 会被 丢弃 且 是 静默 丢弃 使用 此 策略 可能 会使 我们 无法 发现 系统 的 异常 状态 建议 是 一些 无关紧要 的 业务 采用 此 策略 博客 网站 统计 阅读 量 就是 采用 的 这种 拒绝 策略 丢弃 队列 最前 面的 任务 然后 重新 提交 被 拒绝 的 任务 此 拒绝 策略 是 一种 喜新厌旧 的 拒绝 策略 是否 要 采用 此种 拒绝 策略 还得 根据 实际 业务 是否 允许 丢弃 老 任务 来 认真 衡量 由 调用 线程 提交 任务 的 线程 处 理该 任务 如果 任务 被 拒 绝了 则由 调用 线程 提交 任务 的 线程 直接 执行 此 任务 我们 可以 通过 代码 来 验证 这一点 通 通过 结果 可以 看到 主 线程 main 也 执 行了 任务 这 正 说 明了 此 拒绝 策略 由 调用 线程 提交 任务 的 线程 直接 执行 被 丢弃 的 任务 的 jvmjvm 是 java 虚拟机 在 不同 操作系统 安装 不同 版本 的 jvm 来 运行 编译 过后 的 字节 码 文件 class 来 实现 跨 平台 原理 为什么 要 优化 采用 默认 的 配置 不见得 能 起到 最好 的 效果 甚至 可能会 导致 运行 效率 更差 又 或者 面 临高 并发 情况下 想 让 程序 平稳 顺畅 的 运行 所以 我们 需要 针对实际 的 需 要来 进行 优化 插件 visualvm 现在 安装 插件 插件 的 安装 属于 visualvm 的 一个 重要 功能 凭借 插件 我们 可以 将 这个 工具 的 功能 变得 更强 大打 开 工具 gt 插件 选择 可用 插件 页 我们 在这里 安装 一个 visualgc 方便 我们 看到 内存 回收 以及 各个 分 代 的 情况 打上 勾 之后 点击 安装 就是 常规 的 next 以及 同意 协议 等 网络 不是 很 稳定 有时候 可能 需要 多 尝试 几次 安装 完成后 我们 将 当前 监控 页 关掉 再次 打开 就可以 看到 profiler 后面 多了 一个 visualgc 页 另外 如果 开发工具 使用 的 是 intellijidea 的话 可以 下载 一个 插件 通过 插件 启动 可以 直接 到 上述 页面 不 用在 左边 的 条 目中 寻找 自己 的 项目 jvm 组成 每一个 java 虚拟机 都由 一个 类 加载 器 子系统 负责 加载 程序 中 的 类型 类 和 接口 并 赋予 唯一 的 名字 每一个 java 虚拟机 都有 一个 执行 引擎 executionengine 负责 执行 被 加载 类 中 包含 的 指令 jvm 的 两 种类 装载 器 包括 启动 类 装载 器 和 用户 自定义 类 装载 器 启动 类 装载 器 是 jvm 实现 的 一部分 用户 自定义 类 装载 器 则是 java 程序 的 一部分 必须 是 classloader 类 的 子类 类 加载 器 子系统 运行时 数据 区 方法 区 堆 虚拟机 栈 本地 方法 栈 程序 计数器 执行 引擎 本地 方 法库 而 本地 库 接口 也 就是 用于 调用 本地 方法 的 接口 在此 我们 不 细说 主要 关注 的 是 上述 的 个 组件 类 加载 器 子系统 执行 过程 加载 验证 准备 解析 和 初始化 这个 步骤 加载 找到 字节 码 文件 读 取到 内存 中 类 的 加载 方式 分为 隐 式 加载 和 显示 加载 两种 隐 式 加载 指的是 程序 在 使用 new 关键词 创建 对象 时会 调用 类 的 加载 器 把 对应 的 类 加 载到 jvm 中 显示 加载 指的是 通过 直接 调用 classforname 方法来 把 所需 的 类 加 载到 jvm 中将 字节 码 加 载到 内存 中 验证 验证 此 字节 码 文件 是不是 真的 是 一个 字节 码 文件 毕竟 后缀名 可以 随便 改 而 内在 的 身份 标识 是 不会 变 的 在 确认是 一个 字节 码 文件 后 还会 检查 一系列 的 是否 可 运行 验证 元 数据 验证 字节 码 验证 符号 引用 验证 等 java 虚拟机 规范 对此 要求 很 严格 在 java 的 规范 中 已经有 页 的 描述 验证 过程 的 内容 准备 为 类 中 static 修饰 的 变量 分配 内存空间 并 设置 其 初始值 为 或 null 可能会 有人 感觉 奇 怪在 类 中 定义 一个 static 修饰 的 int 并 赋 值了 为什么 这里 还是 赋值 因为 这个 int 的 是 在 初始化 阶段 的 时候 才 赋值 的 这里 只是 先把 内存 分配 好 但 如果 你 的 static 修饰 还加 上了 final 那么 就 会在 准备 阶段 就会 赋值 解析 解析 阶段 会将 java 代码 中 的 符号 引用 替 换为 直接 引用 比如 引用 的 是 一个 类 我们 在 代码 中 只有 全 限 定名 来 标识 它在 这个 阶段 会 找到 这个 类 加 载到 内存 中 的 地址 初始化 如 刚才 准备 阶段 所说 的 这个 阶段 就是 对 变量 的 赋值 的 阶段 原文 链接 一 jvm 将 整个 类 加载 过程 划分 为了 三个 步骤 装载 加载 装载 过程 负责 找到 二进制 字节 码 并 加载 至 jvm 中 jvm 通过 类 名 类 所在 的 包 名 通过 classloader 来 完成 类 的 加载 同样 也 采用 以上 三个 元 素来 标识 一个 被 加载 了 的 类 类 名 包 名 classloader 实例 id 因此 不 同类 加载 器 加载 相同 的 类 是 不同 的 有 继承 将 先在 加载 父 类 将 类 class 文件 中 的 二进制 数据 读入 到 内存 中 将其 放在 运行时 数据 区 的 方法 区内 然后 在 堆 区 创建 一个 javalangclass 对象 用来 封装 类 在 方法 区 中 的 数据结构 链接 链接 过程 负责 对 二进制 字节 码 的 格式 进行 校验 解析 类 中 调用 的 接口 类 校验 是 防止 不合法 的 class 文件 然后 对 类 中 的 所有 属性 调用 方法 进行 解析 以 确保 其 需要 调用 的 属性 方法 存在 以及 具备 应 的 权限 例如 publicprivate 域 权限 等 会 造成 等 错误信息 连接 a 验证 确保 被 加载 的 类 的 正确性 b 准备 为 类 的 静态 变量 分配 内存 并 将其 初始 化为 默认值 c 解析 把 类 中 的 符号 引用 转 化为 直接 引用 初始化 初始化 过程 即为 执行 类 中 的 静态 初始化 代码 构造 器 代码 以及 静态 属性 的 初始化 在 四种 情况下 初始化 过程 会被 触发 执行 调 用了 new 反射 调 用了 类 中 的 方法 子类 调 用了 初始化 先 执行 父 类 静态 代码 和 静态 成员 再 执行 子类 静态 代码 和静 态变量 然后 调用 父 类 构造 器 最后 调用 自身 构造 器 jvm 启动 过程中 指定 的 初始化 类 双亲 委派 机制 外 链 图片 转存 失败 源 站 可能有 防盗链 机制 建议 将 图片 保存 下来 直接 上传 imgggfvxnmp imagesimagepng 类 加载 器 一般 有种 其中 前 种 是 必然 存在 的 启动 类 加载 器 加载 ltjavahomegtlib 下 的 c 实现 的 扩展 类 加载 器 加载 下 的 jvm 用 此 classloader 来 加载 扩展 功能 的 一些 jar 包 应用程序 类 加载 器 加载 classpath 下 的 自定义 类 加载 器 而 双亲 委派 机制 是 如何 运作 的 呢 我们 以 应用程序 类 加载 器 举例 它在 需要 加载 一个 类 的 时候 不会 直 接去 尝试 加载 而是 委托 上级 的 扩展 类 加载 器 去 加载 而 扩展 类 加载 器 也是 委托 启动 类 加载 器 去 加载 启动 类 加载 器 在 自己 的 搜索 范围内 没有 找到 这么 一个 类 表示 自己 无法 加载 就 再让 扩展 类 加载 器 去 加载 同样 的 扩展 类 加载 器 在 自己 的 搜索 范围内 找 一遍 如果 还是 没有 找到 就 委托 应用程序 类 加载 器 去 加载 如果 最终 还是 没找到 那 就会 直接 抛出 异常 了 而为 什么 要 这么 麻烦 的 从下到上 再 从上到下 呢 这是 为了 安全 着想 保证 按照 优先级 加载 如果 用户 自己 编写 一个 名为 javalangobject 的 类 放到 自己 的 classpath 中 没有 这种 优先级 保证 应用程序 类 加载 器 就把 这个 当做 object 加载 到了 内存 中 从 而会 引发 一片 混乱 而 凭借 这种 双亲 委派 机制 先 一路 向上 委托 启动 类 加载 器 去找 的 时候 就把 正确 的 object 加载 到了 内存 中 后面 再 加载 自行 编写 的 object 的 时候 是 不会 加载 运行 的 注意 所有 的 类 加载 器 都 继承 与 classloader 类 并且 继承 于 可以 从 本地 和 网上 下载 字节 码 urlclassloader 继承 是 最先 加载 的 它 然后 依次 加 载出 对象 运行时 数据 区运 行时 数据 区 分为 虚拟机 栈 本地 方法 栈 堆 区 方法 区 和 程序 计数器 外 链 图片 转存 失败 源 站 可能有 防盗链 机制 建议 将 图片 保存 下来 直接 上传 imgfngkmca imagesimagepng 方法 区域 methodarea 博客 在 sunjdk 中 这块 区域 对应 的 为 又 称为 持久 代 方法 区域 存 放了 所 加载 的 类 的 信息 名称 修饰符 等 类 中 的 静态 变量 类 中 定义 为 final 类型 的 常量 类 中 的 field 信息 类 中 的 方法 信息 当 开发人员 在 程序 中 通过 class 对象 中 的 等 方法来 获取 信息 时 这些 数据 都来 源于 方法 区域 同时 方法 区域 也是 全局 共享 的 在 一定 的 条件下 它也 会被 gc 当 方法 区域 需要 使用 的 内存 超过 其 允许 的 大小 时会 抛出 outofmemory 的 错误信息 方法 区 主要 用于 存储 虚拟机 加载 的 类 信息 常量 静态 变量 以及 编译器 编译 后 的 代码 等 数据 在 jdk 及其 之前 方法 区 是 堆 的 一个 逻辑 部分 一片 连续 的 堆 空间 但 为了 与 堆 做 区分 方法 区 还有 个 名字叫 非 堆 也 有人用 永久 代 hotspot 对 方法 区 的 实现 方法来 表示 方法 区 从 jdk 已经 开始 准备 去 永久 代 的 规划 jdk 的 hotspot 中 已经 把 原本 放在 方法 区 中 的 静态 变量 字符串 常量 池 等 移到 堆 内存 中 常量 池 除 字符串 常量 池 还有 class 常量 池 等 这里 只是 把 字符串 常量 池 移到 堆 内存 中 在 jdk 中 方法 区 已经 不存在 原 方法 区 中 存储 的 类 信息 编译 后 的 代码 数据 等 已经 移动 到了 元 空间 metaspace 中元 空间 并没有 处于 堆 内存 上 而是 直接 占用 的 本地 内存 nativememory 去 永久 代 的 原因 字符串 存在 永久 代 中 容易 出现 性能 问题 和 内存 溢出 类 及 方法 的 信息 等比 较难 确定 其 大小 因此 对于 永久 代 的 大小 指定 比较 困难 太小 容易 出现 永久 代 溢出 太大 则 容易 导致 老 年代 溢出 永久 代 会为 gc 带来 不必要 的 复杂度 并且 回收 效率 偏低 堆 heap 博客 它是 jvm 用来 存储 对象 实例 以及 数组 值 的 区域 可以 认为 java 中所 有 通过 new 创建 的 对象 的 内存 都 在此 分配 heap 中 的 对象 的 内存 需要 等待 gc 进行 回收 堆 是 jvm 中所 有 线程 共享 的 因此 在其 上 进行 对象 内存 的 分配 均 需要 进行 加锁 这也 导致 了 new 对象 的 开销 是 比 较大 的 sunhotspotjvm 为了 提升 对象 内存 分配 的 效率 对于 所 创建 的 线程 都会 分配 一块 独立 的 空间 其 大小 由 jvm 根据 运行 的 情况 计算 而 得 在 tlab 上 分配 对象 时 不需要 加锁 因此 jvm 在给 线程 的 对象 分配 内存 时会 尽量 的 在 tlab 上 分配 在 这种 情况下 jvm 中分 配 对象 内存 的 性能 和 c 基 本是 一样 高效 的 但 如果 对象 过大 的话 则 仍然是 直接 使用 堆 空间 分配 tlab 仅 作用于 新生代 的 edenspace 因此在 编写 java 程 序时 通常 多个 小 的 对象 比大 的 对象 分配 起来 更加 高效 堆 和 方法 区 一样 确切 来说 jvm 规范 中 方法 区 就是 堆 的 一个 逻辑 分区 就是 一个 所有 线程 共享 的 存放 对象 的 区域 也是 gc 的 主要 区域 其中 的 分区 分为 新生代 老 年代 新生代 中 又 可以 细 分为 一个 eden 两个 survivor 区 fromto eden 中 存放 的 是 通过 new 或者 newinstance 方法 创建 出来 的 对象 绝大多数 都是 很 短命 的 正常 情况下 经历 一次 gc 之后 存活 的 对象 会 转入 到 其中 一个 survivor 区 然后再 经历 默认 次 的 gc 就 转入 到老 年代 这是 常规 状态 下在 survivor 区 已经 满了 的 情况下 jvm 会 依据 担保 机制 将 一些 对象 直接 放入 老 年代 堆 内存 主要 用于 存放 对象 和 数组 它是 jvm 管理 的 内存 中 最大 的 一块 区域 堆 内存 和 方法 区 都 都被 所有 线程 共享 在 虚拟机 启动时 创 建在 垃圾 收集 的 层面 上 来看 由于 现在 收集器 基本上 都 采用 分 代 收集 算法 因此 堆 还 可以 分为 新生代 younggeneration 和 老 年代 oldgeneration 新生代 还 可以 分为 java 的 栈 虚拟机 只会 直接 对 javastack 执行 两种 操作 以 帧 为 单位 的 压 栈 或 出 栈 博客 每个 帧 代表 一个 方法 java 方法 有 两种 返回 方式 return 和 抛出 异常 两种 方式 都会 导致 该 方法 对应 的 帧 出 栈 和 释放 内存 帧 的 组成 局部变量 区 包括 方法 参数 和 局部变量 对于 instance 方法 还要 首先 保存 this 类型 其中 方法 参数 按照 声明 顺序 严格 放置 局部变量 可以 任意 放置 操作数 栈 帧 数据 区 用来 帮助 支持 常量 池 的 解析 正常 方法 返回 和 异常 处理 本地 方法 栈 与 虚拟机 栈 的 区 别是 虚拟机 栈 执行 的 是 java 方法 本地 方法 栈 执行 的 是 本地 方法 nativemethod 其他 基本上 一致 在 hotspot 中 直接 把 本地 方法 栈 和 虚拟机 栈 合二为一 这里 暂时 不做 过多 叙述 程序 计数器 博客 每一个 线程 都有 它自己 的 pc 寄存器 也是 该 线程 启动时 创建 的 pc 寄存器 的 内容 总是 指向 下一 条 将被 执行 指令 的 饿 地址 这里 的 地址 可 以是 一个 本地 指针 也 可 以是 在 方法 区 中 相对 应于 该 方法 起始 指令 的 偏移量 若 thread 执行 java 方 法则 pc 保存 下一 条 执行 指令 的 地址 若 thread 执行 native 方 法则 pc 的 值 为 undefined 程序 计数器 是 线程 私有 的 虽然 名字叫 计数器 但 主要用途 还是 用来 确定 指令 的 执行 顺序 比如 循环 分支 跳转 异常 捕获 等 而 jvm 对于 多线程 的 实 现是 通过 轮流 切换 线程 实现 的 所以 为了 保证 每个 线程 都能 按 正确 顺序 执 行将 程序 计数器 作为 线程 私有 程序 计数器 是 唯一 一个 jvm 没有 规定 任何 oom 的 区块 oomoutofmemory 程序 计数器 是 一块 非常 小 的 内存空间 可以 看做 是 当前 线程 执行 字节 码 的 行号 指示器 每个 线程 都有 一个 独立 的 程序 计数器 因此 程序 计数器 是 线程 私有 的 一块 空间 此外 程序 计数器 是 java 虚拟机 规定 的 唯一 不会 发生 内存 溢出 的 区域 本地 方法 栈 保存 native 方法 进入 区域 的 地址 博客 依赖于 本地 方法 的 实现 如 某个 jvm 实现 的 本地 方法 借口 使用 c 连接 模型 则 本地 方法 栈 就是 c 栈 可以说 某 线程 在 调用 本地 方法 时 就进 入了 一个 不受 jvm 限制 的 领域 也 就是 jvm 可以 利用 本地 方法来 动态 扩展 本身 本地 方法 栈 与 虚拟机 栈 的 区 别是 虚拟机 栈 执行 的 是 java 方法 本地 方法 栈 执行 的 是 本地 方法 nativemethod 其他 基本上 一致 在 hotspot 中 直接 把 本地 方法 栈 和 虚拟机 栈 合二为一 这里 暂时 不做 过多 叙述 堆 区域 是 怎么 划分 的 外 链 图片 转存 失败 源 站 可能有 防盗链 机制 建议 将 图片 保存 下来 直接 上传 imgbpiuruk imagesimagepng java 虚拟机 将 堆 内存 划 分为 新生代 老 年代 和 永久 代 永久 代 是 hotspot 虚拟机 特有 的 概念 jdk 之 后为 metaspace 替代 永久 代 它 采用 永久 代 的 方式 来 实现 方法 区 其他 的 虚拟机 实现 没有 这一 概念 而且 hotspot 也有 取消 永久 代 的 趋势 在 jdk 中 hotspot 已经 开始 了 去 永久 化 把 原本 放在 永久 代 的 字符串 常量 池 移出 永久 代 主要 存放 常量 类 信息 静态 变量 等 数据 与 垃圾 回收 关系不大 新生代 和 老 年代 是 垃圾 回收 的 主要 区域 博客 堆 结构 分 代 的 意义 java 虚拟机 根据 对象 存活 的 周期 不同 把 堆 内存 划 分为 几块 一般 分为 新生代 老 年代 和 永久 代 对 hotspot 虚拟机 而言 这 就是 jvm 的 内存 分 代 策略 堆 内存 是 虚拟机 管理 的 内存 中 最大 的 一块 也是 垃圾 回收 最 频繁 的 一块 区域 我们 程序 所有 的 对象 实例 都 存放在 堆 内存 中 给 堆 内存 分 代 是为了 提高 对象 内存 分配 和 垃圾 回收 的 效率 试想 一下 如果 堆 内存 没有 区域 划分 所有 的 新创建 的 对象 和 生命周期 很长 的 对象 放在 一起 随着 程序 的 执行 堆 内存 需要 频繁 进行 垃圾 收集 而 每次 回收 都要 遍历 所有 的 对象 遍历 这些 对象 所 花费 的 时间 代价 是 巨大 的 会 严重影响 我们 的 gc 效率 有 了 内存 分 代 情况 就 不同 了 新创建 的 对象 会在 新生代 中 分配 内存 经过 多次 回收 仍然 存活 下来 的 对象 存放在 老 年代 中 静态 属性 类 信息 等 存放在 永久 代 中 新生代 中 的 对象 存活 时间短 只需 要在 新生代 区域 中 频繁 进行 gc 老 年代 中 对象 生命 周期长 内存 回收 的 频率 相对 较低 不需要 频繁 进行 回收 永久 代 中 回收 效果 太差 一般 不 进行 垃圾 回收 还 可以 根据 不同 年代 的 特点 采用 合适 的 垃圾 收集 算法 分 代 收集 大大 提 升了 收集 效率 这些 都是 内存 分 代 带来 的 好处 堆 结构 分 代 java 虚拟机 将 堆 内存 划 分为 新生代 老 年代 和 永久 代 永久 代 是 hotspot 虚拟机 特有 的 概念 jdk 之 后为 metaspace 替代 永久 代 它 采用 永久 代 的 方式 来 实现 方法 区 其他 的 虚拟机 实现 没有 这一 概念 而且 hotspot 也有 取消 永久 代 的 趋势 在 jdk 中 hotspot 已经 开始 了 去 永久 化 把 原本 放在 永久 代 的 字符串 常量 池 移出 永久 代 主要 存放 常量 类 信息 静态 变量 等 数据 与 垃圾 回收 关系不大 新生代 和 老 年代 是 垃圾 回收 的 主要 区域 新生代 younggeneration 新 生成 的 对象 优先 存放在 新生代 中 新生代 对象 朝生夕死 存活率 很低 在 新生代 中 常规 应用 进行 一次 垃圾 收集 一般 可以 回收 的 空间 回收 效率 很高 hotspot 将 新生代 划 分为 三块 一块 较大 的 eden 伊 甸 空间 和 两块 较小 的 survivor 幸存者 空间 默认 比例 为 划分 的 目的 是因为 hotspot 采用 复制 算法 来 回收 新生代 设置 这个 比例 是为了 充分利用 内存空间 减少 浪费 新 生成 的 对象 在 eden 区 分配 大 对象 除外 大 对象 直接 进入 老 年代 当 eden 区 没有 足够 的 空间 进行 分配 时 虚拟机 将 发起 一次 minorgcgc 开始时 对象 只会 存在于 eden 区 和 fromsurvivor 区 tosurvivor 区 是 空 的 作为 保留 区域 gc 进 行时 eden 区 中所 有 存活 的 对象 都会 被 复制到 tosurvivor 区 而在 fromsurvivor 区 中 仍 存活 的 对象 会 根据 它们 的 年龄 值 决定 去向 年龄 值 达到 年龄 阀值 默 认为 新生代 中 的 对象 每 熬过 一轮 垃圾 回收 年龄 值 就 加 gc 分 代 年龄 存储 在 对象 的 header 中 的 对象 会被 移到 老 年代 中 没有 达到 阀值 的 对象 会被 复制到 tosurvivor 区 接着 清空 eden 区 和 fromsurvivor 区 新生代 中 存活 的 对象 都在 tosurvivor 区 接着 fromsurvivor 区 和 tosurvivor 区 会 交换 它们 的 角色 也 就是 新 的 tosurvivor 区 就是 上次 gc 清空 的 fromsurvivor 区 新 的 fromsurvivor 区 就是 上次 gc 的 tosurvivor 区 总之 不管怎样 都会 保证 tosurvivor 区 在 一轮 gc 后 是 空 的 gc 时 当 tosurvivor 区 没有 足够 的 空间 存 放上 一次 新生代 收集 下来 的 存活 对象 时 需要 依赖 老 年代 进行 分配 担保 将 这些 对象 存放在 老 年代 中老年 代 oldgenerationn 在 新生代 中 经历 了 多次 具体 看 虚拟机 配置 的 阀值 gc 后 仍然 存活 下来 的 对象 会 进入 老 年代 中老年 代 中 的 对象 生命周期 较长 存活率 比 较高 在 老 年代 中 进行 gc 的 频率 相对而言 较低 而且 回收 的 速度 也 比较慢 永久 代 永久 代 存储 类 信息 常量 静态 变量 即时 编译器 编译 后 的 代码 等 数据 对 这一 区域 而言 java 虚拟机 规范 指出 可以 不 进行 垃圾 收集 一般而言 不会 进行 垃圾 回收 三 永久 代 和 方法 区 方法 区 方法 区 methodarea 是 jvm 规范 里面 的 运行时 数据 区 的 一个 组成部分 jvm 规范 中 的 运行时 数据 区 还 包 含了 pc 寄存器 虚拟机 栈 堆 方法 区运 行时 常量 池 本地 方法 栈 主要 用来 存储 class 运行时 常量 池 字段 方法 代码 jit 代码 等 运行时 数据 区 跟 内存 不是 一个 概念 方法 区 是 运行时 数据 区 的 一部分 方法 区 是 jvm 规范 中 的 一部分 并不是 实际 的 实现 切忌 将 规范 跟 实现 混为一谈 永久 代 永久 带 又叫 perm 区 只 存在于 hotspotjvm 中 并且 只 存在于 jdk 和 之前 的 版本 中 jdk 中 已经 彻底 移 除了 永久 带 jdk 中 引 入了 一个 新 的 内存 区域 叫 metaspace 并不是 所有 的 jvm 中都 有 永久 带 ibm 的 joracle 的 jrocket 都没有 永久 带 永久 带 是 实现 层面 的 东西 永久 带 里面 存 的 东西 基本上 就是 方法 区 规定 的 那些 东西 区别 方法 区 是 规范 层面 的 东西 规定 了 这一个 区域 要 存放 哪些 东西 永久 带 或者是 metaspace 是 对 方法 区 的 不同 实 现是 实现 层面 的 东西 hotspotjdk 中 移 除了 永久 带 以后 的 内存 结构 元 空间 上面 说到 jdk 中 已经 不存在 永久 代 方法 区 替代 它 的 一块 空间 叫做 元 空间 和 永久 代 类似 都是 jvm 规范 对 方法 区 的 实现 但是 元 空间 并不在 虚拟机 中 而是 使用 本地 内存 元 空间 的 大小 仅 受 本地 内存 限制 但可以 通过 xxmetaspacesize 和 来 指定 元 空间 的 大小 执行 引擎 执行 引擎 包含 即时 编译器 jit 和 垃圾 回收 器 gc 对 即时 编译器 我们 简单 介绍 一下 主要 重点 在于 垃圾 回收 器 jvm 垃圾 回收 垃圾 回收 就是 通过 垃圾 收集器 把 内存 中 没用 的 对象 清理 掉 垃圾 回收 涉及到 的 内容 有 判断 对象 是否 已 死 是否 为 垃圾 选择 垃圾 收集 算法 选择 垃圾 收集 的 时间 选择 适当 的 垃圾 收集器 清理 垃圾 已 死 的 对象 判断 对象 是否 已 死 判断 对象 是否 已 死 有 引用 计数 算法 和 可达性 分析 算法 引用 计数 算法 给 每一个 对象 添加 一个 引用 计数器 每当 有 一个 地方 引 用它 时 计数器 值 加 每当 有 一个 地方 不再 引 用它 时 计数器 值 减 这样 只要 计数器 的 值 不为 就 说明 还有 地方 引 用它 它就 不是 无用 的 对象 如 下图 对象 有 个 引 用它 的 引用 计数器 值 为 对象 有 两个 地方 引 用它 的 引用 计数器 值 为 可达性 分析 算法 了解 可达性 分析 算法 之前 先 了解 一个 概念 gcroots 垃圾 收集 的 起点 可以 作为 gcroots 的 有 虚拟机 栈 中 本地 变 量表 中 引用 的 对象 方法 区 中 静态 属性 引用 的 对象 方法 区 中 常量 引用 的 对象 本地 方法 栈 中 jninative 方法 引用 的 对象 当 一个 对象 到 gcroots 没有 任何 引用 链 相连 gcroots 到 这个 对象 不 可达 时 就 说明 此 对 象是 不可用 的 是 死 对象 如 下图 和 gcroots 之间 有 可达 路径 这些 对象 不 会被 回收 但 到 gcroots 之间 没有 可达 路径 这些 对象 就 被判 了 死刑 上面 被判 了 死刑 的 对象 并不是 必死无疑 还有 挽救 的 余 余地 进行 可达性 分析 后 对象 和 gcroots 之间 没有 引用 链 相连 时 对象 将 会被 进行 一次 标记 接着 会 判断 如果 对象 没有 覆盖 object 的 finalize 方法 或者 finalize 方法 已经 被 虚拟机 调 用过 那么 它们 就 会被 行刑 清除 如果 对象 覆 盖了 finalize 方法 且 还没有 被 调用 则会 执行 finalize 方法 中 的 内容 所以在 finalize 方法 中 如果 重新 与 gcroots 引用 链 上 的 对象 关联 就可以 拯救 自己 但是 一般 不 建议 这么做 外 链 图片 转存 失败 源 站 可能有 防盗链 机制 建议 将 图片 保存 下来 直接 上传 imgugihpaa imagesimagepng 方法 区 回收 上面 说的 都是 对 堆 内存 中 对象 的 判断 方法 区 中 主要 回收 的 是 废弃 的 常量 和 无用 的 类 判断 常量 是否 废弃 可以 判断 是否 有 地方 引用 这个 常量 如果 没有 引用 则为 废弃 的 常量 判断 类 是否 废弃 需要 同时 满足 如下 条件 该类 所有 的 实例 已经 被 回收 堆 中 不存在 任何 该类 的 实例 加载 该类 的 classloader 已经 被 回收 该类 对应 的 javalangclass 对象 在 任何地方 没有 被 引用 无法 通过 反射 访问 该类 的 方法 常用 垃圾 回收 算法 常用 的 垃圾 回收 算法 有 三种 标记 清除 算法 复制 算法 标记 整理 算法 标记 清除 算法 分为 标记 和 清除 两个 阶段 首先 标 记出 所有 需要 回收 的 对象 标记 完成后 统一 回收 所有 被 标记 的 对象 缺点 标记 和 清除 两个 过程 效率 都不 高 标记 清除 之 后会 产生 大量 不 连续 的 内存 碎片 复制 算法 把 内存 分为 大小 相等 的 两块 每次 存储 只用 其中 一块 当 这一 块 用 完了 就把 存活 的 对象 全部 复制到 另一 块 上 同时 把 使 用过 的 这块 内存空间 全部 清理 掉 往复 循环 缺点 实际 可 使用 的 内存空间 缩小 为 原来 的 一半 比较 适合 标记 整理 算法 先 对 可用 的 对象 进行 标记 然后 所有 被 标记 的 对象 向 一段 移动 最后 清除 可用 对象 边界 以外 的 内存 分 代 收集 算法 把 堆 内存 分为 新生代 和 老 年代 新生代 又 分为 eden 区 fromsurvivor 和 tosurvivor 一般 新生代 中 的 对象 基本上 都是 朝生夕灭 的 每次 只有 少量 对象 存活 因此 采用 复制 算法 只需要 复制 那些 少量 存活 的 对象 就可以 完成 垃圾 收集 老 年代 中 的 对象 存活率 较 高就 采用 标记 清除 和 标记 整理 算法 来 进行 回收 外 链 图片 转存 失败 源 站 可能有 防盗链 机制 建议 将 图片 保存 下来 直接 上传 imgawozfl imagesimagepng 在 这些 区域 的 垃圾 回收 大概有 如下 几种 情况 新生代 使 用时 minorgc 老 年代 使用 的 fullgc 同 时会 触发 一 minorgc 大多数 情况下 新 的 对象 都 分 配在 eden 区 当 eden 区 没有 空间 进行 分配 时 将 进行 一次 minorgc 清理 eden 区 中 的 无用 对象 清理 后 eden 和 fromsurvivor 中 的 存活 对象 如果 小于 tosurvivor 的 可用 空间 则 进入 tosurvivor 否则 直接 进入 老 年代 eden 和 fromsurvivor 中 还 存活 且 能够 进入 tosurvivor 的 对象 年龄 增加 岁 虚拟机 为 每个 对象 定义 了 一个 年龄 计数器 每 执行 一次 minorgc 年龄 加当 存活 对象 的 年龄 到达 一定 程度 默认 岁 后 进入 老 年代 可以 通过 来 设置 年龄 的 值当 进行了 minorgc 后 eden 还不 足 以为 新 对象 分配 空间 那 这个 新 对象 肯定 很 大新 对象 直接 进入 老 年代 占 tosurvivor 空间 一半 以上 且 年龄 相等 的 对象 大于 等于 该 年龄 的 对象 直接 进入 老 年代 比如 survivor 空间 是 m 有 几个 年龄 为 的 对象 占用 总 空间 已经 超过 m 则 年龄 大于 等于 的 对象 都 直接 进入 老 年代 不需要 等到 指定 的 岁数 在 进行 minorgc 之前 会 判断 老 年代 最大 连续 可用 空间 是否 大于 新生代 所有 对象 总 空间 如果 大于 说明 minorgc 是 安全 的 否 则会 判断 是否 允许 担保 失败 如果 允许 判断 老 年代 最大 连续 可用 空间 是否 大于 历次 晋升 到老 年代 的 对象 的 平均 大小 如果 大于 则 执行 minorgc 否则 执行 fullgc 当在 java 代码 里 直接 调用 systemgc 时会 建议 jvm 进行 fullgc 但 一般 情况下 都会 触发 fullgc 一般 不 建议 使用 尽量 让 虚拟机 自己 管理 gc 的 策略 永久 代 方法 区 中 用于 存放 类 信息 jdk 及 之前 的 版本 永久 代 中 还 存储 常量 静态 变量 等 当 永久 代 的 空间 不足 时 也 会 触发 fullgc 如果 经过 fullgc 还 无法 满足 永久 代 存放 新 数据 的 需求 就会 抛出 永久 代 的 内存 溢出 异常 大 对象 需要 大量 连续 内存 的 对象 例如 很长 的 数组 会 直接 进入 老 年代 如果 老 年代 没有 足够 的 连续 大 空间 来 存放 则会 进行 fullgcminorgc 和 fullgc 在说 这两种 回收 的 区别 之前 我们 先 来说 一个 概念 stoptheworld 如 字面 意思 每次 垃圾 回收 的 时候 都 会将 整个 jvm 暂停 回收 完成后 再 继续 如果 一边 增加 废弃 对象 一边 进行 垃圾 回收 完成 工作 似乎 就 变得 遥遥无期 了 而 一般来说 我们 把 新生代 的 回收 称为 minorgcminor 意思 是 次要 的 新生代 的 回收 一般 回收 很快 采用 复制 算法 造成 的 暂停 时间 很短 而 fullgc 一般 是 老 年代 的 回收 并 伴随 至少 一次 的 minorgc 新生代 和 老 年代 都 回收 而 老 年代 采用 标记 整理 算法 这种 gc 每次 都比 较慢 造成 的 暂停 时间比 较长 通常是 minorgc 时间 的 倍 以上 所以 很明显 我们 需要 尽量 通过 minorgc 来 回收 内存 而 尽量 少 的 触发 fullgc 毕竟 系统 运行 一会儿 就要 因为 gc 卡住 一段时间 再加上 其他 的 同步 阻塞 整个 系统 给人 的 感觉 就是 又 卡 又 慢 选择 垃圾 收集 的 时间 当 程序 运行时 各种 数据 对象 线程 内存 等 都 时 刻在 发生变化 当 下达 垃圾 收集 命令 后 就 立刻 进行 收集 吗 肯定 不是 这里 来 了解 两个 概念 安全 点 safepoint 和 安全区 saferegion 安全 点 从 线程 角度 看 安全 点 可以 理解为 是 在 代码 执行 过程中 的 一些 特殊 位置 当 线程 执行 到 安全 点 的 时候 说明 虚拟机 当前 的 状态 是 安全 的如 果有 需要 可以 在这里 暂停 用户 线程 当 垃圾 收集 时 如果 需要 暂停 当前 的 用户 线程 但 用户 线程 当时 没在 安全 点 上 则 应该 等待 这些 线程 执行 到 安全 点 再 暂停 举个 例子 妈妈 在 扫地 儿子 在 吃 西瓜 瓜皮 会 扔到 地上 妈妈 扫到 儿子 跟前 时 儿子 说 妈妈 等一下 让 我 吃完 这块 再 扫 儿子 吃完 这块 西瓜 把 瓜皮 扔到 地上 后 就是 一个 安全 点 妈妈 可以 继续 扫地 垃圾 收集器 可以 继续 收集 垃圾 理论上 解释 器 的 每条 字节 码 的 边界 上 都可以 放 一个 安全 点 实际上 安全 点 基本上 以 是否 具有 让 程序 长时间 执行 的 特征 为 标准 进行 选定 安全区 安全 点 是 相对于 运行 中 的 线程 来说 的 对于 如 sleep 或 blocked 等 状态 的 线程 收集器 不会 等待 这些 线程 被 分配 cpu 时间 这时候 只要 线程 处于 安全区 中就 可以 算是 安全 的 安全区 就是在 一段 代码 片段 中 引用 关系 不会 发生变化 可以 看作 是 被 扩展 拉 长了 的 安全 点 还以 上面 的 例子 说明 妈妈 在 扫地 儿子 在 吃 西瓜 瓜皮 会 扔到 地上 妈妈 扫到 儿子 跟前 时 儿子 说 妈妈 你 继续 扫地 吧 我 还得 吃 分钟 呢 儿子 吃 瓜 的 这段 时间 就是 安全区 妈妈 可以 继续 扫地 垃圾 收集器 可以 继续 收集 垃圾 gc 的 基本原理 gc 的 基本原理 将 内存 中 不 再被 使用 的 对象 进行 回收 gc 中 用于 回收 的 方法 称为 收集器 由于 gc 需要 消耗 一些 资源 和 时间 java 在对 对象 的 生命周期 特征 进行 分析 后 按照 新生代 旧生 代 的 方式 来 对 对象 进行 收集 以 尽可能 的 缩短 gc 对 应用 造成 的 暂停 对 新生代 的 对象 的 收集 称为 minorgc 对 旧生 代 的 对象 的 收集 称为 fullgc 程序 中 主动 调用 systemgc 强制执行 的 gc 为 fullgc 不同 的 对象 引用 类型 gc 会 采用 不同 的 方法 进行 回收 jvm 对象 的 引用 分 为了 四种 类型 强 引用 默认 情况下 对象 采用 的 均为 强 引用 这个 对象 的 实例 没有 其他 对象 引用 gc 时 才 会被 回收 软 引用 软 引 用是 java 中 提供 的 一种 比较 适合于 缓存 场景 的 应用 只有 在 内存 不够用 的 情况下 才 会被 gc 弱 引 用在 gc 时 一定 会被 gc 回收 虚 引用 由于 虚 引用 只是 用来 得知 对象 是否 被 gcyoung 年轻 代 年轻 代 分 三个 区 一个 eden 区 两个 survivor 区 大部分 对象 在 eden 区 中 生成 当 eden 区 满 时 还 存活 的 对象 将被 复制到 survivor 区 两 个中 的 一个 当 这个 survivor 区 满 时 此 区 的 存活 对象 将被 复制到 另外 一个 survivor 区 当 这个 survivor 去也 满了 的 时候 从 第一个 survivor 区 复制 过来 的 并且 此时 还 存活 的 对象 将被 复制 年 老区 tenured 需要 注意 survivor 的 两个 区 是 对称 的 没 先后 关系 所以 同一个 区 中 可能 同时 存 在从 eden 复制 过来 对象 和 从前 一个 survivor 复制 过来 的 对象 而 复制到 年 老区 的 只有 从 第一个 survivor 去 过来 的 对象 而且 survivor 区 总有 一个是 空 的 tenured 年老 代 年老 代 存放 从 年轻 代 存活 的 对象 一般来说 年老 代 存放 的 都是 生命 期 较长 的 对象 perm 持久 代 用于 存放 静态 文件 如今 java 类 方法 等 持久 代 对 垃圾 回收 没有 显著 影响 但是 有些 应用 可能 动态 生成 或者 调用 一些 class 例如 hibernate 等 在 这种 时候 需要 设置 一个 比 较大 的 持久 代 空间 来 存放 这些 运行 过程中 新增 的 类 持久 代 大小 通过 xxmaxpermsize 进行 设置 版权 声明 本文 为 csdn 博 主 java 程序员 张 凯 的 原创 文章 遵循 ccbysa 版权 协议 转载 请 附上 原文 出处 链接 及 本 声明 原文 链接 常见 垃圾 收集器 现在 常见 的 垃圾 收集器 有 如下 几种 新生代 收集器 老年 代 收集器 堆 内存 垃圾 收集器 g 每种 垃圾 收集器 之间 有 连线 表示 他们 可以 搭配 使用 serial 收集器 serial 是 一款 用于 新生代 的 单线程 收集器 采用 复制 算法 进行 垃圾 收集 serial 进行 垃圾 收集 时 不仅 只用 一条 线程 执行 垃圾 收集 工作 它在 收集 的 同时 所有 的 用户 线程 必须 暂停 stoptheworld 就 比如 妈妈 在家 打扫卫生 的 时候 肯定 不会 边 打扫 边 让 儿子 往 地上 乱扔 纸屑 否则 一边 制造 垃圾 一遍 清理 垃圾 这 活 啥时候 也 干 不完 如下 是 serial 收集器 和 serialold 收集器 结合 进行 垃圾 收集 的 示意图 当 用户 线程 都 执行 到 安全 点 时 所有 线程 暂停 执行 serial 收集器 以 单线程 采用 复制 算法 进行 垃圾 收集 工作 收集 完 之后 用户 线程 继续 开始 执行 适用 场景 client 模式 桌面 应用 单核 服务器 可以用 xxuserserialgc 来 选择 serial 作为 新生代 收集器 外 链 图片 转存 失败 源 站 可能有 防盗链 机制 建议 将 图片 保存 下来 直接 上传 imgbnetx imagesimagepng parnew 收集器 parnew 就是 一个 serial 的 多线程 版本 其 它与 serial 并无 区别 parnew 在 单核 cpu 环境 并不 会比 serial 收集器 达到 更好 的 效果 它 默认 开启 的 收集 线程 数 和 cpu 数量 一致 可以 通过 来 设置 垃圾 收集 的 线程 数 如下 是 parnew 收集器 和 serialold 收集器 结合 进行 垃圾 收集 的 示意图 当 用户 线程 都 执行 到 安全 点 时 所有 线程 暂停 执行 parnew 收集器 以 多线程 采用 复制 算法 进行 垃圾 收集 工作 收集 完 之后 用户 线程 继续 开始 执行 适用 场景 多核 服务器 与 cms 收集器 搭配 使用 当 使用 来 选择 cms 作为 老年 代 收集器 时 新生代 收集器 默认 就是 parnew 也 可以用 xxuseparnewgc 来 指定 使用 parnew 作为 新生代 收集器 外 链 图片 转存 失败 源 站 可能有 防盗链 机制 建议 将 图片 保存 下来 直接 上传 imgnhfdsnc imagesimagepng 收集器 也是 一款 用于 新生代 的 多线程 收集器 与 parnew 的 不同之处 是 parnew 的 目标 是 尽可能 缩短 垃圾 收集 时 用户 线程 的 停顿 时间 的 目标 是 达到 一个 可 控制 的 吞吐量 吞吐量 就是 cpu 执行 用户 线程 的 的 时间 与 cpu 执行 总 时间 的 比值 吞吐量 运行 用户 代 代码 时间 运行 用户 代码 时间 垃圾 收集 时间 比如 虚拟机 一 共运 行了 分钟 其中 垃圾 收集 花 费了 分钟 那 吞吐量 就是 比如 下面 两个 场景 垃圾 收集器 每秒 收集 一次 每次 停顿 秒 和 垃圾 收集器 每秒 收集 一次 每次 停顿 时间 秒 虽然 后者 每次 停顿 时间 变 短了 但是 总体 吞吐 量变 低了 cpu 总体 利用率 变 低了 可以 通过 来 设置 收集器 尽可 能在 多长 时间内 完成 内存 回收 可以 通过 xxgctimeratio 来 精确 控制 吞吐量 如下 是 parallel 收集器 和 parallelold 收集器 结合 进行 垃圾 收集 的 示意图 在 新生代 当 用户 线程 都 执行 到 安全 点 时 所有 线程 暂停 执行 parnew 收集器 以 多线程 采用 复制 算法 进行 垃圾 收集 工作 收集 完 之后 用户 线程 继续 开始 执 行在 老 年代 当 用户 线程 都 执行 到 安全 点 时 所有 线程 暂停 执行 parallelold 收集器 以 多线程 采用 标记 整理 算法 进行 垃圾 收集 工作 适用 场景 注重 吞吐量 高效 利用 cpu 需要 高效 运算 且不 需要 太多 交互 可以 使用 xxuseparallelgc 来 选择 作为 新生代 收集器 jdkjdk 默认 使用 作为 新生代 收集器 外 链 图片 转存 失败 源 站 可能有 防盗链 机制 建议 将 图片 保存 下来 直接 上传 imgfubtddz imagesimagepng serialold 收集器 serialold 收集器 是 serial 的 老 年代 版本 同样是 一个 单线程 收集器 采用 标记 整理 算法 如 下图 是 serial 收集器 和 serialold 收集器 结合 进行 垃圾 收集 的 示意图 适用 场景 client 模式 桌面 应用 单核 服务器 与 收集器 搭配 作为 cms 收集器 的 后备 预 案外 链 图片 转存 失败 源 站 可能有 防盗链 机制 建议 将 图片 保存 下来 直接 上传 imgnjkqne imageswpsjpg cms 收集器 cms 收集器 是 一种 以 最短 回收 停顿 时间 为 目标 的 收集器 以 最短 用户 线程 停顿 时间 著称 整个 垃圾 收集 过程 分为 个 步骤 初始 标记 标记 一下 gcroots 能 直接 关联 到 的 对象 速度 较快 并发 标记 进行 gcrootstracing 标 记出 全部 的 垃圾 对象 耗时 较长 重新 标记 修正 并发 标记 阶段 引 用户 程序 继续 运行 而 导致 变化 的 对象 的 标记 记录 耗时 较短 并发 清除 用 标记 清除 算法 清除 垃圾 对象 耗时 较长 整个 过程 耗时 最长 的 并发 标记 和 并发 清除 都是 和 用户 线程 一起 工作 所以 从总体上 来说 cms 收集器 垃圾 收集 可以 看做 是 和 用户 线程 并发 执行 的 cms 收集器 也 存在 一些 缺点 对 cpu 资源 敏感 默认 分配 的 垃圾 收集 线程 数 为 cpu 数 随着 cpu 数量 下降 占用 cpu 资源 越多 吞吐量 越小 无法 处理 浮动 垃圾 在 并发 清理 阶段 由于 用户 线程 还在 运行 还会 不断 产生 新 的 垃圾 cms 收集器 无法 在 当次 收 集中 清除 这 部分 垃圾 同时 由于 在 垃圾 收集 阶段 用户 线程 也 在 并发 执行 cms 收集器 不能 像 其他 收集器 那样 等 老 年代 被 填满 时 再 进行 收集 需要 预留 一部分 空间 提供 用户 线程 运行 使用 当 cms 运行时 预留 的 内存空间 无法 满足 用户 线程 的 需要 就会 出现 的 错误 这时 将会 启动 后备 预案 临时 用 serialold 来 重新 进行 老 年代 的 垃圾 收集 因为 cms 是 基于 标记 清除 算法 所以 垃圾 回收 后会 产生 空间 碎片 可以 通过 开启 碎片 整理 默认 开启 在 cms 进行 fullgc 之前 会 进行 内存 碎片 的 整理 还 可以用 设置 执行 多少次 不 压缩 不 进行 碎片 整理 的 fullgc 之后 跟着 来 一次 带 压缩 碎片 整理 的 fullgc 适用 场景 重视 服务器 响应速度 要求 系统 停顿 时间 最短 可以 使用 来 选择 cms 作为 老年 代 收集器 外 链 图片 转存 失败 源 站 可能有 防盗链 机制 建议 将 图片 保存 下来 直接 上传 imgegcio imagesimagepng parallelold 收集器 parallelold 收集器 是 的 老 年代 版 本是 一个 多线程 收集器 采用 标记 整理 算法 可以 与 收集器 搭配 可以 充分利用 多核 cpu 的 计算 能力 适用 场景 与 收集器 搭配 使用 注重 吞吐量 jdkjdk 默认 使用 该 收集器 作为 老年 代 收集器 使用 来 指定 使用 paralleold 收集器 外 链 图片 转存 失败 源 站 可能有 防盗链 机制 建议 将 图片 保存 下来 直接 上传 imgmplpz imagesimagepng g 收集器 g 收集器 是 jdk 才 正式 引用 的 商用 收集器 现在 已经成为 jdk 默认 的 收集器 前面 几 款 收集器 收集 的 范围 都是 新生代 或者 老 年代 g 进行 垃圾 收集 的 范围 是 整个 堆 内存 它 采用 化整为零 的 思路 把 整个 堆 内存 划 分为 多个 大小 相等 的 独立 区域 region 在 g 收集器 中 还 保留着 新生代 和 老 年代 的 概念 它们 分别 都是 一部分 region 如 下图 外 链 图片 转存 失败 源 站 可能有 防盗链 机制 建议 将 图片 保存 下来 直接 上传 imgkbzetma imagesimagepng 每一个 方块 就是 一个 区域 每个 区域 可能是 edensurvivor 老 年代 每种 区域 的 数量 也 不一定 jvm 启动 时会 自动 设置 每个 区域 的 大小 mm 必须 是的 次 幂 最多 可以 设置 个 区域 即 支持 的 最 大堆 内 存为 mg 假如 设置 xmxgxmsg 则 每个 区域 大小 为 gm 为了 在 gcrootstracing 的 时候 避免 扫描 全 堆 在 每个 region 中都 有 一个 rememberedset 来 实时 记录 该 区域内 的 引用 类型 数据 与其 他 区域 数据 的 引用 关系 在前 面的 几 款 分 代收 集中 新生代 老 年代 中 也有 一个 rememberedset 来 实时 记录 与其 他 区域 的 引用 关系 在 标 记时 直接 参考 这些 引用 关系 就可以 知道 这些 对象 是否 应 该被 清除 而 不用 扫描 全 堆 的 数据 g 收集器 可以 建立 可 预测 的 停顿 时间 模型 它 维护 了 一个 列表 用于 记录 每个 region 回收 的 价值 大小 回收 后 获得 的 空间 大小 以及 回收 所需 时间 的 经验值 这样 可以 保证 g 收集器 在 有限 的 时间内 可以获得 最大 的 回收 效率 如 下图 所示 g 收集器 收集器 收集 过程 有 初始 标记 并发 标记 最终 标记 筛选 回收 和 cms 收集器 前 几步 的 收集 过程 很 相似 外 链 图片 转存 失败 源 站 可能有 防盗链 机制 建议 将 图片 保存 下来 直接 上传 imgnpygab imagesimagepng 初始 标记 标 记出 gcroots 直接 关联 的 对象 这个 阶段 速度 较快 需要 停止 用户 线程 单线程 执行 并发 标记 从 gcroot 开始 对 堆 中 的 对象 进行 可达 新 分析 找出 存活 对象 这个 阶段 耗时 较长 但可以 和 用户 线程 并发 执行 最终 标记 修 正在 并发 标记 阶段 引 用户 程序 执行 而 产生 变动 的 标记 记录 筛选 回收 筛选 回收 阶段 会对 各个 region 的 回收 价值 和 成本 进行 排序 根据 用户 所 期望 的 gc 停顿 时间 来 指定 回收 计划 用 最少 的 时间 来 回收 包含 垃圾 最多 的 区域 这 就是 garbagefirst 的 由来 第一时间 清理 垃圾 最多 的 区块 这里 为了 提高 回收 效率 并没有 采用 和 用户 线程 并发 执行 的 方式 而是 停顿 用户 线程 适用 场景 要求 尽可能 可控 gc 停顿 时间 内存 占用 较大 的 应用 可以用 xxuseggc 使用 g 收集器 jdk 默认 使用 g 收集器 jvm 的 优化 调 优 目标 使用 较小 的 内存 占 用来 获得 较高 的 吞吐量 或者 较低 的 延迟 程序 在 上线 前 的 测试 或 运行 中有 时会 出现 一些 大大 小小的 jvm 问题 比如 cpuload 过高 请求 延迟 tps 降 低等 甚至 出现 内存 泄漏 每次 垃圾 收集 使用 的 时间 越来 越长 垃圾 收集 频率 越来越高 每次 垃圾 收集 清理 掉 的 垃圾 数据 越来越少 内存 溢出 导致 系统 崩溃 因此 需 要对 jvm 进行 调 优 使得 程序 在 正常 运行 的 前提下 获得 更高 的 用户 体验 和 运行 效率 这里有 几个 比较 重要 的 指标 内存 占用 程序 正常 运行 需要 的 内存大小 延迟 由于 垃圾 收集 而 引起 的 程序 停顿 时间 吞吐量 用户 程序 运行 时间 占 用户 程序 和 垃圾 收集 占用 总 时间 的 比值 当然 和 cap 原则 一样 同时 满足 一个 程序 内存 占用 小 延迟 低 高 吞吐量 是 不可能 的 程序 的 目标 不 同调 优 时 所 考虑 的 方向 也 不 同在 调 优 之前 必 须要 结合实际 场景 有 明确 的 的 优化 目标 找到 性能 瓶颈 对 瓶颈 有 针对性 的 优化 最后 进行 测试通过 各种 监控 工具 确认 调 优 后 的 结果 是否 符合 目标 调 优 可以 依赖 参考 的 数据 有 系统 运行日志 堆栈 错误信息 gc 日志 线程 快照 堆 转 储 快照 等 系统 运行日志 系统 运行日志 就是在 程序代码 中 打 印出 的 日志 描述 了 代码 级别 的 系统 运行 轨迹 执行 的 方法 入 参 返回值 等 一般 系统 出现问题 系统 运行日志 是 首先要 查看 的 日志 堆栈 错误信息 当 系统 出现异常 后 可以 根据 堆栈 信息 初步 定位 问题所在 比如 根据 可以 判断 是 堆 内存 溢出 根据 可以 判断 是 栈 溢出 根据 enspace 可以 判断 是 方法 区 溢出 等 gc 日志 程序 启动时 用 和 可以 在 程序 运行时 把 gc 的 详细 过程 记录下来 或者 直接 配置 verbosegc 参数 把 gc 日志 打 印到 控制台 通过 记录 的 gc 日志 可以 分析 每块 内存 区域 gc 的 频率 时间 等 从而 发现问题 进行 有 针对性 的 优化 线程 快照 顾名思义 根据 线程 快照 可以 看到 线程 在 某一 时刻 的 状态 当 系统 中 可能 存在 请求 超时 死循环 死锁 等 情况 是 可以 根据 线程 快 照来 进一步 确定 问题 通过 执行 虚拟机 自带 的 jstackpid 命令 可以 dump 出 当前 进程 中 线程 的 快照 信息 更 详细 的 使用 和 分析 网上 有 很 多例 这篇 文章 写到 这里 已经 很 长了 就不 过多 叙述 了 贴 一篇 博客 供 参考 堆 转 储 快照 程序 启动时 可以 使用 和 当 程序 发生 内存 溢出 时 把 当时 的 内存 快照 以 文件 形式 进行 转 储 也 可以 直接 用 jmap 命令 转 储 程序 运行时 任意 时刻 的 内存 快照 事后 对 当时 的 内存 使用情况 进行 分析 jvm 的 优化 我们 可以 从 jit 优化 内存 分区 设置 优化 以及 gc 选择 优化 三个 方面 入手 jit 优化 在 系统启动 的 时候 首先 java 代码 是 解释 执行 的当 方法 调用 次数 到达 一定 的 阈值 的 时候 clientserver 会 采用 jit 优化 编译 而 直接 将 jvm 的 启动 设置 为 xcomp 并不 会有 想象 中 那么 好没 有 足够 的 profile 侧 写 可以 大致 理解为 分析 结果 优化 出来 的 代码 质量 很差 甚至于 执行 效率 还要 低于 解释 器 执行 并且 机器码 的 大小 很 容易 就 超出 字节 码 大小 的 倍 以上 那么 我们 能做 的 就是 通过 附加 启动 命令 适当 的 调整 这个 阈值 或者 调整 热度 衰减 行为 在 恰当 的 时候 触发 对 代码 进行 即时 编译 方法 计数器 阈值 回 边 计数器 阈值 这 并不是 直接 调整 阈值 回 边 计数器 的 调整 在此 仅 作 简单 介绍 此 计数器 会 根据 是 client 模式 还是 server 模式 有 不同 的 计算公式 关闭 热度 衰减 设置 半 衰 周期 而 jit 也是 一片 广阔 的 知识 海洋 有 兴趣 可以 根据 以下 的 优化 技术 名称 搜索 了解 详情 在此 就不 赘述 了 jvm 内存 分区 优化 调 优 工具 用 可以 查看 虚拟机 启动 的 所有 进程 执行 主 类 的 全名 jvm 启动 参数 比如 当 执 行了 jpstest 类 中 的 main 方法 后 main 方法 持续 执行 执行 jpsl 可 看到 下面 的 oomtest 类 的 pid 为 加上 v 参数 还 可以 看到 jvm 启动 参数 用 监视 虚拟机 信息 jstatgcpid 每 毫秒 打印 一次 java 堆 状况 各个 区 的 容量 使用 容量 gc 时间 等 信息 打 印次 jstat 还 可以 以其 他 角度 监视 各区 内存大小 监视 类 装载 信息 等 具体 可以 googlejstat 的 详细 用法 用 查看 堆 内存 信息 执行 jmaphistopid 可以 打 印出 当前 堆 中所 有 每个 类 的 实例 数量 和 内存 占用 如下 classname 是 每个 类 的 类 名 b 是 byte 类型 c 是 char 类型 i 是 int 类型 bytes 是 这个 类 的 所有 示例 占用 内存大小 instances 是 这个 类 的 实例 数量 执行 jmapdump 可以 转 储 堆 内存 快 照到 指定 文件 比如 执行 可以 把 当前 堆 内存 的 快照 转 储 到 文件 中 然后 可以 对 内存 快照 进行 分析 利用 jvisualvm 分析 内存 信息 各个 区 如 edensurvivorold 等 内存 变化 情况 如果 查看 的 是 远程 服务器 的 jvm 程序 启动 需要 加上 如下 参数 分析 堆 转 储 快照 前面 说到 配置 了 参数 可以 在 程序 发生 内存 溢出 时 dump 出 当前 的 内存 快照 也 可以用 jmap 命令 随时 dump 出 当时 内存 状态 的 快照 信息 dump 的 内存 快照 一般 是以 hprof 为 后缀 的 二进制 格式文件 可以 直接 用 命令 来 分析 内存 快照 它 的 本质 实际上 内嵌 了 一个 微型 的 服务器 可以 通过 浏览器 来 分析 对应 的 内存 快照 比如 执行 表示 以 端口 启动 jhat 内嵌 的 服务器 在 控制台 可以 看到 服务器 启 动了 访问 http 可以 看到 对 快照 中 的 每个 类 进行 分析 的 结果 jvisualvm 也 可以 分析 内存 快 照在 jvisualvm 菜单 的 文件 装入 选择 堆 内存 快照 快照 中 的 信息 就以 图形界面 展示出 来了 如下 主要 可以 查看 每个 类 占用 的 空间 实例 的 数量 和 实例 的 详情 等 jvm 调 优 经验 我们 依据 javaperformance 这 本书 的 建议 的 设置 原则 进行 设置 java 整个 堆 大小 设置 xmx 和 xms 设置 为 老 年代 存活 对象 的 倍 即 fullgc 之后 的 老 年代 内存 占用 的 倍 xmx 和 xms 的 大小 设置 为 一样 避免 gc 后 对 内存 的 重新分配 而 fullgc 之后 的 老 年代 内存大小 我们 可以 通过 前面 在 visualvm 中 添加 的 插件 visualgc 查看 先 手动 进行 一次 gc 然后 查看 老 年代 的 内存 占用 新生代 xmn 的 设置 为 老 年代 存活 对象 的 倍 老 年代 的 内存大小 设置 为 老 年代 存活 对象 的 倍 jvm 配置 方面 一般 情况 可以 先用 默认 配置 基本 的 一些 初始 参数 可以 保证 一般 的 应用 跑 的 比较稳定 了 在 测试 中 根据 系统 运行状况 会话 并发 情况 会话 时间 等 结合 gc 日志 内存 监控 使用 的 垃圾 收集器 等 进行 合理 的 调整 当 老 年代 内存 过 小时 可能 引起 频繁 fullgc 当 内存 过大 时 fullgc 时间 会 特别 长 那么 jvm 的 配置 比如 新生代 老 年代 应该 配置 多大 最合适 呢 答案 是 不一 定调 优 就是 找 答案 的 过程 物理 内存 一定 的 情况下 新生代 设置 越大 老 年代 就 越小 fullgc 频率 就 越高 但 fullgc 时间 越短 相反 新生代 设置 越小 老 年代 就 越大 fullgc 频率 就越 低 但 每次 fullgc 消耗 的 时间 越大 建议 如下 xms 和 xmx 的 值 设置成 相等 堆 大小 默 认为 xms 指定 的 大小 默认 空闲 堆 内存 小于 时 jvm 会 扩 大堆 到 xmx 指定 的 大小 空闲 堆 内存 大于 时 jvm 会 减 小堆 到 xms 指定 的 大小 如果在 fullgc 后 满足 不 了 内存 需求 会 动态 调整 这个 阶段 比较 耗费 资源 新生代 尽量 设置 大 一些 让 对象 在 新生代 多 存活 一段时间 每次 minorgc 都要 尽可能 多 的 收集 垃圾 对象 防止 或 延迟 对象 进入 老 年代 的 机会 以 减少 应用程序 发生 fullgc 的 频率 老 年代 如果 使用 cms 收集器 新生代 可以 不用 太大 因为 cms 的 并行 收集 速度 也 很快 收集 过程 比较 耗时 的 并发 标记 和 并发 清除 阶段 都可以 与 用户 线程 并发 执行 方法 区 大小 的 设置 之前 的 需要 考虑 系统 运行时 动态 增加 的 常量 静态 变量 等 只要 差不多 能 装下 启动时 和 后期 动态 加载 的 类 信息 就行 代码 实现 方面 性能 出现问题 比如 程序 等待 内存 泄漏 除了 jvm 配置 可能 存在 问题 代码 实现 上 也有 很大 关系 避免 创建 过大 的 对象 及 数组 过大 的 对象 或 数组 在 新生代 没有 足够 空间 容纳 时会 直接 进入 老 年代 如果是 短命 的 大 对象 会 提前 出发 fullgc 避免 同时 加载 大量 数据 如一 次 从 数据库 中 取出 大量 数据 或者 一次 从 excel 中 读取 大量 记录 可以 分批 读取 用完 尽快 清空 引用 当 集合 中有 对象 的 引用 这些 对象 使 用完 之后 要尽 快把 集合 中 的 引用 清空 这些 无用 对象 尽快 回收 避免 进入 老 年代 可以 在 合适 的 场景 如 实现 缓存 采用 软 引用 弱 引用 比 如用 软 引 用来 为 objecta 分配 实例 在 发生 内存 溢出 前 会将 objecta 列入 回收 范围 进行 二次 回收 如果 这次 回收 还没有 足够 内存 才会 抛出 内存 溢出 的 异常 避免 产生 死循环 产生 死循环 后 循环 体内 可能 重复 产生 大量 实例 导致 内存空间 被 迅速 占满 尽量 避免 长时间 等待 外部 资源 数据库 网络设备 资源 等 的 情况 缩小 对象 的 生命周期 避免 进入 老 年代 如果 不能 及时 返回 结果 可以 适当 采用 异步 处理 的 方式 等 常用 jvm 参数 参考 参数 说明 实例 xms 初始 堆 大小 默认 物理 内存 的 xmsmxmx 最 大堆 大小 默认 物理 内存 的 xmsgxmn 新生代 内存大小 官方 推荐 为 整个 堆 的 xmnmxss 线程 堆栈 大小 jdk 及 之后 默认 m 之前 默认 设置 新生代 和 年老 代 的 比值 如 为 表示 年轻 代与 年老 代 比值 为 年轻 代 占 整个 年轻 代 年老 代 和 的 年轻 代 中 eden 区 与 两个 survivor 区 的 比值 注意 survivor 区有 两个 如 表示 edensurvivor 一个 survivor 区 占 整个 年轻 代 的 永久 代 初始值 默 认为 物理 内存 的 永久 代 最大值 默 认为 物理 内存 的 在 控制台 打印 类 加载 信息 verbosegc 在 控制台 打印 垃圾 回收 日志 xxprintgc 打印 gc 日志 内容 简单 打印 gc 日志 内容 详细 在 gc 日志 中 添加 时间 戳 xloggcfilename 指定 gc 日志 路径 seserialgc 年轻 代 设置 串行 收集器 年轻 代 设置 并行 收集器 设置 收集 时 使用 的 cpu 数 并行 收集 线程 数 设置 回收 的 最大 时间 毫秒 设置 垃圾 回收 时间 占 程序 运行 时间 的 百分比 公式 为 n 设置 老年 代为 并行 收集器 parallelold 收集器 设置 老 年代 并发 收集器 设置 cms 收集器 为 增量 模式 适用于 单 cpu 情况 设置 jvm 参数 的 几种 方式 集成 开发 环境 下 启动 并 使用 jvm 如 eclipse 需要 修改 根目录 文件 服务器 下 安装版 tomcat 可 使用 tomcatwexe 工具 tomcat 目 录下 和 直接 修改 注册表 两种 方式 修改 jvm 参数 windows 服务器 解压 版 tomcat 注册 windows 服务 方法 同上 解压 版本 的 tomcat 通过 startupbat 启动 tomcat 加载 配置 的 在 tomcat 的 bin 下 catalinabat 文件 内 添加 linux 服务器 tomcat 设置 jvm 修改 环境 下 配置 javaoptsfullgc 是 mangc 的 倍 数据库 优化 sql 一 什么 是 分 区分 表 分库 分区 将 表 的 数据 均衡 分 摊到 不同 的 硬盘 系统 或是 不同 服务器 存储 介子 中 实际上 还是 一张 表 提高 查询 效率 就是 把 一张 表 的 数据 分成 n 个 区块 在 逻辑 上 看 最终 只是 一张 表 但 底层 是 由 n 个 物理 区块 组成 的 分 表 就是 把 一张 表 按 一定 的 规则 分解成 n 个 具有 独立 存储空间 的 实 体表 系统 读写 时 需要 根据 定义 好 的 规则 得到 对应 的 字 表明 然后 操作 它 分库 一旦 分 表 一个 库 中 的 表 会 越来越多 关系 型 数据库 关系 型 数据库 和 常见 的 表格 比较 相似 关系 型 数据库 中表 与 表 之间 是 有 很多 复杂 的 关联 关系 的 常见 的 关系 型 数据库 有 非 关系 型 数据库 nosql 大量 的 nosql 数据库 如 出于 简化 数据库 结构 避免 冗余 影响 性能 的 表 连接 摒弃 复杂 分布式 的 目的 被 设计 in 和 exists 的 区别 外层 查询 表 小于 子 查询 表 则用 exists 外层 查询 表 大于 子 查询 表 则用 in 如果 外层 和 子 查询 表 差不多 则 爱用 哪个 用 哪个 索引 失效 索引 字段 进行 判 空 查询 时 也 就是 对 索引 字段 判断 是否 为 null 时 语句 为 isnull 或 isnotnull 对 索引 字段 进行 like 查询 时 like 后面 跟 判断 索引 列 是否 不等于 某个 值 时 操作符 比如 对 索引 列 进行 运算 这里 运算 包括 等 运算 也 包括 使用 函数 or 会 导致 索引 失效 单机 优化 建 表 三 范式 三 范式 列 不可分割 表 中 的 记录 具有 唯一 标识 通常 通过 主键 来 实现 表 中 尽量 不要 有 冗余 的 字段 能够 通过 其他 表 推导 出来 的 数据 不要 单独 设置 字段 通常 通过 外 键 来 实现 每 一列 属性 都是 不可 再分 的 属性 值 确保 每 一列 的 原子 性 每 一行 的 数据 只能 与其 中一 列 相关 即 一行 数据 只 做 一件事 只要 数据 列 中 出现 数据 重复 就 要把 表 拆分 开来 表 中 记录 是 唯一 标识 通过 主键 来 实现 二 范式 就是 要有 主键 要求 其他 字段 都 依赖于 主键 数据 不能 存在 传递 关系 即 每个 属性 都 跟 主键 有 直接关系 而 不是 间接 关系 像 agtbgtc 属性 之间 含有 这样 的 关系 是 不符合 第三 范式 的 是 要 消除 传递 依赖 方便 理解 可以 看做 是 消除 冗余 学号 姓名 年龄 性别 所在 院校 所在 院校 院校 地址 院校 电话 关系 型 数据库 瓶颈 高 并发 读写 需求 网站 高 并发 高 双 十一 购物 硬盘 io 是 一个 很大 的 问题解决 集群 和 分布式 海量 数据 的 高效率 读写 解决 分 表 分库 表 的 数据量 太大 高 扩展性 和 可用性 单机 优化 关系 型 数据库 的 优化 技术 定位 慢 查询 找出 执行 效率 低 sql 定位 的 时候 先 关闭 mysql 服务 cmd 在 bin 目 录下 cmd 执行 查看 和 修改 慢 查询 时间 阈值 查询 慢 查询 的 次数 系统 默认 的 慢 查询 时间 为 查询 表 中所 有的 数据 selectcount fromemp 设置 慢 查询 时间 默认设置 是 当前 会话 的 慢 查询 时间 如果 需要 设置 全局 的 常用命令 查看 数据库 运 行了 多久 单位 是 秒 查看 crud 的 次数 只 看 查询 的 次数 新增 和 查询 的 比例 是 二八 查询 所有 连接数 查询 最大 连接数 可以 作为 配置 数据库 最大 连接数 依据 查询 慢 查询 的 次数 系统 默认 的 慢 查询 时间 为 查看 数据库 慢 查询 时间 表 中 总 条数 selectcount 设置 慢 查询 时间 默认设置 是 当前 会话 的 慢 查询 时间 如果 需要 设置 全局 的 步骤 总结 关闭 原有 mysql 服务 以 支持 记录 慢 sql 的 方式 来 启动 设置 慢 查询 时间 阀值 构造 慢 sql 到 日志 文件 中 找 慢 sqldatadir 什么时候 开启 慢 查询 系统 中所 有 sql 都 执行 一遍 才能 判断 是否 有 慢 sql 什么时候 开启 能 覆盖 所有 sql 执行 开发者 自 验 开发 完成后 需要 统一 打包 统一 部署 统一 验证 测试 人员 测试 测试 人员 需要 测试 所有 功能 项目 上线 用户 用了 所有 功能分析 慢 查询 外 链 图片 转存 失败 源 站 可能有 防盗链 机制 建议 将 图片 保存 下来 直接 上传 imgkwhtwpvi imagesimagepng 外 链 图片 转存 失败 源 站 可能有 防盗链 机制 建议 将 图片 保存 下来 直接 上传 imgbuflqj imagesimagepng explain 慢 查询 的 sql 语句 type 如果 all 表示 全 表 扫描 possiblekeys 可能 用到 的 索引 key 实际 用到 的 索引 rows 扫描 多少 行 分析 慢 查询 索引 失效 的 问题 like 百分号 不能 在前面 likeouhcnkkxfl 优化 单机 的 优化 表 结构 索引 sql 选择 数据库 引擎 表 机构 遵循 范式 nf 反 三 范式 nf 添加 字段 课程 封面 能 看到 浏览量 或 购买 量 点 进 去就 加给 课程 添加 一个 字段 变长 根据 存储 数据 的 大小 用 多少 就 分配 多少 定长 会 立即 分配 相应 的 空间 来 存储 数据 索引 索引 index 是 帮助 数据库 管理 系统 dbms 高效 获取 数据 的 数据结构 组织 数据 方式 及 访问 数据 的 api 的 封装 listsetmap 数组 索引 算法 myisam 不支持 事务 外 键 查询 较多 可用 表 锁 innodb 支持 事务 外 键 读写 都可以 行 锁 只 支持 btree 算法 以 空间 换 时间 添加 索引 查询 效率高 增 删改 的 效率 低 增加 io 索引 存在 磁盘 上面 总结 使用 索引 把 全 表 查找 变为 索引 查找 减少 查询 次数 增加 查询 效率 而 索引 查找 效率 的 取决于 索引 算法 也 就是 索引 index 是 帮助 dbms 高效 获取 数据 的 数据结构 索引 的 分类 根据 索引 列 的 多少 分为 复合 索引 多 列 和 普通 索引 单列 普通 索引 唯一 索引 主键 索引 全文索引 普通 索引 允许 重复 的 值 出现 一般来说 普通 索引 的 创建 是 先 创建 表 然后 在 创建 普通 索引 createindex 索引 名 on 表 列 列名 altertable 表 名 addindex 索引 名 列 列名 比如 createtableaaa name name 唯一 索引 除了 不能 有 重复 的 记录 外 其它 和 普通 索引 一样 当 表 的 某 列 被 指 定为 unique 约束 时 这 列 就是 一个 唯一 索引 例如 createtablebbb unique 这时 name 列 就是 一个 唯一 索引 在 创建 表 后 再去 创建 唯一 索引 索引 名 on 表 名 列 列 altertable 表 名 adduniqueindex 索引 名 列 列 例如 createtableccc 注意 unique 字段 可 以为 null 并可以 有 多 null 但是 如果是 具体内容 则 不能 重复 主键 字段 不 能为 null 也 不能 重复 主键 索引 是 随着 设定 主键 而 创建 的 也 就是 把 某个 列 设为 主键 的 时候 数据库 就会 給 改 列 创建 索引 这 就是 主键 索引 唯一 且 没有 null 值 创建 表 时 指定 主键 例如 createtableddd notnulldefaul 这时 id 列 就是 主键 索引 如果 你 创建 表 时 没有 指定 主键 也 可以 在 创建 表 后 再 添加 主键 指令 altertable 表 名 addprimarykey 列名 举例 createtableeee notnulldefault id 全文索引 用来 对表 中 的 文本 域 charvarchartext 进行 索引 全文索引 针对 myisam 有用 添加 主键 altertable 表 名 addprimarykey 列名 创建 索引 的 原则 经常 作为 查询 或者 排序 条件 的 字段 建立 索引 唯一性 太差 的 字段 不适合 创建 索引 比如 性别 频繁 更新 修改 的 字段 不适合 创建 索引 因为 每次 修改 都 需要 重新 维护 索引 结构 导致 大量 的 io 单列 只 在 一个 字段 创建 多 列 复合 索引 由 多个 字段 共同 组成 索引 dnameloc 删除 索引 altertable 表 名 dropindex 索引 名 删除 主键 修改 先 删除 后 添加 修改 索引 的 代价 占用 磁盘空间 对 dml 操作 有影响 因为 要 维护 索引 变慢 对于 创建 的 多 列 索引 复合 索引 不是 使用 的 第一 部分 就不会 使用 索引 会 使用 索引 不会 使用 索引 会 使用 索引 会 使用 索引 不会 索引 or 会 导致 索引 失效 不会 使用 索引 不会 使用 索引 会 使用 索引 like 模糊 查询 前置 匹配 导致 索引 失效 判断 会 导致 索引 失效 索引 失效 对于 创建 的 多 列 索引 复合 索引 不是 使用 的 第一 部分 索引 会 失 效用 or 会 导致 索引 失效 like 模糊 查询 前置 匹配 导致 索引 失效 isnullisnull 判断 会 导致 索引 失效 如果 mysql 估计 使用 全 表 扫描 要比 使用 索引 快 则不 使用 索引 表 中一 条 数据 存储 引擎 分类 和 innodb 的 区别 主要 事务 安全 myisam 不支持 事务 innodb 支持 查询 和 添加 速度 myisam 速度快 innodb 速度慢 支持 全文索引 myisam 支持 innodb 不支持 锁 机制 myisam 表 锁 innodb 行 锁 外 键 myisam 不支持 外 键 innodb 支持 外 键 通常 不 设置 外 键 通常是 在 程序 中 保证 数据 的 一致 外 链 图片 转存 失败 源 站 可能有 防盗链 机制 建议 将 图片 保存 下来 直接 上传 imgbph imagesimagepng 引擎 的 使用 场景 myisam 存储 引擎 如果 表 对事 务 要求 不高 同时 是以 查询 和 添加 为主 的 我们 考虑 使用 myisam 存储 引擎 比如 bbs 中 的 发帖 表 回复 表 innodb 存储 引擎 对事 务 要求 高 保存 的 数据 都是 重要 数据 我们 建议 使用 innodb 比如 订单 表 账号 表 memory 存储 比如 我们 数据 变化 频繁 不需要 入库 同时 又 频繁 的 查询 和 修改 我们 考虑 使用 memory 速度 极快 修改 数据库 引擎 指定 存储 引擎 的 时机 建 表 的 时候 指定 没有 指定 的 时候 使用 的 是 myini 默认 的 createtabletest idint namevarchar 指定 数据库 引擎 createtable 表 名 字段 列表 engine 存储 引擎 名称 createtabletest idint namevarchar enginemyisam 修改 存储 引擎 查询 qqueryselectdml 数据管理 定义 删除 分 表 水平 行 业务 id 区间 时间 hash 分 表 垂直 列 将 一些 不 经常 查询 的 大 的 字段 分 一张 表 用 外 键 连接 水平 分割 行 和 垂直 分割 列 所以 一个 好 的 拆分 依据 是 最 重要 的 unionunionall 分 表 策略 水 平分 表 数据 百 w 一张 表 经常 组合 union 查询 如果 一张 表 中 数据量 巨大 时 我们 要 经常 查询 则 可以 按照 合适 的 策略 拆 分为 多张 小 表 尽量 在 单张 表 中 查询 减少 扫描 次数 增加 查询 效率 如果 拆分 不好 经常 组合 union 查询 还不 如不 拆 分分 表 策略 按 时间 分 表 这种 分 表 方式 有 一定 的 局限性 当 数据 有 较强 的 实效性 如 微 博 发送 记录 微 信 消息 记录 等 这种 数据 很少 有 用户 会 查询 几个 月前 的 数据 如 就可以 按 月分 表 按 业务 类型 按 区间 范围 分 表 一般 在有 严格 的 自 增 id 需求 上 如 按照 userid 水 平分 表 tableuserid 从 wtableuserid 从 wwtableuserid 从 wwhash 分 表 通过 一个 原始 目标 的 id 或者 名称 通过 一定 的 hash 算法 计算出 数据 存储 表 的 表 名 然后 访问 相应 的 表 teacherteacher 生成 id 的 方式 主键 自 增 uuid 雪花 算法 最 简单 hash 算法 tuserid 复杂 hash 算法 分张 表 余 加 可以 得到 最 大张 垂直 分 表 字段 却 很长 表 占用 空间 很大 检索 表 时 需要 执行 大量 io 严重 降 低了 性能 这个 时候 需 要把 大 的 字段 拆 分到 另一个 表 并且 该 表 与 原 表 是 一对一 的 关系 外 键 join 如果 一张 表 某个 字段 信息 量大 但是 我们 很少 查询 则 可以 考虑 把 这些 字段 单独 的 放入 到 一张 表 中用 外 键 关联 如果 硬是 要 查询 就是 用 跨 表 查询 join 分区 分区 是 将 数据 分段 划 分在 多个 位置 存放 可 以是 同一 块 磁盘 也 可以 在 不同 的 机器 分区 后 表面上 还是 一张 表 但 数据 散 列到 多个 位置 了 app 读写 的 时候 操作 的 还是 大 表 名字 db 自动 去 组织 分区 的 数据 查看 数据库 是否 支持 以后 支持 优化 小 技巧 ddl 优化 变 多次 索引 维护 为 一次 索引 维护 变 多次 唯一 校验 为 一次 唯一 校验 变 多次 事务 提交 为 一次 事务 提交 dml 优化 变 多次 事务 提交 为 一次 事务 提交 种 sql 语句 优化 变 多次 维护 为 一次 维护 dql 优化 注意 索引 失效 的 情况 对于 limit 分页 当 偏移 量大 的 时候 使用 一个 带有 索引 的 字段 进行 排序 或者 过滤 就 不再是 全 表 扫描 多 机 优化 主流 方案 shardingsphere 是 一套 开源 的 分布式数据库 中间件 解决方案 组成 的 生态圈 它 由 和 shardingsidecar 计划 中 这款 相互 独立 的 产品 组成 他们 均 提供 标准化 的 数据 分片 分布式 事务 和 数据库 治理 功能 可 适用于 如 java 同构 异构 语言 容器 云 原生 等 各种 多样化 的 应用 场景 shardingjdbc 读写 分离 分 表 分库 定位 为 轻量级 java 框 架在 java 的 jdbc 层 提供 的 额外 服务 它 使用 客户端 直连 数据库 以 jar 包 形式 提供 服务 无需 额外 部署 和 依赖 可 理解为 增强版 的 jdbc 驱动 完全 兼容 jdbc 和 各种 orm 框架 当当网 开源 框架 文档 丰富 使用 成本低 shardingjdbc 是 一个 开源 的 适用于 微 服务 的 分布式 数据 访问 基础 类 库 它 始终 以 云 原生 的 基础 开发 套件 为 目标 只 支持 java 语言 适用于 任何 基于 java 的 orm 框架 如 或 直接 使用 jdbc 基于 任何 第三方 的 数据库 连接池 如 等 支持 任意 实现 jdbc 规范 的 数据库 目前 支持 和 定位 为 透明化 的 数据库 代理 端 提供 封 装了 数据库 二进制 协议 的 服务端 版本 用于 完 成对 异构 语言 的 支持 目前 先 提供 mysql 版本 它可 以 使用 任何 兼容 mysql 协议 的 访问 客户端 如 等 操作 数据 对 dba 更加 友好 向 应用程序 完全 透明 可直接 当做 mysql 使用 适用于 任何 兼容 mysql 协议 的 客户端 shardingsidecar 定位 为 kubernetesks 或 mesos 的 云 原生 数据库 代理 以 daemonset 的 形式 代理 所有 对 数据库 的 访问 通过 无 中心 零 侵入 的 方案 提供 与 数据库 交互 的 的 啮合 层 即 databasemesh 又 可称 数据 网格 三者 的 区别 特点 数据库 任意 mysqlmysql 连接 消耗 数 高低 高 异构 语言 仅 java 任意 任意 性能 损耗 低损耗 略高 损耗 低 无 中心 化 是否 是 静态 入口 无 有无 主从 同步 准备 环境 分别 构造 主从 数据库 并 输出 日志 方便 定位 问题 拷贝 数据库 安装 目录 的 文件夹 进入 myini 进行 修改 配置 修改 master 中 的 myini 路径 改为 master 的 路径 权限 不足以 管理 身份 运行 netstartmysqlxy 重启 服务 弄 错了 可以 删除 服务 重新 操作 开启 日志 非 必须 非 必须 开启 sql 语句 的 日志 生产 环境 不 建议 开启 查看 日志 目录 并 开启 sql 语句 的 日志 开启 后 重启 mysql 上述 开启 日志 配置 将 失效 测试 环境 使用 进行 读写 分离 pom 导 包 什么 是 框架 程序 中 的 框架 framework 其实是 一系列 jar 包 的 组合 程序 中 的 框架 framework 其实是 一系列 jar 包 的 组合 一个 半成品 不需 要从 零 起步 提高 开发 效率 为了 解决 某一个 领域 的 问题 而 产生 适用于 团队 开发 统一 规范 方便 维护 代码 重用 spring 用到 的 设计 模式 代理 模式 在 aop 和 remoting 中被 用 的 比 较多 单 例 模式 在 spring 配置文件 中 定义 的 bean 默 认为 单 例 模式 模板 方法 用来 解决 代码 重复 的 问题 比如 工厂 模式 beanfactory 用来 创建 对象 的 实例 适配器 springaop 装饰 器 观察者 spring 时间 驱动 模型 回 调 回 调 接口 是 一个 di 注入 轻量级 控制 反转 ioc 和 面向 切面 编程 aop 的 容器 框架 轻量级 相对于 重量级 框架 设计 比较 繁琐 配置 较多 例如 ejbtomcat 不支持 现在 基本 不 用了 而言 开发 使用 比较简单 功能强大 控制 反转 将 创建 对象 的 权利 交给 spring 容器 去 管理 就不 用了 我们 之前 new 对象 的 方式 了 我们 直接 用 autowide 注入 就可以 了 通过 引入 ioc 容器 利用 依赖 关系 注入 的 方式 实现 对象 之间 的 解 耦 beanfactory 是 懒 加载 ioc 容器 的 基本 实现 它是 工厂 设计 模式 的 实现 允许 通过 名称 创 建和 检索 对象 beanfactory 也 可以 管理 对象 之间 的 关系 是 beanfactory 的 子类 功能 更加 强大 是 迫切 加载 主要 的 个 实现 从 类 路径 下 加载 配置文件 从 文件 系统 中 加载 配置文件 factorybean 而言 这个 bean 不是 简单 的 bean 而是 一个 能 生产 或者 修饰 对象 生成 的 工厂 bean 它 的 实现 与 设计 模式 中 的 工厂 模式 和 修饰 器 模式 类似 代理 模式 注解 tranlcation 将 相同 的 逻辑 抽取 出来 即将 业务 逻辑 从 应用服务 中 分离出来 然后 以 拦截 的 方式 作 用在 一个 方法 的 不同 位置 例如 日志 事务 的 处理 过滤 隔离 注解 xml 不同 的 类 有 相同 的 方法 可以 把 方法 抽出来 形成 一个 单独 的 类 谁要 这个 方法 就 直接 调 如果 多个 类 出现 了 相同 的 代码 就应该 抽取 一个 父 类 然后 把 这些 公共 的 代码 都 写在 父 类 中 将 日志 记录 性能 统计 安全 控制 事务处理 异常 处理 等 代码 从 业务 逻辑 代码 中 划分 出来 通过 对 这些 行为 的 分离 我们 希望 可以 将 它们 独立 到 非 指导 业务 逻辑 的 方法 中 进而 改变 这些 行为 的 时候 不影响 业务 逻辑 的 代码 解 耦 di 一个 对象 的 创建 可能 涉及到 另一个 对象 的 创建 比如 a 对象 的 成员 变量 持有 b 对象 的 引用 这 就是 依赖 a 依赖于 b 那么 spring 容器 在 创建 对象 a 的 时候 也 会 创建 对象 b 并把 对象 b 注入 到 对象 a 中 spring 致力于 jee 应用 的 各层 的 解决方案 而 不是 仅仅 专注 于 某一 层 的 方案 在 企业级 开发 中 通常 用于 整合 其他 层次 的 框架 spring 相当 于是 一个 大 的 工厂 程序员 需要 将 对象 的 创建 交给 spring 去 执行 spring 的 一个 最大 的 目的 就是 使 javaee 开发 更加 容易 spring 提供 了 对 开源 社区 中 很多 框架 及 javaee 中 很多 技术 的 支持 让 程序员 很 轻松 能 整合 及 使用 这些 框架 技术 spring 在 一定 程度 行 降 低了 代码 之间 的 耦合度 使得 维护 难度 降 低了 容器 框架 装 对象 bean 是 spring 中 的 对象 测试 配置文件 springmvc 默认 单利 线程 安全 springmvc 是 spring 中 的 一个 模块 它 可以 和 spring 无缝 连接 是 一个 web 层 表现 层 的 框架 也 叫 mvc 框架 核心 控制器 用于 web 层 核心 功能 的 处理 以及 在所 有 控制器 执行 之前 所有 的 webmvc 框架 都 采 用了 这种 方式 在 springmvc 中 使用 的 是 为 核心 控制器 核心 控制器 会 拦截 匹配 的 请求 把 拦截 下来 的 请求 依据 相应 的 规则 分 发到 目标 controller 来 处理 modelandview 是 springmvc 控制器 中 特有 一个 对象 描述 一次 请求 响应 的 数据 model 和 视图 view 一 全 注解 实例 化 bean 的 注解 controller 控制 层 注解 service 业务 层 componet 通用 的 repository 持久 化 前提 是 扫描 包 路径 请求 注解 requestmapping 前提 是 开启 mvc 注解 注入 注解 autowired 创建 对象 可以 使 用在 字段 和 setter 方法 上 接收 请求 参数 req 参数 形 参 名字 必须 与 表单 中 name 属性 值 相同 通过 对象 获取 bean 属性 要与 表单 中 的 name 属性 值 相同 通过 pathvariable 获取 的 三种 实现 实现 controller 接口 实现 接口 普通 类 pojo 和 注解 requestmapping 注意事项 要 使用 controller 注解 创建 对象 的 注解 就需要 配置 lt 扫描 包 路径 会 扫描 cnitsource 包 及其 子 包下 所有 的 类 如 果类 上面 有 实例 化 bean 的 注解 例如 controller 容器 就会 创建 该类 的 实例 并 交给 容器 管理 否 则不 创建 要 使用 requestmapping 注解 请求 映射 注解 就需要 配置 lt 开启 spring 对 mvc 的 支持 即 能够 使用 requestmapping 注解 执行 流程 二 返回 jsonrequestbody 注解 requestbody 注解 用于 读取 http 请求 的 内容 字符串 通过 springmvc 提供 的 接口 将 读到 的 内容 转 换为 jsonxml 等 格式 的 数据 并 绑定 到 controller 类 方法 的 参 数上 本 例子 应用 requestbody 注解 实现 接收 http 请求 的 json 数据 将 json 数据 转 换为 java 对象 responsebody 注解 responsebody 注解 用于 将 controller 类 的 方法 返回 的 对象 通过 接口 转 换为 指定 格式 的 数据 如 jsonxml 等 通过 response 响 应给 客户端 springdatajpa 技术 特点 我们 只需要 定义 接口 并 集成 springdatajpa 中所 提供 的 接口 就可以 了 不需要 编写 接口 实现 类 springdatajpa 是 spring 基于 orm 框架 jpa 规范 的 基础上 封装 的 一套 jpa 应用 框架 可使 开发者 用 极 简 的 代码 即可 实现 对 数据 的 访问 和 操作 springdatajpa 的 独特 之处 就是 简单 查询 根本 不用 写 实现 类 直接 写 接口 就 就好 它能 根据 你 的 接口 去 生成 sql 很酷 炫 吧 常用 注解 entity 这是 一张 表 tablename 自定义 的 表 名 自定义 设置 这个 实体类 在 数据库 所 对应 的 表 名 id 把 这个 类 里面 所在 的 变量 设置 为 主键 设置 主键 的 生成 策略 这种 方式 依赖于 具体 的 数据库 如果 数据库 不支持 自 增 主键 那么 这个 类型 是 没法用 的 basic 表示 一个 简单 的 属性 到 数据库 表 的 字段 的 映射 对于 没有 任何 标注 的 getxxxx 方法 默认 即为 basicfetch 表示 该 属性 的 读取 策略 有 eager 和 lazy 两种 分别 表示 主 支 抓取 和 延迟 加载 默 认为 eagercolumnname 自定义 字段名 length 自定义 长度 nullable 是否 可以 空 unique 是否 唯一 自定义 该 字段 的 类型 和 长度 表示 对 这个 变量 所 对应 的 字段名 进行 一些 个性化 的 设置 例如 字段 的 名字 字段 的 长度 是否 为 空 和 是否 唯一 等等 设置 transient 表示 该 属性 并非 一个 到 数据库 表 的 字段 的 映射 orm 框架 将 忽略 该 属性 如果 一个 属性 并非 数据库 表 的 字段 映射 就 务必 将其 标示 为 transient 否则 orm 框架 默认 其 注解 为 basic 对于 昨天 实践 的 注解 已经 解析 完 了啦 那么 今天 为了 接着 对 jpa 表 之间 的 各种 关系 的 映射 继续 实践 我们 再 新建 几个 实体类 接下来 我们 分别 新 建了 entity 表 table nameemployee 表 名 泛 化 继承 关系 在 我们 jpa 如果 要 抽取 一个 父 类 就 必需 加上 非常 明 确定 的 告诉 jpa 这是 一个 用于 映射 的 父 类 自动 从 当前 上下 文中 获取 这个 对象 查询 query 的 使用 重要 基于 方法 名称 命名 规则 查询 findby 关键字 属性 名称 属性 名称 的 首字母 大写 查询 条件 首字母 大写 基于 query 注解 查询 关键字 方法 命名 sqlwhere 字句 collectionltgtc whereidin collectionltgtc whereidnotin name upper 第一种 根据 方法 命名 规则 自动 生成 findby 基于 一列 等值 查询 findby 列名 例如 findbyname stringname 根据 收 派 标准 名称 查询 stringname 基于 一列 模糊 查询 findby 列名 like 例如 findbynamelike stringname 基于 两 列 等值 查询 findby 列名 and 列名 例如 第二种 不 按 命名 规则 写 的 查询方法 可以 配置 query 绑定 jpql 语句 或者 sql 语句 query nativequery 为 false 配置 jpql 为 true 配置 stringname 第三种 不 按 命名 规则 写 的 查询方法 配置 query 没写 语句 实体类 namedquery 定义 不 常用 stringname namedqueries namedquery querymodifying 注解 完成 修改 删除 操作 重要 修改 query 测试 junit 单元测试 要 添加 事务 设置 事务 不回 滚 false 版权 声明 本文 为 csdn 博 主 匿名 攻城 狮 的 原创 文章 遵循 ccbysa 版权 协议 转载 请 附上 原文 出处 链接 及 本 声明 原文 链接 是 一个 orm 框架 性能 一般 sql 不 可控 不用 自己 写 sql 一般 的 都 处 理了 hibernate 是 整 orm 映射 规范 的 一种 实现 mybatismybatis 是 一款 优秀 的 持久 层 框架 它 支持 定制 化 动态 sql 存储 过程 以及 高级 映射 核心 对象 通过 xml 配置 拿到 多 对 多 查询 男性 用户 如果 输 入了 姓名 则 按照 姓名 模糊 查找 否则 如果 输 入了 年龄 则 按照 年龄 查找 否则 查找 姓 名为 鹏程 的 用户 param name stringnameparam age integerage 一旦 有条件 成立 的 when 后续 的 when 则 不会 执 行当 所有 的 when 都不 执 行时 才会 执行 鹏程 查询 所有 用户 如果 输 入了 姓名 按照 姓名 进行 模糊 查询 如果 输入 年龄 按照 年龄 进行 查询 如果 两者都 输入 两个 条件 都要 成立 param name stringnameparam age integerage 如果 多出 一个 and 会 自动 去除 如果 缺少 and 或者 多出 多个 and 则会 报错 close 原文 链接 嵌套 查询 和 嵌套 结果 嵌套 结果 发 一条 关联 sql 解决问题 映射 文件 mapper 结果 的 手动 封装 resultmaplt 多 对 一 操作 查询 员工 的 同时 查询 部门 一条 结果 map 的 值 type 返回 类型 嵌套 结果 一条 嵌套 结果 lt 多 对 一 操作 嵌套 查询 在 查询 出来 的 值 deptid 在 根据 deptid 这个 值 去 查询 另外 东西 n 条 缓 存在 mybatis 中一 级 缓存 默认 是 开启 的 并且 一直 无法 关闭 一级 原理 mybatis 的 一级 缓存 作用 域 在 session 中 默认 开启 且 无法 关闭 当 执行 相同 的 sql 时 mybatis 不 执行 sql 而是 从 缓存 命中 返回 mybatis 查询 时 先去 缓冲区 命中 如果 命中 直接 返回 没有 就 执行 sql 查 数据库 一级 缓存 sqlsession 级别 缓存 缓存 对象 存储周期 为 第一次 获 取到 sqlsession 被 销 毁掉 或是 sqlsession clearcache 一级 缓存 满足 条件 同一个 session 中 相同 的 sql 和 参数 二级缓存 二级缓存 级别 缓存 缓存 对象 存储周期 为 第一次 获 取到 被 销 毁掉 应用 停止 了 mybatis 的 二级缓存 的 作用 域 是 一个 mapper 的 namespace 同一个 namespace 中 查询 sql 可以 从 缓存 中 命中 面试题 mybatis 相较 于 jdbc 的 优点 jdbc 重复性 代码 比 较多 mybatis 没有 jdbc 贾 琏 欲 执事 jdbc 在 封装 数据 那块 比较 麻烦 比如 查询 一条 数据 返回值 需 要在 结果 集 里面 进行 封装 使用 mybatis 自动 会 封装 jdbc 没有 缓存 支持 mybatis 也是 有 缓存 支持 jdbc 写 sql 写到 代码 里面 sql 和 代码 融合 在一起 修改 起来 不是 很 方便 mybatis 统一 维护 sql 专门 有 mapperxml 文件 配置 mybatis 比较 灵活 支持 批量 操作 mybatis 事务 mybatis 提供 了 一个 事务 接口 transaction 以及 两个 实现 类 jdbctransaction 和 当 spring 与 mybatis 一起 使 用时 spring 提供 了 一个 实现 类 接口 提供 的 抽象 方法 有 获取 数据库 连接 getconnection 提交 事务 commit 回 滚 事务 rollback 和 关闭 连接 close 源码 如下 和 区 别传 进来 的 参数 会加 引号 当成 字符串 解析 能够 很大 程 度上 防止 sql 注入 传入 的 数据 直接 显示 生成 在 sql 中 注意 mybaties 排 序时 使用 orderby 动态 参数 时 需要 注意 使用 而 不用 符号 转义 转义 cdata 未 解析 字符 数据 的 sql 可以用 xml 和 注解 的 方式 blogselectblog intid leftjoin 和 只会 查出 相等 的 全部 查出来 所有 字段 springboot 简化 开发 使用 springboot 很 容易 创建 一个 独立 运行 运行 jar 内嵌 servlet 容器 准 生产 级别 的 基于 spring 框架 的 项目 使用 springboot 你 可以 不用 或者 只需要 很少 的 spring 配置 特点 独立 运行 的 spring 项目 springboot 可以 以 jar 包 的 形式 独立 运行 运行 一个 springboot 项目 只需 通过 javajarxxjar 来 运行 内嵌 的 servlet 容器 springboot 可选择 内嵌 tomcatjetty 无需 以 war 包 形式 部署 项目 提供 starter 简化 maven 的 配置 如 使用 时会 自动 加入 的 jar 自动 配置 会 根据 在 类 路径 中 的 jar 包 类 为 jar 包 里 的 类 自动 配置 bean 准 生产 级别 的 应用 监控 springboot 提供 了 基于 httpsshtelnet 对 运行时 的 项目 进行 监控 无 代码 生产 和 xml 配置 springx 中 通过 条件 注解 实现 原文 链接 启动 流程 分为 两步 启动 流程 分为 两步 详情 创建 实例 判断 是否 为 web 环境 设置 初始化 器 从 处 读取 配置文件 中 key 为 的 value 进行 实例 化 操作 设置 监听器 推断 应用 入口 类 执行 获取 启动 监听 根据 以及 参 数来 准备 环境 创建 上下文 创建 failureanalyzer 用于 触发 从 springfactories 加载 的 failureanalyzer 和 实例 spring 上下文 前置 处理 spring 上下文 刷新 spring 上下文 后置 处理 注解 包括 三个 注解 根据 应用 所 声明 的 依赖 来 对 spring 框架 进行 自动 配置 简单 概括 一下 就是 是 借助 import 的 帮助 将 所有 符合 自动 配置 条件 的 bean 定义 加 载到 ioc 容器 configuration 它 就是 javaconfig 形式 的 springioc 容器 的 配置 类 被 标注 的 类 等于在 spring 的 xml 配置文件 中 装配 所有 bean 事务 提供 了 一个 spring 的 上下文 环境 componentscan 组件 扫描 可 自动 发现 和 装配 bean 功能 其实 就是 自动 扫描 并 加载 符合 条件 的 组件 或者 bean 定义 最 终将 这些 bean 定义 加 载到 ioc 容器 中 可以 通过 basepackages 等 属性 来 细粒度 的 定制 componentscan 自动 扫描 的 范围 如果 不 指 定则 默认 spring 框架 实现 会 从 声明 componentscan 所在 类 的 package 进行 扫描 默认 扫描 的 run 方法 里 的 booterclass 所在 的 包 路径 下 文件 所以 最好 将该 启动 类 放到 根 包 路径 下 自动 装配 这里 我们 可以 看到 使用 import 添 加了 一个 类 spring 自动 注入 配置 的 核心 功能 就 依赖于 这个 对象 在 这个 类 中 提供 了 一个 方法 用来 加载 配置文件 借助 spring 提供 的 工具 类 springfactories 的 方法 加载 配置文件 扫描 的 默认 路径 位于 中 配置文件 种 先 加载 bootstrap 是 应用程序 的 父 上下文 系统 级别 配置 后 加载 配置 文件名 是 固定 的 或 像 键值 对 那样 kv 结构 applicationyml 使用 缩进 表示 层级 关系 缩进 时 不允许 使用 tab 键 只允许 使用 空格 缩进 的 空格 的 数目 不重要 只要 相同 层级 的 元素 左 对齐 即可 大小写 敏感 bootstrap 配置文件 有 以下 几个 应用 场景 使用 配置 中心 时 这时 需 要在 bootstrap 配置文件 中 添加 连 接到 配置 中心 的 配置 属性 来 加载 外部 配置 中心 的 配置 信息 一些 固定 的 不能 被 覆盖 的 属性 一些 加密 解密 的 场景 springcloud 五大 组件 注册 中心 eureka 服务 的 注册 和 管理 服务 负载 均衡 ribbonfeign 接口 调用 组件 断路器 hystrix 豪猪 解决 雪崩 路由 网关 zuul 为 后台 服务 提供 统一 访问 的 接口 配置 中心 config 对 多个 服务 里面 的 配置文件 进行 统一管理 eureka 各个 服务 启动时 eurekaclient 都 会将 服务 注册 到 eurekaserver 并且 eurekaclient 还 可以 反过来 从 eurekaserver 拉 取 注册表 从而 知道 其他 服务 在 哪里 eurekaclient 负责 将 这个 服务 的 信息 注册 到 eurekaserver 中 eurekaserver 注册 中心 里面 有 一个 注册表 保存 了 各个 服务 所在 的 机器 和 端口号 ribbon 服务 间 发起 请求 的 时候 基于 ribbon 做 负载 均衡 从一 个 服务 的 多台 机器 中 选择 一台 feign 请求 调用 基于 feign 的 动态 代理 机制 根据 注解 和 选择 的 机器 拼接 请求 url 地址 发起 请求 底层 是 ribbonhystrix 发起 请 求是 通过 hystrix 的 线程 池 来 走 的 不同 的 服务 走 不同 的 线程 池 实现 了 不同 服务 调用 的 隔离 避免了 服务 雪崩 的 问题 zuul 如果 前端 移动 端 要 调用 后端 系统 统一 从 zuul 网关 进入 由 zuul 网关 转发 请求 给 对应 的 服务 原文 链接 服务 熔断 服务 熔断 的 作用 类似于 我们 家用 的 保险丝 当 某 服务 出现 不可用 或 响应 超时 的 情况 时 为了 防止 整个 系统 出现 雪崩 暂时 停止 对 该 服务 的 调用 服务 出现 不可 调 用时 暂时 停止 对 该 服务 的 调用 比如说 评论 服务 当前 不可用 其他 模块 业务 不影响 服务 降级 服务 间 调用 时有 服务 挂了 而 直接 返回 一个 提前 准备好 的 fallback 托 底 错误处理 信息 服务 降级 是 从 整个 系统 的 负荷 情况 出发 和 考虑 的 对 某些 负荷 会比 较高 的 情况 为了 预防 某些 功能 业务 场景 出现 负荷 过载 或者 响应 慢 的 情况 在其 内部 暂时 舍弃 对 一些 非 核心 的 接口 和 数据 的 请求 而 直接 返回 一个 提前 准备好 的 fallback 退路 错误处理 信息 这样 虽然 提供 的 是 一个 有损 的 服务 但却 保证 了 整个 系统 的 稳定性 和 可用性 熔断 vs 降级 相同点 目标 一致 都是 从 可用性 和 可靠性 出发 为了 防止 系统 崩溃 用户 体验 类似 最终 都让 用户 体验到 的 是 某些 功能 暂时 不可用 不同点 触发 原因 不同 服务 熔断 一般 是 某个 服务 下游 服务 故障 引起 而 服务 降级 一般 是 从 整体 负荷 考虑 原文 链接 每 一层 用到 的 注解 使用 redis 有 什么 缺点 缓存 和 数据库 双 写 一致 性问题 缓存 雪崩 问题 缓存 击穿 问题 缓存 的 并发 竞争 问题 单线程 的 redis 为什么 这么 快 你 知道 redis 是 单线程 工作 模型 吗 纯 内存 操作 单线程 操作 避免了 频繁 的 上下文切换 采 用了 非 阻塞 io 多路复用 机制 redis 的 数据类型 及 使用 场景 这种 类型 你 用 到过 几个 string 一般 做 一些 复杂 的 计数 功能 的 缓存 hash 单点 登录 list 做 简单 的 消息 队列 的 功能 set 做 全局 去 重 的 功能 sortedset 做 排行榜 应用 取 topn 操作 延时 任务 做 范围 查找 redis 过期 策略 和 内存 淘汰 机制 正解 redis 采用 的 是 定期 删除 惰性 删除 策略 为什么 不用 定时 删除 策略 定期 删除 惰性 删除 是 如何 工作 的 呢 采用 定期 删除 惰性 删除 就 没 其他 问 题了 么 redis 和 数据库 双 写 一致 性问题 最终 一致性 和 强 一致性 如果 对数 据有 强 一致 性要求 不能 放 缓存 如何 应对 缓存 穿透 和 缓存 雪崩 问题 缓存 穿透 即 黑客 故意 去 请求 缓存 中 不存在 的 数据 导致 所有 的 请求 都 怼 到 数据库 上 从而 数据库 连接 异常 缓存 雪崩 即 缓存 同一时间 大面积 的 失效 这个 时候 又 来了 一波 请求 结果 请求 都 怼 到 数据库 上 从而 导致 数据库 连接 异常 中小型 的 公司 一般 遇不到 这些 问题 但是 大 并发 的 项目 流量 有 几百万 左右 这两个 问题 一 定要 深刻 考虑 如何 解决 redis 并发 竞争 key 问题 这个 问题 大致 就是 同时 有 多个 子系统 去 set 一个 key 不太 推荐 使用 redis 的 事务 机制 如果 对 这个 key 操作 不 要求 顺序 这种 情况下 准备 一个 分布式 锁 大家 去 抢 锁 抢到 锁 就做 set 操作 即可 如果 对 这个 key 操作 要求 顺序 假设有 一个 key 系统 a 需 要将 key 设置 为 valuea 系统 b 需 要将 key 设置 为 valueb 系统 c 需 要将 key 设置 为 valuec 期望 按照 key 的 value 值 按照 的 顺序 变化 这种 时候 我们 在 数据 写入 数据库 的 时候 需要 保存 一个时间 戳 假设 时间 戳 如下 系统 akeyvaluea 系统 bkeyvalueb 系统 ckeyvaluec 那么 假设 这会 系统 b 先 抢到 锁 将 key 设置 为 valueb 接下来 系统 a 抢到 锁 发现 自己 的 valuea 的 时间 戳 早于 缓存 中 的 时间 戳 那就 不做 set 操 作了 以此类推 其他 方法 比如 利用 队列 将 set 方法 变成 串行 访问 也 可以 总之 灵活 变通 默认 端口 kvalue 非 关系 性 数据库 数据结构 string 字符串 一个 string 类型 的 value 最大 可以 存储 m 一般 做 一些 复杂 的 计数 功能 的 缓存 hash 散 列 单点 登录 list 列表 做 简单 的 消息 队列 的 功能 set 集 合做 全局 去 重 的 功能 sortedset 有序 集 合做 排行榜 应用 取 topn 操作 延时 任务 做 范围 查找 这种 类型 你 用 到过 几个 存储 setkeyxxx 取值 getkey 集群 主从 和 哨兵 的 集合体 为了 解决 单机 redis 容量 有限 的 问题 将 redis 的 数据 根据 一定 的 规则 分 配到 多台 机器 使用 集群 只需 要将 redis 配置文件 中 的 clusterenable 配置 打开 即可 每个 集群 中 至少 需要 三个 主 数据库 才能 正常 运行 新增 节点 非常 方便 多个 redis 节点 网络 互联 数据 共享 所有 的 节点 都是 一 主 一 从 也 可 以是 一 主 多 从 其中 从不 提供 服务 仅 作为 备用 客户端 可以 连接 任何 一个 主 节点 进行 读写 不支持 同时 处理 多个 key 如 msetmget 因为 redis 需 要把 key 均匀分布 在 各个 节点 上 并发 量 很高 的 情况下 同时 创建 keyvalue 会 降低 性能 并 导致 不可 预测 的 行为 支持 在线 增加 删除 节点 主从复制 主 数据库 master 和 从 数据库 slave 特 点主 可以 读写 从 只读 主 挂了 之后 不会有 从 升 为主 一个 主 可以 有 多个 从 从 唯一 对应 一个 主 主 挂了 就不 提供 写 服务 服务 就 真的 挂了 哨兵 是 监控 redis 集群 的 运行状况 特点是 建立在 主从 模式 的 基础上 如果 只有 一个 redis 节点 哨兵 就 没 意义 了 主 挂了 会有 选举 机制 选择 一个 从 提升 为主 修改 配置文件 持久 化 在于 数据 备份 和 故障 恢复 redis 所有 的 数据 都 保存 在 内存 中 对 数据 的 更新 将 异步 地保 存在 磁 盘上 aof 记录 服务器 执行 的 所有 写 操作 命令 并在 服务器 启动时 通过 重新 执行 这些 命令 来 还原 数据 集 优点 aof 可以 更好 的 保护 数据 不 丢失 一般 aof 会 每隔 秒 通过 一个 后台 线程 执行 一次 fsync 操作 最多 丢失 秒钟 的 数据 aof 日志 文件 以 appendonly 模式 写入 所以 没有 任何 磁盘 寻址 的 开销 写入 性能 非常 高 而且 文件 不容易 破损 即使 文件 尾部 破损 也 很 容易 修复 缺点 对于 同一 份 数据 来说 aof 日志 文件 通常 比 rdb 数据 快照 文件 更 大做 数据 恢复 aof 比 rdb 差 aof 先把 命令 读出来 在 执行 rdb 直接 导 进去 数据 rdb 快照 可以 将 存在于 某一 时刻 的 所有 数据 都 写入 磁盘 优点 速度快 适合于 用做 备份 主从复制 也是 基于 rdb 持久 化 功能 实现 的 缺点 会有 数据 丢失 优点 rdb 可以 做 冷 备 生成 多个 文件 每个 文件 都 代表 了 某一个 时刻 的 完整 的 数据 快照 相对于 aof 持久 化 机制 来说 直接 基于 rdb 数据文件 来 重启 和 恢复 redis 的 数据 会 更加 快速 当 进行 rdb 持久 化时 对 redis 服务 处理 读写 请求 的 影响 非常 小 可以 让 redis 保持 高性能 因为 redis 主 进程 只需要 fork 一 个子 进程 让 子 进程 执行 磁盘 io 操作 来 进行 rdb 持久 化 即可 生成 一次 rdb 文件 的 过程 就是 把 当前 时刻 内存 中 的 数据 一次性 写入 文件 中 而 aof 则 需要 先把 当前 内存 中 的 小量 数据 转 换为 操作 指令 然后 把 指令 写到 内存 缓存 中 然后再 刷 写入 磁盘 缺点 一般 不 要让 生成 rdb 文件 的 间隔 太长 否则 每次 生成 的 rdb 文件 太大 了 对 redis 本身 的 性能 会有 影响 rdb 文件 的 文件名称 默认 生成 rdb 文件 的 策略 默 认为 以 下种 意思 是 每隔 s min 如果有 超过 个 key 发 生了 变化 就 写 一份 新 的 rdb 文件 每隔 s min 如果有 超过 个 key 发 生了 变化 就 写 一份 新 的 rdb 文件 每隔 s min 如果有 超过 个 key 发 生了 变化 就 写 一份 新 的 rdb 文件 配置 多种 策略 可以 同时 生效 无论 满足 哪一种 条件 都 会写 一份 新 的 rdb 文件 savesavesave 是否 开启 rdb 文件 压缩 该 功能 可以 节约 磁盘空间 默 认为 在 写入 文件 和 读取 文件 时 是否 开启 rdb 文件 检查 检查 是否 有无 损坏 如果在 启动时 检查 发现 文件 损坏 则 停止 启动 默认 是否 开启 aof 机制 默 认为 文件 的 名称 默 认为 的 策略 默 认为 每秒 fsync 一次 noredis 不 主动 fsync 完全 交由 操作系统 决定 always 条 指令 fsync 一次 缓存 雪崩 穿透 击穿 缓存 穿透 访问 一个 不存在 的 key 缓存 不起作用 请求 会 穿透 到 db 流 量大 时 db 会 挂掉 解决方案 采 用布 隆 过滤器 使用 一个 足 够大 的 bitmap 用于 存储 可能 访问 的 key 不存在 的 key 直接 被 过滤 访问 key 未在 db 查询 到 值 也 将 空 值 写进 缓存 但可以 设置 较短 过期 时间 缓存 击穿 一个 存在 的 key 在 缓存 过期 的 一刻 同时 有 大量 的 请求 这些 请求 都会 击 穿到 db 造成 瞬时 db 请求 量大 压力 骤增 解决方案 在 访问 key 之前 采用 来 设置 另一个 短期 key 来 锁住 当前 key 的 访问 访问 结束 再 删除 该 短期 key 缓存 雪崩 大量 的 key 设置 了 相同 的 过期 时间 导致 在 缓 存在 同一 时刻 全部 失效 造成 瞬时 db 请求 量大 压力 骤增 引起 雪崩 解决方案 可以 给 缓存 设置 过期 时间 时 加上 一个 随机 值 时间 使得 每个 key 的 过期 时间 分布 开来 不会 集中 在 同一 时刻 失效 原文 链接 基本概念 elasti icsearchrdbms 索引 index 数据库 database 类型 type 表 table 文档 document 行 row 字段 field 列 column 映射 mapping 表 结构 schema 全文索引 索引 查询 索引 索引 index 是 elasticsearch 存放 具体 数据 的 地方 是 一类 具有 相似 特征 的 文档 的 集合 elasticsearch 中 索引 的 概念 具有 不同 意思 这里 的 索引 相当于 关系 数据库 中 的 一个 数据库 实例 在 elasticsearch 中 索引 还可 以 作为 动词 表示 对 数据 进行 索引 操作 类型 在 之前 的 版本 一个 elasticsearch 索引 中 可以 有 多个 类型 从 版本 开始 一个 elasticsearch 索引 中 只有 个 类型 一个 类型 是 索引 的 一个 逻辑 上 的 分类 通常 具有 一组 相同 字段 的 文档 组成 elasticsearch 的 类型 概念 相当于 关系 数据库 的 数据表 文档 文档 是 elasticsearch 可被 索引 的 基础 逻辑 单元 相当于 关系 数据库 中 数据表 的 一行 数据 elasticsearch 的 文档 具有 json 格式 由 多个 字段 组成 字段 相当于 关系 数据库 中 列 的 概念 链接 为 什么用 查询 东西 太多 效率高 通过 分词器 将 关键字 进行 拆分 提高 查询 效率 把 需要 查询 的 字段 添加到 es 索引 库 我们 在里面 搜索 然后 es 给 我们 返回 上线 es 创建 索引 从 es 查 成功 之后 更改 数据库 状态 简写 elasticsearch 是 一个 开源 的 高 扩展 的 分布式 全文 检索 引擎 它可 以 近乎 实时 的 存储 检索 数据 本身 扩展性 很好 可以 扩展到 上百 台 服务器 处理 pb 级别 的 数据 elasticsearch 也 使用 java 开发 并 使用 lucene 作为 其 核心 来 实现 所有 索引 和 搜索 的 功能 但是 它 的 目的 是 通过 简单 的 restfulapi 来 隐藏 lucene 的 复杂性 从而 让 全文 搜索 变得 简单 es 特点 和 优势 分布式 实时 文件 存储 可将 每一个 字段 存入 索引 使其 可以 被 检索 到 实时 分析 的 分布式 搜索引擎 分布式 索引 分 拆成 多个 分片 每个 分片 可有 零个 或 多个 副本 集群 中 的 每个 数据 节点 都可 承载 一个 或 多个 分片 并且 协 调和 处理 各种 操作 负载 再 平衡 和 路由 在 大多数 情况下 自动 完成 可以 扩展到 上百 台 服务器 处理 pb 级别 的 结构化 或 非 结构化 数据 也 可以 运 行在 单 台 pc 上 已 测试 支持 插件 机制 分词 插件 同步 插件 hadoop 插件 可视化 插件 等 倒排 索引 倒排 索引 invertedindex 也 叫 反向 索引 有 反向 索引 必有 正向 索引 通俗 地 来讲 正向 索引 是 通过 key 找 value 反向 索引 则是 通过 value 找 key 把 需要 查询 的 数据 分词 拆分 添加 索引 kv 结构 索引 数据 fastdfsfastdfs 是以 c 语言 开发 的 一项 开源 轻量级 分布式 文件 系统 他 对 文件 进行 管理 主要功能 有 文件 存储 文件 同步 文件 访问 文件 上传下载 特别 适合 以 文件 为 载体 的 在线 服务 如图 片 网站 视频 网站 等 分布式 文件 系统 基于 客户端 服务器 的 文件 存储系统 对等 特性 允许 一些 系统 扮演 客户端 和 服务器 的 双重 角色 可供 多个 用户 访问 的 服务器 比如 用户 可以 发表 一个 允许 其他 客户机 访问 的 目录 一旦 被 访问 这个 目录 对 客户机 来说 就像 使用 本地 驱动器 一样 fastdfs 由 跟踪 服务器 trackerserver 存储 服务器 storageserver 和 客户端 client 构成 trackerserver 追踪 服务器 追踪 服务器 负责 接收 客户端 的 请求 选择 合适 的 组合 与 storageserver 之间 也 会用 心跳 机制 来 检测 对方 是否 活着 tracker 需要 管理 的 信息 也 都 放在 内存 中 并且 里面 所有 的 tracker 都是 对等 的 每个 节点 地位 相等 很 容易 扩展 客户端 访问 集群 的 时候 会 随机 分配 一个 tracker 来 和 客户端 交互 storageserver 储存 服务器 实际 存储 数据 分成 若干个 组 group 实际 traker 就是 管理 的 storage 中 的 组 而 组 内 机器 中 则 存储 数据 group 可以 隔离 不同 应用 的 数据 不同 的 应用 的 数据 放在 不同 group 里面 优点 海量 的 存储 主从 型 分布式 存储 存储空间 方便 拓展 fastdfs 对 文件 内容 做 hash 处理 避免 出现 重复 文件 然后 fastdfs 结合 nginx 集成 提供 网站 效率 客户端 client 主 要是 上传下载 数据 的 服务器 也 就是 我们 自己 的 项目 所 部署 在 的 服务器 每个 客户端 服务器 都 需要 安装 nginx 链接 保证 消息 不 丢失 开启 事务 不 推荐 开启 confirm 推荐 可以 开启 confirm 模式 在 生产者 那里 设置 开启 了 confirm 模式 之后 每次 写 的 消息 都会 分配 一个 唯一 的 id 然后 如何写 入了 rabbitmq 之中 rabbitmq 会给 你 回 传 一个 ack 消息 告诉 你 这个 消息 发送 ok 了 如果 rabbitmq 没能 处理 这个 消息 会 回 调 你 一个 nack 接口 告诉 你 这个 消息 失败 了 你 可以 进行 重试 而且 你 可以 结合 这个 机制 知道 自己 在 内存 里 维护 每个 消息 的 id 如果 超过 一定 时间 还没 接 收到 这个 消息 的 回 调 那么 你 可以 进行 重发 开启 rabbitmq 的 持久 化 交换机 队列 消息 关闭 rabbitmq 的 自动 ack 改成 手动 保证 消息 不 重复 消费 幂 等 性 每个 消息 用 一个 唯一 标识 来 区分 消费 前先 判断 此 标识 有没有 被 消费 过 若 已 消费 过 则 直接 ackrabbitmq 如何 保证 消息 的 顺序 性 将 消息 放入 同一个 交换机 交给 同一个 队列 这个 队列 只有 一个 消费者 这个 消费者 只允许 同时 开启 一个 线程 rabbitmq 保证 消息 不 丢失 的 具体 方案 前提 开启 confirm 开启 rabbitmq 的 持久 化 交换机 队列 消息 关闭 rabbitmq 的 自动 ack 改成 手动 配置 消费 重试 次数 消费 重试 间隔时间 等 保证 投放 消息 不 丢失 先将 消息 放入 生产者 redis 此时 消息 的 状态 为 未 投放 再放 入 队列 根据 和 confirmcallback 的 结果 来 确定 消息 是否 投递 成功 投递 成功 的 修改 生产者 redis 中 此 消息 的 投递 状态 为 已 投递 投递 失败 的 将会 放入 失败 的 redis 并从 生产者 redis 中 删除 由 定时 任务 定期 扫描 并 重新 投递 需要 一个 专门 的 定时 任务 扫描 生产者 redis 中 存 放了 一定 时间 但是 状态 还是 未 投放 的 消息 此 消息 会被 认为 已经 投递 但是 没有 任何 反馈 结果 由于 不可知 因素 导致 没有 returncallback 也没有 confirmcallback 此类 消息 被 扫 描到 后会 放入 失败 的 redis 并从 生产者 redis 中 删除 由 定时 任务 定期 扫描 并 重新 投递 还需要 一个 专门 的 定时 任务 扫描 生产者 redis 中 存 放了 很久 仍然 未 消费 的 数据 状态 为 已 投递 此类 消息 被 扫 描到 后会 放入 失败 的 redis 并从 生产者 redis 中 删除 由 定时 任务 定期 扫描 并 重新 投递 扫描 失败 的 redis 的 定时 任务 都 遵循 一条 原则 一条 消息 最多 被 重新 投递 三次 若 投 递了 三次 仍然 失败 则 记录 日志 记 录到 数据库 不会 再 投递 需要 人工干预 处理 保证 消费 消息 不 丢失 消费者 取到 消息 后 从 消息 中 取出 唯一 标识 先 判断 此 消息 有没有 被 消费 过 若 已 消费 过 则 直接 ack 避免 重复 消费 正常 处理 成功 后 将 生产者 redis 中 的 此 消息 删除 并 ack 告诉 server 端 此 消息 已 成功 消费 遇到 异常 时 捕获 异常 验证 自己 在 消息 中 设定 的 重试 次数 是否 超过 阀值 若 超过 则 放入 死信 队列 若 未 超过 则 向 将 消息 中 的 重试 次数 加 抛出 自定义 异常 进入 重试 机制 有 专门 的 消费者 用于 处理 死信 队列 中 消费 多次 仍未 消费 成功 的 数据 可以 记录 日志 入库 人工干预 处理 集群 部署 方案 rabbitmq 有 两种 集群 部署 方案 普通 模式 rabbit 和 rabbit 两个 节点 仅有 相同 的 元 数据 即 队列 的 结构 消息 实体 只 存在于 其中 一个 节点 rabbit 或者 rabbit 当 消息 进入 rabbit 节点 的 queue 后 consumer 从 rabbit 节点 消 费时 rabbitmq 会 临时 在 rabbitrabbit 间 进行 消息 传输 把 a 中 的 消息 实体 取出 并 经过 b 发送给 consumer 镜像 模式 把 需要 的 队列 做成 镜像 队列 存在 与 多个 节点 消息 实 体会 主动 在 镜像 节点 间 同步 属于 rabbitmq 的 ha 方案 副作用 也 很明显 除了 降低 系统 性能 外 如果 镜像 队列 数量 过多 加之 大量 的 消息 进入 集群 内部 的 网络带宽 将会 被 这种 同步 通讯 大大 消耗掉 基本概念 mq 全 称为 messagequeue 即 消息 队列 它 也是 一个 队列 遵循 fifo 原则 rabbitmq 是 由 erlang 语言 开发 基于 高级 消息 队列 协议 协议 实现 的 消息 队列 它是 一种 应用程序 之间 的 通信 方法 消息 队列 在 分布式 系统开发 中 应用 非常 广泛 rabbitmq 使用 场景 消 峰 amp 限流 应用 解 耦 异步 处理 数据 分发 消息 通讯 分布式 事务 排序 保证 amp 先进先出 场景 原理图 外 链 图片 转存 失败 源 站 可能有 防盗链 机制 建议 将 图片 保存 下来 直接 上传 imgxlpfrva imagesimagepng 外 链 图片 转存 失败 源 站 可能有 防盗链 机制 建议 将 图片 保存 下来 直接 上传 imgwelezpp imagespng 常见 的 消息 队列 分类 fanout 广播 将 消息 交给 所有 绑定 到 交换机 的 队列 alldirect 定向 把 消息 交给 符合 指定 routingkey 的 队列 一堆 或 一个 topic 通配符 把 消息 交给 符合 routingpattern 路由 模式 的 队列 一堆 或者 一个 如何 避免 消息 丢失 手动 签收 消费者 的 ack 机制 可以 防止 消费者 丢失 消息 持久 化 持久 化 可以 防止 消费者 丢失 消息 常用 的 设计 模式 创建 型 模式 共 五种 工厂 模式 抽象 工厂 模式 单 例 模式 建造 者 模式 原型 模式 结构 型 模式 共 七种 适配器 模式 装饰 器 模式 代理 模式 外观 模式 桥 接 模式 组合 模式 享 元 模式 行为 型 模式 共 十 一种 策略 模式 模板 方法 模式 观察者 模式 迭代 子模式 责任 链 模式 命令 模式 备忘录 模式 状态 模式 访问者 模式 中介 者 模式 解释 器 模式 工厂 模式 工厂 模式 适用于 生产 大量 相似 对象 抽象 工厂 模式 生产 家族 全套 的 各类 对象 静态 工厂 模式 将 多 方法 工厂 模式 里 的 方法 置 为 静态 的 不需要 创建 实例 直接 调用 即可 较为 常用 多 方法 工厂 static 静态 stringargs 不需要 创建 实例 直接 调用 即可 sendersend 抽象 模式 抽象 工厂 模式 abstractfactory 增加 多个 工厂 类 单利 模式 由于 某种 需要 要 保证 一个 类 在 程序 的 生命周期 当中 只有 一个 实例 并且 提供 该 实例 的 全局 访问 方法 单 例 模式 在 程序设计 中 非常 的 常见 一般来说 某些 类 我们 希望 在 程序 运行 期间 有 且 只有 一个 实例 原因 可能是 该类 的 创建 需要 消耗 系统 过多 的 资源 花费 很多 的 时间 要 保证 一个 类 在 程序 的 生命周期 当中 只有 一个 实例 并且 提供 该 实例 的 全局 访问 方法 写出 至少 两种 不同 方式 的 单 例 模式 的 类 并 说说 他们 的 区别 单利 模式 的 意义 懒汉 模式 具有 线程 安全问题 饿汉 模式 stringargs 懒汉 式 顾名思义 懒汉 式 就是 应用 刚 启动 的 时候 并不 创建 实例 当 外部 调用 该类 的 实例 或者 该类 实例 方法 的 时候 才 创建 该类 的 实例 是以 时间 换 空间 懒汉 式 的 优点 实例 在被 使用 的 时候 才 被 创建 可以 节省 系统资源 体现 了 延迟 加载 的 思想 延迟 加载 通俗 上将 就是 一开始 的 时候 不 加载 资源 一直 等到 马上 就要 使用 这个 资源 的 时候 躲 不过 去了 才 加载 这样 可以 尽可能 的 节省 系统资源 懒汉 式 的 缺点 由于 系统 刚 启动时 且 未被 外部 调 用时 实例 没有 创建 如果 一时间 有 多个 线程 同时 调用 方法 很有 可能会 产生 多个 实例 也就是说 下面 的 懒汉 式 在 多线程 下 是 不能 保持 单 例 实例 的 唯一性 的 要想 保证 多线程 下 的 单 例 实例 的 唯一性 得用 同步 同步 会 导致 多线程 下 由于 争夺 锁 资源 运行 效率 不高 classlazymode 私有化 构造 方法 privatelazymode 准备 一个 私有化 字段 提供 一个 共有 的 可 访问 的 方法 返回 该类 对象 if instancenull returninstance 饥 汉 式 顾名思义 懒汉 式 就是 应用 刚 启动 的 时候 不管 外部 有没有 调用 该类 的 实例 方法 该类 的 实例 就 已经 创建 好了 以 空间 换 时间 饥 汉 式 的 优点 写法 简 单在 多线程 下 也 能 保证 单 例 实例 的 唯一性 不用 同步 运行 效率高 饥 汉 式 的 缺点 在 外部 没有 使 用到 该类 的 时候 该类 的 实例 就 创 建了 若 该类 实例 的 创建 比较 消耗 系统资源 并且 外部 一直 没有 调用 该 实例 那么 这 部分 的 系统资源 的 消耗 是 没有意义 的 饿汉 模式 classhungry 私有化 构造 方法 privatehungry 准备 一个 私有化 字段 提供 一个 方法 返回 该类 对象 returninstance 适配器 模式 定义 作为 两个 不 兼容 的 接口 之间 的 桥梁 将 一个 类 的 接口 adaptee 通过 适配器 adapter 转换成 客户 期望 的 另一个 目标 接口 target 代理 模式 引用 静态 代理 静态 代理 的 代理 对象 和 被 代理 对象 在 代理 之前 就 已经 确定 它们 都 实现 相同 的 接口 或 继承 相同 的 抽象类 聚合 优于 继承 可以 适应 代理 执行 顺序 变换 的 场景 动态 代理 jdk 动态 代理 接口 cglib 动态 代理 不要 接口 aop 底层 实现 就是 动态 代理 jdk 动态 代理 jdk 动态 代理 是 利用 反射 机制 生成 一个 实现 代理 接口 的 匿名 类 在 调用 业务 方法 前 调用 处理 代理 类 必须 实现 接口 并且 jdk 动态 代理 只能 代理 实现 了 接口 的 类 没有 实现 接口 的 类 是 不能实现 jdk 动态 代理 结合 下面 代码 来看 就 比较 清晰 了 使用 jdk 动态 代理 类 基本 步骤 编写 需 要被 代理 的 类 和 接口 我 这里 就是 编写 代理 类 例如 我 这里 的 dynamiclogproxy 需要 实现 接口 重写 invoke 方法 使用 动态 创建 代理 类 对象 通过 代理 类 对象 调用 业务 方法 cglib 动态 代理 cglib 是 针对 类 来 实现 代理 的 它 会对 目标 类 产生 一个 代理 子类 通过 方法 拦截 技术 对 过滤 父 类 的 方法 调用 代理 子类 需要 实现 接口 另外 如果 你 是 基于 spring 配置文件 形式 开发 那你 需要 显示 声明 如果 你 是 基于 springboot 开发 则 一般 在 启动 类 头部 显示 的 添加 注解 装饰 者 模式 装饰 器 decorator 装饰 组件 component 通过 装饰 在 原有 对象 的 基础 上得 到了 一个 新 的 具有 更多 属性 和 行为 的 对象 动态地 将 行为 附 加到 对象 上 提供 了 比 继承 更具 有 弹性 的 替代 方案 在 装饰 者 模式 中 存在 两个 角色 组件 component 和 装饰 器 decorator 并且 两者 要 实现 相同 的 接口 或 抽象类 实现 接口 或 继承 抽象类 都行 这样 就可以 使用 装饰 器 来 装饰 组件 了 现实生活 中有 很多 这样 的 例子 比如 购买 手 机时 一个 裸机 就算是 一个 组件 如果 想要 装饰 下 手机 加个 手机套 贴个 膜 送 支 手写笔 等 这些 就是 装饰 器 原文 链接 三个 装饰 器 新 属性 行为 可以 分别 装饰 安 卓 手机 和 苹果 手机 手机 descriptionios 手机 装饰 者 基 类 手 机壳 装饰 phonesp 加了 个 保护套 手机 膜 装饰 phonesp 贴了 个 膜 手写笔 装饰 publicphonepen phonesp 送了 支 手写笔 stringargs phone coverphone membranephone 输出 观察者 模式 引用 观察者 模式 观察 监听 模式 发布 订阅 模式 行为 型 模式 主要 关注 对象 间 的 通讯 主要 关注 的 是 对象 的 一对 多 关系 也 就是 多个 对象 都 依赖 一个 对象 当 该 对象 的 状态 发生 改变 时 其他 对象 都能 收到 相应 的 通知 观察者 tom 和 jerry 用户 被 观察者 报社 dailynews 模拟 当 被 观察者 改变 状态 时 它 的 所有 观察者 都会 收到 通知 并 更新 取消 订阅 不再 接受 消息 报刊 订阅 实例 报社 dailynewstom 和 jerry 都 订阅 服务 每当 有 最新消息 到来 报社 就会 通知 他们 接着 tom 取 消了 这个 服务 则 报社 的 最新消息 不会 通知 tom 而 只 通知 jerry 在 这个 过程中 dailynews 报社 扮演 被 观察者 角色 tom 和 jerry 两个 用户 扮演 观察者 角色 用户 抽象 接口 实现 两个 用户 实体类 报社 观察 方法 接口 newspaper 注册 观察者 删除 观察者 通知 观察者 的 功能 报社 实体类 抽象 主题 subject 也 就是 抽象 被 观察者 接口 提供 增加 删除 和 通知 观察者 的 方法 抽象 观察者 observer 观察者 接口 提供 更新 的 方法 具体 主题 concretesubject 实现 抽象 主题 接口 因此 具有 增加 删除 通知 观察者 的 方法 具体 观察者 实现 抽象 观察者 接口 注册 具体 主题 后 就可以 接 收到 通知 更新 原文 链接 风格 rest 指的是 一组 架构 约束条件 和 原则 满足 这些 约束条件 和 原则 的 应用程序 或 设计 就是 restfulrestful 特点 包括 每一个 uri 代表 种 资源 客户端 使用 个 表示 操作 方式 的 动词 对 服务端 资源 进行 操作 get 用来 获取 资源 post 用来 新建 资源 也 可以 用于 更新 资源 put 用来 更新 资源 delete 用来 删除 资源 通过 操作 资源 的 表现形式 来 操作 资源 资源 的 表现形式 是 xml 或者 html 客户端 与 服务端 之间 的 交互 在 请求 之间 是 无 状态 的 从 客户端 到 服务端 的 每个 请求 都必须 包含 理解 请求 所 必需 的 信息 restful 架构 restful 架构 是 对 mvc 架构 改进 后 所 形成 的 一种 架构 通过 使用 事先 定义 好 的 接口 与 不同 的 服务 联系起来 在 restful 架构 中 浏览器 使用 postdeleteput 和 get 四种 请求 方式 分 别对 指定 的 url 资源 进行 增 删改 查 操作 因此 restful 是 通过 uri 实现 对 资源 的 管理 及 访问 具有 扩展性 强 结构 清晰 的 特点 restful 架构 将 服务器 分成 前端 服务器 和 后端 服务器 两部分 前端 服务器 为 用户 提供 无 模型 的 视图 后端 服务器 为 前端 服务器 提供 接口 浏览器 向 前端 服务器 请求 视图 通过 视 图中 包含 的 ajax 函数 发起 接口 请求 获取 模型 项目 开发 引入 restful 架构 利于 团队 并行 开 发在 restful 架构 中将 多数 http 请求 转移到 前端 服务器 上 降低 服务器 的 负荷 使 视图 获取 后端 模型 失败 也 能 呈现 但 restful 架构 却不 适用于 所有 的 项目 当 项目 比较 小时 无需 使用 restful 架构 项目 变得 更加 复杂 三次 握手 和 四次 挥手 第一次 握手 客户端 向 服务器 发出 连接 请求 报文 这个 是 三次 握 手中 的 开始 表示 客户端 想要 和 服务端 建立 连接 第二次 握手 tcp 服务器 收到 请求 报文 后 如果 同意 连接 则 发出 确认 报文 询问 客户端 是否 准备好 第三次 握手 tcp 客户 进程 收到 确认 后 还 要向 服务器 给出 确认 这里 客户端 表示 我 已经 准备好 第一次 挥手 tcp 发送 一个 fin 结束 用来 关闭 客户 到 服务端 的 连接 客户端 向 服务器 发 结束 消息 第二次 挥手 服务端 收到 这个 fin 他 发回 一个 ack 确认 服务器 收到 这个 消息 回 来个 确认 收到 第三次 挥手 服务端 发送 一个 fin 结束 到 客户端 服务端 关闭 客户端 的 连接 服务器 向 客户端 发生 结束 消息 第四次 挥手 客户端 发送 ack 确认 报文 确认 并将 确认 的 序号 这样 关闭 完成 客户端 收到 消息 tcp 和 udptcpudp 区别 首先 它们 都是 传输 层 的 协议 tcp 是 可靠 传输 协议 是 面向 连接 双向 连接 的 基于 流 的 传输 控制 协议 udp 是 不可靠 的 协议 是 无 连接 的 基于 数据包 的 用户数 据报 协议 tcp 传输 数据 都 需要 先 建立 连接 所以 传输 效率 比 较低 但是 安全 udp 虽然是 不可靠 传输 协议 但是 传输 数据 效率高 tcpip 如何 保证 可靠性 数据包 有 哪些 数据 组成 当 客户 和 服务器 彼此 交互 数据 前 必须 先在 双方 之间 建立 一个 tcp 连接 之后 才能 传输 数据 tcp 协议 使用 超时 重传 断点续传 数据 确认 等 方式 来 确保 数据 包被 正确地 发送至 目的 端 数据包 由 起 始行 消息 头 实体 内容 组成 又 分为 请求 数据包 和 响应 数据包 数据结构 数据结构 是 指 相互之间 存在着 一种 或 多种 关系 的 数据 元素 的 集合 和 该 集合 中 数据 元素 之间 的 关系 组成 常用 的 数据结构 有 数组 栈 链表 队列 树 图 堆 散 列表 等 如图所示 栈 栈 是 一种 特殊 的 线性表 仅能 在 线性表 的 一端 操作 栈 顶 允许 操作 栈 底 不允许 操作 栈 的 特点是 先进后出 或者 说是 后进先出 从 栈 顶 放入 元素 的 操作 叫 入 栈 取出 元素 叫出 栈 栈 的 结构 就像 一个 集装箱 越 先 放进去 的 东西 越 晚 才能 拿出来 放 碗 所以 栈 常 应用于 实现 递归 功能 方面 的 场景 例如 斐 波 那 契 数列 使用 场景 因为 队列 先进先出 的 特 点在 多线程 阻塞 队列 管理 中 非常 适用 队列 队列 与 栈 一样 也是 一种 线性表 不同 的 是 队列 可以 在 一端 添加 元素 在 另一端 取出 元素 也 就是 先进先出 从 一端 放入 元素 的 操作 称为 入队 取出 元素 为 出 队 ajax 异步 的 js 和 xml 作用 提高 用户 体验 效率高 较少 服务器 与 浏览器 之间 的 数据传输 实质 通过 浏览器 的 ajax 对象 发送 异步 请求 学习 ajax 其实是 学习 使用 浏览器 的 对象 对象 发 异步 请求 将 响应 的 数据 局部 更 新到 页面 同步 你 先 做完 我 再做 后 一步 的 操作 必须 要 等待 前 一步 操作 的 结果 异步 各做 各 的 相互 不 干扰 效率高 获取 ajax 对象 ajax 没有 标准化 需要 区分 浏览器 发 快递 发送 快递 的 单位 申 通 韵 达 顺 丰 ajax 准备 快递 地址 电话 open geturlid 发送 快递 send null 给 一个 回执单 接收 服务器 响应 的 数据 使用 ajax 发送 get 请求 使用 ajax 发送 post 请求 获取 ajax 对象 xhropen postajaxpost 准备 发送 请求 如果 要 提交 数据 才 设置 xhrsend usernamename 发送 请求 设置 回 调 函数 if alert xhrresponsetext 接收 服务器 响应 的 数据 ie 缓冲 问 题在 ie 浏览器 中 发送 get 请求 的 时候 如果 你 发送 的 请求 地址 是 一样 的话 它会 将 之前 你 访 问过 的 页面 直接 返回 给你 就不会 请求 服务器 了 解决 发送 post 欺骗 浏览器 事务 本地 分布式 事务 acid 原子 性 atomicity 原子 性 是 指 事务 是 一个 不可分割 的 工作单位 事务 中 的 操作 要么 都 发生 要么 都不 发生 一致性 consistency 针对 一个 事务 操作 前 与 操作 后 的 状态 一致 隔离 性 isolation 事务 的 隔离 性 是 多个 用户 并发 访问 数据库 时 数据库 为 每一个 用户 开启 的 事务 不能 被 其他 事务 的 操作 数据 所 干扰 多个 并发 事务 之间 要 相互 隔离 持久性 durability 表示 事务 结束 后 的 数据 不 随着 外界 原因 导致 数据 丢失 事务 结束 数据 保 存到 库 脏 读 指 一个 事务 读 取了 另外 一个 事务 未 提交 的 数据 幻 读 是 指在 一个 事务 内 读取 到了 别的 事务 插入 的 数据 导致 前后 读取 不一致 一般 是 行 影响 多了 一行 不可 重复 读在 一个 事务 内 读取 表 中 的 某一 行 数据 多次 读取 结果 不同 这个 不一 定是 错误 只是 某些 场合 不对 四种 隔离 级别 设置 数据库 设置 事务 隔离 级别 查询 当前 事务 隔离 级别 设置 描述 serializable 可 避免 脏 读 不可重复读 虚 读 情况 的 发生 串行化 repeatableread 可 避免 脏 读 不可重复读 情况 的 发生 可 重 复读 readcommitted 可 避免 脏 读 情况 发生 读 已 提交 readuncommitted 最低 级别 以上 情况 均 无法 保证 读 未 提交 原文 链接 适当 的 connection 方法 比如 setautocommit 或 设置 描述 指示 不可以 发生 脏 读 不可重复读 和 虚 读 的 常量 指示 不可以 发生 脏 读 和 不可重复读 的 常量 虚 读 可以 发生 指示 可以 发生 脏 读 dirtyread 不可重复读 和 虚 读 phantomread 的 常量 指示 不可以 发生 脏 读 的 常量 不可重复读 和 虚 读 可以 发生 事务 的 传播 机制 required 默认 支持 使用 当前 事务 如果 当前 事务 不存在 创建 一个 新 事务 支持 使用 当前 事务 如果 当前 事务 不存在 则不 使用 事务 中文翻译 为 强制 支持 使用 当前 事务 如果 当前 事务 不存在 则 抛出 创建 一个 新 事务 如果 当前 事务 存在 把 当前 事务 挂起 无 事务 执行 如果 当前 事务 存在 把 当前 事务 挂起 无 事务 执行 如果 当前 有 事务 则 抛出 嵌套 事务 如果 当前 事务 存在 那么 在 嵌套 的 事务 中 执行 如果 当前 事务 不存在 则 表现 跟 required 一样 原文 链接 注解 方式 transactional 只能 被 应用到 public 方法 上 对于 其它 它 非 public 的 方法 如果 标 记了 transactional 也 不会 报错 但 方法 没有 事务 功能 默认 情况 下一个 有 事务 方法 遇到 时会 回 滚 遇到 受 检查 的 异 常是 不会 回 滚 的 要想 所有 异常 都回 滚 要 加上 transactional 其它 异常 原文 链接 的 属性 name 是 必须 的 表示 与 事务 属性 关联 的 方 法名 业务 方 法名 对 切入点 进行 细化 通配符 可以 用来 指定 一批 关联 到 相同 的 事务 属性 的 方法 如 等等 propagation 不是 必须 的 默认值 是 required 表示 事务 传播 行为 包括 不是 必须 的 默认值 default 表示 事务 隔离 级别 数据库 的 隔离 级别 timeout 不是 必须 的 默认值 永不 超时 表示 事务 超时 的 时间 以 秒 为 单位 readonly 不是 必须 的 默认值 false 不是 只读 的 表示 事务 是否 只读 rollbackfor 不是 必须 的 表示 将被 触发 进行 回 滚 的 exception s 以 逗号 分开 如 不是 必须 的 表示 不被 触发 进行 回 滚 的 exception s 以 逗号 分开 如 任何 将 触发 事务 回 滚 但是 任何 将不 触发 事务 回 滚 其他 的 方法 之 只读 的 版权 声明 本文 为 csdn 博 主 sharehappylife 的 原创 文章 遵循 ccbysa 版权 协议 转载 请 附上 原文 出处 链接 及 本 声明 原文 链接 分布式 事务 事务 保持一致 可用性 对 数据 修改后 立马 响应 不能 延迟 io 同步 阻塞 nio 异步 阻塞 i 操作 主要 分成 两部分 数据 准备 将 数据 加 载到 内核 缓存 数据 加 载到 操作系统 将 内核 缓存 中 的 数据 加 载到 用户 缓存 从 操作系统 复制到 应用 中 同步 和 异步 的 概念 描述 的 是 用户 线程 与 内核 的 交互 方式 阻塞 和 非 阻塞 的 概念 描述 的 是 用户 线程 调用 内核 io 操作 的 方式 同步 阻塞 io 用户 线程 在 内核 进行 io 操作 时 被 阻塞 同步 非 阻塞 io 是 在 同步 阻塞 io 的 基础 上将 socket 设置 为 nio nonblock 拦截器 和 过滤器 拦截器 一个 拦截器 对象 可以 多次 调用 拦截 controller 请求 对 直接 访问 静态 请求 的 资源 不做 拦截 登录 验证 没有 登录 就 返回 登录 页面 过滤器 使用 过滤器 的 目的 是 用来 做 一些 过滤 操作 获取 我们 想要 获取 的 数据 比如 在过 滤器 中 修改 字符 编码 在过 滤器 中 修改 的 一些 参数 包括 过滤 低俗 文字 危险 字符 等过 滤器 和 拦截器 的 区别 拦截器 是 基于 java 的 反射 机制 的 过滤器 是 基于 函 数回 调 拦截器 不依赖 与 servlet 容器 过滤器 依赖 与 servlet 容器 拦截器 只 能对 action 请求 起作用 过滤器 则可 以对 几乎 所有 的 请求 起作用 拦截器 可以 访问 action 上下文 值 栈 里 的 对象 而过 滤器 不能 访问 在 action 的 生命周期 中 拦截器 可以 多次 被 调用 而过 滤器 只 能在 容器 初始 化时 被 调用 一次 拦截器 可以 获取 ioc 容器 中 的 各个 bean 而过 滤器 就 不行 这点 很重 要在 拦截器 里 注入 一个 service 可以 调用 业务 逻辑 抽象类 和 接口 抽象 当 父 类 的 某些 方法 不确定 时 可以用 abstract 关键字 来 修饰 该 方法 抽象 方法 用 abstract 来 修饰 该类 抽象类 抽象类 抽象类 含有 抽象 方法 的 类 叫做 抽象类 用 abstract 关键字 修饰 抽象类 不能 被 实例 化 但是 类 的 其它 功能 依然 存在 成员 变量 成员 方法 和 构造 方法 的 访问 方式 和 普通 类 一样 只有 被 继承 时 才 可以 被 使用 抽象 方法 抽象 方法 在 类 中 没有 方 法体 的 方法 就是 抽象 方法 用 abstract 关键字 修饰 抽象 方法 只需要 声明 不能 有方 法体 不需要 实现 某些 功能 但是 必须 被 重写 从 形态 上 看 抽象类 可以 给出 一些 成员 的 实现 接口 却不 包含 成员 的 实现 抽象类 的 抽象 成员 可被 子类 部分 实现 接口 的 成员 需要 实现 类 完全 实现 一个 类 只能 继承 一个 抽象类 但可 实现 多个 接口 等等 如何 区 分类 是 对 对象 的 抽象 抽象类 是 对 类 的 抽象 接口 是 对 行为 的 抽象 若 行为 跨越 不 同类 的 对象 可 使用 接口 对于 一些 相似 的 类 对象 用 继承 抽象类 抽象类 是 从 子类 中 发现了 公共 的 东西 泛 化出 父 类 然后 子类 继承 父 类 接口 是 根本 不知 子类 的 存在 方法 如何 实现 还不 确认 预先 定义 git 和 svn 一般 使用 分布式 版本 控制 svn 集中式 版本 控制 git 优点 适合 分布式 开发 强调 个体 公共 服务器 压力 不会 太大 速度快 灵活 能 离线 工作 添加 代码 能 addcommit 到 本地 仓库 有 网 在 推到 中央 仓库 svn 优点 代码 一致性 高 集中式 服务器 更 安全 权限 分配 适合 开发 人数 不多 的 项目 缺点 要 网 反射 和 nio 讲讲 你 理解 的 nio 和 bio 的 区 别是 啥 谈谈 reactor 模型 io bio 是 面向 流 的 nio 是 面向 缓冲区 的 bioblockio 同步 阻塞 式 io 就是 我们 平常 使用 的 传统 io 它 的 特点是 模式 简单 使用方便 并发 处理 能力 低 nionewio 同步 非 阻塞 io 是 传统 io 的 升级 客户端 和 服务器端 通过 channel 通道 通讯 实现 了 多路复用 是 nio 的 升级 也 叫 nio 实现 了 异步 非 堵塞 io 异步 io 的 操作 基于 事件 和 回 调 机制 原文 链接 同步 和 异步 同步 方法 执行 后 需要 等 待在 店铺 买手机 没 货 叫 等待 一 会去 仓库 拿 就是 调用 某个 东西 是 调用 方得 等待 这个 调用 返回 结果 才能 继续 往后 执行 异步 方法 执行 后 不需要 等待 可以 处理 其他 事情 在 网上 买手机 下单 后 就不 管了 快递 到了 再取 中间 可以 做 其他 事情 和 同步 相反 调用 方 不会 理解 得到 结果 而是 在 调用 发出 后 调用者 可用 继续 执行 后续 操作 被 调用者 通过 状 体 来 通知 调用者 或者 通过 回掉 函数 来 处理 这个 调用 同步 方法 调用 一旦 开始 调用者 必须 等到 方法 调用 返回 后 才能 继续 后续 的 行为 异步 方法 调用 更像 一个 消息 传递 一旦 开始 方法 调用 就会 立即 返回 调用者 就可以 继续 后续 的 操作 而 异步 方法 通常 会在 另外 一个 线程 中 真实地 执行 着 整个 过程 不会 阻碍 调用者 的 工作 阻塞 和 非 阻塞 强调 的 是 程序 在 等待 调用 结果 消息 返回值 时 的 状态 阻塞 调 用是 指 调用 结果 返回 之前 当前 线程 会被 挂起 调用 线程 只有 在 得到 结果 之后 才会 返回 非 阻塞 调用 指在 不能 立刻 得到 结果 之前 该调 用 不会 阻塞 当前 线程 对于 同步 调用 来说 很多 时候 当前 线程 还是 激活 的 状态 只是 从 逻辑 上 当前 函数 没有 返回 而已 即 同步 等待 时 什么 都 不干 白白 占 用着 资源 同步 和 异步 强调 的 是 消息 通信 机制 所谓 同步 就是在 发出 一个 调 用时 在 没有 得到 结果 之前 该 调用 就不 返回 但是 一旦 调用 返回 就 得到 返回 值了 换句话说 就是 由 调用者 主动 等待 这个 调用 的 结果 而 异步 则是 相反 调 用在 发出 之后 这个 调用 就 直接 返 回了 所以 没有 返回 结果 换句话说 当 一个 异步 过程 调用 发出 后 调用者 不会 立刻 得到 结果 而是 在 调用 发出 后 被 调用者 通过 状态 通知 来 通知 调用者 或 通过 回 调 函数 处理 这个 调用 参考 博客 深 拷贝 和 浅 拷贝 假设 b 复制 了 a 当 修改 a 时 看 b 是否 会 发生变化 如果 b 也 跟着 变了 说明 这是 浅 拷贝 拿人 手 短 如果 b 没变 那就是 深 拷贝 自食其力 外 链 图片 转存 失败 源 站 可能有 防盗链 机制 建议 将 图片 保存 下来 直接 上传 imgwcqonil imagesbmp 欢迎 使用 markdown 编辑器 你好 这是 你 第一次 使用 markdown 编辑器 所 展示 的 欢迎 页 如果 你想 学习 如何 使用 markdown 编辑器 可以 仔细阅读 这篇 文章 了解 一下 markdown 的 基本 语法 知识 新 的 改变 我们 对 markdown 编辑器 进行了 一些 功能 拓展 与 语法 支持 除了 标准 的 markdown 编辑器 功能 我们 增加了 如下 几点 新功能 帮助 你 用它 写 博客 全新 的 界面设计 将会 带来 全新 的 写作 体验 在 创作 中心 设置 你 喜爱 的 代码 高亮 样式 markdown 将 代码 片 显示 选择 的 高亮 样式 进行 展示 增加了 图片 拖拽 功能 你 可以 将 本地 的 图片 直接 拖拽 到 编辑 区域 直接 展示 全新 的 katex 数学公式 语法 增加了 支持 甘特图 的 mermaid 语法 功能 增加了 多 屏幕 编辑 markdown 文章 功能 增加了 焦点 写作 模式 预览 模式 简洁 写作 模式 左右 区域 同步 滚轮 设置 等功能 功能 按钮 位于 编辑 区域 与 预览 区域 中间 增加了 检查 列表 功能 功能 快捷键 撤销 ctrlcommandz 重做 ctrlcommandy 加粗 ctrlcommandb 斜体 ctrlcommandi 标题 无序 列表 有序 列表 检查 列表 ctrl lcommandshiftc 插入 代码 插入 链接 插入 图片 查找 ctrlcommandf 替换 ctrlcommandg 合理 的 创建 标题 有助于 目录 的 生成 直接 输入 次 并按 下 space 后 将 生成 级 标题 输入 次 并按 下 space 后 将 生成 级 标题 以此类推 我们 支持 级 标题 有助于 使用 toc 语法 后 生成 一个 完美 的 目录 如何 改变 文本 的 样式 强调 文本 强调 文本 加粗 文本 加粗 文本 标记 文本 删除 文本 引用 文本 hois 是 液体 运算 结果是 插入 链接 与 图片链接 link 图片 带 尺寸 的 图片 居中 的 图片 居中 并且 带 尺寸 的 图片 当然 我们 为了 让 用户 更加 便捷 我们 增加了 图片 拖拽 功能 如何 插入 一段 漂亮 的 代码 片 去 博客 设置 页面 选择 一款 你 喜欢 的 代码 片 高亮 样式 下面 展示 同样 高亮 的 代码 片 生成 一个 适合 你 的 列表 项目 项目 项目 项目 项目 项目 计划任务 完成任务 创建 一个 表格 一个 简单 的 表格 是 这么 创建 的 项目 value 电脑 手机 导管 设定 内容 居中 居 左 居 右 使用 居中 使用 居 左 使用 居 右 第一 列 第二 列 第三 列 第一 列 文本 居中 第二 列 文本 居 右 第三 列 文本 居 左 将 ascii 标点 字符 转 换为 智能 印刷 标点 html 实体 例如 创建 一个 自定义 列表 如何 创建 一个 注脚 一个 具有 注脚 的 文本 注释 也是 必不可少 的 markdown 将 文本 转 换为 htmlkatex 数学公式 您可 以 使用 渲染 latex 数学 表达式 katexgamma 公式 展示 n n nngamma n n n n nn 是 通过 欧 拉 积分 z tzetdtgamma z intinftytzetdt z tzetdt 你 可以 找到 更多 关于 的 信息 latex 数学 表达式 here 新 的 甘特图 功能 丰富 你 的 文章 monmonmon 已 完成 进行 中计 划一 计划 二 现有 任务 关于 甘特图 语法 参考 这儿 uml 图表 可以 使用 uml 图表 进行 渲染 mermaid 例如 下面 产生 的 一个 序列图 张三李四 王 五 你好 李四 最近 怎么样 你 最近 怎么样 王 五 我 很好 谢谢 我 很好 谢谢 李四 想了 很长 时间 文字 太 长了 不适合 放在 一行 打 量着 王 五 很好 王 五 你 怎么样 张三李四 王 五 这将 产生 一个 流程图 链接 长方形 圆 圆角 长方形 菱形 关于 mermaid 语法 参考 这儿 flowchart 流程图 我们 依旧会 支持 flowchart 的 流程图 开始 我 的 操作 确认 结束 yesno 关于 flowchart 流程图 语法 参考 这儿 导出 与 导入 导出 如果 你想 尝试 使用 此 编辑器 你 可以 在此 篇文章 任意 编辑 当你 完 成了 一篇 文章 的 写作 在 上方 工具栏 找到 文章 导出 生成 一个 md 文件 或者 html 文件 进行 本地 保存 导入 如果 你想 加载 一篇 你 写过 的 md 文件 在 上方 工具栏 可以 选择 导入 功能 进行 对应 扩展名 的 文件 导入 继续 你 的 创作 mermaid 语法 说明 注脚 的 解释 