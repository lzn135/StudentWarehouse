python 每日 一练 24 requests 模块 获取 免费 的 代理 并 检测 代理 ip 是否 有效 目录 通过 代理 服务 发送 请求 获取 免费 的 代理 ip 检测 代理 ip 是否 有效 通过 代理 服务 发送 请求 在 爬 取 网页 的 过程 中经 常会 出现 不久前 可以 爬 取 的 网页 现在 无法 爬 取 的 情况 这是 因为 您 的 ip 被 爬 取 网站 的 服务器 屏蔽 了 此时 代理 服务 可 以为 您 解决 这一 麻烦 设置 代理 时 首先 需要 找到 代理 地址 例如 对应 的 端口 号为 完整 的 格式 为 代码 如下 代理 的 应用 导入 网络 请求 模块 头部 信息 windowsntwinx applewebkit khtmllikegecko 设置 代理 ip 与 对应 的 端口号 try 对 需要 爬 取 的 网页 发送 请求 print 打印 响应 状态 码 进行 编码 htmletreehtml responsetext 解析 infojoin info replace xa strip replace 本机 ip 本机 ip print info 输出 当前 ip 匿名 信息 f 错误 异常 信息 为 e 打印 异常 信息 程序 运行 结果 如 下图 所示 由于 示例 中 代理 ip 是 免费 的 所以 使用 得 时间 不 固定 超出 使用 的 时间 范围 该 地址 将 失效 在 地址 失效 或者 地址 错 误时 控制台 将 显示 以下 所示 的 异常 信息 错误 异常 信息 为 由于 连接 方 在 一段时间 后 没有 正确 答复 或 连接 的 主机 没有反应 连接 尝试 失败 获取 免费 的 代理 ip 为了 避免 爬 取 目标 网页 的 后台 服务器 对 我们 实施 封锁 ip 的 操作 我们 可以 每 发送 一次 网络 请求 更换 一个 ip 从而 降低 被 发现 的 风险 其实在 获取 免费 的 代理 ip 之前 需要 先 找到 提供 免费 代理 ip 的 网页 然后 通过 爬虫 技术 将 大量 的 代理 ip 提取 并 保存 至 文件 当中 以 某 免费 代理 ip 网页 为 例 实现 代码 如下 获取 免费 的 代理 导入 网络 请求 模块 导入 html 解析 模块 导入 pandas 模块 iplist 创建 保存 ip 地址 的 列表 头部 信息 windowsntwinx applewebkit khtmllikegecko urlheaders 用于 获取 指定 网站 中 的 ip 及 端口 paramurl 抓取 网站 的 链接 paramheaders 请求 头 设置 编码 方式 判断 请求 是否 成功 htmletreehtml responsetext 解析 html 获取 所有 带有 ip 的 li 标签 lilisthtmlxpath forliinlilist 遍历 每行 内容 iplixpath 获取 ipportlixpath 获取 端口 iplistappend ipport print f 代理 ip 为 ip 对应 端口 为 port columnsip 创建 临时 表格 foriinrange 构造 免费 代理 ip 的 请求 地址 i getip urlheaders iptableipiplist 将 提取 的 ip 保存 至 excel 文件 中 的 ip 列 生成 xlsx 文件 iptabletoexcel 程序代码 运行 后 控制台 将 显示 如 下图 所示 的 代理 ip 与 对应 端口 项目 文件 中将 自动 生成 ipxlsx 文件 文件 内容 如 下图 所示 如果 以上 示例 代码 运行 出错 读者 可以 参考 以上 示例 代码 的 学习 思路 然后 爬 取其 他 免费 代理 ip 的 网页 博 主 这里 提供 几个 免费 的 代理 ip 网站 检测 代理 ip 是否 有效 提供 免费 代理 ip 的 网页 有 很多 但是 经过 测试 会 发现 并不是 所有 的 免费 代理 ip 都是 有效 的 甚至 更 不是 匿名 ip 即 获取 远程 访问 用户 的 ip 地址 是 代理服务器 的 ip 地址 不是 用户 本地 真实 的 ip 地址 所以 要 使用 我们 爬 取 下来 的 免费 代理 ip 就需要 对 这个 ip 进行 检测 实现 检测 免费 代理 ip 是否 可 用时 首先 需要 读取 保存 免费 代理 ip 的 文件 然后 对 代理 ip 进行 遍历 并 使用 免费 的 代理 ip 发送 网络 请求 而 请求 地址 可以 使用 查询 ip 位置 的 网页 如果 网络 请求 成功 说明 免费 的 代理 ip 可以 使用 并且 还会 返回 当前 免费 代理 ip 的 匿名 地址 代码 如下 检测 代理 ip 是否 有效 导入 网络 请求 模块 导入 pandas 模块 导入 html 解析 模块 ipxlsx 读取 代理 ip 文件 内容 iplistiptableip 获取 代理 ip 信息 头部 信息 windowsntwinx applewebkit khtmllikegecko chromesafari 循环 遍历 代理 ip 并 通过 代理 发送 网络 请求 foripiniplist 这里 添 加了 http 和 https 两个 代理 这样 写 是因为 有些 网页 采用 http 协议 有的 则 采用 https 协议 为了 在这 两类 网页 上 都能 顺利 使用 代理 所以 一般 都 同时 写上 当然 如果 确定 了 某 网页 的 请求 类型 可以 只 写 一种 ipip ipip 判断 是否 请求 成功 请求 成功 说明 代理 ip 可用 进行 编码 htmletreehtml responsetext 解析 infojoin info replace xa strip replace 本机 ip 本机 ip print info 输出 当前 ip 匿名 信息 e 打印 异常 信息 pass 程序 运行 结果 如 下图 所示 由于 博 主 网络 原 因故 测试 出来 的 可用 的 ip 地址 较少 读者 可以 根据 自己 查找 的 ip 查询 请求 地址 进行 更换 测试 免费 的 ip 地址 可用 的 较少 可以 购买 付费 代理 