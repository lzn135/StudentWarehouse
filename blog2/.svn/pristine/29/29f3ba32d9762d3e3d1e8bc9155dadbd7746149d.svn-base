增强 导读 作者 gopalshankar 翻译 徐 晨 亮 原文 地址 与 mysql 原生 数据 字典 一致 在 mysql 的 子系统 设计 中 我们 做了 一些 很 有用 的 增强 在这 篇文章 中 我 将会 介绍 自 mysql 以来 的 旧 的 实现 方式 然后 介绍 我们 做了 什么 改变 首次 引入 mysql 作为 一种 从 正在 运行 的 mysql 服务器 检索 元 数据 的 标准 兼容 方式 当 我们 回顾 的 历史 时 对于 某些 特定 查询 性能 总是有 很多 的 抱怨 特别是 在有 许多 数据库 对象 schema 表 等 的 情况下 为了 解决 这些 上报 的 问题 从 mysql 开始 我们 进行了 许多 性能 优化 来 加快 查询 的 执行 速度 mysql 手册 lt 链接 gt 中 描述 了 这些 优化 当 用户 在 查询 中 提供 显 式 schema 名称 或 表 名 时 将会 应用 这些 尽管 有 这些 改进 的 性能 仍然是 我们 许多 用户 的 主要 痛 点在 当前 实现 方式 下 产生 的 性能 问题 背后 的 关键 原因是 表 的 查询 实现 方式 是 在 查询 执行 期间 创建 临时 表 这些 临时 表 通过 以下 方式 填充 元 数据 来自 文件 例 如表 定义 来自 frm 文件 细节 来自于 存储 引擎 例如 动态 表 的 统计 信息 来自 mysqlserver 层 中 全局 数据结构 的 数据 对于 一个 mysql 实例 来说 可能有 上百 个 库 每个 库 又有 上百 张 表 查询 最 终会 从 文件 系统 中 读取 每个 单独 的 frm 文件 造成 很多 io 读取 并且 最终 还会 消耗 更多 的 cpu 来 打开 表 并 准备 相关 的 内存 数据结构 它 确实 尝试 使用 mysqlserver 层 的 表 缓存 系统 变量 但是在 大型 实例 中 很少 有 一个 足 够大 的 表 缓存 来 容纳 所有 的 表 如果 查询 未 使用 优化 则 可以 很 容易 碰到 上面 的 性能 问题 例如 让我们 考虑 下面 的 两个 查询 sec sec 从 explain 的 输出 可以 看到 我们 看到 前 一个 查询 将 使用 where 子 句中 为 tableschema 和 tablename 字段 提供 的 值 作为 键 从 文件 系统 读取 所需 frm 文件 但是 后 一个 查询 最 终将 读取 整个 数据 目录 中 的 所有 frm 这 非常 昂贵 且 无法 扩展 frmfiles 中 的 一个 主要 变化 是 引 入了 基于 innodb 的 数据 字典 这一 变化 使 我们 能够 摆脱 基于 文件 的 元 数据 存储 frm 文件 并 帮助 mysql 转向 支持 事务 ddl 有 关在 中 引入 数据 字典 功能 及其 优点 的 更多 详细信息 请在 此处 查看 staale 的 文章 lt 链接 既然 所有 数据库 表 的 元 数据 都 存储 在 事务 数据 字典 表 中 它 使 我们 能够 将 表 设计 为 数据 字典 表 上 的 数据库 视图 这 消 除了 成本 例 如在 执行 期间 为 每个 查询 创建 临时 表 以及 扫描 文件 系统 目录 以 查找 frm 文件 现在 还可 以 利用 mysql 优化 器 的 全部 功能 使用 数据 字典 表 上 的 索 引来 获得 更好 的 执行计划 下面 的 图 解释 了 mysql 和 设计 上 的 区别 如果 我们 在 之前 介绍 的 背景 下 考虑 上面 的 例子 我们 会 看到 优化 器 在 两种 情况下 都会 使用 数据 字典 表 上 的 索引 当 我们 通过 这个 全新 的 设计 的 来看 性能 提升 时 我们 发现 它比 mysql 更 有效 例 如此 查询 现在 快 倍 个 数据库 每 个个 表 另外 一篇 博客 将 详细 介绍 中 性能 并非 所有 表 都 通过 中 的 数据 字典 表 作为 视图 实现 目前 我们 将 以下 表 设计 为 视图 即将 推出 的 mysql 版本 将 提供 以下 表 作为 视图 为了 描述 查询 这些 查询 没有 直接 实 现为 数据 字典 表 上 的 视图 让 我 首先 描述 在 表 中有 两种 类型 的 元 数据 静态 表 元 数据 例如 这些 静态 数据 将会 从 数据 字典 中 直接 读取 动态 表 元 数据 例如 动态 元 数据 经 常会 变更 例如 自 增值 会在 每次 插入 后 自 增 在 许多 情况下 动态 元 数据 也 会 产生 一些 成本 以便 按需 准确 计算 并且 对于 某些 特定 的 查询 这个 准确性 并没 有用 考虑 datafree 统计 信息 的 情况 该 统计 信息 显示 表 中 的 空闲 字节数 缓存 值 通常 就 足 够了 defaultcached 在 mysql 中 动态 表 元 数据 将 默 认为 缓存 这 可以 通过 设置 默认 缓存 进行 配置 并且 可以 更 改为 以便 始终 直接 从 存储 引擎 检索 动态 信息 以 稍高 的 查询 执 行为 代价 作为 替代 方案 用户 还 可以 在 表 上 执行 analyzetable 以 更新 缓存 的 动态 统计 信息 中 的 设计 是 向前 迈出 的 一步 简单 且 可 维护 的 实现 我们 摆 脱了 很多 的 遗留 漏洞 正确 使用 mysql 优化 器 进行 查询 与 检索 静态 表 元 数据 时 的 相比 查询 执行 速度快 倍 如 查询 q 中 所示 在 中 还有 更多 关于 的 讨论 与 旧 的 实现 相比 新 的 实现 方式 有 一些 变化 有关 它 的 更多 详细信息 请 查看 mysql 手册 感谢您 使用 mysql 链接 链接 扫 码 加入 mysql 技术 q 群 群 号 