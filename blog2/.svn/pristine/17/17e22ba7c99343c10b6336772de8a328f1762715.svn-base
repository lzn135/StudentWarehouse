系统安全 二十 pe 数字签名 之 上 什么 是 数字签名 及 signtool 签名 工具 详解 您 可能 之前 看到过 我 写 的 类似 文章 为什么 还要 重复 撰写 呢 只是 想 更好 地 帮助 初学者 了解 病毒 逆向 分析 和 系统安全 更加 成 体系 且不 破坏 之前 的 系列 因此 我 重新 开 设了 这个 专栏 准备 系统 整理 和 深入 学习 系统安全 逆向 分析 和 恶意代码 检测 系统安全 系列 文章 会 更加 聚焦 更加 系统 更加 深入 也是 作者 的 慢慢 成长史 换 专业 确实 挺 难 的 逆向 分析 也是 块 硬骨头 但我 也 试试 看看 自己 未来 四年 究竟 能 将它 学到 什么 程度 漫漫 长征路 偏向虎山行 享受 过程 一起 加油 作者 前文 介绍 了 宏病毒 相关 知识 它 仍然 活跃 于 各个 apt 攻击 样本 中 具体内容 包括 宏病毒 基础 原理 防御 措施 自发 邮件 及 apt 样本 分析 本文 将 详细 介绍 什么 是 数字签名 并 采用 signtool 工具 对 exe 文件 进行 签名 后续 深入分析 数字签名 的 格式 及 pe 病毒 内容 这些 基础 性知识 不仅 和 系统安全 相关 同样 与 我们 身边 常用 的 软件 文档 操作系统 紧密联系 希望 这些 知识 对 您 有所 帮助 更 希望 大家 提高 安全意识 安全 保障 任重道远 本文 参考 了 参考文献 中 的 文章 并 结合 自己 的 经验 和 实践 进行 撰写 也 推荐 大家 阅读 参考文献 文章 目录 一 pe 文件 的 数字签名 概念 普及 github 网站 证书 验证 过程 二 阮 一 峰 老师 告诉 大家 什么 是 数字签名 三 signtool 签名 pe 文件 四 总结 从 年月 开始 我 来 到了 一个 陌生 的 专业 网络空间 安全 初 入 安全 领域 是 非常 痛苦 和 难受 的 要 学 的 东西 太多 涉及面 太 广 但 好在 自己 通过 分享 篇 网络安全 自学 系列 文章 艰难 前行 着 感恩 这一 年 相识 相知 相 趣 的 安全 大佬 和 朋友们 如果 写得 不好 或 不足之处 还请 大家 海涵 接下来 我 将 开启 新 的 安全 系列 叫 系统安全 也是 免费 的 篇文章 作者 将 更加 深入 的 去 研究 恶意 样本 分析 逆向 分析 内网 渗透 网络 攻防 实战 等 也 将 通过 在线 笔记 和 实践 操作 的 形式 分享 与 博 友 们 学习 希望 能与 您 一起 进步 加油 推荐 前文 网络安全 自学 篇 系列 篇 作者 的 github 资源 逆向 分析 网络安全 前文 分析 系统安全 一 什么 是 逆向 分析 逆向 分析 基础 及 经典 扫雷 游戏 逆向 系统安全 二 如何 学好 逆向 分析 及 吕布 传 游戏 逆向 案例 系统安全 三 idapro 反汇编 工具 初识 及 逆向 工程 解密 实战 系统安全 四 ollydbg 动态 分析 工具 基础 用法 及 crakeme 逆向 系统安全 五 ollydbg 和 cheatengine 工具 逆向 分析 植物 大战 僵尸 游戏 系统安全 六 逆向 分析 之 条件 语句 和 循环 语句 源码 还原 及 流程 控制 系统安全 七 逆向 分析 之 pe 病毒 原理 c 实现 文件 加解密 及 ollydbg 逆向 系统安全 八 windows 漏洞 利 用之 cve 复现 及 蓝屏 攻击 系统安全 九 windows 漏洞 利 用之 ms 远程 代码 执行 漏洞 复现 及 深度 提 权 系统安全 十 windows 漏洞 利 用之 smbv 服务 远程 代码 执行 漏洞 cve 复现 系统安全 十一 那些 年 的 熊猫 烧香 及 pe 病毒 行为 机理 分析 系统安全 十二 熊猫 烧香 病毒 ida 和 od 逆向 分析 上 病毒 初始化 系统安全 十三 熊猫 烧香 病毒 ida 和 od 逆向 分析 中 病毒 释放 机理 系统安全 十四 熊猫 烧香 病毒 ida 和 od 逆向 分析 病毒 释放 过程 下 系统安全 十五 chrome 浏览器 保留 密码 功能 渗透 解析 蓝屏 漏洞 及 某 音乐 软件 漏洞 复现 系统安全 十六 pe 文件 逆向 基础知识 pe 解析 pe 编辑 工具 和 pe 修改 系统安全 十七 windowspe 病毒 概念 分类 及 感染 方式 详解 系统安全 十八 病毒 攻防 机理 及 winrar 恶意 劫持 漏洞 脚本 病毒 自启动 定时 关机 蓝屏 攻击 系统安全 十九 宏病毒 之 入门 基础 防御 措施 自发 邮件 及 apt 宏 样本 分析 系统安全 二十 pe 数字签名 之 上 什么 是 数字签名 及 signtool 签名 工具 详解 声明 本人 坚决 反对 利用 教学方法 进行 犯罪 的 行为 一切 犯罪行为 必将 受到 严惩 绿色 网络 需要 我们 共同 维护 更 推荐 大家 了解 它们 背后 的 原理 更好 地 进行 防护 该 样本 不会 分享 给 大家 分析 工具 会 分享 参考文献 见 后 一 pe 文件 的 数字签名 概念 普及 pe 文件 pe 文件 的 全 称是 意为 可 移植 的 可执行 的 文件 常见 的 exedllocxsyscom 都是 pe 文件 pe 文件 是 微软 windows 操作系统 上 的 程序 文件 可能是 间接 被执行 如 dll 后续 文章 会 详细分析 pe 文件 格式 为什么 要对 pe 文件 进行 数字签名 呢 防 篡改 通过 对 数字签名 的 验证 保证 文件 未被 非法 篡改 降低 误报 安全 软件 通过 验证 文件 是否 有 正规 厂商 的 数字签名 来 降低 误报 pe 文件 数字签名 及 验证 过程 签名 软件 发布者 使用 散 列 算法 如 md 或 sha 计算 pe 文件 的 散 列 值 软件 发布者 使用 私钥 对 散 列 值 进行 签名 得到 签名 数据 将 签名 私钥 对应 的 公 钥 和 签名 数据 等 以 证书 的 形式 附 加在 pe 文件 之中 形成 经过 数字签名 的 pe 文件 软件 发布者 将 经过 数字签名 的 pe 文件 进行 发布 验证 从 pe 文件 证书 中 提取 软件 发布者 的 公 钥 使用 的 散 列 算法 签名 算法 原始 散 列 值 的 签名 数据 使用 提取 的 公 钥 和 对应 签名 验证 算法 将 签名 数据 还 原为 原始 pe 文件 的 原始 散 列 值 对 现有 pe 文件 使用 同样 的 散 列 算法 计算出 对应 的 散 列 值 对比 两个 散 列 值 是否 一致 从而 判断 数据 是否 被 破坏 和 篡改 pe 文件 数字签名 的 总体 结构 pe 文件 数字签名 信息 存放在 位置 同时 pe 文件 可选 文 件头 datadirecotry 第 项 记录 文件 偏移 及 大小 下一 篇文章 作者 尝试 详细 讲解 pe 文件 结构 及 签名 解析 使用 peview 查看 签名 前后 对比 图 可以 看到 存储 相关 签名 信息 pe 文件 数字签名 查看 这里 以 zoomitexe 程序 为 例 我们 可以 看到 经过 数字签名 后 的 pe 文件 还会 多出 一个 数字签名 的 属性 点击 详细信息 可以 查看 对应 的 证书 对应 的 证书 信息 及 证书 路径 如 下图 所示 包括 签名 算法 哈希 算法 有效期 颁发 者 信息 等 微软 数字签名 证书 查看 接着 我 带领 大家 看看 windows 证书 运行 中 输入 certmgrmsc 可以 看到 这里 面有 个 系统 默认 的 ecc 签名 的 根 证书 如 下图 所示 我们 随意 导出 其中 一个 根 证书 导出 直接 选择 base 编码 那个 就行 可以 看到 导出 的 ecc 密钥 证书 如 下图 所示 包括 证书 的 有效期 等 信息 这 就是 微软 在 实现 椭圆 曲线 加密 ecc 算法 的 数字证书 位于 cryptoapidll 文件 也是 被 我们 利 用来 伪造 可信任 来源 的 签名 漏洞 数字签名 常用 算法 及 应用领域 数字签名 常用 算法 包括 rsa 数字签名 算法 基于 大 整数 分解 问题 mdshadsa 数字签名 算法 基于 离散对数问题 ecdsa 椭圆 曲线 数字签名 算法 eccdsa 椭圆 加密算法 属于 dsa 的 一个 变种 基于 椭圆 曲 线上 的 离散对数问题 其 应用领域 包括 pe 文件 数字签名 https 数字签名 电子邮件 数字签名 office 文档 数字签名 代码 数字签名 github 网站 证书 验证 过程 接着 看看 github 网站 进行 微软 证书 验证 的 过程 在 windows 系统 访问 一个 网站 例 githubcom 时 该 网站 会 向 windows 系统 发送 由 第三方 权威机构 ca 签署 的 网站 证书 windows 系统 则会 验证 该 证书 是否 由 ca 颁发 若 验证 通过 则 windows 系统 与 网站 成功 建立 tls 链接 为了 方便 下一次 更快 的 访问 windows 将 验证 成功 的 证书 放入 内存 中一 块 证书 缓存 中 在下 一次 校验 时 如果 该 证书 存在于 缓存 中 则 直 接取 缓存 中 的 值 进行 校验 这里 利用 cve 在 成功 缓存 证书 数据 后 根据 下面 描述 的 windows 证书 缓存 机制 恶意 网站 可以 伪造 虚假 的 网站 例 githubcom 证书 且 通过 windows 验证 将 自身 伪装成 合法 网站 当 windows 接 收到 新 的 证书 时 windows 将 新 接收 的 证书 与 已 缓存 证书 的 证书 的 公 钥 进行 遍历 对比 寻找 匹配 的 值 伪造 的 恶意 证书 与 windows 系统 中 的 缓存 证书 有 同样 的 公 钥 但 curve 项 没有 在 校验 范围内 所以 可以 通过 构造 自定义 curve 来 伪造 证书 使得 证书 验证 流程 依然 成立 但 通过 验证 的 证书 已经 不是 之前 成功 验证 的 安全 证书 在 第 篇文章 中 我们 将 详细 复现 微软 证书 cve 漏洞 二 阮 一 峰 老师 告诉 大家 什么 是 数字签名 参考 文章 数字签名 是什么 阮 一 峰 原始 网站 写到 这里 您 可能 还是 很 疑惑 什么 是 数字签名 下面 我 通过 阮 一 峰 老师 的 博客 进行 讲解 个人认为 这是 一篇 讲得 比较 清晰 的 原理 文章 同时 也 包 含了 网络安全 中 加密 解密 信息 传输 等 知识 假设 鲍 勃 有 两把 钥匙 一把 是 公 钥 另一 把 是 私钥 鲍 勃 把 公 钥 送给 他 的 朋友们 帕 蒂 道 格 苏珊 每人 一把 苏珊 要给 鲍 勃 写 一封 保密 的 信 她 写完 后用 鲍 勃 的 公 钥 加密 就可以 达到 保密 的 效果 鲍 勃 收信 后用 私钥 解密 就看 到了 信件 内容 这里 要 强调 的 是 只要 鲍 勃 的 私钥 不 泄露 这封 信 就是 安全 的 即使 落在 别人 手里 也 无法 解密 鲍 勃 给 苏珊 回信 决定 采用 数字签名 他 写完 后 先用 hash 函数 生成 信件 的 摘要 digest 然后 鲍 勃 使用 私钥 对 这个 摘要 加密 生成 数字签名 signature 鲍 勃 将 这个 签名 附在 信件 下面 一起 发给 苏珊 苏珊 收信 后 取下 数字签名 用 鲍 勃 的 公 钥 解密 得到 信件 的 摘要 由此证明 这封 信 确 实是 鲍 勃 发出 的 苏珊 再 对 信件 本身 使用 hash 函数 将 得到 的 结 果与 上 一步 得到 的 摘要 进行 对比 如果 两者 一致 就 证明 这封 信 未被 修 改过 复杂 的 情况 出现 了 道 格 想 欺骗 苏珊 他 偷偷 使 用了 苏珊 的 电脑 用 自己 的 公 钥 换 走了 鲍 勃 的 公 钥 此时 苏珊 实际 拥 有的是 道 格 的 公 钥 但是 还 以为 这是 鲍 勃 的 公 钥 因此 道 格 就可以 冒充 鲍 勃 用 自己 的 私钥 做成 数字签名 写信给 苏珊 让 苏珊 用 假 的 鲍 勃 公 钥 进行 解密 后来 苏珊 感觉 不对劲 发现 自己 无法 确定 公 钥 是否 真的 属于 鲍 勃 她想 到了 一个 办法 要求 鲍 勃 去找 证书 中心 简称 ca 为 公 钥 做 认证 证书 中心 用 自己 的 私钥 对 鲍 勃 的 公 钥 和 一些 相关 信息 一起 加密 生成 数字证书 鲍 勃 拿到 数字证书 以后 就可以 放心 了 以后 再 给 苏珊 写信 只 要在 签名 的 同时 再 附上 数字证书 就行了 苏珊 收信 后用 ca 的 公 钥 解开 数字证书 就可以 拿到 鲍 勃 真实 的 公 钥 了然 后 就能 证明 数字签名 是否 真的 是 鲍 勃 签 的 下面 我们 看 一个 应用 数字证书 的 实例 https 协议 这个 协议 主要 用于 网页 加密 首先 客户端 向 服务器 发出 加密 请求 服务 器用 自己 的 私钥 加密 网页 以后 连同 本身 的 数字证书 一起 发送给 客户端 客户端 浏览器 的 证书 管理器 有 受 信任 的 根 证书 颁发 机构 列表 客户端 会 根据 这张 列表 查看 解开 数字证书 的 公 钥 是否 在 列表 之内 如果 数字证书 记载 的 网址 与 你 正在 浏览 的 网址 不一致 就 说明 这张 证书 可能 被 冒用 浏览器 会发 出 警告 如果 这张 数字证书 不是 由 受 信任 的 机构 颁发 的 浏览器 会 发出 另一种 警告 如果 数字证书 是 可靠 的 客户端 就可以 使用证 书中 的 服务器 公 钥 对 信息 进行 加密 然后 与 服务器 交换 加密 信息 数字签名 是为了 保证 数据 完整性 通过 它 可以 判断 数据 是否 被 篡改 私钥 加密 完 的 数据 所有 知道 公 钥 的 都可以 解密 这样 不安全 私钥 加密 的 作用 是为了 确认 身份 用 对应 的 公 钥 解密 摘 要则 证明 摘要 来自 谁 起到 签名 的 作用 三 signtool 签名 pe 文件 逆向 分析 软件 安全 该 testexe 程序 后续 文章 也 会 分享 均 上传 至 github 第一步 通过 makecertexe 生成 需要 的 证书 生成 两个 文件 分 别是 testcer 和 微软 testcer 创建 过程中 需要 输入 私钥 密码 这里 设置 为 第二步 查看 证书 信息 如果 未 信任 需要 点击 安装 证书 安装 并 信任 该 证书 第三步 利用 signcodeexe 工具 进行 数据 签名 选择 需要 签名 的 testexe 程序 第四步 自动 选择 自定义 选项 然后 点击 从 文件 中 选择 testcer 文件 testcer 文件 在 第一个 步骤 你 生成 的 目录 中 然后 下一步 第五步 点击 浏览 按钮 添加 文件 testpvktestpvk 文件 也是 在 第一步 生成 的 目录 中 点击 下一步 哈希 算法 可以 选 md 也 可以 选 sha 点击 下一步 第六步 默认 点击 下一步 出现 数据 描述 框 自己 可以 填写 也 可以 不 填 点击 下一步 第七步 填写 时间 戳 服务器 也 可以 不 选 添加 时间 戳 点击 下一步 完成 弹出 签名 成功 框 第八 步 此时 testexe 文件 完成 数字签名 打开 该 exe 文件 属性 如 下图 所示 可以 看到 签名 相关 信息 注意 该 数字签名 正常 且 颁发 者 为 windows 最后 我们 使用 peview 软件 打开 pe 文件 可以 看到 签名 前 和 签名 后 的 结构 存在 区别 下一 篇文章 我们 将 详细分析 数字签名 的 结构 四 总结 文章 写到 这里 就 介绍 完毕 希望 文章 对 您 有所 帮助 这篇 文章 主要 讲解 pe 文件 数字签名 分享 阮 一 峰 老师 的 博客 告诉 大家 什么 是 数字签名 结合 signtool 工具 对 exe 文件 进行 签名 作者 作为 网络安全 初学者 的 慢慢 成长 路 吧 希望 未来 能 更 透彻 撰写 相关 文章 同时 非常感谢 参考文献 中 的 安全 大佬 们 的 文章 分享 感谢 小伙伴 和 师傅 们 的 教导 从 网络安全 到 系统安全 从 木马病毒 到 后门 劫持 从 恶意代码 到 溯源 分析 从 渗透 工具 到 二进制 工具 还有 python 安全 顶 会 论文 黑客 比赛 和 漏洞 分享 未知 攻 焉知 防 人生 漫漫 其 路 远 兮 作为 初学者 自己 真是 爬着 前行 感谢 很多人 的 帮助 继续 爬着 继续 加油 学 安全 一年 认识了 很多 安全 大佬 和 朋友 希望 大家 一起 进步 这篇 文章 中 如果 存在 一些 不足 还请 海涵 作者 作为 网络安全 和 系统安全 初学者 的 慢慢 成长 路 吧 希望 未来 能 更 透彻 撰写 相关 文章 同时 非常感谢 参考文献 中 的 安全 大佬 们 的 文章 分享 感谢 师傅 实验室 小伙伴 的 教导 深知 自己 很菜 得 努力 前行 编程 没有 捷径 逆向 也没有 捷径 它们 都是 搬 砖 活 少 琢磨 技 巧干 就 对了 什么时候 你 把 攻击 对手 按在 地上 摩擦 你 就 赢了 也 会 慢慢 形 成了 自己 的 安全 经验 和 技巧 加油 吧 少年 希望 这个 路线 对 你 有所 帮助 共勉 欢迎 大家 讨论 是否 觉得 这 系列 文章 帮助 到 您 如果 存在 不足之处 还请 海涵 任何 建议 都可以 评论 告知 读者 共勉 逆向 分析 网络安全 年月 新开 的 娜 璋 ai 安全 之家 主要 围绕 python 大数 据分析 网络空间 安全 人工智能 web 渗透 及 攻防 技术 进行 讲解 同时 分享 ccfsci 南 核 北 核 论文 的 算法 实现 娜 璋 之家 会 更加 系统 并 重构 作者 的 所有 文章 从 零 讲解 python 和 安全 写了 近十年 文章 真心 想把 自己 所学 所 感 所做 分享 出来 还请 各位 多多指教 真诚 邀 请您 的 关注 谢谢 byeastmount 星期天 凌晨 夜 于 贵阳 参考文献 武大 软件 安全 课程 强推 网络安全 自学 篇 四十六 微软 证书 漏洞 cve 上 windows 验证 机制 及 可执行文件 签名 复现 强推 数字签名 是什么 阮 一 峰 强推 原始 网站 强推 对 windows 平 台下 pe 文件 数字签名 的 一些 研究 dovefeng 强推 强推 哈希 hash 数字签名 phant 强推 恶意 文件 分析 系统 中 的 数字签名 验证 绿 盟 科技 强推 翻译 windowspe 文件 中 的 数字签名 格式 看 雪 银 雁 冰 大神 pe 文件 数字签名 工具 ahuope 文件 解析 异常 处理表 与 数字签名 签名 伪造 pe 文件 的 签名 伪造 与 签名 验证 劫持 嘶吼 roartalk 数字签名 ctfwiki 数字签名 算法 介绍 和 区别 infinisign 求助 关于 pe 文件 的 数字签名 看 雪 论坛 区块 链 数字签名 是什么 chinakingkong 校验文件 数字签名 的 合法性 verifype ahuo 数字签名 shinymood 恶意 文件 分析 系统 中 的 数字签名 验证 百度 文库 如何 判断 一个 文件 是否 已经有 数字签名 csdn 论坛 