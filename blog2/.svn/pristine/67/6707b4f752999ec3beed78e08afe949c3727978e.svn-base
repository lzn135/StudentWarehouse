index 填充 因子 不只是 一个 传说 填充 因子 听说 过不过 这个 需要 我 去 设置 吗 默认 不就 可以 了 我 想 听到 填充 因子 这个词 大部分 的 反映 基本 上边 就可以 总结 的 回复 因为 另一 句话 在 大多数 书籍 或者 文字 中会 提到 乱 去 设置 填充 因子 会 降低 性能 那 这篇 文字 到底 要说 什么 我们 的 从 btree 来 说起 当然 这不是 去 讲述 btree 的 知识 因为 要讲 填充 因子 不得 不从 btree 说起 但要 谈 一个 东西 我们 的 有 一个 前提 索引 或者说 大部分 索引 或 这里 提到 的 索引 是 btree 方式 组成 的 并且 您对 btree 大致 的 原理 是 有 了解 的 基础上 在 展开 这个 话题 首先 需要 画一 个 简易 的 btree 的 图 期间 部分 leafpage 已经 满了 有些 还 有空 的 位子 根 节点 通过 指针 与 叶子 节点 进行 连接 同时 每个 叶子 节点 的 末端 也 通过 指针 指向 下一个 叶子 节点 开始 的 位置 这时 我们 要 插入 这个 数字 很明显 叶子 节点 已经 没有 位置 可以 插入 这个 数字 那 叶子 节点 就需要 进行 拆分 下面 这张 图 可以 很 清晰 的 看到 如果 叶子 节点 满了 的 情况 下在 进行 数据 的 插入 就需要 进行 叶子 节点 的 拆分 以及 根 节点 部分 数据 的 变更 致 拆分 的 规律 将 中间 的 节点 放入 到 根 节点 小于 中间 节点 的 数据 放到 记录 的 左边 大于 中间 节点 的 放到 数据 记录 的 右边 所以 btree 总是会 保持 一个 平衡 那 填充 因子 到底 在这里 起 一个 什么 作用 innodb 在 创建 或 重建 b 树 索引 时 是 进行 批量 加载 的 这样 创建 索引 的 途径 称为 排序 索引 构建 配置 选项 定义 在 排序 索引 构建 期间 填充 的 每个 btree 页 面上 的 空间 百分比 其余 空间 保 留给 未来 索引 增长 根据 官方 的 资料 如果是 cluster 索引 的 情况下 其实 就是 所谓 的 索引 组织 表 oracle 聚 簇 索引 主键 sqlserverinnodb 会 留下 的 页面 来 保证 后续 的 插入 和 升级 索引 记录 的 空间 预留 当然 填充 索引 的 作用 并不是 仅仅 于此 在 我们 大量 删除 row 的 情况下 默认 的 情况下 当 一个 页面 的 数据 不足 的 情况下 就要 开始 收缩 页面 或者 我们 称之为 合并 页面 所以 填充 因子 的 设计 尤其 针对 一些 特殊 的 表 来 说是 有 必要 进行 单体 设计 的 尤其 对 性能 要求 极高 的 领域 你 愿意 你 的 数据 页面 一会 合并 一会 分割 吗 所以 下面 就需要 开始 解决 这个 问题 下面 有 几个 业务 场景 的 假设 假设 业务 比较稳定 数据 在 落 盘 后 不会 经常 的 更改 或者 删除 假设 数据 属于 记录 变更 性质 会经 常被 update 例如 一些 订单 的 状态 一个 订单 至少有 个 状态 在 几分钟 中 内 会 进行 变化 并且会 经常 更改 一些 注释 假设 表 属于 统计表 数据 在 记录 后 不会 改变 大部分 都是 在 进行 查询 活动 以上 三个 场景 对于 填充 因子 的 需 求是 各种各样 的 我们 待会 来说 这三个 需求 现在 我们 回到 mysql 的 填充 因子 这个 参数 如果 你 使用 的 mysql 的 版本 你 会 看到 一个 的 值 说明 默认 的 填充 率 当然 这不是 针对 primarykey 也 就是 我们 的 主键 以及 聚 簇 索引 来说 的 mysql 的 聚 簇 索引 强制 的 填充 率 是 而 剩下 的 填充 率 的 设置 都是 给 二级 索引 准备 的 回到 我们 刚才 的 那个 话题 三个 场景 如果 我们 的 业务 大致 是 这样 的 可以 考虑 设置 填充 率 在 左右 也 就是 如果 我们 的 业务 中 的 数据 会 经常 进行 更 改则 填充 率 可以 考虑到 也 即使 业务 场景 三 基本上 我们 可以 不 改变 默认 的 值 那 可能会 有人 问我 的 表 经常 变动 平均 几秒 就 变动 一 次数 据我 是不是 可以 将 这个 填充 率 设置 为 让 我 的 数据 页面 不经 常被 split 或者 merge 给 足够 的 空间 来 防止 上面 的 那些 操作 这样 做 可能会 产生 索引 占用 更多 的 磁盘空间 对于 值 较低 的 索引 索引 中有 更多 的 页面 索引 统计数据 抽样 可能 不是 最优 的 优化 器 可能会 选择 具有 次优 统计 信息 的 错误 查询 计划 所以 看完 这篇 文 字后 可以 去看 看您 的 mysql 的 的 系统 当前 设置 时 多少 并且 根据您 库 中 重要 的 表 的 情况 适当 的 调整 您 的 值 这样 对于 某些 系统 会有 性 能上 的 帮助 