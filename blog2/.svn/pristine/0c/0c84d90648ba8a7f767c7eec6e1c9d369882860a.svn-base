基于 java 基础 面向对象 实现 植物 大战 僵尸 简易版 前言 从零开始 学习 的 java 的 第一 个月 在 面向对象 oop 的 学习 中 跟着 讲师 完 成了 飞机 大战 的 游戏 编码 第二 个月 开始 接触 api 心血来潮 便 结合 api 中 的 集合 多线程 开始 植物 大战 僵尸 的 编码 从 游戏 模式 的 设计 到 游戏 内容 的 实现 大约 花费 个 礼拜 的 时间 如今是 我 接触 java 第 个月 回头 来看 曾经 自己 引 以为 豪 甚至在 一定 程 度上 帮助 自己 拿到 offer 的 作品 代码 显得 稚嫩 生涩 本来 想 好好 改造 一番 代码 在 新增 一些 未完成 的 功能 但又 不忍心 动刀 毕 竟是 自己 的 第一个 完整 作品 于是乎 想把 设计 思路 和 游戏 代码 都 分享 出来 和 大家 一起 互相 交流学习 游戏 设计 植物 大战 僵尸 中有 一个 小游戏 关卡 屏幕 的 正上方 有 一个 滚轮 机会 随机 生成 植物 玩家 可以 选中 植物 后 自由选择 草坪 来 进行 安放 基 于此 游戏 模式 我 将该 关卡 抽取 出来 单独 做 成了 一个 简易版 的 植物 大战 僵尸 游戏 的 画面 大概 如下 屏幕 左侧 会 自动 生成 植物 的卡 牌 单击 选中 后 可以 放置 在 草 坪上 右侧 会 自动 生成 僵尸 不同 的 僵尸 移动 速度 不同 血量 不同 还有 的 僵尸 有 隐藏 奖励 比如 全屏 僵尸 静止 全屏 僵尸 死亡 等 当时 竟然 没有 做 游戏 的 暂停 的 功能 导致 现在 截图 的 时机 很难 把 控 那 这里 就 先说 一下 游戏 暂停 的 功能 应该 怎么做 吧 最 简单 的 一种 暂停 方式 是 鼠标 移出 屏幕 游戏 暂停 所以 这里 需要 引入 一个 鼠标 监听器 事件 mouseevente 当 游戏 处于 运行 状态 时 if statusstart 通过 鼠标 移动 事件 的 对象 获取 当前 鼠标 的 位置 intxegetx intyegety 如果 鼠标 超 出了 游戏 界面 if 将 游戏 的 状态 改为 暂停 状态 statuspause 当然 这 只是 一个 简单 的 通过 监听 鼠标 的 位置 来 改变 游戏 状态 方法 还可 以 使用 键盘 监听器 当 按 下 某个 键 时 游戏 暂停 这样 的 用户 体验 更好 但 原理 是 一样 的 这里 就不 展示 代码 了 游戏 对象 首先 分析 一下 游戏 中有 哪些 对象 各式各样 的 植物 各式各样 的 僵尸 各式各样 的 子弹 那么 这里 就可以 抽出 三个 父 类 分 别是 植物 僵尸 子弹 在 面向对象 中 子类 将 继承 父 类 所有 的 属性 和 方法 所以 可以 将 三 大类 中共 有的 属性 和 方法 抽 到 各自 的 父 类 中 比如 僵尸 父 类 僵尸 父 类 僵尸 共有 的 属性 僵尸 的 状态 这里 补充 一下 为什么 父 类 是 抽象类 比如 每个 僵尸 都有 移动 方法 但 每个 僵尸 的 移动 方式 是 不同 所以 该 方法 的 方 法体 可能是 不同 的 抽象 方法 没有 方 法体 在 子类 中 再去 进行 重写 就可以 了 但有 抽象 方法 的 类 必须 是 抽象类 因此 父 类 一般 都是 抽象类 移动 方式 植物 父 类 子弹 父 类 就 同理 可 得了 上面 说到 子类 共有 的 方法 需要 抽 到 父 类 中 那么 部分 子类 共有 的 方法 该 如何 处理 呢 比如 豌豆 射手 寒冰 射手 可以 发射 子弹 坚果 墙 就 没有 射击 的 这个 行为 所以 这里 就需要 用到 接口 interface 射击 接口 将 部分 子类 共有 的 行为 抽 取到 接 口中 接 口中 的 方法 默认 是 publicabstract 的 规范 的 编码 应该 将该 字段 舍去 到此为止 游戏 对象 的 属性 方法 基本 都 定义 完了 至于 图片 的 显示 以及 如何将 图片 画出来 只需要 使用 相应 的 api 即可 这里 就 不做 描述 了 工作 一年 回过来 看看 这里能 优化 的 地方 还有 很多 比如 对象 的 血量 攻击力 移动 等 都可以 统统 写入 到 配置文件 中 这样 在做 游戏 参数 的 调整 时 不需 要去 修改 代码 相关 的 内容 只需要 修改 配置文件 里面 的 参数 即可 游戏 内容 现在 我们 有 了 游戏 的 对象 该 开始 让 对象 加入到 游 戏中 来 接着 让 他们 动起来 最后 还得 让 他们 打 起来 首 先让 对象 加入到 游 戏中 来 我 是 这么 做的 这里 还 是以 僵尸 为 例 首先 有 要 一个 僵尸 的 集合 僵尸 集合 接着 定义 随机 生成 僵尸 方法 控制 不同 种类 僵尸 出现 的 概率 if typelt returnnewzombie elseif typelt returnnewzombie elseif typelt returnnewzombie 僵尸 入场 设置 进场 间隔 这里 补充 一下 为什么 要 设置 进场 的 间隔 因为 游戏 的 运行 是 基于 定时器 的 每隔 一段时间 定时器 就会 执行 一次 你 所加 入 定时器 的 方法 所以 这里 需要 设置 进场 间隔 来 控制 游戏 的 速度 zombieentertime 对 自 增量 zombieentertime 进行 取 余 计算 if zombieentertime 满足 条件 就 调用 随机 生成 僵尸 方法 并将 生成 的 僵尸 加入到 僵尸 的 集合 中 zombiesadd nextonezombie 最早 时候 我 用 的 数据结构 是 数组 但在 后续 的 编码 中 发现 对 僵尸 对象 有 很多 的 遍历 以及 增删 操作 数组 的 增删 操作 是 十分 麻烦 复杂 的 所以 我 就 换 成了 集合 在工作中 也 一样 先 思考 在 编码 选择 正确 的 数据结构 往往 能 起到 事半功倍 的 效果 植物 入场 的 设计 是 我 当时 自认为 很 精妙 的 一个 点 先说 一下 当时 在 编码 中 发现 的 问题 首先 植物 入场 时 是 在 滚轮 机上 的 滚轮 机上 的 移动 就会 涉及到 追击 和 停止 的 问题 追击 的 方式 当然是 追 前 一个 植物 卡 牌 但 当 第一个 植物 卡 牌 被选 中 放置 到 草地上 后 那 该 如何 追击 呢 最 开始 我 的 做法 是 给 植物 多加 几个 状态 来 解决 这个 问题 但是 发现 状态 过 多会 导致 if 判断 中 的 条件 将 大大 增加 并且在 尝试 后 还是 没有 实现 想要 的 效果 于是 我 就将 植物 集合 一分为二 在后 面的 游戏 功能设计 中 回头 过 来看 才 发 现将 植物 集合 分为 滚轮 机上 的 集合 和 战 场上 的 集合 实在是 太 精妙 了 请听 我 娓娓道来 滚轮 机上 的 植物 状态 为 stop 和 战 场上 的 植物 状态 为 life 和 movemove 为 被 鼠标 选中 移动 的 状态 这里 设计 不合 理会 引发 后面 的 一个 植物 在 滚轮 机上 的 碰撞 判定 遍历 滚轮 机上 植物 集合 从 第二个 开始 for i 如果 第一个 植物 的 y 大于 并且是 stop 状态 则 状态 改为 waitif plantsget gety isstop plantsget gowait 如果 第 i 个 植物 y 小于 i 个 植物 的 yheight 则 说明 碰 到了 改变 i 的 状态 为 stopif plantsget i isstop plantsget i iswait ampamp plantsget i isstop plantsget i iswait ampampplantsget i gety ltplantsget i gety plantsget i getheight plantsget i gostop 如果 第 i 个 植物 y 大 于于 i 个 植物 的 yheight 则 说明 还没 碰到 或者 第 i 个 植物 被 移 走了 改变 i 的 状态 为 wait 可以 继续 往上走 if plantsget i isstop ampampplantsget i gety gtplantsget i gety plantsget i getheight plantsget i gowait 检测 滚轮 机上 的 植物 状态 迭代 器 while ithasnext plantpitnext 如果 滚 轮机 集合 里 有 move 或者 life 状态 的 植物 则 添加到 战场 植物 的 集合 中 并从 原 数组 中 删除 现在 发现 把 滚轮 机上 move 状态 的 植物 添加到 战 场上 植物 集合 的 最佳 操作 时间 点 应该是 等 植物 状态 变为 life 后 再 添加 if pismove pislife plantslifeadd p itremove 当然 滚轮 机上 的 对 植物 状态 判断 的 代码 还是 显得 生涩 也 正是 自己 想 优化 这段 代码 时 萌 生了 分享 游戏 设计 过程 和 游戏 代码 的 念头 那么 下面 就 说说 这段 代码 该 如何 优化 先 对 状态 做 下 说明 wait 植物 卡 牌 在 滚轮 机上 移动 状态 因为 是 等着 被 鼠标 选中 所以 取名为 waitstop 植物 卡 牌 在 滚轮 机上 停止 状态 有 两种 情况 到 顶了 撞到 上一个 卡 牌 了 开始 对 以下 代码 进行 优化 如果 第 i 个 植物 y 小于 i 个 植物 的 yheight 则 说明 碰 到了 改变 i 的 状态 为 stopif plantsget i isstop plantsget i iswait ampamp plantsget i isstop plantsget i iswait ampampplantsget i gety ltplantsget i gety plantsget i getheight plantsget i gostop 优化 后 的 代码 是 这样 的 将 一个 复杂 的 boolean 拆成 多个 if 条件 if plantsget i isstop plantsget i iswait breakif plantsget i isstop plantsget i iswait breakif plantsget i gety ltplantsget i gety plantsget i getheight breakplantsget i gostop boolean 条件 当然 也 可以 进行 优化 甚至 还 可以 简化 一下 植物 的 状态 这里 因为 游戏 的 规则 僵尸 只能 攻击 在 草 坪上 的 植物 所以 把 带 放置 的 植物 和 草 坪上 的 植物 分为 两个 集合 是 十分 合理 精妙 的 在 判断 僵尸 是否 攻击 植物 只需 要去 遍历 草 坪上 的 植物 集合 即可 如果 不 拆 分当 要 判断 僵尸 是否 攻击 植物 的 时候 需要 遍历 的 集合 将是 所有 的 植物 集合 并且 需要 增加 至少 个 状态 来 区分 植物 是 在 草 坪上 还是 在 滚轮 机上 这段 代码 想想 就是 又臭又长 接下来 该 让 对象 们 都 动起 来了 之前 说到 在 父 类 中 的 移动 方法 是 抽象 方法 在 各自 的 子类 中都 进行 重写 后 不同 的 对象 移动 方式 就是 各式各样 的 了 子弹 移动 for bulletbbullets bstep 僵尸 移动 设置 移动 间隔 if zombiesteptime for zombiezzombies 只有 活着 的 僵尸 会 移动 if zislife zstep 看着 代码 中 对 集合 复杂 的 遍历 不得 不感 概 lambda 表达式 真是 个 好东西 子弹 移动 bulletsforeach b gtbstep 这里 好像 还是 没法 展示 lambda 表达式 强大 的 功能 请看 下面 的 例子 为了 应对 产品 不断 变更 的 需求 前辈 们 总结经验 得出 的 设计 模式 已经 能在 一定 程 度上 应 对此 问题 设计 模式 声明 策略 接口 在 实现 类 中 完成 过滤 逻辑 for if strategyoperate student student 当 需求 变更 时 只需 要在 策略 接口 的 实现 类 中 变更 判断 逻辑 即可 tt 但 好像 还是 有点 麻烦 又 要写 接口 又要 写 实现 类 后续 的 维护 也是 个 头疼 问题 这个 时候 救世主 lambda 表达式 就 出现 了 无需 接口 便可 实现需求 的 快速 变更 filter collect 让我们 看看 上面 到底 发 生了 啥 首 先将 数据 的 集合 流化 接着 调用 过滤 方法 强大 lambda 表达式 让 代码 变得 简洁 并且 判断 条件 的 修改 可在 代码 中 直接 维护 无需 在 策略 接口 的 实现 类 维护 最后 在 转成 集合 返回 一个 满足 产品 需求 的 集合 回到 正题 如何 让 对象 们 打 起来 呢 下面 以 僵尸 攻击 植物 为 例 僵尸 的 超 类 中 定义 了 僵尸 的 攻击 方法 由于 僵尸 们 的 攻击行为 是 相同 所以 这里是 普通 方法 僵尸 攻击 植物 plantp intypgety 结合 图片 来看 上述 代码 应该 就 更好 理解 黑 框 p 代表 植物 黑 框 z 代表 植物 虚线 是 指 两者 接触 的 极限 距离 当 僵尸 进入 虚线 内 就 保证 可以 攻击 到 植物 僵尸 攻击 设置 攻击 间隔 if zombiehittime for zombiezzombies 如果 战 场上 没有 植物 则 把 所有 僵尸 的 状态 改为 life 这里 补充 一下 为什么 要 先将 所有 的 僵尸 的 状态 先 改成 life 状态 也 就是 移动 状态 因为 下 面对 僵尸 是否 攻击 的 植物 的 判断 是 从 遍历 战 场上 的 植物 集合 开始 的 假如有 只 僵尸 在 吃 植物 把 战 场上 唯一 的 一个 植物 吃 掉了 那么 僵尸 的 状态 将从 攻击 改成 移动 呢 所以 这里 运 用了 逆向 的 思想 先将 所有 的 僵尸 改为 移动 状态 如果 符合 攻击 的 条件 那么 在 改为 攻击 状态 即便是 战 场上 没有 植物 那么 僵尸 还 依然是 移动 的 状态 if zisdead zgolife 这里 应该有 个 对战 场上 植物 集合 的 判断 在 进行 遍历 for 如果 僵尸 是 活 的 并且 植物 是 活 的 并且 僵尸 进入 攻击 植物 的 范围 这里有 个 bug 僵尸 竟然会 攻击 鼠标 选中 还未 放下 的 植物 所以 下面 的 判断 条件 中 应该 还需要 移除 被 鼠标 选中 状态下 植物 if zislife ampamppisdead p ampamp 僵尸 状态 改为 攻击 状态 zgoattack 植物 掉血 ploselive 如果 出现 了 一些 效果 的 偏移 造成 的 原因是 图片 大小不一 造成 的 坐标 偏移 因为 图片 都是 网上 找 的 所以 效果 不是 太 理想 至此 游戏 的 基本功能 基本 实现 了 java 是 一门 面向对象 的 语言 万物 皆 对象 特征 皆 属性 行为 皆 方法 肉眼 能 看到 的 僵尸 植物 草坪 都是 对象 对象 的 特性 比如 血量 移动 速度 都是 属性 对象 的 行为 比如 移动 攻击 死亡 都是 方法 下面 说 说对 游戏 功能 的 优化 游戏 优化 放置 植物 的 优化 已经 放置 过 植物 的 草地 不能 再 放置 植物 了 之前 是 将 草地 设计 成 empty 和 hold 两种 状态 现在 来看 其实 只需要 返回 一个 true 和 false 就行了 将 整个 植物 集合 定义 成 一个 虚拟 的 boolean 集合 即可 移除 植物 的 优化 设计 思路 是 新增 一个 铲子 对象 铲子 集合 铲子 入场 铲子 只有 一把 if shovelssize shovelsadd newshovel 使用 铲子 while ithasnext shovelsitnext 如果 铲子 是 移动 状态 就 遍历 植物 集合 if sismove while ithasnext plantpitnext intxpgetx intxpgetx pgetwidth intypgety intypgety pgetheight if pislife blover p isclick 移除 植物 itremove 移除 铲子 itremove 看着 这 极其 复杂 好像 很厉害 的 代码 我 又 萌 生了 痛 下 狠 手 的 想法 但 为了 保持 原生 我 忍住 于是乎 还 发现了 一个 bug 如果 选中 铲子 后 战 场上 唯一 的 植物 被 僵尸 吃 掉了 那么 这个 铲子 将 一直 跟随着 鼠标 无法 达到 使 用后 消除 的 效果 了 解决方案 当然 也 很简单 当 战 场上 植物 集合 的 size 为时 清空 铲子 集合 即可 游戏 可玩性 的 优化 上文 在 游戏 设计 中 提到 的 击杀 僵尸 后 可能 随机 获得 奖励 类型 是 这样 实现 的 还是 从 设计 分析 开始 并非 击杀 任何 类型 的 僵尸 都可以 获得 奖励 所以 奖励 应该 放在 接 口中 奖励 接口 这里 还是 存在 代码 不 规范 的 问题 接口 的 方式 默认 是 publicabstract 接 口中 的 变量 默认 是 这些 默认 的 字段 应该 舍去 全屏 静止 全屏 清除 当 僵尸 死亡 时 需 要去 判断 该 僵尸 是否 有 奖励 接口 如果有 则 执行 相应 奖励 的 方法 检测 僵尸 状态 迭代 器 while ithasnext zombiezitnext 僵尸 血量 小于 则 死亡 死亡 的 僵尸 从 集合 中 删除 if zgetlive lt 判断 僵尸 是否 有 奖励 的 接口 if awarda award switch type zombiezozombies zogodead zomgostop breakzgodead itremove 僵尸 跑进 房子 而 游戏 生命 减 一并 删除 僵尸 if zoutofbound 添加 游戏 背景音乐 bgm 是 一个 游戏 的 灵魂 之一 这里 给 游戏 添加 背景音乐 我 的 选择 是 新建 一条 线程 专门 用来 执行 音乐 的 解析 和 播放 启动 线程 加载 音乐 bgmwav r tstart 读 音频 wav 格式 专用 线程 stringwavfile filenamewavfile 这里 需要 注意 的 是 java 中 解析 音乐 的 api 只 支持 wav 格式 的 文件 文件 格式 的 转换 大多数 音乐 播放器 都可以 做到 后续 优化 植物 种类 的 扩充 及 对应 功能 的 实现 比如 杀伤力 最大 的 玉米 加农炮 需要 个 小 玉米 进行 合成 那么 在 判断 是否 能够 合成 玉米 加农炮 时 需要 对 植物 集合 进行 遍 历来 做 坐标 的 判断 所以 这边 建议 最 好把 可 合成 的 植物 单独 放在 一个 集合 中 这样 在做 合成 判断 的 时候 会 简单 很 多当 集合 的 size 小于 时 就可以 提示 合成 失败 了 冰冻 西瓜 的 设计 思路 也是 如此 动作类 僵尸 的 加入 如 撑杆跳 僵尸 跳舞 僵尸 等 说 一下 撑杆跳 僵尸 的 设计 思路 此类 僵尸 和 其他 僵尸 相比 多了 一种 跳 的 行为 所以 会有 一个 单独 的 方法 和 单独 的 状态 并且 跳 只能 触发 一次 所以 撑杆跳 僵尸 的 状态 变化 应该是 行走 gt 遇到 植物 跳过去 gt 再 遇到 植物 就 开始 攻击 在 执行 状态 变化 的 时候 应该 要去 考虑 当前 的 状态 是否 还可 跳跃 当 植物 攻击 范围内 不存在 僵尸 时 植物 停止 攻击 这个 就 简单 拉 在 植物 执行 攻击 方法 时 校验 一下 是否 有 y 坐标 相同 的 僵尸 即可 源码 分享 也 可以 留下 邮箱 方便 代码 分享 