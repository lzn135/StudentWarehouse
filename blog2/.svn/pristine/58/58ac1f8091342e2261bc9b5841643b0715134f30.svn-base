十八 道 jvm 面试题 总汇 附 解析 一 java 类 加载 过程 java 类 加载 需要 经历 以 下个 过程 加载 加载 是 类 加载 的 第一个 过程 在 这个 阶段 将 完成 以下 三件 事情 通过 一个 类 的 全 限 定名 获取 该类 的 二进制 流 将该 二进制 流 中 的 静态 存储 结构 转 化为 方法 去 运行时 数据结构 在 内存 中 生成 该类 的 class 对象 作为 该类 的 数据 访问 入口 验证 验证 的 目的 是为了 确保 class 文件 的 字 节流 中 的 信息 不会 危害到 虚拟机 在 该 阶段 主要 完成 以下 四种 验证 文件 格式 验证 验证 字 节流 是否 符合 class 文件 的 规范 如 主次 版本号 是否 在 当前 虚拟机 范围内 常量 池中 的 常量 是否 有 不被 支持 的 类型 元 数据 验证 对 字节 码 描述 的 信息 进行 语义 分析 如 这个 类 是否 有 父 类 是否 集 成了 不被 继承 的 类 等 字节 码 验证 是 整个 验证 过程 中最 复杂 的 一个 阶段 通过 验证 数据流 和 控制 流 的 分析 确定 程序 语义 是否 正确 主要 针对 方 法体 的 验证 如 方法 中 的 类型 转换 是否 正确 跳转 指令 是否 正确 等 符号 引用 验证 这个 动作 在后 面的 解析 过程中 发生 主要 是为了 确保 解析 动作 能 正确 执行 准备 准备 阶段 是 为 类 的 静态 变量 分配 内存 并 将其 初始 化为 默认值 这些 内存 都 将在 方法 区 中 进行 分配 准备 阶段 不 分配 类 中 的 实例 变量 的 内存 实例 变量 将会 在 对象 实例 化时 随着 对象 一起 分 配在 java 堆 中 在 准备 阶段 value 初始值 为 在 初始化 阶段 才会 变为 解析 该 阶段 主要 完成 符号 引 用到 直接 引用 的 转换 动作 解析 动作 并不一定 在 初始化 动作 完成 之前 也有 可能在 初始化 之后 初始化 初始 化时 类 加载 的 最后 一步 前面 的 类 加载 过程 除了 在 加载 阶段 用户 应用程序 可以 通过 自定义 类 加载 器 参与 之外 其余 动作 完 全由 虚拟机 主导 和 控制 到了 初始化 阶段 才 真正 开始 执行 类 中 定义 的 java 程序代码 使用 卸载 二 描述 一下 jvm 加载 class 文件 的 原理 机制 java 语言 是 一种 具有 动态 性 的 解释 型 语言 类 class 只有 被 加 载到 jvm 后 才能 运 行当 运行 指定 程 序时 jvm 会将 编译 生成 的 class 文件 按照 需 求和 一定 的 规则 加 载到 内存 中 并 组织 成为 一个 完整 的 java 应用程序 这个 加载 过程 是 由 类 加载 器 完成 具体来说 就是 由 classloader 和它 的 子类 来 实现 的 类 加载 器 本身 也是 一个 类 其实质 是 把 类 文件 从 硬盘 读 取到 内存 中 类 的 加载 方式 分为 隐 式 加载 和 显示 加载 隐 式 加载 指的是 程序 在 使用 new 等 方式 创建 对象 时会 隐 式 地 调用 类 的 加载 器 把 对应 的 类 加 载到 jvm 中 显示 加载 指的是 通过 直接 调用 classforname 方法来 把 所需 的 类 加 载到 jvm 中 任何 一个 工程项目 都是 由 许多 类 组成 的当 程序 启动时 只 把 需要 的 类 加 载到 jvm 中 其他 类 只有 被 使 用到 的 时候 才 会被 加载 采用 这种 方法 一方面 可以 加快 加载 速度 另一方面 可以 节约 程序 运行时 对 内存 的 开销 此 外在 java 语 言中 每个 类 或 接口 都 对应 一个 class 文件 这些 文件 可以 被 看成是 一个个 可以 被 动态 加载 的 单元 因此 当 只有 部 分类 被 修 改时 只需要 重新 编译 变化 的 类 即可 而 不需要 重新 编译 所有 文件 因此 加 快了 编译 速度 在 java 语 言中 类 的 加载 是 动态 的 它 并不会 一次性 将 所有 类 全部 加载 后 再运行 而是 保证 程序 运行 的 基础 类 例如 基 类 完全 加 载到 jvm 中 至于 其他 类 则在 需要 的 时候 才 加载 类 加载 的 主要 步骤 装载 根据 查找 路径 找到 相应 的 class 文件 然后 导入 链接 链接 又可 分为 个 小步 检查 检查 待 加载 的 class 文件 的 正确性 准备 给 类 中 的 静态 变量 分配 存储空间 解析 将 符号 引用 转 换为 直接 引用 这一步 可选 初始化 对 静态 变量 和 静态 代码 块 执行 初始化 工作 三 java 内存 分配 寄存器 我们 无法控制 静态 域 static 定义 的 静态 成员 常量 池 编译 时 被 确定 并 保 存在 class 文件 中 的 final 常 量值 和 一些 文本 修饰 的 符号 引用 类 和 接口 的 全 限定 名 字段 的 名称 和 描述符 方法 和 名称 和 描述符 非 ram 存储 硬盘 等 永久 存储空间 堆 内存 new 创建 的 对象 和 数组 由 java 虚拟机 自动 垃圾 回收 器 管理 存取 速度慢 栈 内存 基本 类型 的 变量 和 对象 的 引用 变量 堆 内存空间 的 访问 地址 速度快 可以 共享 但是 大小 与 生存期 必须 确定 缺乏 灵活性 四 java 堆 的 结构 是什么 样子 的 什么 是 堆 中 的 永久 代 permgenspacejvm 的 堆 是 运行时 数据 区 所有 类 的 实例 和 数组 都是 在 堆上 分配 内存 它在 jvm 启动 的 时候 被 创建 对象 所占 的 堆 内存 是 由 自动 内存 管理 系统 也 就是 垃圾 收集器 回收 堆 内存 是 由 存活 和 死亡 的 对象 组成 的 存活 的 对 象是 应用 可以 访问 的 不 会被 垃圾 回收 死亡 的 对 象是 应用 不可 访问 尚且 还没有 被 垃圾 收集器 回 收掉 的 对象 一 直到 垃圾 收集器 把 这些 对象 回 收掉 之前 他们 会 一直 占据 堆 内存空间 五 gc 是什么 为什么 要有 gcgc 是 垃圾 收集 的 意思 内存 处理 是 编程 人员 容易 出现问题 的 地方 忘记 或者 错误 的 内存 回收 会 导致 程序 或 系统 的 不稳定 甚至 崩溃 java 提供 的 gc 功能 可以 自动 监测 对象 是否 超过 作用 域 从而 达到 自动 回收 内存 的 目的 java 语言 没有 提供 释放 已 分配 内存 的 显示 操作方法 六 简述 java 垃圾 回收 机制 在 java 中 程序员 是 不需要 显示 的 去 释放 一个 对象 的 内存 的 而是 由 虚拟机 自行 执 行在 jvm 中有 一个 垃圾 回收 线程 它是 低 优先级 的 在 正常 情况下 是 不会 执行 的 只有 在 虚拟机 空闲 或者 当前 堆 内存不足 时 才会 触发 执行 扫 面 那些 没有 被 任何 引用 的 对象 并将 它们 添加到 要 回收 的 集合 中 进行 回收 七 如何 判断 一个 对象 是否 存活 或者 gc 对象 的 判定 方法 判断 一个 对象 是否 存活 有 两种 方法 引用 计数 法 所谓 引用 计数 法 就是 给 每一个 对象 设置 一个 引用 计数器 每当 有 一个 地方 引用 这个 对象 时 就将 计数器 加 一 引用 失效 时 计数器 就 减 一当 一个 对象 的 引用 计数器 为 零时 说明 此 对象 没有 被 引用 也 就是 死 对象 将 会被 垃圾 回收 引用 计数 法 有 一个 缺陷 就是 无法 解决 循环 引用 问题 也就是说 当 对象 a 引用 对象 b 对象 b 又 引用 者 对象 a 那么 此时 ab 对象 的 引用 计数器 都 不为 零 也就 造成 无法 完成 垃圾 回收 所以 主流 的 虚拟机 都没有 采用 这种 算法 可达性 算法 引用 链 法 该 算法 的 思想 是 从一 个 被称为 gcroots 的 对象 开始 向下 搜索 如果 一个 对象 到 gcroots 没有 任何 引用 链 相连 时 则 说明 此 对象 不可 用在 java 中 可以 作为 gcroots 的 对象 有 以下 几种 虚拟机 栈 中 引用 的 对象 方法 区 类 静态 属性 引用 的 对象 方法 区 常量 池 引用 的 对象 本地 方法 栈 jni 引用 的 对象 虽然 这些 算法 可以 判定 一个 对象 是否能 被 回收 但是 当 满足 上述 条件 时 一个 对象 比 不一定 会被 回收 当 一个 对象 不 可达 gcroot 时 这个 对象 并不会 立马 被 回收 而是 出于 一个 死缓 的 阶段 若 要被 真正 的 回收 需要 经历 两次 标记 如果 对象 在 可达性 分析 中 没有 与 gcroot 的 引用 链 那么 此时 就 会被 第一次 标记 并且 进行 一次 筛选 筛选 的 条件 是 是否 有 必要 执行 finalize 方法 当 对象 没有 覆盖 finalize 方法 或者 已被 虚拟机 调 用过 那么 就 认为是 没必要 的 如果 该 对象 有 必要 执行 finalize 方法 那么 这个 对象 将会 放在 一个 称为 fqueue 的 对 队列 中 虚拟 机会 触发 一个 finalize 线程 去 执行 此 线程 是 低 优先级 的 并且 虚拟机 不会 承诺 一直 等待 它 运行 完 这是 因为 如果 finalize 执行 缓慢 或者 发 生了 死锁 那么 就会 造成 fqueue 队列 一直 等待 造成了 内存 回收 系统 的 崩溃 gc 对 处于 fqueue 中 的 对象 进行 第二次 被 标记 这时 该 对象 将被 移除 即将 回收 集合 等待 回收 八 垃圾 回收 的 优点 和 原理 并 考虑 种 回收 机制 java 语言 中一 个 显著 的 特点 就是 引 入了 垃圾 回收 机制 使 c 程序员 最 头疼 的 内存 管理 的 问题 迎刃而解 它 使得 java 程序员 在 编写程序 的 时候 不再 需要 考虑 内存 管理 由于 有 个 垃圾 回收 机制 java 中 的 对象 不再 有 作用 域 的 概念 只有 对象 的 引用 才有 作用 域 垃圾 回收 可以 有效 的 防止 内存 泄露 有效 的 使用 可以 使用 的 内存 垃圾 回收 器 通常是 作为 一个 单独 的 低级 别的 线程 运行 不可 预知 的 情况下 对 内存 堆 中 已经 死亡 的 或者 长时间 没有 使用 的 对象 进行 清楚和 回收 程序员 不能 实时 的 调用 垃圾 回收 器 对 某个 对象 或 所有 对象 进行 垃圾 回收 回收 机制 有 分 代 复制 垃圾 回收 和 标记 垃圾 回收 增量 垃圾 回收 九 垃圾 回收 器 的 基本原理 是什么 垃圾 回收 器 可以 马上 回收 内存 吗 有 什么 办法 主动 通知 虚拟机 进行 垃圾 回收 对于 gc 来说 当 程序员 创建 对象 时 gc 就 开始 监控 这个 对象 的 地址 大小 以及 使用情况 通常 gc 采用 有 向 图 的 方式 记录 和 管理 堆 heap 中 的 所有 对象 通过 这种 方式 确定 哪些 对 象是 可达 的 哪些 对 象是 不 可达 的当 gc 确定 一些 对象 为 不 可达 时 gc 就有 责任 回收 这些 内存空间 可以 程序员 可以 手动 执行 systemgc 通知 gc 运行 但是 java 语言 规范 并不 保证 gc 一 定会 执行 十 java 中会 存在 内存 泄漏 吗 请 简单 描述 所谓 内存 泄露 就是指 一个 不 再被 程序 使用 的 对象 或 变量 一直 被 占据 在 内存 中 java 中有 垃圾 回收 机制 它 可以 保证 一 对象 不 再被 引用 的 时候 即 对象 变 成了 孤儿 的 时候 对象 将 自动 被 垃圾 回收 器 从 内存 中 清 除掉 由于 java 使用 有 向 图 的 方式 进行 垃圾 回收 管理 可以 消除 引用 循环 的 问题 例如 有 两个 对象 相互 引用 只要 它们 和 根 进程 不 可达 的 那么 gc 也是 可以 回收 它们 的 例如 下面 的 代码 可以 看到 这种 情况 的 内存 回收 java 中 的 内存 泄露 的 情况 长 生命周期 的 对象 持有 短 生命周期 对象 的 引用 就很 可能发生 内存 泄露 尽管 短 生命周期 对象 已经 不再 需要 但是 因为 长 生命周期 对象 持有 它 的 引用 而 导致 不能 被 回收 这 就是 java 中 内存 泄露 的 发生 场景 通俗 地 说 就是 程序员 可能 创 建了 一个 对象 以后 一直 不再 使用 这个 对象 这个 对象 却 一直 被 引用 即 这个 对象 无用 但是 却 无法 被 垃圾 回收 器 回收 的 这 就是 java 中 可能 出现 内存 泄露 的 情况 例如 缓存 系统 我们 加载 了 一个 对象 放在 缓存 中 例如 放在 一个 全局 map 对象 中 然后 一直 不再 使 用它 这个 对象 一直 被 缓存 引用 但却 不 再被 使用 检查 java 中 的 内存 泄露 一定 要让 程序 将 各种 分支 情况 都 完整 执行 到 程序 结束 然后 看 某个 对象 是否 被 使 用过 如果 没有 则 才能 判定 这个 对象 属于 内存 泄露 如果 一个 外 部类 的 实例 对象 的 方法 返 回了 一个 内 部类 的 实例 对象 这个 内 部类 对象 被 长期 引 用了 即使 那个 外 部类 实例 对象 不 再被 使用 但由于 内 部类 持久 外 部类 的 实例 对象 这个 外 部类 对象 将不 会被 垃圾 回收 这也 会 造成 内存 泄露 下面 内容 来自于 网上 主要特点 就是 清空 堆栈 中 的 某个 元素 并不是 彻底 把 它从 数组 中 拿掉 而是 把 存储 的 总数 减少 本人 写得 可以 比 这个 好在 拿掉 某个 元素 时 顺便 也 让 它从 数组 中 消失 将 那个 元素 所在 的 位置 的 值 设置 为 null 即可 我 实在 想不到 比 那个 堆栈 更 经典 的 例子 了 以致 于我 还要 引用 别人 的 例子 下面 的 例子 不是 我 想到 的 是 书上 看到 的 当然 如果 没有 在 书上 看到 可能 过一段时间 我 自己 也 想 的 到 可是 那时 我 说是 是 我 自己 想到 的 也 没有人 相信 的 上面 的 原理 应该 很简单 假如 堆栈 加了 个 元素 然后 全部 弹出来 虽然 堆栈 是 空 的 没有 我们 要 的 东西 但是 这是 个 对 象是 无法 回收 的 这个 才 符合 了 内存 泄露 的 两个 条件 无用 无法 回收 但是 就是 存在 这样 的 东西 也 不一 定会 导致 什么样 的 后果 如果 这个 堆栈 用 的 比 较少 也就 浪 费了 几个 k 内存 而已 反正 我们 的 内存 都上 g 了 哪里 会有 什么 影响 再说 这个 东西 很快 就 会被 回收 的 有 什么关系 下面 看 两个 例子 因为 是 static 就 一直 存 在到 程序 退出 但是 我们 也 可以 看到 它有 自愈 功能 就是说 如果 你 的 stack 最多 有 个 对象 那么 最多 也就 只有 个 对象 无法 被 回收 其实 这个 应该 很 容易 理解 stack 内部 持有 个 引用 最坏 的 情况 就是 他们 都是 无用 的 因为 我们 一旦 放 新 的 进去 以前 的 引用 自然 消失 内存 泄露 的 另外 一种 情况 当 一个 对象 被 存储 进 hashset 集合 中 以后 就不能 修改 这个 对象 中 的 那些 参与 计算 哈希 值 的 字段 了 否则 对象 修改后 的 哈希 值 与 最初 存储 进 hashset 集合 中 时 的 哈希 值 就 不同 了 在 这种 情况下 即使 在 contains 方法 使用 该 对象 的 当前 引用 作为 的 参 数去 hashset 集合 中 检索 对象 也 将 返回 找不到 对象 的 结果 这也 会 导致 无法 从 hashset 集合 中 单独 删除 当前 对象 造成 内存 泄露 十一 深 拷贝 和 浅 拷贝 简单 来讲 就是 复制 克隆 张三 浅 拷贝 就是 对 对象 中 的 数据 成员 进行 简单 赋值 如果 存在 动态 成员 或者 指针 就会 报错 深 拷贝 就是 对 对象 中 存在 的 动态 成员 或 指针 重新 开辟 内存空间 十一 systemgc 和 runtimegc 会做 什么事情 这两个 方法 用来 提示 jvm 要 进行 垃圾 回收 但是 立即 开始 还是 延迟 进行 垃圾 回收 是 取决于 jvm 的 十二 finalize 方法 什么时候 被 调用 析 构 函数 finalization 的 目的 是什么 垃圾 回收 器 garbagecolector 决定 回收 某 对象 时 就会 运行 该 对象 的 finalize 方法 但是在 java 中 很 不幸 如果 内存 总是 充足 的 那么 垃圾 回收 可能 永远 不会 进行 也就是说 filalize 可能 永远 不被 执行 显然 指望 它 做 收尾 工作 是 靠不住 的 那么 finalize 究竟是 做什么 的 呢 它最 主要 的 用途 是 回收 特殊 渠道 申请 的 内存 java 程序 有 垃圾 回收 器 所以 一般 情况下 内存 问题 不用 程序员 操心 但有 一种 调用 nonjava 程序 c 或 cfinalize 的 工作 就是 回收 这 部分 的 内存 十三 如果 对象 的 引用 被 置 为 null 垃圾 收集器 是否 会 立即 释放 对象 占用 的 内存 不会在 下一个 垃圾 回收 周 期中 这个 对象 将是 可被 回收 的 十四 什么 是 分布式 垃圾 回收 dgc 它是 如何 工作 的 dgc 叫做 分布式 垃圾 回收 rmi 使用 dgc 来 做 自动 垃圾 回收 因为 rmi 包 含了 跨 虚拟机 的 远程 对象 的 引用 垃圾 回收 是 很 困难 的 dgc 使用 引用 计数 算法 来给 远程 对象 提供 自动 内存 管理 十五 串行 serial 收集器 和 吞吐量 throughput 收集器 的 区别 是什么 吞吐量 收集器 使用 并行 版本 的 新生代 垃圾 收集器 它 用于 中等 规模 和 大规模 数据 的 应用程序 而 串行 收集器 对 大多数 的 小 应用在 现代 处理器 上 需要 大概 m 左右 的 内存 就 足 够了 十六 在 java 中 对象 什么时候 可以 被 垃圾 回收 当 对象 对 当前 使用 这个 对象 的 应用程序 变得 不可 触及 的 时候 这个 对象 就可以 被 回 收了 十七 简述 java 内存 分配 与 回收 策略 以及 minorgc 和 majorgc 对象 优 先在 堆 的 eden 区 分配 大 对象 直接 进入 老 年代 长期 存活 的 对象 将 直接 进入 老 年代 当 eden 区 没有 足够 的 空间 进行 分配 时 虚拟 机会 执行 一次 minorgcminorgc 通常 发 生在 新生代 的 eden 区 在 这个 区 的 对象 生存期 短 往往 发生 gc 的 频率 较高 回收 速度 比 较快 fullgcmajorgc 发 生在 老 年代 一般 情况下 触发 老 年代 gc 的 时候 不会 触发 minorgc 但是 通过 配置 可以 在 fullgc 之前 进行 一次 minorgc 这样 可以 加快 老 年代 的 回收 速度 如果 觉得 本文 有用 推荐 顶一顶 可以 让 更多 的人 能够 看到 欢迎 关注 公众 号 java 架构师 学习 你 会 喜欢 的 