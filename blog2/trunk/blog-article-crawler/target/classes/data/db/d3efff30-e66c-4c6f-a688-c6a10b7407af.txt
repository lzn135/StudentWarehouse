elk-filebeat 收集 docker 容器 日志 目录 使用 docker 搭建 elkfilebeat 安装 与 配置 docker 容器 设置 参考 文章 首发 地址 使用 docker 搭建 elk 使用 dockercompose 文件 构建 elk 文件 如下 执行 启动 elk 可以 使用 dockerlogs 命令 查看 elk 启动 日志 启动 成功 后 打开 浏览器 访问 httpfilebeat 安装 与 配置 关于 filebeat 本文 也 不做 过多 介绍 只 讲解 安装 与 配置 filebeat 的 挂载 说明 filebeatyml 配置 需 要在 本地 有 对应 文件 稍后 会 说到 filebeat 抓取 日志 进度 数据 挂 载到 本地 防止 filebeat 容器 重启 所有 日志 重新 抓取 因为 要 收集 docker 容器 的 日志 所以 要 挂 在到 docker 日志 存储 目录 使 它有 读取 权限 filebeat 配置文件 设置 在 同级 目录 新建 config 文件 夹在 config 文件 下 新建 filebeatyml 文件 文件 内容 如下 需要 读取 日志 的 目录 因为 docker 使用 的 logdriver 是 jsonfile 因此 采集 到 的 日志 格式 是 json 格式 设置 为 true 之后 filebeat 会将 日志 进行 jsondecode 处理 如果 启用 此 设置 则在 出现 json 解组 错误 或 配置 中 定义 了 messagekey 但 无法 使用 的 情况下 filebeat 将 添加 errormessage 和 errortypejson 键 一个 可选 的 配置 设置 用于 指定 应用 行 筛选 和 多行 设置 的 json 密钥 如果 指定 键 必须 位于 json 对象 的 顶层 且 与 键 关联 的 值 必须 是 字符串 否则 不会 发生 过滤 或 多行 聚合 tailfilestrue 将 error 日志 合 并到 一行 直接 输 出到 elasticsearch 这里 的 hosts 是 elk 地址 端口号 是 elasticsearch 端口 过滤掉 一些 不必要 字段 在 config 文件 下 新建 文件 文件 内容 如下 执行 启动 filebeat 在 需要 抓取 docker 日志 的 所有 主 机上 按照 以上 步骤 安装 运行 filebeat 即 可到 这一步 其实 就 已经 可以 在 elk 里面 建立 索引 查 抓 取到 的 日志 但是 如果 docker 容器 很多 的话 没有办法 区分 日志 具体 是 来自 哪个 容器 所以 为了 能够 在 elk 里 区分 日志 来源 需 要在 具体 的 docker 容器 上 做 一些 配置 接着 看下 面的 内容 docker 容器 设置 可以 给 具体 的 docker 容器 增加 labels 并且 设置 logging 参考 以下 设置 设置 增加 重新启动 应用 然后 访问 http 重新 添加 索引 查看 日志 可以 增加 过滤 条件 attrsservicedb 此时 查 看到 的 日志 就 全部 来自 db 容器 结果 如 下图 所示 参考 文章 采集 dockercontainer 日志 beats 详解 四 首发 地址 转 载于 