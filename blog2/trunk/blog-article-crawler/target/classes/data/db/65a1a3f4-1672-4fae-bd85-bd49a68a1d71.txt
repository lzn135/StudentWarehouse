mysql 是 怎么 解决 幻 读 的 mvcc 间隙 锁 mysql 的 默认 隔离 级 别是 rr 可 重 复读 网上 随便 一查 都 知道 rr 会 导致 幻 读 同一个 事务 里面 多次 查询 的 结果 不一致 可是 我 自己 测试 过后 发 现在 rr 下 并不 存在 幻 读 的 问题 哪 mysql 是 怎么 解决 幻 读 的 呢 有 两种 手段 mvcc 多 版本 控制 范围 锁 mvcc 每次 开启 事务 后 都会 递增 创建 一个 版本号 version 之后 的 增删 查 改 都是 基于 这个 版本号 进行 操作 的 select version 读取 创建 版本 小于 或 等于 当前 事务 版本号 并且 删除 版本 为 空 或 大于 当前 事务 版本号 的 记录 这样 可以 保证 在读 取 之前 记录 是 存在 的 createversion 将 当前 事务 的 版本号 保存 至行 的 创建 版本号 createversion 新 插入 一行 并以 当前 事务 的 版本号 作为 新 行 的 创建 版本号 同时 将 原 记录 行 的 删除 版本号 设置 为 当前 事务 版本号 新 行 旧 行 deleteversion 将 当前 事务 的 版本号 保存 至行 的 删除 版本号 例子 初始 数据表 名 当前 version 由于 id 的 createversion 小于 当前 version 所以 可以 查出来 插入 一条 数据 这时候 如果 上面 的 selct 事务 没 结束 继续 查询 的话 并不会 查询 到 id 的 数据 由于 新 插入 的 数据 createversion 大于 查询 的 version 这样 就 避免了 幻 读 的 情况 更新 一条 数据 如果 事务 在 update 之前 开启 如 version 那么 只能 看到 的 数据 那么 看到 的 数据 就是 update 前 的 间隙 锁 mysql 的 间隙 所是 基于 索引 的 对于 唯一 索引 innode 会把 间隙 所 降级 为 行 锁 非 唯一 索引 的话 就需要 用到 间隙 锁 也 叫 范围 锁 idnumber 事务 一 对于 number 索引 可以 分为 多个 范围 无穷小 无穷大 这时候 锁住 的 是 区间 对应 的 临界 记录 是 idnumber idnumber 对于 这 范围内 的 数据 都是 被 锁住 的 事务 二 insertintotest idnumber value 是 会被 阻塞 事务 三 insertintotest idnumber value 也是 会被 阻塞 事务 四 insertintotest idnumber value 也是 会被 阻塞 事务 五 insertintotest idnumber value 插入 成功 因为 gt 所以在 锁 区间 外 事务 六 insertintotest idnumber value 插入 成功 number 值 一样 但是 idgt 所以在 锁 区间 外 