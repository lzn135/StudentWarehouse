mysql 中 的 binlog binlog 文件 结构 mysql 的 binlog 文件 中 记录 的 是 对 数据库 的 各种 修改 操作 用来 表示 修改 操作 的 数据结构 是 logevent 不同 的 修改 操作 对应 的 不同 的 logevent 比较 常用 的 logevent 有 等 binlog 文件 的 内容 就是 各种 logevent 的 集合 binlog 文件 中 logevent 结构 如 下图 所示 binlog 写入 机制 binlog 写入 过程 大概 分为 以下 三步 根据 记录 模式 和 操作 触发 event 事件 生成 logevent 事件 触发 执行 机制 将 事务 执行 过程中 产生 logevent 写入 缓冲区 每个 事务 线程 都有 一个 缓冲区 logevent 保 存在 一个 binlogcachemngr 数据结构 中 在 该 结构 中有 两个 缓冲区 一个是 stmtcache 用于 存放 不支持 事务 的 信息 另 一个是 trxcache 用于 存放 支持 事务 的 信息 事务 在 提交 阶段 会将 产生 的 logevent 写入 到 外部 binlog 文件 中 不同 事务 以 串行 方式 将 logevent 写入 binlog 文件 中 所以 一个 事务 包含 的 logevent 信息 在 binlog 文件 中 是 连续 的 中间 不会 插入 其他 事务 的 logeventbinlog 文件 操作 binlog 状态 查看 默认 不 开启 sec 开启 binlog 功能 尝试 直接 设置 参数 hy 需要 修改 mycnf 或 myini 配置文件 在 mysqld 下面 增加 如下 内容 后 重启 相关 参数 binlog 文件名 及其 路径 的 配置 sec mysql 命令行 查看 binlog 文件 查看 目前 有 哪些 binlog 文件 sec sec 查看 目前 使用 的 是 哪个 binlog 文件 sec 查看 binlog 文件 中 记录 的 事件 系统 命令行 查看 binlog 文件 使用 binlog 恢复 数据 下面 演示 一个 删除 数据库 再到 恢复 数据库 的 过程 tom yjdept yjdept yjdept 恢复 数据库 命令行 操作 从上 面的 binlog 中找到 要 恢复 数据 的 起始 位置 和 结束 位置 查询 数据库 是否 已 恢复 还 可以 根据 时间段 来 恢复 数据 定期 期 全部 备份 数据库 数据 mysqlbinlog 可以 做 增量 备份 和 恢复 操作 删除 binlog 文件 删除 指定 文件 删除 指定 时间 之前 的 文件 resetmaster 清除 所有 文件 可以 通过 设置 expirelogsdays 参 数来 启动 自动 清理 功能 默认值 为 表示 没 启用 设置 为 表示 超出 天 binlog 文件 会 自动 删 除掉 和 binlog 区别 redolog 是 属于 innodb 引擎 功能 binlog 是 属于 mysqlserver 自带 功能 并且 是以 二进制 文件 记录 redolog 属于 物理 日志 记录 该 数据 页 更新 状态 内容 binlog 是 逻辑 日志 记录 更新过程 redolog 日志 是 循环 写 日志 空间 大小 是 固定 binlog 是 追加 写入 写完 一个 写下 一个 不会 覆盖 使用 redolog 作为 服务器 异常 宕机 后 事务 数据 自动 恢复 使用 binlog 可以 作为 主从复制 和 数据 恢复 使用 binlog 没有 自动 crashsafe 能力 