2014 乌云 安全 峰会 文字版 记录 转 自 cto 先 摘录 一些 我 认为 比较 精彩 的 部分 全文 在 下面 噢 猪猪 侠 就 如果 研究 用户 密码 设置 规则 的话 就 得上 大 数据 这里 我们 搜 集了 亿条 用户 和 用户 密码 我们 得 出了 这个 东西 我们 利用 大数 据统计 出了 多个 使用 的 最多 的 弱 口令 标 红色 的 是 top 中 国是 使用 英语 较少 的 国家 我们 可以 看到 前 位 全是 数字 再看 蓝色 标记 的 这个 很有 意思 这是 一个 多情 的 国家 我 还 对比 一下 我 的 更具 有 中国特色 我 这是 top 数字 使用 数据 在 整个 亿条 密码 中 使用 有 千 多 万 使用 的 有 千百 多 万 猪猪 侠 分析 这 亿 密码 可以 看到 密码 用 纯 数字 的 大概有 亿 就 占了 密码 全部 用 小写字母 当 密码 的 占了 密码 全是 大写 的 占了 用户名 和 密码 相同 的 也有 两千 多多 万 占了 密码 中 包 含了 一部分 用户名 的 也有 使用 top 口令 的 大概 占了 左右 口令 中含有 特殊 字符 的 占 猪猪 侠 这是 整个 整个 针对 使用 亿 密码 计算出来 的 结果 当 我们 分析 一些 密码 的 时候 往往 也 能够 得到 一个 规律 就是 我 根据 那些 亿条 密码 得出 的 结论 就是 大多数人 设置 密码 的 时候 都 会把 生日 加进去 还 会把 年份 加进去 比如 这个 密码 是 去年 设置 的 会把 年 加进去 还有 可能是 名字 加上 生日 做 技术员 的 会 转换 一下 还有 设 密码 的 时候 复杂度 有 要求 就要 有 数字 和 特殊符号 就会 加上 还有 键盘 布局 和 公司 相关 的 东西 补充 进去 还 有些 地方 要求 大小写 要么 就是 第一个 大写 要么 第一个 单词 大写 这样 或者 把 自己 姓名 的 第一个 首字母 大写 猪猪 侠 这是 我们 发现 频率 最高 的 密码 设置 方式 就可以 总 结成 这样 要么 是 用户名 加生 日用 户名 加 特定 字符 要么 是 用户名 加生 日中 文名 拼音 加生 日中 文名 拼音 加 拼音 猪猪 侠 根据 这些 规律 我们 实现 了 生成 密码 的 算法 可以 根据 你 这个 人 生成 一个 和你 有关 的 密码 大家 可以 看一下 这是 一个 分隔符 比如 很多人 会用 乌云 要么 乌云 这样 来 连接 后面 一些 特殊 常用 字符 就有 一次 我 在 微 博 上面 看到 李 铁军 他 教 别人 怎么 设置 密码 他 说 他 的 密码 一般 都是 在后 面会 加上 一堆 com 他 把 这个 方法 告诉 更 多人 更 多人 可能会 采用 这个 方法 所以 你 只需 要看 他们 怎么 设置 的 然后 把 它 变成 算法 自动 生成 出来 这是 处理 生日 的 一个 小 函数 我们 知道 日期 这个 东西 会有 前导 的 没有 前导 的话 是 有 前导 的话 是 猪猪 侠 就是 你 把 能够 考虑 的 细节 考虑 进 去就 生成 一个 专门 有 针对性 的 密码 脚本 有 了 生日 密码 算法 我们 发现 都是 中文名 我们 又有 一个 小 函数 就是 把 中文名 转成 拼音 然后 再把 你 拼音 的 名字 比如 姓 不 转成 拼音 把 你 的 名 取 前面 的 两个 开头 字母 这里 可以 看到 朱 猪猪 侠 整个 生成 别人 密码 的 过程 是 动态 生成 的 有人 会说 你 根本 不知道 我 的 名字 不知道 我 的 生日 是 没办法 知道 我 的 密码 的 在这里 的话 因为 互联 网上 已经 泄 漏了 亿 多条 用户 信息 我们 知道 所以 这里 可以 做一个 数据 接口 然后 给 扫描器 调用 给 算法 调用 这里是 我 做的 一个 案例 大家 可以 看一下 乌云 上 也 介绍 过 就是 你 只需 要在 这个 系统 上面 输入 一个 域名 然后 它 就会 返回 所有 与 这个 域 名为 结尾 的 所有人 的 信息 张 健 可能有 一些人 已经 知道 这个 事情 就是 最后 这一 条 一个 公司 破产 的 时候 它 宣称 丢 掉了 万个 用户 的 比特 币 和 万个 自己 的 比特 币 加起来 超过 亿 美金 这是 一个 非常 惊人 的 数字 张 健 第二 黑客 攻击 这个 案例 挺有 意思 这个 交易 所在 一年 四个月 的 时间内 被人 黑了 三次 每一次 黑 的 数量 都 挺大 第一次 是 万个 第二次 是 万千 个 第三次 是 万个 加起来 差不多 有 万个 而且 每次 黑 的 方式 不同 第一次 黑 的 托管商 第二次 闯入 帐户 通过 电子邮件 第三次 稍候 我 会讲 一下 张 健 刚才 我 问 大家 比特 币 价格 的 时候 不知道 有 几个人 查 了 它 价格 现在 人民币 不到 三千元 这个 交易所 很有 意思 它 第三次 被盗 的 时候 在 它 被盗 的 前一天 这个 交易所 创始 人在 qq 群 里 大量 出售 他 的 lr 和 bcorn 而 且说 要 多少 有 多少 张 健 所以说 很多人 怀疑 这是 监守自盗 因为 被 黑了 很 多次 不在乎 自 黑 一次 然后 彻底 关门 因为 我 一个 朋友 在 这个 事件 中 丢失 了 个 比特 币 所以 他 要求 我 一定 提下 这 个人 这个 人叫 周 彤 张 健 案例 三 攻击 服务 托管商 刚才 那个 交易所 第一次 被黑 是 黑了 它 的 托管商 这个 托管商 出 的 事 太多 其中 一个 跟 比特 币 有关 就是 超级 管理员 密码 泄露 因为 不费 工夫 就可以 更改 用户 的 密码 因为 他 是 一个 相当于 后台 客户 服务 的 帐号 被 泄露 这个 黑客 拿 到了 超级 管理员 权限 之后 就 扫描 所有 程序 最后 只 选择 了 攻陷 八台 张 健 就是 因为 这 八 台上 运 行了 比特 币 程序 也就是说 这个 黑客 就是 冲着 比特 币 来 的 这 八 台中 出现 了 这三个 人 就是 刚才 的 那家 交易所 还有 一个 矿石 它 应该是 排 第三 第四 的 还有 一个 比特 币 当时 的 首席 科学家 这个 人 居然 也 丢失 了 个 比特 币 所以 这个 事件 给 我们 的 启示 千万 不 要把 私钥 放在 云 平台 即使 你 没有问题 他 可能 黑 掉 你 的 上级 张 健 域名 劫持 这 也是 一个 挺 典型 的 案件 黑客 利用 公开 的 信息 获得了 这个 拥有 者 的 出生地点 和 母亲 婚前 姓名 说服 注册 商 交 出了 域名 和 控制权 进 而又 控制 了 他 的 电子邮件 最后 进入 他 在 一个 交易平台 的 帐户 然后 把 这个 交易平台 全部 侵 了 张 健 虽然 得逞 的 原因 因为 公开 的 这些 情况 可能 跟他 并没有 直接关系 但是 他 没有 开启 双边 验证 这是 一个 安全 上 的 漏洞 但是 这个 公司 也 挺有 故事 的 其实 这 里面 每个 公司 都 挺有 故事 的 这些 公司 的 创始人 也是 在 今年初 因为 洗钱 被 fbi 逮捕 了 现在 应该 还在 fbi 那儿 张 健 合适 这个 刚才 我 也 提 到了 这个 造成 的 丢失 不在少数 包括 最大 的 一个 丢失 事件 门头沟 那个 事件 万个 比特 币 有 部分 人 怀疑 私钥 是 管理 不善 就是 没有 备份 的 后果 是 灾难性 的 应该有 三四 个人 找过 我 其中 一个人 相当 典型 他 属于 本地 的 私钥 损 坏了 把 钱包 发给 我 问 能不能 恢复 说 恢复 的 钱 分 我 一 半张 健 我 经过 很 多次 尝试 后 真的 不能 恢复 所以 这样 的 情况 下不 管你 有 多少 资产 很快 就 丢 掉了 就是说 没人 能 花 这笔 钱 就是 它 永远 的 丢 掉了 其实 丢掉 这些 钱 让 比特 币 整体 的 数量 稍微 减 少了 一些 张 健 第二种 情况 就是 私钥 被盗 这个 也是 非常 普遍 的 可能 每个月 甚至 每周 都在 发生 这个 对 安全 性要求 非常 高 包括 企业 我们 公司 也 会 采用 冷 钱包 的 存储 架构 去做 这样 的 安全 防范 张 健 也就是说 因为 你 要用 比特 币 进行 支付 所以 你 必须 在 业务 的 层面 保证 有 一定 的 私钥 或者 有 一定 的 逼债 所以 你 不能 百分之百 冷 存储 所以 现在 很多 交易所 将 大部分 币 冷 存储 一旦 黑客 侵入 而且 侵入 的 级别 比 较深 拿到 这些 私钥 也 不会 损失 在 线下 冷 钱包 的 钱 这是 一个 现在 普遍 的 一个 架构 张 健 其实 交易 安全 风险 比特 币 还是 做的 非常好 这 也是 比特 币 安全性 一方面 叫 双 发 攻击 因为 比特 币 是 pp 的 架构 什么意思 呢 就是 每 花 一笔 钱 这笔 交易 是 通过 这个 结点 性质 广播 给 全网 就是说 全网 不同 节点 接受 这个 交易 的 节点 时间 是 不同 的 所以有 可能 你 可能 同时 广播 两个 交易 一个 交易 是 发给 交易 的 商家 另一个 交易 是 发给 自己 通过 不同 的 节点 广播 一旦 出现 了 假如说 你 又 同时 掌握 了 比 较大 的 算 例 张 健 你 就可以 通过 自己 的 算 例 优先 确认 你 广播 发给 自己 的 这笔 交易 而 推翻 发给 商家 的 那笔 交易 所以 商家 会 误认为 收到 这笔 钱 但是 后来 事实上 这笔 钱 消失 了 这 就是 双 发 攻击 避免 这个 攻击 的 方法 非常 非常 简 单张 健 因为 这个 攻击 的 成本 非常 之高 所以说 只 要在 发送 大额 交易 的 时候 比如说 几千个 或者 上万 个 等待 足 够多 的 确认 数量 就可以 避免 这个 攻击 因为 攻击 程度 概率 随 确认 数量 的 增加 呈 指数 级 下降 的 张 健 谈到 比特 币 私钥 容易 被盗 它 的 脆弱 性问题 其实 所有人 都 认识到 这个 问题 包括 比特 币 核心 开发 团队 所以 在年 采访 中 比特 币 首席 科学家 说 正在 添加 一个 新 的 特性 这个 特性 可以 降低 比特 币 钱包 受到 攻击 后 的 脆弱性 这个 特性 叫 多重 签名 交易 张 健 什么意思 呢 简单 讲 一下 就是 传统 的 私钥 被盗 相当于 这个 地址 商 的 钱 全部 被人 拿走 但是 通过 多重 签名 交易 生成 就是 多个 私钥 共同 生成 这个 地址 然后 有 m 个 私钥 签名 这个 地址 上 的 交易 然后 m 和 n 都可以 自定义 只要 m 小于 n 就可以 这就 造成了 安全 方面 的 特性 张 健 不仅 仅对 存储 还有 交易 就是 对 不同 的 角色 赋予 不同 的 私钥 保证 比特 币 本身 的 安全性 比特 币 第一次 从 技术 层 面上 实现 了 真正 的 可执行 的 担保 交易 比如说 支付宝 的 担保 交易 它是 用 支付宝 信誉 担保 的 买卖双方 都 相信 支付宝 平台 但是 通过 多重 签名 技术 步入 说 三把 私钥 生成 一个 地址 只要 其中 两把 私钥 同意 才 能动 这个 私钥 的 钱 gainover 就这样 完 了吗 当然 不止 这些 危害 这个 不仅仅是 个 漏洞 这是 我 年月 号 我 在 漏洞 下面 做的 一个 评论 我 是 这么 说的 问题 很 隐蔽 这个 开发人员 肯定是 注意 不到 的 只 要是 有 这么 用 的 估计 都会 存在 问题 这是 当时 我 在 漏洞 下面 做的 评论 gainover 后来 的话 我 看 还 存在 哪些 问题 我们 看一下 乌云 已经 公开 的 案例 实际上 这三个 漏洞 的话 与我 多少 都 有点 关系 不管是 马甲 还是 间接 报告 还是 怎么样 的 实际上 我 发了 这个 之后 还是 没有 引起 太多 各大 企业 的 注意 第一 全部 博客 可 留 后门 gainover 你 只要 你 是 新浪 博客 用户 不管 你 以后 访问 新浪 博客 任意 文件 都会 执行 我 这个 恶意代码 的 第二个 淘宝 支付宝 的 这个 叫 一个 可大 规模 悄无声息 窃取 淘宝 支付宝 帐号 的 这个 标题 看起来 很大 但是 实际上 一点 都不 危言耸听 的 gainover 这些 企业 不知道 自查 周期 比 较长 还是 怎么样 的 同样 的 漏洞 在 阿里 云 服务 上 一样 存在 的 后来 也 被 报告 修复 了 现在 我 看了 一下 淘宝 相关 的 页 面上 同等 类型 漏洞 都 已经 做了 相应 保护措施 了 他们 已经 意识到 这个 漏洞 危害 的 严重性 了 gainover 其实 我 今天 给 大家 讲 的 就是说 漏洞 这块 东西 就 说到 这里 我 标题 还有 后半 部分 叫 xss 僵尸 网络 这个 东西 敢 这么说 的话 是 有 一定 漏洞 基础 的 是因为 这个 漏洞 本身 特点 决定 它是 可以 用来 做 这个 东西 的 首先 隐蔽性 gainover 为什么 说它 隐蔽 这个 漏洞 本身 特点 你 想想 对于 一个 用户 来说 可能 很多 用户 对 钓鱼 网站 网址 都 分不清楚 的 你 让 他 在 页面 来看 原代码 看 它 上面 是不是 存在 恶意代码 这是 根本 没可能 的 gainover 第二个 传统 的 杀毒软件 它是 很难 去 防 这类 攻击 的 这个 东西 对于 软件 来说 至少 很难 有 办法 去 区分 是 xss 还是 这个 网站 本身 的 所 以对 用户 这一 层 的话 用户 是 很难 去 发觉 他们 是 已经 中招 的 了 gainover 哪怕 我 自己 搞 这方 面的 如果 不 专门 看 的话 我 自己 很难 察觉 所以 我 也 自己 也 很 担心 这类 漏洞 这个 对 厂商 来说 这与 传统 的 漏洞 不太 一样 的 传统 的 是 在 页面 里 插 一段 代码 你 接到 报告 说 这个 页面 有 问题 厂商 查 的话 发现 这里 黑客 插 了 一段 代码 gainover 但是 对 xss 来说 这个 漏洞 是 存在 用户 电脑 本地 存储 上 的 用户 觉得 页面 有 问题 让 厂商 去 查 厂商 去看 页面 完全 没有 任何问题 然后就 不再 过去了 这样 的话 不管是 最 用户 还是 厂商 来说 这种 类型 的 漏洞 隐蔽性 是 特别 好 的 gainover 第二个 持久性 这是 一个 长期存在 用户 电脑 上 的 这个 漏洞 原理 也是 发过 的 大家 可以 看看 它用 flash 本地 存储 如果 你 不是 自己 去 清 flashcookies 的话 是 很难 清掉 的 gainover 我 记得 软件 flashcookies 是 勾上 的 以前 我 看 安全卫士 软件 的话 flas shcookies 是 不 勾上 的 就是 用户 清理 垃圾 什么的 不会 清理 掉 这些 垃圾 这样 的话 这个 东西 就是在 用户 电脑 上 长期存在 gainover 另外 的话 那些 软件 去 来 清理 这些 东西 它 就是 找到 浏览器 默认 的 flashcookies 存放 目录 对 它 清除 我 现在 不知道 第三方 有没有 清除 这个 如果 没有 我 建议 以后 可以 做上 如果 没有 的话 这个 后果 很严重 的 按照 我 前面 演示 如果 这次 没有打开 网页 或者 qq 空间 不会 被 窃取 但 总有一天 你 会被 窃取 gainover 第三 流量 大 大家 可以 看到 这种 类型 的 漏洞 影响 到了 基本上 是 全国 所有 视频 网站 当然 有些 网站 没有用 那个 代码 的话 就 没有 gainover 第二个 电 商 类 的 也是 受影响 的 虽然 现在 都 修 了 第三个 新浪 微 博 也是 受影响 的 这 也是 大 流量 的 社交 网站 所以说 这个 受影响 的 用户量 是 非常大 的 gainover 其次 用户 页面 时间 停留 长 大家 可以 看到 特别是 对于 视频 网站 来 说它 的 用户 基本上 都在 看 视频 一个 小时 两个 小时 恶意代码 就会 在那里 被执行 一个 小时 两个 小时 这样 黑客 利用 代码 可以获得 很长 执行时间 的 这 为 后面 的 攻击 是 能够 提供 很大 的 帮助 的 gainover 最后 基于 这些 特点 的话 这 跟 前面 原理 差不多 的 我们 可以 看到 黑客 首先 做一个 感染 阶段 它 首 先找 一些 比较好 入侵 的 或者 有 漏洞 的 中小型 的 网站 去 入侵 入侵 了 之后 就在 里面 插入 这样 一个 xss 代码 因为 这些 中小型 网站 它在 上面 用户 cookies 有 什么用 啊 一点 用 没有 所以 黑客 不会 偷 这个 它 的 目的 是 植入 后续 的 xss 接着 这些 flashxss 在 感染 到 足够 用户数量 之后 我们 可以 让 flashxss 执行 黑客 的 操作 最 简单 的 就是 信息 窃取 当 感染 数量 达到 一百万 的 时候 我 假设 里面 只有 的 用户 比方说 他 先看 qq 空间 再看 网站 的话 就会 有 一万人 的 数据 窃取 这 可能 只是 一天 的 数据 如果是 一个月 呢 一年 呢 gainover 因为 这个 漏洞 不宜 被 发现 不易 被 清理 所以 这个 积累 到 一年 的话 危害 是 非常大 的 而且 这些 受害者 在看 视频 的 时候 他 的 浏览器 可以 被 黑客 做 一些 事情 的 当然 这个 还会 有 其他 的 利用 方式 这个 就要 发挥 想象力 了 所以 我 这里 总 结了 一下 这种 类型 的 做 僵尸 网络 的话 首先 感染 阶段 然后 是 执行 阶段 从 危害 上来 说 的话 我 觉得 影响 几乎 全国 所有 网站 的 下面 可以 进行 提问 剑心 总结 起来 我们 知道 国内安全 最大 的 问题 不是说 我们 技术 有 多 差 或者 什么 是 环境 问题 环境 问题 总结 起来 就是 封闭 的 问题 所以 在座 的 了解 到 说 这个 技术 我 不能说 那个 企业 说 这个 事 不能 对外 说 说了 怎么样 这 才是 真正 阻止 我们 的 安全 环境 的 一个 根本问题 乌云 一直以来 大概 四年 以来 一直 以 开放 的 思路 做 安全 核心 的 法 就是说 让 社区 能够 通过 开放 的 方式 成长 也 很 高兴 今天 看到了 岁 的 白 帽子 得有 一个 好 的 社区 让 他 学习 引导 他 剑心 我 觉得 是 用 开放 的 思路 做 社区 还有 我 觉得 很多 企业 企业 是 最让人 头疼 以前 大家 认为 第一时间 不 会说 为什么 不 会说 因为 一个 企业 如果 出了 安全问题 一 定是 安全 工程师 最先 知道 他 不会 反 馈给 领导 他 的 领导 不会 反 馈给 公司 决策层 所以 整个 企业 看起来 一片 太平 但是 我们 知道 安全 包括 今天 这么多 议题 我们 可以 看到 我们 的 安全 滥 到 什么 程度 剑心 对 用户 也 一样 我们 希望 以 开放 的 思路 在 安全 上好 好做 一做 今天 峰会 也是 这个 思路 峰会 上午 是 白 帽子 的 专场 下午 是 企业 我们 也 看出 这 很 符合实际 上午 大家 很 自由 下午 慢慢 有点 拘泥 了 就是 总是 不 止痒 的 感觉 如果 乌云 通过 这个 峰会 有 一个 改变 看到 下午 有 很多 人在 这儿 挖 人我 挺 反感 这个 事情 的 我 看到 很 多好 的人 去了 阿里巴巴 在 网上 不说话 了 这个 id 不 活跃 了 一到 企业 里 去 可能 被 非技术 人员 就 给 限制 了 我 觉得 这是 很 不好 的 而且 企业 分享 的 时候 会有 一些 当然 这 不能 怪 企业 本身 它 的 立场 是 对 的 但是 我们 不 希望 这样 的 方式 出现 即使 出现 大家 也是 买过 票 的 剑心 核心 的 意思 希望 大家 一起 包括 社区 白 帽子 乌云 企业 一起 把 这个 事情 做的 更 开放 一些 长久 一些 而 不是 把 两边 人 挖走 cto 直播 小组 乌云 安全 峰会 即将 开始 敬请期待 主持 人我 叫 肉 肉 我 和 大家 一样 也是 乌云 的 白 帽子 我 是 第一次 做 主持 所以 你们 不 要对 我 要求 太高 首先 感谢 大家 对 乌云 峰会 的 支持 这是 乌云 第一次 举办 大型活动 之前 有 很多 我 听 多 很多 小伙伴 问 乌云 怎么 没有 线下 活动 因为 太忙 了嘛 主持人 这是 第一次 以后 会经 常有 的 因为 是 第一次 活动 虽然 很 用 心地 去 准备 但是 没有经验 时间 上面 可能 有些 匆忙 所以 准备 的 可能 还 有点 不足 还望 大家 多 谅解 这样 的 情况下 我 知 道白 帽子 是 赠票 活动 虽然 要求 高 但是 很 值 因为 咱们 门票 在 一周 时间 抢购一空 主持人 今天 到场 的 应该是 三百 多人 有 一百 多 个人 是 专门 从 外地 赶过来 的 经常 有人 给我 晒 机票 门票 的 我 在这里 代表 乌云 对 各位 的 到来 表示 热烈 的 欢迎 主持人 感谢 大家 这次 峰会 没有 安排 任何 商业化 议题 这是 对 大家 的 尊重 我们 这次 的 议题 有 十一个 可能 你 会 听到 很多 干货 这次 以 有 第一次 登台 演讲 的 嘉宾 我 相信 他们 的 表现 不会 让 你们 失望 的 主持人 因为 有 很多人 想要 过来 但是 因为 没 有票 所以 很 遗憾 不过 我们 也 准备 了 互动 屏 不管 在 场内 还是 场外 都可以 参与 的 地址 在 屏幕 上面 可以 通过 手机 和 电脑 访问 主持 人在 会议 开始 之前 我 得 提醒 大家 一下 这是 黑客 的 聚会 大家 知道 黑客 的 聚会 可能 有点 危险 的 我 不知道 有 没有人 注意 到外 面的 易拉宝 上面 写着 熊出没 估计 你们 都 忽略 了 所以 今天 上网 要 格外 小心 一点 哦 主持人 会议 开始 前 我们 先看 一个 短片 主持人 这 短片 大家 应该能 看出来 是 对 乌云 的 介绍 之前 我 统计 了 一下 数据 乌云 从 年月日 有 了 第一个 注册 用户 现在 白 帽子 数量 是 个 注册 厂商 个 这一 路 走来 有 很多 艰辛 感谢 大家 一路 的 陪伴 主持人 这个 短片 可能 有点 太 匆忙 了 还不 能让 大家 深入 地 了解 乌云 如果 想 了解 乌云 就是在 网上 活跃 一点 还有 今天 今天 乌云 第一 运营官 疯狗 会在 接下来 的 第一个 议 题中 给 大家 介绍 一下 乌云 讲讲 乌云 的 成长 还有 它 一些 理念 上 的 还有 从 乌云 上 沉淀 出来 的 东西 分享 给 大家 主持人 请 大家 欢迎 乌云 主 站 负责人 疯狗 乌云 主 站 负责人 因为 肉 肉 平时 跟 我们 不是 这样 的 面对 我们 几个 想说 什么 说什么 但是 今天 到场 嘉宾 太 多了 看起来 非常 非常 紧张 所以 希望 大家 理解 乌云 主 站 负责 人我 也是 看到 这么 多人 非常 非常感谢 大家 因为 我 也是 参 加过 这样 的 会议 感到 很正常 了 但是 我们 自己 乌云 峰会 的 时候 心里 倒是 很 忐忑 乌云 主 站 负责人 今天 到场 的 嘉宾 主 要是 互联网 企业 还有 互联网 媒体 再有 就是 平 台上 的 白 帽子 还有 一个 特殊 的 群体 我 也是 昨 天才 知道 的 还有 一个 叫 白 帽子 的 家长 们 乌云 主 站 负责人 现在 计算机技术 还有 网络 普及 的 非常快 很多 的 学生 接触 互联网 非常 非常 早 的 新一代 做 安全 网络 的 非常 小 还未 成年 所以 有的 小白 帽 家里 不放心 说 你 自己 大老远 跑 帝 都很 混乱 的 地方 不放心 所以 爸爸妈妈 陪着 过 来了 我 想 对 各位 家长 说 你们 的 孩子 很 优秀 他们 也 会是 中国 未来 互联网 强大 核心 的 力量 乌云 主 站 负责人 大家 知道 乌云 是 第三方 机构 大家 可以 看到 今天 很 应景 白 帽子 会 分享 安全 研究 的 心得 企业 也 会 分享 一些 防守 防护 的 经验 也是 双方 的 经验 与 智慧 的 碰撞 我 也 相信 今天 的 白 帽子 身价 也 会 飙升 三倍 企业 演讲 之后 也 会 吸引 有 场下 白 帽子 的 加入 一切 皆有 可能 乌云 主 站 负责人 首先 我 还是 自我介绍 一下 我 的 网络 id 也 就是 乌云 上 的 昵称 叫 疯狗 这 起了 很 久了 也 没什么 意义 就是 一个 代号 我 研究 安全 也是 蛮 久 的 了 我 有 十 余年 经验 乌云 主 站 负责人 这 十 余年 并不是 向 大家 炫耀 我 的 技术 多么 多么 而是 我 真的很 热爱 这个 行业 我 相信 今天 在座 的人 把 网络安全 信息 安全 目前 或者 曾经是 自己 非常重要 的 一部分 乌云 主 站 负责人 插 一句 除了 上面 的 介绍 外 我 不知道 是不是 只有 我 一个 人我 是 唯一 把 乌云 公开 漏洞 的 都 看了 的人 乌云 主 站 负责人 四 年前 的 夏天 几个 小伙伴 对外 正式 地 公布 了 乌云 漏洞 报告 平台 黑客 圈 或者 中国 安全 网络 圈 有 一些 老前辈 后来 也是 找到 我们 说 其实 我们 也 想做 这样 的 平台 但是 被 你们 先 走了 一步 这样 也就是说 乌云 或者说 第三方 漏洞 报告 平台 就是 由 我们 这 一帮 年轻人 营运 担负 了 很多 期望 和 责任 在 肩上 乌云 主 站 负责人 今天 也 希望 用 你好 路人甲 做 话题 因为 开始 登录 乌云 的 时候 都没有 帐号 在 没有 获得 帐号 之前 我们 都统 称为 路人甲 所以 很多 新 加入 我们 都 当做 路人甲 所以 我 希望 以 这样 的 文化 开始 今天 的 简单 的 乌云 的 介绍 乌云 主 站 负责人 很多 加入 乌云 的 都会 误会 我们 因为 我们 是 没有 甲方 工作经验 的 就 办了 这个 平台 其实 我 想说 的 是 我们 甲方 经验 还是 很多 的 我们 在 甲方 工 作了 很 多年 发现了 种种 弊端 才 出来 做 这个 平台 的 乌云 主 站 负责人 我们 做的 过程中 发现了 什么问题 呢 我 以前 在 新浪网 工作 除了 日常 的 发掘 自己 的 漏洞 做 防御 体系 等 等外 还有 一个 重要 的 事情 我 相信 在座 的 很多 比如 新 参与 工作 的 一些 安全 从业者 们 是 没有 经历过 的 是什么 呢 乌云 主 站 负责人 我们 每天 还有 项 重要 的 工作 就是 去看 这些 白 帽子 可能 当时 叫 黑客 或者 研究者 的 博客 因为 他们 会 公开 一些 漏洞 信息 而且 是 在 没有 修复 的 情况下 人人 看到 之后 都 会去 利用 乌云 主 站 负责人 所以 我们 天天 还要 扫 各种 rs 看看 大家 有没有 报告 我们 的 漏洞 报 告了 赶紧 应急 我们 觉得 这种 模式 或者 现状 体现 了 一个 问题 我们 深入研究 了 这些 人心 理 他们 有时候 也 并不是 很 恶意 的 他们 也 想说 我 发现 一个 问题 我 希望 反 馈给 厂商 得到 厂商 的 重视 同时 我 的 技术 也 在 业界 得到 反响 交 更好 的 朋友 技术 得到 更好 的 提升 乌云 主 站 负责人 但是 那种 环境 没有 乌云 的 平台 所以 大家 选择 了 这种 不太 友善 的 方式 所以 我们 觉得 做 乌云 的 平台 漏洞 的 信息 在 它有 影响 的 时候 我们 报告给 厂商 厂商 解决 后 我们 会 公开 细节 让你在 圈子里 能 分享 你 的 想法 结交 更多 的 朋友 乌云 主 站 负责人 还有 一个 安全 群 太 封闭 大家 也 知道 安全 技术 或者说 黑客技术 稍微 走 偏 一点 可能 通过 非法手段 牟取暴利 的 方式 一种 手段 其实 这个 不得不 承认 现在 国内 特别 特别 的 普遍 因为 它是 牟利 的 手段 攻击者 就不 希望 让 其他人 跟 自己 争利 也 不 希望 让 企业 知道 有 哪些 缺陷 封堵 掉 而是 长期 循环 乌云 主 站 负责人 所以 攻击 的 手段 永远 走在 我们 前面 而 我们 对 黑 产 一无所知 乌云 一直 强调 说 我们 要把 细节 公开 其实 也是 希望 让 大家 看到 系统安全 到底 是什么 样子 我们 做着 做着 就 发现了 很 层次 的 意义 我们 发现 受益 越来越 大我 让 安全 研究人员 通过 这个 平台 学到 其他人 的 技术 和 技 能让 安全 研究人员 互相 认识 也 能 获得 更高 荣誉 的 机会 也 让 企业 了解 到 自己 一个 真实 的 安全 的 现状 同时 我们 也 让 普通用户 如何 才能 保护 自己 现在 的 问题 都会 出现在 哪里 乌云 主 站 负责人 所以 我们 是 帮 企业 完 成了 正像 循环 白 帽子 提供 安全漏洞 企业 披露 安全问题 用户 了解 到 这些 安全问题 信息 对 企业 提出 安全 需求 企业 加强 自身 的 安全 建设 和 重视 白 帽子 价值 更多 的 白 帽子 会 加入到 这么 一个 流程 让 这个 循环 越 走 越大 创造 更多 的 价值 乌云 主 站 负责人 刚才 肉 肉 也 提 到了 乌云 上有 很多 很多 的 企业 我 这里 简单 截 取了 一些 说明 我们 乌云 为 哪些 企业 提供 漏洞 信息 报告 服务 的 乌云 主 站 负责人 厂商 我 只是 随 随便 取了 一下 乌云 第一页 第二 页 的 企业 其实 我们 覆盖 非常 非常 广 有 互联网 媒体 网络 的 金融 电子商务 社交 平台 视频 分享 移动 营运 还有 软件 开发商 甚至 说 安全 服务商 等等等等 可以说 覆 盖了 整个 中国 互联网 网络 我们 就是 为 这样 的 企业 提供 漏洞 信息 报告 的 服务 乌云 主 站 负责人 刚才 肉 肉 也 说了 乌云 上有 很多 厂商 大家 现在 可以 看到 的 大概有 多家 这些 厂商 都是 我 刚才 提到 的 这些 性质 的 企业 还有 一些 看不到 的 它们 是 地方 的 信息 站点 传统 的 行业 这些 我们 就 没有 去 显示 我 说 这 五百家 的 企业 注册 是 这个 数字 的 三倍 乌云 主 站 负责人 不能说 几乎 现在 也是 已经 覆 盖了 整个 中国 互联网 企业 这是 一个 活跃 的 白 帽子 数量 还有 一些 白 帽子 活跃 在 乌云 的 其他 平台 像 内容 分享 平台 上等 实际上 注册 数量 是 这个 数字 的 六倍 多 乌云 主 站 负责人 而且 这些 白 帽子 来源 他们 的 角色 个人身份 都 千奇百怪 首先 有 专业 的 安全 人员 还有 学生 医生 博士 教师 安 防 人员 企业 策划 等等 他们 来自 各个领域 但是 他们 有 一个 共同点 对 安全 充满了 兴趣 非常 非常 喜欢 就是 这样 一批 人 集中 在一起 形 成了 现在 乌云 白 帽子 的 群体 乌云 主 站 负责人 目前 乌云 已经 接 到了 七万五千家 的 漏洞 报告 的 数量 但是 这个 数量 还在 飞速 地 上涨 中 我 只是 取了 一下 前 阵子 我 统计 出 的 结果 其实 这些 漏洞 对 乌云 对 企业 对白 帽子 来说 都是 无形 的 财富 几乎 所有 都有 覆盖 我 想不到 还有 什么 没有 报告 提交 的 乌云 主 站 负责人 所以 乌云 接下来 要做 的 也是 积极 分析 这些 漏洞 报告 中有 价值 的 信息反馈 给 各个 渠道 像 企业 用户 甚至 白 帽子 媒体 等等等等 乌云 主 站 负责人 大家 也 会看 到过 各种各样 的 漏洞 风险 的 统计图 其实 这种 也 确实 很有 意义 大家 可以 从中 得到 一些 辅助 的 参考 作用 乌云 的 风险 统计图 是 非常 非常 有价值 它 的 价值 在 哪里 它 的 统计 是以 实际 发生 案例 统计 出来 的 并不是 我们 拍 脑袋 共享 出来 的 或者 通过 数据 计算出来 我们 就是 通过 切实 发生 的 案例 来 统计 的 乌云 主 站 负责人 这个 风险 统计图 我们 认为是 当今 互联网 一个 真正 的 现状 可以 看到 前 五条 基本 都是 安全 运 维 还有 管 理上 的 最终 撞 库 太多 太多 很好 地 体 现像 好莱坞 的 艳照 门 这 都能 体现 出来 这是 现在 最广 也是 我们 迫切 解决 的 问题 而且 安全 的 影响 也 从 传统 的 开发者 慢慢 转移 到了 安全 的 运 维 者 和 管理者 上面 有 这么 一个 转变 乌云 主 站 负责人 乌云 在这 四年 的 运营 当中 也是 见 过了 很多 的 漏洞 我们 也 产 生了 漏洞 的 非常 中肯 的 评估 方案 这个 都在 乌云 的 安全 中心 大家 可以 去 查看 这也 会是 我们 今后 向 外界 输出 的 重点 乌云 主 站 负责人 我们 首先 认为 漏洞 有 两个方面 具体 的 影响 第一 威胁 的 角色 是 谁 一个 难度 怎么样 是不是 很 容易 被人 重现 说 这个 世界上 一个人 能 利用 还是 世界上 一万 个人 能 利用 还有 一个 就是 数据 的 影响 乌云 主 站 负责人 就是 这个 漏洞 具体 影响到 我们 业务 比较 敏感 信息 就是 这个 数据 的 范围 多大 还有 这个 系统 的 重要性 看似 很简单 这都是 乌云 这 四 年来 慢慢 沉淀 分析 下来 的 也 跟 曾经 的 安全 机构 组织 所说 的 理念 有 不同 的 地方 乌云 主 站 负责人 我们 乌云 的 想法 我们 想把 安全 圈子 变成 什么 样子 大家 都 知道 有 soho 工作 的 模式 就是在 家里 工作 我 想 我们 乌云 叫 乌 ho 我 觉得 大理 非常 安逸 空气 都很 安逸 你 稍微 积极 一些 都不 被人 接受 这是 非常 舒服 的 地方 像我 真 辞去 一 切去 那儿 待 一阵子 大家 知道 这个 在 国内 很不 现 实在 国内 国民 生活 压力 很大 的 我们 不能 放弃 一些 东 西去 追寻 我们 理想国 这种 状态 所以 我们 就 希望 能把 乌云 起码 在 白 帽子 领域 做到 什么 呢 乌云 主 站 负责人 我们 可以 游山玩水 去 哪里 玩儿 就去 哪里 玩儿 没钱 了 打开 电脑 只用 不到 一个 小时 的 时间 参与 了 一些 项目 可能 拿到 一个月 的 开销 我 就可以 轻轻松松 去做 一些 想要 的 生活 很 理想 但 这说明 了 我们 的 理想 和 目的 乌云 主 站 负责人 很多 企业 跟 我们 说 我们 报告 平台 是 被动 的 搜集 平台 但有 时候 我 想 主 动地 杜绝 我 的 信息 安全 风险 比如 一个 重要 的 产品 上线 我 想 主 动地 知道 我 面临 的 风险 并且 告知 我 怎么 修复 这 就是 我们 的 理念 主动 为 企业 提供 安全 的 服务 乌云 主 站 负责人 另外 也 希望 给 白 帽子 一个 合法收入 的 机会 因为 现 在做 黑色 产业 的人 非常 非常 多 他们 真想 这么做 吗 也是 被 社 会被 生活 所 逼迫 我 敢 打赌 如果有 一个 合理 的 收入 没有人 愿意 赚 这个 黑钱 所以 我 希望 这样 能让 白 帽子 从一 个 合理 的 方向 去 赚取 自己 应得 的 报酬 乌云 主 站 负责人 很多 白 帽子 还会 问 很多 新来 或者 老 白 帽 或者 还 不是 白 帽子 想 成为 白 帽子 的 来到 乌云 能 得到 什么 乌云 主 站 负责 人我 觉得 大家 可以 在上面 用 一个 合法 的 渠道 能 谋取 一些 合法 的 收入 同时 还 能以 一个 正确 的 渠道 展现 自己 也 能 得到 思想 比较 开放 前卫 的 企业 认可 还 可以 认识 朋友 通过 交流 得到 提升 我们 的 目标 想法 就是 这么 简单 这都是 说的 很 实际 的 一些 乌云 主 站 负责人 上面 我 介绍 了 一下 乌云 过去 现在 将来 的 大致 方向 接下来 我 还是 把 时间 交给 顶尖 的 白 帽子 和 企业 让 他们 来 与 大家 分享 乌云 主 站 负责人 刚才 肉 肉 提到 场外 有熊 出没 注意 的 牌子 这个 想说 在 现在 的 环境 手机 等 通信 都是 不安全 的 但是 我们 通过 报道 和 比较 虚 的 东西 让 大家 看到 这个 我们 觉得很 不可靠 所以 我们 想在 现场 做一个 互动 让 大家 亲身 参与 其中 是 怎样 的 惊心动魄 的 体验 这样 我 想 大家 会 更 刻骨铭心 一些 乌云 主 站 负责人 大家 知道 海底 捞 是 很 著名 的 火锅 饭店 其实 一个 火锅 你 一 筷子 下 去也 不知道 捞出 什么 我们 场 里 捞 其实 能 捞到 什么 我 也 不知道 乌云 向 大家 保证 如果 你 对 测试 的 行为 敏感 或者 反感 请注意 你们 的 平板 电脑 手机 之类 的 不要 传递 敏感 信息 大部分 数据 我们 还是 会 马赛克 给 大家 盖住 的 重在 参与 乌云 主 站 负责人 最后 如果 在场 的 嘉宾 需要 帮助 的话 我 可以 在 现场 对 大家 进行 支援 也 可以 在 屏幕 上 反馈 一些问题 我们 工作人员 会 帮助 大家 处理 之后 我们 的 平时 工作 交 流上 的 可以 通过 qq 和 邮箱 我 主要 从事 乌云 报告 平台 运 维 工作 谢谢 大家 主持人 谢 狗 哥 介绍 听完 之后 我 相信 对 乌云 不怎么 了解 的 也有 了 一定 的 认识 狗 哥 在上面 总结 乌云 风险 统计图 现在 风险 标准 挺多 但是 最适合 咱们 的 可能 还得 是 从 乌云 上面 沉淀 下来 的 所以 在座 的 企业 朋友 也 可以 回去 思考 一下 自己 什么地方 没 做好 的 还需要 再 改进 一下 的 主持人 接下来 进入 正式 议题 第 一个是 关于 智能家居 的 智能家居 我 记得 提出 的 时候 就 已经在 两 年前 开始 提 出了 但是 真 正火 起来 的话 也 就是 这一段 时间 一个 东西 火 起来 的 时候 很多人 会 好奇 有些人 好奇 它 怎么 用 有些人 可能 想着 怎么做 还有 的人 好 奇点 就是 这个 东 西安 不安全 我们 乌云 一个 小伙伴 对 智能家居 方面 很 着迷 他 就是 乌云 的 白 帽子 liverslivers 大家好 第一次 和 大家 见面 心情 非常 紧张 我 先说 一下 我 自己 我 之前 主要 专业 还是 搞 web 的 我 一直 做 乙方 的 工作 大约是 两 年前 业余 的 时候 开始 研究 一些 可编程 的 路由器 就 一发而不可收拾 特别 喜欢 智 能上 的 设备 但是 研究 的 也 不够 多 大家 知道 后来 替补 上来 的 有 一些 东西 没准 备好 时间 太 匆忙 如果 后面 有 讲 的 不好 的 地方请 大家 多多 谅解 livers 这里 先给 大家 看 一个 视频 这是 一款 智能 插座 它有 一个 手机 控 制单 可以 控制 开关 但是 我 发现了 它 的 协议 发现 里面 是 有 问题 的 所以 我 就用 就 简单 地 模 拟了 一下 它 的 收发 这两个 是 在 同一个 网络 上 的 就是 家里 远程 可以 控制 我 的 插座 livers 我 先 介绍 一下 背景 可能 有些人 对 智能家居 还 不是 很 了解 智能家居 很早 就 进入 中国市场 了 大约有 十年 的 时间 了 但 一直 不温不火 直到 这两年 才 突然 一下子 迸发 出来 而且 出现 了 不少 比较 好玩儿 的 事 以前 都是 智能家居 成套 的 系统 现在 有 一些 智能家居 的 单体 像 之前 出了 一些 智能 路由器 还有 一些 智能 的 插座 深受 极 客 的 喜爱 销量 非常 火 livers 但是 纵观 全局 来看 传统 的 智能家居 占有 非常大 的 市场份额 我 相信 未来 肯定 会有 越来越多 的 智能家居 的 产品 出现 它 形态 也 会 越来越 丰富 我 也 很 期待 livers 我 简单 介绍 一下 智能家居 整体 框架 大家 可以 看到 它 中间 有 一个中心 的 部分 叫 中 控 梯 它 相当于 枢纽 它 控制 了 视频 开关 还有 红外 的 一些 装置 还有 基于 wifi 的 装置 它会 和 路由器 进行 交互 再 通过 手机 终端 或者 电脑 来 控制 livers 但是 按照 目前 的 形式 渐渐 的 觉得 中 控 梯 太 臃肿 就把 中 控 梯 和 路由器 做到 一块 小米 马上 就上 一些 把 网关 和 路由器 结合 卖 的 路由器 livers 但是 我 是 觉得 它们 太 过于 追求 创新 技术上 的 一些 创新 对于 产品 的 安全性 考虑 的 不太 周到 出现 了 一些 安全问题 按照 剑心 的 要求 他 让 我 写 一个 技术 框架 就 整 理了 一套 把 之前 做的 经验 整理出来 livers 智能家居 我 这边 研究 的 主 要是 两大块 一块 智能 路由器 这 部分 另一 块 智能家居 的 配件 路由器 这 部分 我 主 要是 从 它 的 固件 web 接口 和 云端 的 交互 等 去 研究 的 配件 我 主要 分析 了 它 的 通信协议 还有 客户端 包括 它 的 云端 控制 当然 很 普通 的 例子 就不 讲了 我 讲 一些 我 碰到 的 坑 儿 比较 好玩儿 的 事 livers 可能 有些 智能 设备 的 厂商 防止 代码 不被 外漏 或者 保护 的 作用 它 会把 自己 的 固件 做 加密 这里 我 看到了 智能 路由器 我 下载 了 它 的 固件 它是 加密 的 后来 找 到了 它 一个 非常 老 的 版本 就是 未 加密 的 我 把 这个 版本 提取 出来 搜索 它 里面 可能 很 固件 更新 有关 的 东西 我 发 现在 它 的 设计 页面 里 有 一个 阿 不 路 的 函数 我 反汇编 它 的 程序 它 里面 硬 编码 了 一个 bus 文件 这个 bus 文件 调 用了 另外 一个 这个 bus 调用 了 解压 固件 的 livers 我 就 反汇编 这个 大家 可以 看到 图上 有 一个 非常 明显 的 加密 的 密钥 其实 就是 被 类似 解密 出来 可以 直接 当做 aesk 传 进来 我 又 跟着 程序 往下走 发现 它又 调 用了 rsa 的 加密 上面 可以 看到 一个 非常大 的 整数 串 这 就是 rsa 的 密钥 就是 科普 一下 小 知识 片 入 式 的 系统 为了 更精 细化 没有 采用 opell 如果 对照 里面 加密 库 的话 就是 参 照了 ipilivers 我 又 顺着 程序 往下走 把 程序 完全 理 出来 它 整体 就是 这样 先读 取了 字 节用 rsa 解密 这 字节 剩下 的 就是 用 as 每次 循环 次 节 进行 解密 前面 它会 有 一个 版本 限期 我 图上 标注 了 上面 然后 是 长度 把 这个 去掉 然后 做 rmb 验证 如果 相同 就 刷 入 固件 如果 不相同 就把 解密 出来 的 东西 删除 这样 的话 我们 就可以 完全 模拟程序 写 一套 自己 的 解密 程序 来 发现 它 固件 里面 的 各种 问题 livers 另一种 比较 好玩儿 的 就是 变形 压缩 的 东西 这里 小路 路由 我 后来 又 看了 一下 小路 路由 它是 内部 有 一些 不 常规 的 压缩 你 用 普通 工具 是 无法 把 它 踢出来 这就 需要用 精彩 文件 分析 的 功力 当你 解 到 这 三层 你 会 发现 它有 一个 插队 的 压缩包 它以 xz 开头 以 yz 结尾 你 去掉 多余 的 代码 才 能把 它 顺利 地 解压 出来 livers 前面 我 是 从 软件 的 部分 来讲 像我 这样 的 无业游民 对 一些 设备 不可能 花 很多 的 财力 去 购买 更多 的 是 自己 从 网上 下载 一个 固件 去 分析 但是 如果 你 有 能力 购买 一些 硬件 的话 你 会 发现 硬件 的 漏洞 更多 livers 像 智能 路由器 经 常用 的 otw 系统 它本身 的 串口 会够 你 一个 root 终端 你 直接 用 ttl 转 usb 就可以 直接 控制 了 你 整个 的 路由器 除了 这个 串口 还有 像 gtak 口 这个 完全可以 调节 gpu 像 有些 不 不需要 加密 的 你 就 可以用 gtak 口 去 破解 它 的 加密 也 可以 读写 它 的 里面 的 flash 内容 把 文件 直接 提取 出来 当然 还有 更 暴力 的 可以 直接 把 flash 拆除 下来 livers 说 完了 固件 我 再 说说 接口 之 前提 路由 在 乌云 也 测 过 它 里面 的 版本 就是 被 自身 变异 了 变 的 没法儿 看相 当于 提高了 一个 难度 从 网上 搜索 也 搜索 不到 任何 这种 反 变异 程序 我 自己 尝 试了 一下 发现了 可以 把 变异 过 的 程序 反 变异 过来 livers 我 看了 一下 官方 的 pach 官方 的 pach 打的 lno 嵌入式 对 浮点数 的 运算 非常 处理 的 所以 它本身 会把 浮点数 转换成 整形 luwa 本身 不到 k 这时候 我 就把 值 出来 可以 反 变异 出 luwa 的 代码 后面 我 会把 工具 分享 给 大家 livers 还有 比较 特殊 的 情况 有些 不是 把 代码 加密 它把 代码 给 隐藏 了 这里 我 看了 一下 华为 的 智能 路由器 它本身 的 web 目录 是 空 的 我 就 觉得很 神奇 它 怎么 没有 web 的 接口 livers 我 提 取了 它 的 固件 找到 它 的 web 调用 相关 的 程序 我 反 变异 了 它 web 发现 的 一个 很 神奇 的 配置 它 里面 保存 了 所有 的 文件 的 名称 大小 还有 偏移 直接 从 web 值 里 给 提取 出来 这样 我们 就能 进行 web 上 的 审计 livers 说到 审计 尤其 像 luwac 这样 的 程序 可能 之前 不是 经 常用 很多 程序员 在用 的 时候 不太熟悉 往往会 犯 一些 非常 低级 的 错误 像 直接 读取 加到 字符串 中 直接 执行 livers 这里 我 就把 它 全部 整 理了 一下 这里 就说 一下 接口 认证 它 的 接口 认证 比较 奇特 的 luwas 节点 分 多层次 的 上层 节点 如果 设置 了 就需要 登录 验证 了 如果 没有 设置 就 没有 登录 验证 的 环节 livers 如果 上层 节点 设置 下层 节点 也 不会 登录 验证 还有 从 弹出 声明 官方 是 四个 参数 但是 后面 加了 一个 当 有 第五个 的 时候 就可以 直接 访问 livers 后面 我 又 研究 了 一下 其他 的 就是 前一段时间 刚出来 的 华为 荣耀 立方 大约 这个 固件 是 八月 二十 几号 的 版本 我 把 它 提取 出来 然后 查找 里面 的 问题 我 这里 碰 见了 一个 非常 神奇 的 地方 在 它 etc 目录 下有 一个 ppt 文件 这个 文件 可以 任意 文件 上传 我 又 看了 它 lat 符 这样 的话 如果能 访 问到 的话 就可以 上传 一个 通过 系统 的 命令 安装 一些 apk 可以 做 一些 非常 好玩儿 的 事 livers 对于 智能 路由器 业内人士 的话 比较 喜欢 它 的 各种 app 的 插件 也是 它 的 一个 比 较大 的 卖点 但是 由于 这些 插件 可能是 第三方 开发 的 或者 自己 又 重新 做的 所以在 一些 配置 上 没有 做好 处理 的 livers 像 这个 非常 常用 的 一个 离线 下载 的 插件 它本身 没有 登录 验证 很多人 直接 拿来 用了 包括 一些 大 的 厂商 这样 的话 如果 对 外网 开放 的话 你 可以 直接 远程 查勘 它 下载 了 什么 你 也 可以 帮 它 下载 一些 东西 有的是 硬 编码 直接 在里面 也是 非常 奇葩 livers 前面 说了 这些 路由器 可能有 密钥 执行 或者 什么 大家 可能 只知道 我 能 拿到 控制 权限 但 到底 我们 拿 到了 它 的 权限 之后 我们 能做 什么 好玩儿 的 事 或者 邪恶 的 事 livers 按照 我 的 经验 想了 一些 比如 你 拿到 它 的 权限 之后 你 可以 交叉 变异 留 一个 后门 可 以是 免 登录 的 ssh 还可 以是 后门 的 web 的 万能 密码 或者是 像 之前 一些 路由器 的 漏洞 把 dns 的 服务 导向 一些 钓鱼 网站 甚至 流量 去 分析 偷取 一些 帐号密码 等 livers 前面 都是 一些 传统 的 想法 当 智能 路由器 和 智能家居 设备 结合 的 时候 我们 就不 只可以 控制 它 的 路由器 我们 还 可以 控制 它 的 家用 设备 比如说 攻破 对方 的 安 防 系统 偷拍 声音 图像 或者 我们 自己 搞 一些 非常 有趣 的 视频 我 这里 就 做了 一个 视频 livers 前面 可以 看到 我 一些 东西 用了 不少 的 反汇编 现在 嵌入式 设备 基本上 都是 mips 构架 这个 在 网上 的 资料 比 较少 所以 我 总 结了 一些 比较 有 特点 的 地方 比如 它 的 寻址 它会 有 一个 gk 的 计算器 这个 是 保持 静态 变量 的 寻址 本来 我 也 想去 搞 一些 溢出 方面 的 我 发现 它 的 溢出 比 x 下 还要 麻烦 x 本身 参数 可以 直接 压 入 对 站 mips 是 完全 通过 计算器 完成 的 所以 调整 它 的 对 站 相对 麻烦 一些 livers 前面 讲了 我 对 路由器 的 小小的 研究 下面 我 讲 一些 智能家居 配件 协议 上 的 分析 很多 传统 的 智能家居 配件 会 基于 还有 频段 通过 的 协议 进行 传输 如果 淘宝 去 搜 一下 几乎 都是 这样 的 配件 但是 这个 安全性 非常 差 算是 上 时代 的 产物 了 livers 这里 我 为了 让 大家 看一下 我 也 做了 类似 的 视频 这里 通过 手机 控制 端 控制 一个 遥控 门铃 通过 控制 我 的 电灯 的 开关 我 自己 diy 了 一些 工具 用了 它 的 收发器 还有 发射 装置 用 prs 的 单片 写了 一些 解码 程序 我 可以 直接 snif 它 的 信号 然后 点击 livers 当然 这些 东西 完全 可以用 工具 直接 按 非常 简单 的 完成 但是 这个 价格不菲 我 自己 搞了 一套 成本 大概 也就 十块钱 就可以 直接进行 收发 由于 低成本 的话 这样 的话 我们 就可以 做 更大 范围 的 事 因为 它 的 传送 范围 是非 常远 的 大约有 十米 左右 所以 我 可以 做 很多 放在 每个 楼层 通过 snif 把 抓取 的 数据 存储 到 单片机 里 最终 传到 我 的 电脑 上 这样 的话 可以 远程 控制 一栋 大楼 的 智能 设备 就是 这种 比较简单 的 智能 开关 livers 大部分 的 设备 基本上 都是 用 的 的 芯片 它 发 的 基本上 都是 固定 码 和 硬 编码 的 一些 东西 除了 还有 智能家居 还 常用 一些 红外 红外 就是 非常 简单 的 像 控制 电视机 空调 但是 红外 是 多 信号 无法 穿墙 所以 它 经常 做 转发 像 前面 讲 的 等 进行 转发 这样 的话 我们 就可以 间接地 再来 控制 或者 wifi 的 东 西来 控制 红外 我 可以 远程 地 帮 他 调高 空调 或者 远程 地 帮 他 打开 电视 换 频道 livers 前面 都是 讲 的 一些 比较 传统 的 可能 稍微 有些 科普 了 这里 我 讲 一些 最近 比较 火 的 一些 主 要是 wifi 上 的 一些 东西 传统 的 wifi 就是 物 联网 主要 基于 ap 模式 去 那些 是 各种 包括 传统 的 破解 密码 就可以 了 livers 但是 后面 一些 单 品 延 用了 一些 新 的 技术 叫做 闪 联 技术 我 之前 买过 一些 闪 联 设备 的 插座 我 第一次 配置 的 时候 完全 震惊 到了 我 直接 输入 wifi 就可以 直 接连 入 互联网 我 当时 还 奇怪 我 用 的 苹果 它 怎么 可以 控制 我 切换 网络 呢 livers 所以 我 就 觉得 这个 东西 非常 好玩儿 然 后去 研究 它 等我 理 清了 它 的 传输 方法 之后 我 完全 被 它 震撼 到了 livers 它 的 过程 其实 比较简单 它 的 芯片 刚开始 的 时候 它把 它 的 网卡 设为 混杂 模式 然后 监听 网络 中所 有的 报文 像 手机 端 配置 帐号 还有 密码 它 可以 通过 自定义 算法 把 它 编到 数据包 中 它 接 收了 这些 直接 通过 长度 的 算法 可以 把 传送 的 帐号 还有 密码 给 解码 出来 livers 所以 这个 就 非常 好玩儿 了 攻击者 可以 同样 的 也 开一 个 网卡 监听 掌握 编码 规则 就是 你 怎么 解码 的 我 也 怎么 解码 我 可以 在旁边 snif 解密 到你 加 的 wifi 帐号密码 它 的 编码 稍微 麻烦 都是 易位 操作 来 减少 cpu 的 预算 livers 这个 问题 之前 老外 研究者 也 提 到过 他们 做了 一些 收复 方案 再 传输 的 时候 用 ues 加密 然后再 传输 但是 aesk 是 直接 硬 编码 到 芯片 里面 的 所以 用户 输 的 时候 每次 都要 输 比 较长 的 aesk 所以 比 以前 更 麻 烦了 livers 前面 是 传输 密钥 到了 后面 有 一些 其他 的 东西 就是 通过 wifi 进行 传递 我 又 研究 了 一下 它 的 插座 它 的 插座 协议 做的 太不 安全 了 我 可以 直接 伪造 它 的 协议 进行 重放 livers 我 分析 了 一下 它 的 协议 它 发了 ulink 数 据报 然后 指令 后面 是 它 的 六个 字节 再到 后面 是 link 空格 最后 是 操作 指令 然后 是 开关 它也 会 进行 验证 就是 发送 一个 本身 的 密码 是 默认 的 这样 的话 攻击者 完全可以 远程 控制 它 的 插座 就是 理 解了 它 的 流程 livers 攻击者 伪造 它 的 mike 加 密码 发送到 云端 云端 再 回击 攻击者 一个 包 攻击者 再发 射到 云端 就可以 控制 你 的 设备 livers 后面 是 蓝牙 快速 融入 到 物 联网 当中 它也 推 出了 就是 低 速率 的 传输 协议 但是 因为 安 卓 好像是 支持 了 这个 协议 但是 对 协议 站 的 实现 却 存在着 一些 缺陷 大家 可以 看到 蓝牙 连接 设备 往 主机 发送 通知 包 的 时候 没有 验证 les 长度 结果 导致 了 溢出 livers 我 之前 写过 类似 这样 的 程序 我 之前 接收 一些 游戏 的 数据包 大部分 游戏 数据包 是 四个 字体 但是 突然 发 一个 空 的 过来 我 的 整个 对 站 都 跑 飞了 调了 一 天才 调好 所以 这就 非常 感同身受 livers 再者 讲 一些 国外 经 常用 的 频段 协议 在 美国 可能 就是 有 都用 的 zwave 它在 密钥 传输 的 时候 有 问题 它 分了 三个 层 路由 层 安全 层 和 应用层 路由 层 在 密钥 传输 的 时候 有 缺陷 就是 中间人 可以 直接 劫持 大家 可以 看 这里 这 相当于 协议 来回 收发 的 过程 包 livers 它 的 设备 为了 组网 方便 会在 内部 初始化 一个个 的 初始 密钥 但 这个 密钥 每个 设备 都 一样 所以 我 在 和 设备 建立 加密 通信 的 时候 中间人 可以 劫持 两端 然 后用 初始化 密钥 把 它 发送 的 k 给 解密 出来 然后 通过 这个 k 解密 到 它 的 一些 通信 livers 之前 blackset 上 也 有人 发现 就是 去年 发现了 一个 实例 它 和 前面 不太 一样 它 的 设备 在 恢复 出厂 模式 的 情况下 它 没有 检查 当前 的 密钥 就 直接 恢复 了 导致 攻击者 可以 伪造 密钥建立 连接 livers 最后 讲 一下 云端 方面 这个 我 在 乌云 上 也 提 交了 就是 云端 和 客户端 两个 协议 相结合 综合利用 可能会 造成 更大 规模 的 事件 它 的 云端 存在 一些 web 上 的 漏洞 可以 直接 控制 到 权限 而且 它 的 权限 比 较大 是 直接 root 权限 liverslivers 我 前面 把 协议 分析 清楚 有 很多 东西 就可以 远程 控制 它 的 设备 它 的 云端 几乎 就把 设备 上 所有 的 信息 全部 存储 而且 云 端上 还有 dibat 模式 它 可以 直接 升级 固件 甚至 黑客 可以 直接 编 一个 固件 然后 升级 到你 的 设备 当中 而 一直 远程 监控 你 livers 可能 这次 题目 选 的 不好 选 的 太大 很多 细节 的 东西 没法儿 仔细 去 讲 前面 的 演讲 就 大致 这些 这里 我 总结 一下 传统 的 类似 的 设备 安全性 非常 差 的 越来越 会 出现 这个 设备 的 单体 它 的 安全问题 会 日益 改善 像 闪 联 的 技术 更多 的 采用到 新 的 设备 当中 我 希望 相关 的 一些 厂商 在 追求 新技术 的 同时 也要 兼顾 下 安全 livers 最 后向 大家 宣传 一下 希望 大家 多多 关注 乌云 等等 谢谢 主持人 谢谢 我 看他 的 短片 里 直接 有 劫持 监控 的 录像 那个 大家 应该 可以 看懂 吧 这个 危害 还是 挺大 的 我 还 听到 他 说 他 可以 控制 整栋 大楼 的 智能 设备 所以 议题 对 大家 来说 有点 生疏 下面 进入 茶 歇 时间 乌云 主 站 负责 人我 中间 跟 一位 朋友 沟通 他 新买 的 房子 家居 进入 的 时候 已经 智能 化了 所以 我们 在 峰 会上 抛出 的 一个 隐患 家庭 安全 上 的 风险 因为 有些人 没 懂 场 里 捞 发 的 意义 是什么 它 由 两部分 构成 一个是 wifi 信息 的 劫持 一个 伪造 的 wifi 另一 部分 是 gsm 协议 的 缺陷 导致 短信 的 嗅 探 乌云 主 站 负责人 大家 可以 在 屏幕 上 看到 现场 互动 的 数据 比如 登录 微 博 一些 网页 的 帐号密码 还有 一些 我们 刷 微 博 或者 看 网页时 传出 的 信息 还有 大家 看到了 一些 短信 这个 短信 大家 也 知道 十一 快 到了 买票 这个 可能会 看到 大家 购票 的 短信 主持人 大家 老是 听 wifi 不安全 什么 所以 今天 就是 带 大家 感受一下 主持人 接下来 进入 下一个 议题 由 乌云 的 白 帽子 就是 大家 熟悉 的 二哥 来 跟 大家 分享 gainover 我 今天 讲 的 东西 xss 是 一个 非常 古老 的 漏洞 但是 是 在 互联 网里 还是 普遍存在 的 我 今天 给 大家 看一看 为什么 说它 普遍存在 是 存在 什么样 的 程度 大家 看到 这个 标题 一个 被 忽略 的 漏洞 到 xss 僵尸 网络 看似 很 严肃 的 标题 gainover 我 实际上 是 一个 不 严肃 的 人我 是 一个 喜欢 卖 萌 的 人我 来过 两次 北京 上次 路过 北京 天安门 但是 我 是 在 天安门 地铁 下面 所以 我 天安门 也 没看到 就回 去了 我 来 是为了 一个 会议 这个 会议 叫做 中国 细胞生物学 大会 gainover 大家 认识 我 的 以为 我 是 搞 计算机 的 实际上 我 是 一个 生物 研究 工作者 当然 你 不要 问我 转基因 到底 有没有 危害 这个 其实 我 也 不是 很好 明确地 回答 你们 但是 你们 可以 问我 xss 漏洞 是什么 gainover 这个 东西 我 不会 多 讲 我 可以 简单 地 说 一下 当你 浏览 一个 正常 页面 的 时候 如果 这个 正常 页面 能够 被 攻击者 在里面 插入 恶意代码 来 执行 他们 目的 的话 我们 可以说 这个 页面 存在 xss 漏洞 gainover 这个 可 以是 网站 本身 的 代码 问题 也 可 以是 用来 渲染 这个 浏览器 本身 存在 的 问题 都可以 导致 xss 漏洞 什么 是 xss 漏洞 挖掘 呢 就是 你想 办法 把 网页 插到 别人 的 网页 中去 今天 的 关注 点在 xss 漏洞 利 用上 这个 在 乌云 上有 很多 案例 了 大家 平时 用 的 最多 的 用 xss 来 窃取 客户 的 cookies 这个 在 乌云 推出来 一个 xss 漏洞 利用 平台 这个 攻击 实际上 被 推 到了 顶峰 gainover 后来 有 一些 厂商 百度 后来 把 这个 机制 加上 用来 缓解 xss 漏洞 利用 方式 乌云 还有 一个 导致 xss 漏洞 利用 叫 xss 盲 导 这点 由于 简单 粗暴 的 方式 也 导致 大家 把 这个 发挥到 极致 了 还有 三类 我 用 红色 图标 给 标出来 的 也是 将 xss 危害 发挥到 极致 的 方式 了 gainover 大家 听说过 xss 是 蠕虫 它会 放大 的 有 了 xss 蠕虫 像 微 博 百度 贴 吧 都发 生过 这个 蠕虫 案例 的 我 在这里 说 一下 黑客 可能 发 一条 微 博 这个 链接 里 会有 恶意代码 当 客户 点击 黑客 发布 的 内容 或者 链接 之后 的话 这个 代码 会 让 用户 自己 也 发条 微 博 这里 同样 也 会发 这个 恶意代码 gainover 这样 的话 含有 恶意代码 的 微 博 会 呈现 几何 级 增长 的 所以 可以 在 很短 时间内 得到 很大 的 爆发 量 这对 社交 网络 来 说是 危害 很大 的 攻击方式 gainover 另外 xss 分布式 服务 攻击 这个 一直是 停留在 概念上 的 东西 这段 时间 有 一个 实际 案例 就是 利用 搜狐 视频 漏洞 进行 攻击 这是 老外 先报 出来 的 国外 媒体 也 纷纷 报道 了 gainover 这个 实际上 黑客 在 大 的 网站 像 搜狐 视频网 站里 去 插入 这样 一个 恶意代码 当 用户 访问 大 流量 网站 比 如在 观看 视频 的 时候 用户 浏览器 会 自动 执行 黑客 命令 黑客 命令 可能会 向他 所要 攻击 的 目标 网站 一秒钟 发出 请求 搜狐 有 十万 客户 观看 这个 视频 的话 就 呈几何 级 的 增长 这样 使 目标 网站 停止 服务 了 gainover 这个 案例 也是 我们 团队 发在 乌云 上 的 一个 案例 这叫 水坑 攻击 这个 在 xss 我们 现在 把 这个 概念 结合起来 了 恩 为什么 叫 水坑 攻击 就是 有时候 我们 要去 攻击 某个 目标 的话 实际上 是 你 很难 接触到 它 的 在 这个 时 间里 比如说 李开复 我们 想去 给 李开复 发 一个 链接 都 很难 直接 发 的 我们 不知道 他 的 联系方式 什么的 想 直接 攻击 他 是 不可能 的 但是 我们 是 可以 知道 李开复 会去 上 k 的 我们 可以 在这里 植入 xss 在 我们 等 四天 之后 李开复 中了 我们 xss 我们 当时 结合 qq 的 漏洞 就是 让 李开复 关注 了 乌云 漏洞 报告 平台 在 这个 过程中 不光 李开复 受到影响 了 还有 其他 的 只要 经常 上 k 的 k 只是 其中 一个 网站 我们 还 会在 很多 网 站上 插入 这个 xss 为什么 叫 水坑 攻击 gainover 比如 你 在 大草原 的话 比如说 我 是 狮子 的话 我 想找 猎物 但是 大草原 太大 了 我 哪里 去找 呢 但是 动物 都 喝水 我 就 蹲在 水坑 等着 等 动物 来 喝水 我 就把 它 捉 到了 gainover 大家 要注意 这个 漏洞 有 一个 特点 第一个 实际上 我们 在 k 插入 xss 的话 实际上 并不是 k 本身 网站 的 漏洞 它本身 网站 我们 也 没 去找 是因为 k 在 当时 用了 第三方 的 评论 插件 我 忘了 叫什么 名字 了 这个 插件 本身 是 有 漏洞 我们 可以 往里 插 恶意代码 这样 的话 在 k 在 第三方 评论 插件 劫持 了 qq 漏洞 然后 使 李开复 关注 了 乌云 漏洞 平台 gainover 实际上 k 对 我们 一点 用 没有用 我们 要 劫持 的 是 qq 的 信息 gainover 虽然 说 我 前面 讲了 xss 利用 方式 有 这些 可能 还有 其他 方式 我 这里 没有 提及 厂商 和 攻击者 对 xss 分别 是 什么样 的 态度 呢 实际上 xss 漏洞 相比 传统 的 它 的 危害 确实 要 小 很多 对于 一些 厂商 来说 的话 特别是 国内 的 一些 厂商 这种 类型 的 漏洞 就像 牛皮癣 一样 清 都 清 不完 它 一直 存在 厂商 有的 时候 要么 修 要么 有的 觉得 域名 不重 要就 不修 了 gainover 对 攻击者 来说 实际上 xss 可以 干 很多 事情 首先 可以 获取 个人信息 这个 待会儿 我 要给 大家 演示 的 gainover 第二个 xss 是 用来 伪造 钓鱼 页面 实际上 我 平时 身边 也有 人在 淘宝 上 买东西 别人 告诉 他 退款 让 他 输入 银行 帐号密码 什么的 可能 前面 装 的 很像 但是 容易 露馅 的 就是 发来 乱七八糟 的 域名 就让 人 警觉 如果 配合 xss 漏洞 的话 在 域名 或者 页 面上 很难 判断 是 页面 自己 的 还是 黑客 构造 出来 的 这对 用户 来说 很难 区分 出来 的 gainover 这个 黑色 产业 已经在 这样 做了 在 乌云 上有 一个 实际 案例 就是 利用 搜狗 拼音 来 钓鱼 的 案例 gainover 现在是 应 题了 叫 一个 被 忽略 的 漏洞 这个 漏洞 是 在年 发布 出来 的 叫 优 库 分站 一个 存储 型 xss 漏洞 这个 漏洞 是 被 优 酷 忽略 的 这个 漏洞 不光 危害 是 高 而且 很高 这个 是 发 漏洞 的 一个 截图 证明 在这 上面 确实 很难 看出来 危害 无法 就是 优 酷 的 一个 视频 里面 有 一个 xss 可以 弹出 这样 一个 框框 就是 不能 直接 看出 它 的 危害 gainover 后来 这个 危害 还 被忽略了 也 公 开了 包括 我 现在 还在 讲 这个 漏洞 还 没被 修 为什么 会被 忽略 这个 是 我 不能 理解 的 首先 我 猜 难道 是因为 存在 缺陷 的 域名 不是 优 酷 自己 的 域名 gainover 实际上 xss 影响 域名 的话 大家 可以 看到 它 确 实是 优 酷 com 至少 从 影响 的 域名 来看 的话 是 应 该被 修 的 而 不是 被 忽略 的 漏洞 第二 哪怕 你 是 第三方 文件 导致 自身 的 域名 不是 你 自己 文件 下 的 为什么 没有 通知 第三方 来 修 这 也是 我 不能 理解 的 漏洞 被 忽略 之后 会有 什么 后果 gainover 现在 我们 就 一起 来看 一下 这个 忽略 了 一年多 的 漏洞 到底 是什么 后果 呢 大家 看到 我 打开 优 酷 这个 说明 首页 上 就可以 执行 恶意代码 不光是 优 酷 土豆 也 一样 这是 我 测试 的 时候 的 提示 酷 也是 一样 这是 曾经 出过 漏洞 的 搜狐 视频 也是 一样 也就是说 用户 只要 曾经 访 问过 我们 恶意 构造 的 页面 之后 不管 他 看 哪个 页面 都会 执行 我们 恶意代码 的 也就是说 这些 视频 网站 都受 影响 的 gainover 问题 一 到底有 多少个 网站 会 受到 这个 漏洞 的 影响 我们 看一下 我们 在 某些 网 站上 就像 我 刚才在 k 评论 一样 在上面 插 一些 xss 用户 在 路过 k 的 时候 就会 被 我们 感染 了 刚才 那个 漏洞 代码 接下来 他 去看 优 酷 视频 或者 其他 视频 网站 的 时候 就会 执行 我们 这个 恶意代码 gainover 大家 知道 有 很多 网站 会 调用 优 酷网 或者 其他 网站 这样 它们 也是 很大 的 受害 群体 为了 研究 到底有 多少 网站 受到 漏洞 影响 我们 是 做 这样 的 实验 我 和 我们 团队 的人 一 起来 做 这样 的 测试 我们 找了 一些 网站 这个 网站 被 我们 拿来 做 测试 表示 抱歉 但 这个 也 没办法 gainover 我们 在这里 插入 xss 五 之后 我们 开始 看 这个 它们 被 我们 感染 恶意代码 它们 访问 用户 的 时候 或者 其他 网站 的 时候 我们 恶意代码 会 让 它们 去 调用 我们 一个 我们 指定 的 网 站在 访问 日志 里 会 记录 这些 用户 在 哪些 网站 访问 到 我们 的 我们 统计 结果是 什么样 的 gainover 这是 在 一段 时间内 统计 的 我们 一 共得 到了 g 的 访问 日志 所有 的 受害者 向 我们 指定 的 发 送了 次 请求 我们 在 请求 里 访问 来源 以后 一 共有 个 域名 受影响 我们 取了 前 名 第一名 是 优 酷 第二个 是 车 的 网站 scar 包括 也 受 牵 连了 在里面 还有 其他 的 还有 我 没 见过 域名 的 网站 这些 都是 被 统计 出来 的 gainover 问题 二对 xss 不 了解 或者 不理解 它 的 危害 可能 看我 之前 的 视频 弹 个 ok 弹 个 ok 到底有 什么用 呢 gainover 我 给 大家 看一下 怎么 从 ok 到 真实 数据 的 泄漏 会 泄漏 什么 数据 黑客 会 获得 什么 数据 我们 看 一个 视频 大家 在生活中 对 普通 网民 来说 用 的 就是 qq 大家 也 比较关心 qq 上面 的 数据 而且 了解 我 的 知道 我 喜欢 黑 腾讯 所以 我 来 拿它 做 演示 gainover 现在 黑客 把 代码 改成 真实 的 代码 了 我 就像 刚才 那样 打开 页面 我 正 在看 qq 空间 这个 是 大家 正常 浏览 但是 没有想到 的 是 内容 更新 了 然后 我 去 上 优 酷网 大家 可以 看到 这个 时候 恶意代码 已经 被执行 了 这都是 模拟 大家 在做 的 操作 最后 我们 来 看看 黑客 这边 得 到了 什么 gainover 大家 可以 看到 我 用 自己 qq 做的 测试 这里 访 问了 优 酷 之后 你 qq 所有 好友 被发 送到 黑客 这边 这个 只是 拿 好友 数据 做 掩饰 可能 其他 数据 也 会 因此而 泄漏 gainover 我们 拿 优 酷 做 演示 就是 你 曾经 访 问了 我 恶意 构造 的 网页 后 你 去看 某些 视频 网站 你 的 信息 都是 会被 发送 到我 这边 的 而且 更 关键 的 是 这个 东西 只要 你 不 清理 它 它 一直 存在 在你 电脑 上 的 总有一天 你 会 上钩 的 gainover 就这样 完 了吗 当然 不止 这些 危害 这个 不仅仅是 个 漏洞 这是 我 年月 号 我 在 漏洞 下面 做的 一个 评论 我 是 这么 说的 问题 很 隐蔽 这个 开发人员 肯定是 注意 不到 的 只 要是 有 这么 用 的 估计 都会 存在 问题 这是 当时 我 在 漏洞 下面 做的 评论 gainover 后来 的话 我 看 还 存在 哪些 问题 我们 看一下 乌云 已经 公开 的 案例 实际上 这三个 漏洞 的话 与我 多少 都 有点 关系 不管是 马甲 还是 间接 报告 还是 怎么样 的 实际上 我 发了 这个 之后 还是 没有 引起 太多 各大 企业 的 注意 第一 全部 博客 可 留 后门 gainover 你 只要 你 是 新浪 博客 用户 不管 你 以后 访问 新浪 博客 任意 文件 都会 执行 我 这个 恶意代码 的 第二个 淘宝 支付宝 的 这个 叫 一个 可大 规模 悄无声息 窃取 淘宝 支付宝 帐号 的 这个 标题 看起来 很大 但是 实际上 一点 都不 危言耸听 的 gainover 这些 企业 不知道 自查 周期 比 较长 还是 怎么样 的 同样 的 漏洞 在 阿里 云 服务 上 一样 存在 的 后来 也 被 报告 修复 了 现在 我 看了 一下 淘宝 相关 的 页 面上 同等 类型 漏洞 都 已经 做了 相应 保护措施 了 他们 已经 意识到 这个 漏洞 危害 的 严重性 了 gainover 其实 我 今天 给 大家 讲 的 就是说 漏洞 这块 东西 就 说到 这里 我 标题 还有 后半 部分 叫 xss 僵尸 网络 这个 东西 敢 这么说 的话 是 有 一定 漏洞 基础 的 是因为 这个 漏洞 本身 特点 决定 它是 可以 用来 做 这个 东西 的 首先 隐蔽性 gainover 为什么 说它 隐蔽 这个 漏洞 本身 特点 你 想想 对于 一个 用户 来说 可能 很多 用户 对 钓鱼 网站 网址 都 分不清楚 的 你 让 他 在 页面 来看 原代码 看 它 上面 是不是 存在 恶意代码 这是 根本 没可能 的 gainover 第二个 传统 的 杀毒软件 它是 很难 去 防 这类 攻击 的 这个 东西 对于 软件 来说 至少 很难 有 办法 去 区分 是 xss 还是 这个 网站 本身 的 所 以对 用户 这一 层 的话 用户 是 很难 去 发觉 他们 们 是 已经 中招 的 了 gainover 哪怕 我 自己 搞 这方 面的 如果 不 专门 看 的话 我 自己 很难 察觉 所以 我 也 自己 也 很 担心 这类 漏洞 这个 对 厂商 来说 这与 传统 的 漏洞 不太 一样 的 传统 的 是 在 页面 里 插 一段 代码 你 接到 报告 说 这个 页面 有 问题 厂商 查 的话 发现 这里 黑客 插 了 一段 代码 gainover 但是 对 xss 来说 这个 漏洞 是 存在 用户 电脑 本地 存储 上 的 用户 觉得 页面 有 问题 让 厂商 去 查 厂商 去看 页面 完全 没有 任何问题 然后就 不再 过去了 这样 的话 不管是 最 用户 还是 厂商 来说 这种 类型 的 漏洞 隐蔽性 是 特别 好 的 gainover 第二个 持久性 这是 一个 长期存在 用户 电脑 上 的 这个 漏洞 原理 也是 发过 的 大家 可以 看看 它用 flash 本地 存储 如果 你 不是 自己 去 清 flashcookies 的话 是 很难 清掉 的 gainover 我 记得 软件 flashcookies 是 勾上 的 以前 我 看 安全卫士 软件 的话 flashcookies 是 不 勾上 的 就是 用户 清理 垃圾 什么的 不会 清理 掉 这些 垃圾 这样 的话 这个 东西 就是在 用户 电脑 上 长期存在 gainover 另外 的话 那些 软件 去 来 清理 这些 东西 它 就是 找到 浏览器 默认 的 flashcookies 存放 目录 对 它 清除 我 现在 不知道 第三方 有没有 清除 这个 如果 没有 我 建议 以后 可以 做上 如果 没有 的话 这个 后果 很严重 的 按照 我 前面 演示 如果 这次 没有打开 网页 或者 qq 空间 不会 被 窃取 但 总有一天 你 会被 窃取 gainover 第三 流量 大 大家 可以 看到 这种 类型 的 漏洞 影响 到了 基本上 是 全国 所有 视频 网站 当然 有些 网站 没有用 那个 代码 的话 就 没有 gainover 第二个 电 商 类 的 也是 受影响 的 虽然 现在 都 修 了 第三个 新浪 微 博 也是 受影响 的 这 也是 大 流量 的 社交 网站 所以说 这个 受影响 的 用户量 是 非常大 的 gainover 其次 用户 页面 时间 停留 长 大家 可以 看到 特别是 对于 视频 网站 来 说它 的 用户 基本上 都在 看 视频 一个 小时 两个 小时 恶意代码 就会 在那里 被执行 一个 小时 两个 小时 这样 黑客 利用 代码 可以获得 很长 执行时间 的 这 为 后面 的 攻击 是 能够 提供 很大 的 帮助 的 gainover 最后 基于 这些 特点 的话 这 跟 前面 原理 差不多 的 我们 可以 看到 黑客 首先 做一个 感染 阶段 它 首 先找 一些 比较好 入侵 的 或者 有 漏洞 的 中小型 的 网站 去 入侵 入侵 了 之后 就在 里面 插入 这样 一个 xss 代码 因为 这些 中小型 网站 它在 上面 用户 cookies 有 什么用 啊 一点 用 没有 所以 黑客 不会 偷 这个 它 的 目的 是 植入 后续 的 xss 接着 这些 flashxss 在 感染 到 足够 用户数量 之后 我们 可以 让 flashxss 执行 黑客 的 操作 最 简单 的 就是 信息 窃取 当 感染 数量 达到 一百万 的 时候 我 假设 里面 只有 的 用户 比方说 他 先看 qq 空间 再看 网站 的话 就会 有 一万人 的 数据 窃取 这 可能 只是 一天 的 数据 如果是 一个月 呢 一年 呢 gainover 因为 这个 漏洞 不宜 被 发现 不易 被 清理 所以 这个 积累 到 一年 的话 危害 是 非常大 的 而且 这些 受害者 在看 视频 的 时候 他 的 浏览器 可以 被 黑客 做 一些 事情 的 当然 这个 还会 有 其他 的 利用 方式 这个 就要 发挥 想象力 了 所以 我 这里 总 结了 一下 这种 类型 的 做 僵尸 网络 的话 首先 感染 阶段 然后 是 执行 阶段 从 危害 上来 说 的话 我 觉得 影响 几乎 全国 所有 网站 的 下面 可以 进行 提问 主持人 二哥 讲 的 xss 很好 由浅入深 看 视频 的 时候 我 看 大家 都很 激动 说 xss 的话 我 也 算 跟 xss 挺 有缘 也 一年 也是 pptv 团队 让 我 配合 做一个 视频 其 实说 真的 他 当时 其实 告诉我 了 如果 他 不 告诉我 我 不会 觉得 那个 有 问题是 一个 qq 的 那会儿 就会 有 很多人 嘲笑 我 你 又被 钓鱼 了 怎么了 主持人 xss 可能 你 自己 有些 厂商 对 不怎么 熟悉 自己 看 的话 看不到 什么 影响 觉得 它 就是 一个 小问题 不值得 修补 什么的 但是 实际上 二哥 讲 的 他 讲 的 一个 案例 就是 之前 在 乌云 上 被 忽略 的 一个 漏洞 因为 乌云 上 漏洞 都是 会 先 通知 厂商 让 厂商 去 修补 但是 厂商 可能 没 注意 导致 一大批 视频 网站 也 跟着 被 连累 所以 以后 还是 得 注意 一下 不管 什么样 的 漏洞 漏洞 的 价值 不是 它 的 技术 点 或者 一些 其他 东西 而是 怎么 去 利用 感谢 二哥 的 分享 乌云 主 站 负责人 今天上午 的 议题 是 很 巧妙 的 安排 我们 知道 互联网 有 两大 入口 第 一是 pcpc 上 的 浏览器 这个 就是 二哥 讲 的 浏览器 上 种种 的 问题 乌云 主 站 负责人 第二个 是 手机 移动 端 其实 我们 接下来 的 议题 就是 茄子 给 我们 贡献 的 移动 端 种种 的 安全隐患 特别是 现在 正 在用 安 卓 手机 的 各位 你们 要 仔细听 茄子 非常感谢 乌云 给 我们 这么 一个 平台 分享 这些 对 大家 有益 的 攻防 的 东西 我 今天 讲 的 议题 是 细数 安 卓 webview 的 那些 神 洞 webview 是 安全 中 常用 的 组件 这个 组件 的 功能 是 导入 一些 网页 的 浏览 像 常用 的 微 博 微 信 还有 手机 来 装 的 所有 的 app 和 核心 的 浏览器 都是 用 的 这个 组件 茄子 我 自我介绍 一下 我 和 剑心 认识 有 七年 了 还有 疯狗 我们 是 比较好 的 朋友 我 是 年在 工作 也有 七年 的 安全 从业 经验 之前 一直 做的 是 web 安全 茄子 web 安全 做了 三年 之后 开始 做 浏览器 安全 曾经 也 获 得过 微软 的 致谢 从 年 我 开始 做 安 卓 安全 就是 移动 安全 这块 茄子 首先 我 有 一个 引子 就是 年月 号 google 官方 公布 的 一些 漏洞 公告 这 修复 了 很多 app 的 它 只 修复 了 app 漏洞 但是 并没 修复 安 卓 的 问题 这个 漏洞 可能有 一些 大家 背后 不知道 的 秘密 两 年后 正好 今天是 一个 非常 巧合 的 日子 月 号 也是 两年 这个 时间 我们 来看 google 对 它 安 卓 系统 做了 什么样 的 修复 茄子 第一 各 问题是 google 在 app 中 内置 了 xss 漏洞 它是 通用 xss 漏洞 安 卓 系统 版本 中都 有 通用 的 xss 漏洞 我 这里 列 出了 五 到 六个 实际上 全部 公开 的 至少有 几百个 茄子 我 了 一个 bug 的 号 是 这个 漏洞 是 前段时间 乌云 网 站上 炒作 的 漏洞 应该说 这个 漏洞 实际 上影 响了 安 卓 以上 所有 的 手机 包括 就是 大家 常用 的 安 卓 的 系统 茄子 实际上 这个 漏洞 就是 我 说的 两 年前 月 号 的 时候 google 在 自己 项 目中 把 yp 的 漏洞 修复 了 修复 了 大家 可以 看到 我 这个 红框 的 修复 它是 把 字符串 做了 相 过滤 茄子 如果 大家 是 企业 商品 人员 上线 前 肯定 要做 一些 测试 实际上 这个 项目 是 内 置于 一个 qa 的 测 试用 秘 大家 可以 看到 这个 字符串 是 空白 的 茄子 我 这里有 一个 演示 来看 这个 能在 大家 的 安 卓 手机 中 导致 什么样 的 危害 我 点我 的 qq 空间 说说 在 分 的 时候 没有 进行 任何 说说 但是 进入 ux 页面 在这里 出了 一个 脚本 运行 然后 我 再 进入 我 的 说说 会 我 说说 全自动 发了 一条 留言 茄子 打开 这个 链接 会 进行 测试 页面 我 的 私信 会 自动 发送 刚才 可以 看到 我们 常用 的 qq 和 微 信 实际上 是 社交 化 的 软件 如果 朋友 给你 发 链接 你 点击 后会 被劫持 这个 漏洞 我 给 大家 的 安全 建议 就是 大家 如果是 以下 的 手机 赶紧 把 手机 升级到 给 qq 或者 微 博 这种 使用 web 的 建议 在 app 中 不相关 业务 的 分离 茄子 下一个 我 要 讲的是 google 在 app 中 内设 的 远程 代码 漏洞 刚才 案例 可以 看到 google 是 非常 不负责任 的 企业 第二个 案例 更 可恶 刚才 我 第一页 说的 两 年前 的 月 号 google 修复 了 自己 其中 的 一个 漏洞 这个 漏洞 价值 美元 这个 漏洞 是 日本 的 一个 安全 研究者 发布 的 茄子 google 为了 修复 这个 漏洞 因为 这个 漏洞 分 节点 是 安 卓 的 版本 这个 版本 中有 内置 的 加速 化 切口 也 就是 你 的 app 没 开发 这个 接口 但是 你 用了 webview 这个 组件 在 安全 及其 以下 的 都会 接入 这个 茄子 在 这个 版本 也是 开始 google 在 安 卓 系统 中 增加 一个 特性 可以 防止 这个 漏洞 反射 注入 的 行为 实际上 就是 屏蔽 掉了 代码 输入 的 漏洞 但是 这个 东西 是 用 安 卓 的 非常 严重 每个 app 编辑 开发者 编辑 的 时候 会 选择 你 的 兼容性 比如 我 当前 编辑 的 是 大于 等于 ok 你 加入 的话 你 的 app 在 以及 以上 是 不存在 漏洞 的 但是 这会 存在 很严重 的 兼容性 的 问题 也 就是 你 的 安 卓 在 及其 以下 运行 也 会 存在 远程 代码 执行 漏洞 茄子 到底 google 对 这两年 前 系统漏洞 怎么 修复 的 它 太不 负责任 了 google 到 这个 版本 才 彻底 屏蔽 了 这个 问题 就是 不管 你 app 编程 是多少 到 这个 系统 上 运行 你 的 远程 代码 漏洞 没有 否则 的话 在 以下 任意 机器 上去 有 这么 一个 开发 的话 都会 存在 远程 执行 漏洞 webview 漏洞 是 做什么 呢 茄子 实际上 它 就像 pc 端 流行 的 那样 它 可以 做到 和 pc 端上 挂 码 的 效果 是 一样 的 但是 安 卓 分 很多 传感器 分 很多 功能 我们 可以 操作 安 卓 应用层 代码 去 执行命令 发短信 打电话 获取 gps 任意 手 机上 手工操作 的 功能 都能 实 现在 实现 这些 功能 之前 如果 下面 有 安 卓 的 开发者 应该 知道 要 操作 这个 功能 是 要 获 取到 app 的 contax 茄子 获取 这个 是 导入 lei 然后 获 取到 app 的 contax 然后 调取 app 任意 层 的 功能 就是 自己 编 一些 代码 但是 这里会 存在 一些 坑 儿 茄子 下面 演示 一下 这个 在 小米 三上 是 怎样 的 这台 机器 是 小米 三 的 最新版 实际上 之前 报告 这个 漏洞 现在 应该 不是 最新版 了 茄子 我 在 远程 监听 的 端口 我 用 小米 内置 浏览器 打开 一个 网页 网页 会 发送 一个 意图 实际上 是 打 开了 一个 漏洞 的 app 组件 它 执行 代码 成功 反弹 的 一个 当然 这个 是 在 app 上 呈现 当我 下载 一个 给它 权限 去 执行 我们 知道 拿到 root 权限 想做 什么 就做 什么 了 茄子 实际上 我 说了 第二个 漏洞 希望 企业 的 一些 开发者 有 自己 的 一些 想法 就是 不 要在 滥用 一些 英特尔 加 face 除了 这两个 漏洞 之外 google 在 两 年前 月 号 还 修复 了 安 卓 一个 漏洞 如果 你 使 用了 webview 这个 组件 它在 默认设置 时 会使 你 本地 隐私 信息 泄露 的 漏洞 茄子 这有 一个 实际 案例 像 淘宝 其实 很简单 我 把 刚才 的 过程 的 代码 换了 茄子 我 的 建议 是 你 加上 本地 协议 地址 的 时候 必须 重 定 空白页 我 今天 要讲 的 webview 最后 一个 漏洞 它是 安 卓 签名 漏洞 茄子 我 给 大家 演示 一下 用 这个 漏洞 去 攻击 微 信 的 app 现在 我 打开 微 信 的 app 假设 我 现在 点击 了 微 信中 的 一个 消息 的 网页 这个 网页 会 显示 我 没有 安装 的 插件 现在 我 给我 的 手机 安 装了 一个 flash 插件 我 截取 这个 信息 我会 往 微 信 app 注 入了 一个 软件 大家 看戏 flash 认出 来了 我 现在 拿到 的 权限 实际上 是 微 信 app 的 权限 我 现在 有 一个 漏洞 可以 绕过 权限 去 拨打 的 电话 现在 我 已经 远程 控制 手机 拨打 成功 实际上 这个 漏洞 要 怎么 修复 茄子 也 很简单 开发者 在 开发 app 时候 强制 去掉 插件 支持 如果是 以上 系统 可以 设 off 状态 以后 就不会 随意 支持 恶意 插件 或者 flash 插件 主持人 感谢 分享 今天 早上 的 议题 就到 这里 下面 是 午餐时间 cto 直播 小组 上午 的 议题 全部 结束 下午 cto 将 继续 为 您 奉上 更为 精彩 的 内容 主持人 下午 的 议题 开始 了 下面 的 议题 是 我们 的 神秘 嘉宾 很多人 可能 猜 到了 神秘 嘉宾 是 谁 他 今天 带来 的 议题 我 先 不说 咱们 看他 讲 完了 你 自己 去 领会 吧 我 之前 在 写 主持稿 的 时候 我 要不 要把 他 写成 是 乌云 最 帅 的 人我 没 见过 他 主持人 下午 的 议题 开始 了 下面 的 议题 是 我们 的 神秘 嘉宾 很多人 可能 猜 到了 神秘 嘉宾 是 谁 他 今天 带来 的 议题 我 先 不说 咱们 们 看他 讲 完了 你 自己 去 领会 吧 我 之前 在 写 主持稿 的 时候 我 要不 要把 他 写成 是 乌云 最 帅 的 人我 没 见过 他 主持 人我 当时 那个 帅 字 不是 对 外貌 的 描述 而是 对 能力 的 描述 我 见过 他 后 我 觉得 他 真的 是 乌云 最 帅 的人 你们 先听 一下 他 的 议题 有 不服气 的 再跟 他 挑战 好吗 现在 有请 神秘 嘉宾 猪猪 侠 猪猪 侠 这个 其实 还是 有点 紧张 的 大家 下午 好 非常高兴 有机 会在 这里 和 大家 分享 一个 关于 自动化 攻击 的 议题 这个 议题 主要 会 从 过去 现在 未来 三个 不同 的 时间跨度 来 介绍 各自 背景 下 的 攻击 的 发展 状况 猪猪 侠 议题 一会 引用 到我 经 常用 的 做 实例 附带 讲 几个 小 研究 还会 披露 安全 现状 也 希望 使 大家 的 安全意识 提升 那么 一丁点儿 我 先 做 一下 调查 在座 的 有 谁是 在 甲方 的 有 在 乙方 做 安全 研究 的 有 多少人 是 做 开发 的 这么 少 人 其他 的人 是 干吗 的 猪猪 侠 我 先 介绍 一 下在 乌云 id 上 的 猪猪 侠 是 我 的 昵称 有 八年 的 从业 经历 擅长 web 安全 数据 挖掘 我 的 微 博 就是 这个 会后 有 什么问题 的话 可以 发 私信 给我 猪猪 侠 开始 议题 之前 我 想讲 一下 我 的 安全观 今天 我们 大谈 信息 安全 的 时候 肯 定都 离不开 互联网 互联网 到底 是什么 呢 我 理解 的 互联网 就是 信息 信息 做 什么用 信息 的 一个 用处 就是 交换 所以 可以用 八 个字 总结 互联网 就是 连接 彼此 交换 信息 猪猪 侠 而 互联 网下 的 信息 安全 就是 保护 信息 在 交换 传递 过程中 的 完整性 可用性 和 保密性 因为 互联网 的 特性 是 无时无刻 都在 发起 连接 和 请求 所以 黑客 在 选择 攻击 对象 的 时候 不会 在意 你 是 谁 而是 你 有没有 与 目标 系统 进行 信息 交换 或者 间接 对 目标 系统 发起 连接 的 请求 猪猪 侠 也就是说 如果 耦合度 越高 的 系统 也 就是 关联 程度 越高 的 系统 被 攻击 的 可能性 越大 有时候 可能 某个 公司 由于 单个 系统 存在 某个 安全 缺陷 或者是 用户 帐号 存在 一个 微弱 的 问题 都会 导致 整个 网络 被 入侵 猪猪 侠 更 深入 一点 去 了解 互联网 的话 我们 会 发现 信息 传递 的 客体 对象 社会 信息 背后 的 属性 都 和 人 有关 说到 人 因为 在 中 国是 没有 良好 的 信息 安全 培训 就是 安全 培训 机制 的 就是 普通 网民 安全意识 还是 比 较低 的 更 重要 的 是 有些人 的 愚蠢 根 本就 没有 补丁 可 打 这个 是 近年来 很 典型 的 apt 案例 会 发现 其中有 一半 以上 最终 问题 都 出在 人 的 身上 猪猪 侠 年年 那个时候 我 刚 如 行 当时 是 is 和 asp 的 天下 记得 那个时候 当时 只要 手 上有 每小时 旁注 的 工具 有 可以 做到 想 黑 哪里 黑 哪里 那个时候 比较 流行 的 web 程序 是 动 议和 动 网 就是 有 天 动 网 报出 一个 信息 的 时候 你 黑 动 网 的话 来 找到 攻击 目标 找到 论坛 就 找出 管理员 的 密码 猪猪 侠 从 现在 看过去 的 玖 以前 的 工具 来来 去 去就 那么 几个 还都是 图形界面 的 如果 想用 脚本 调用 的话 根本 没法儿 调用 所以 那个时候 的 工具 流程 都是 很简单 的 一步 一步 没有什么 新意 过去 可以 总 结成 一个 三字经 无非 就是 进 谷歌 找 记录 没 记录 找 旁注 没 旁注 猜 目录 没 目录 就 嗅 探 找 后台 穷 枚举 传 小马 放 大马 偷 密码 挂 页面 提 权限 扫 内网 个人感觉 现 在要 攻击 一个 网站 是 越来越 容易 我 一直 都想 实现 一个 扫描器 只要 你 点 一下 鼠标 就会 黑下 一堆 服务器 直到 我 用 上了 一 哥 一整套 分布式 扫描 框架 之后 再 套上 一点 脚本 这个 想法 就 实现 了 猪猪 侠 就 开始 可以 点 一下 鼠标 黑 一堆 服务器 先讲 一下 这个 扫描器 的 特点 先用 模块化 高 可 扩展 系统 服务 组件 指纹 标准化 入库 高 覆盖率 重新 定义 网络 边界 猪猪 侠 这里是 整个 扫描器 的 控制台 被 红色 框起来 的 是 信息 搜集 模块 右边 是 扫描 主机 的 管理 模块 就是 你 只 要把 主机 添加 设置 好 它 的 ip 然后 设置 好 进程 点 保存 扫描 任务 就会 分发 下去 猪猪 侠 黄色 那块 是 任务 管理 模块 主 要是 用来 添加 扫描 任务 的 然后 还 可以 查看 扫描 节点 的 完成 状态 完成 框 里面 主 要是 漏洞 利用 模块 可以 用来 配置 一些 web 下 的 识别 规则 或者 管理 一些 漏洞 管理 代码 或者 测试 脚本 大致上 整个 扫描器 的 结构 就是 这样 接下来 我会 逐个 介绍 里面 的 一个一个 功能 猪猪 侠 先讲 一下 流程 就是 你 添加 一个 目标 然后 会有 脚本 自动 分析 这个 目标 目标 可 以是 ip 段 也 可 以是 一个 域名 目标 分解 后会 有 信息 分析 脚本 去做 全面 扫描 把 系统 网络 或者 网站 的 信息 全部 放到 数据 库里 接下来 漏洞 利用 脚本 选择 适合 自己 条件 的 目标 进行 测试 验证 后 是否 存在 如果 存在 的话 会 返回 结果 到 数据库 猪猪 侠 使用 扫描器 之前 需 要给 扫描器 设置 一个 目标 这里 只要 填写 一个 你想 扫描 的 ip 然后 截 出 ip 设置 好 扫描 参数 以后 看 这个 参数 和 mike 很像 因为 后台 就用 的 mike 设置 好 这 几个 信息 之 后点 保存 整个 扫描 任务 就会 开始 然后 你 要做 的 就是 等待 扫描器 返回 漏洞 结果 猪猪 侠 这里 就是 把 域名 当做 扫描 目标 如果 你想 黑 乌云 的话 你 只 要把 乌云 域名 打 上点 保存 它 自动 就 会去 黑 乌云 了 后台 的 大致 工作 流程 第一步 它会 检查一下 这个 域名 有没有 存在 dns 预 漏洞 如果 存在 的话 就会 自动 利用 那些 信息 猪猪 侠 如果 不存在 就会 利用 定义 好 的 去 穷 检 域名 还会 有 一个 脚本 去 在 google 上 爬 就 采集 乌云 底下 的 二级域名 搜集 完 这些 域名 之后 接着 会有 对应 的 域名 把 这些 写成 一个一个 ip 当 获得 这些 之后 把 整个 c 段 一下 加到 扫描 堆 里 了 会 不 某个 域名 或者 某个 公司 的 mx 加到 c 段 里 当 得到 ip 后 引擎 里 会 查出 每个 ip 对应 的 域名 传到 数据库 然后 就会 开始 整个 漏洞 扫描 之后 要做 的 结果 就是 等待 扫描 完成 然后 看有 哪些 漏洞 这里是 信息 搜集 查询 界面 所要 保持 ip 所 对应 的 类型 所 使用 的 什么 版本 猪猪 侠 这里是 更 细 化了 一点 可以 看到 它 的 搜集 能力 还是 非常 强 的 细化 到 每个 小 版本 这里 可以 查询 每个 主机 开放 哪些 端口 端口 开放 哪些 服务 用 的 什么 信息 什么 版本 这是 刚刚 讲 的 反查 的 东西 就是 当 把 某个 ip 上面 所 绑定 的 信息 找到 上面 首页 的 东西 一起 存到 数据库 猪猪 侠 这个 界面 是 用 web 指纹 职别 规则 的 就是说 你 只要 设置 好 规则 它 就会 检测 某个 域名 某个 ip 或者 某个 系统 使 用了 什么 中间件 或者 什么 web 程序 猪猪 侠 讲 一个 简单 的 例子 如果 我们 要 识别 一个 网站 中间件 是否 用 的 金 boss 就可以 在 这个 编辑框 里 设置 一个 条件 判断 hppt 里头 是否 包含 金 boss 这 几个 关键字 如果 包含 的话 就会 判断 出 它 使用 的 是 金 boss 猪猪 侠 如果 你 要 识别 某个 网站 或者 域名 使用 的 是不是 opres 第一步 可以 先 对比 一下 它 后台 存在 的 某个 文件 然后 再看 opres 登录 里面 是否 存在 某些 内容 比如 w 里面 你 要 找回 密码 就会 有 密码 这样 的 关键字 然后 判断 这个 网页 里 是否 包含 content 路径 当 所有 条件 都 满足 以后 就可以 确定 这个 网站 是不是 真的 是 opres 猪猪 侠 我们 可以 看一下 漏 洞库 配置 的 细节 反正 只要 你 设置 好 参数 然后 写好 测试 方法 测试 规则 验证 问题 是否 存在 的 规则 点 保存 就可以 扫 描了 就好像 这是 一个 最 新出 的 cast 的 侏儒 漏洞 就可以 分析 一下 然后 把 相应 的 规则 怎么 测试 怎么 识别 填到 里 面点 保存 就可以 批 量地 扫 整个 世界上 用 discars 是否 存在 漏洞 猪猪 侠 脚本 管理 模块 就 每个 漏洞 你 可以 专门 为 它 写 一个 脚本 只要 你 设置 好 每个 漏洞 的 传 参 你 只要 脚本 指定 两个 参数 一个 ip 一个 端口 对应 的 脚本 漏洞 都可以 手工 下发 然后 我们 可以 看到 图片 任务 条件 那里 是 从 端口 表里 查询 出 所有 端口 为 的 ip 配 这个 心脏 流血 这个 脚本 点 保存 之后 就会 开始 全网 扫描 全网 扫描 的 目标 就是 从 前面 类似 钟爱 信息 搜集 里面 读取 的 猪猪 侠 这里 还是 刚刚 discas 侏儒 漏洞 里面 这 还是 从 应用 表里 查询 出 discas 的 脚本 保存 之后 就可以 进行 全网 扫描 这里是 一些 已经 执行 过 的 脚本 任务 记录 任务 条件 是 是否 查询 还是 简单 使用 猪猪 侠 讲完 细节 之后 再 回顾 一下 扫描 流程 如果 你 要 黑 乌云 的话 只需 要在 控制台 那里 输入 乌云 点 保存 它 就会 自动 分解 乌云 目标 自动 搜集 所有 与 乌云 的 相关 信息 然 后会 自动 存到 数据库 漏洞 设置 脚 本会 自动 生成 队列 下发 最后 你 只需要 等待 漏洞 结果 这里 就是 真的 实现 了 全自动 的 攻击 猪猪 侠 整个 框架 还有 可以 强化 的 地方 比如 更强 的 信息 搜集 能力 也 就是 要 加入 更多 的 信息 搜集 规则 比如 web 指纹 还 可以 加强 资源整合 能力 还有 更高 的 覆盖率 更少 的 误 保 率 更多 的 应用 规则 猪猪 侠 在 强化 信息 搜集 这 方面 未来 将 这是 项 google 扫描器 加进来 这是 规则 漏 洞库 如果 你想 扫描 整个 互联网 就是 全世界 的话 对 网络 的 资源 要求 还是 挺 高 的 这是 我们 的 扫描 成本 如果 你 有 台 兆 宽 的 机器 扫描 a 段 的话 大概 需要 天 就是 你 要 扫描 全世界 的话 需要 万 人民币 这个 成本 非常 高 的 考虑 大 成本 的 问题 我们 又 加入 一个 新功能 就是 你 只要 搞到 一个 能 执行 系统 命令 填上 一个 密码 点 保存 它就 会 成为 一个 攻击 节点 成本 立马 降下 来了 猪猪 侠 讲 完了 扫描器 整个 结构 和 工作 流程 之后 做 分享 一些 我们 做的 小 研究 当 我们 优化 一些 细节 的 时候 发现 成功率 是 很 可怕 的 这里是 优化 的 两个 细节 一个是 用户 常用 口令 设置 规则 一个是 常用 特定 url 目录 字典 库 的 积累 猪猪 侠 这两个 越大 的话 效果 也 会 越好 能 得出 的 结果 就是 稍微 大一 点 的 互联网 公司 就 淡 定 不能不 了 等一下 会有 一个 漏洞 扫描 结果 给 大家 看一下 猪猪 侠 就 如果 研究 用户 密码 设置 规则 的话 就 得上 大 数据 这里 我们 搜 集了 亿条 用户 和 用户 密码 我们 得 出了 这个 东西 我们 利用 大数 据统计 出了 多个 使用 的 最多 的 弱 口令 标 红色 的 是 top 中 国是 使用 英语 较少 的 国家 我们 可以 看到 前 位 全是 数字 再看 蓝色 标记 的 这个 很有 意思 这是 一个 多情 的 国家 我 还 对比 一下 我 的 更具 有 中国特色 我 这是 top 数字 使用 数据 在 整个 亿条 密码 中 使用 有 千 多 万 使用 的 有 千百 多 万 猪猪 侠 分析 这 亿 密码 可以 看到 密码 用 纯 数字 的 大概有 亿 就 占了 密码 全部 用 小写字母 当 密码 的 占了 密码 全是 大写 的 占了 用户名 和 密码 相同 的 也有 两千 多多 万 占了 密码 中 包 含了 一部分 用户名 的 也有 使用 top 口令 的 大概 占了 左右 口令 中含有 特殊 字符 的 占 猪猪 侠 这是 整个 整个 针对 使用 亿 密码 计算出来 的 结果 当 我们 分析 一些 密码 的 时候 往往 也 能够 得到 一个 规律 就是 我 根据 那些 亿条 密码 得出 的 结论 就是 大多数人 设置 密码 的 时候 都 会把 生日 加进去 还 会把 年份 加进去 比如 这个 密码 是 去年 设置 的 会把 年 加进去 还有 可能是 名字 加上 生日 做 技术员 的 会 转换 一下 还有 设 密码 的 时候 复杂度 有 要求 就要 有 数字 和 特殊符号 就会 加上 还有 键盘 布局 和 公司 相关 的 东西 补充 进去 还 有些 地方 要求 大小写 要么 就是 第一个 大写 要么 第一个 单词 大写 这样 或者 把 自己 姓名 的 第一个 首字母 大写 猪猪 侠 这是 我们 发现 频率 最高 的 密码 设置 方式 就可以 总 结成 这样 要么 是 用户名 加生 日用 户名 加 特定 字符 要么 是 用户名 加生 日中 文名 拼音 加生 日中 文名 拼音 加 拼音 猪猪 侠 根据 这些 规律 我们 实现 了 生成 密码 的 算法 可以 根据 你 这个 人 生成 一个 和你 有关 的 密码 大家 可以 看一下 这是 一个 分隔符 比如 很多人 会用 乌云 要么 乌云 这样 来 连接 后面 一些 特殊 常用 字符 就有 一次 我 在 微 博 上面 看到 李 铁军 他 教 别人 怎么 设置 密码 他 说 他 的 密码 一般 都是 在后 面会 加上 一堆 com 他 把 这个 方法 告诉 更 多人 更 多人 可能会 采用 这个 方法 所以 你 只需 要看 他们 们 怎么 设置 的 然后 把 它 变成 算法 自动 生成 出来 这是 处理 生日 的 一个 小 函数 我们 知道 日期 这个 东西 会有 前导 的 没有 前导 的话 是 有 前导 的话 是 猪猪 侠 就是 你 把 能够 考虑 的 细节 考虑 进 去就 生成 一个 专门 有 针对性 的 密码 脚本 有 了 生日 密码 算法 我们 发现 都是 中文名 我们 又有 一个 小 函数 就是 把 中文名 转成 拼音 然后 再把 你 拼音 的 名字 比如 姓 不 转成 拼音 把 你 的 名 取 前面 的 两个 开头 字母 这里 可以 看到 朱 猪猪 侠 整个 生成 别人 密码 的 过程 是 动态 生成 的 有人 会说 你 根本 不知道 我 的 名字 不知道 我 的 生日 是 没办法 知道 我 的 密码 的 在这里 的话 因为 互联 网上 已经 泄 漏了 亿 多条 用户 信息 我们 知道 所以 这里 可以 做一个 数据 接口 然后 给 扫描器 调用 给 算法 调用 这里是 我 做的 一个 案例 大家 可以 看一下 乌云 上 也 介绍 过 就是 你 只需 要在 这个 系统 上面 输入 一个 域名 然后 它 就会 返回 所有 与 这个 域 名为 结尾 的 所有人 的 信息 猪猪 侠 以 京 东为 例 你 比如 buycom 点击 它就 会把 所有 的 信息 返回 过来 我们 只需 要知道 一个人 叫什么 他 的人 生日 是 哪天 或者 不知道 通过 什么 渠道 得 到了 他 的 身份证号 就可以 很简单 地 利用 一些 常用 的 密码 生成 算法 算出 他 的 密码 比如 前几天 泄漏 的 qq 群 数据 备注 里 就有 很多人 的 真实 姓名 那个 拿过来 的话 就可以 生成 密码 效率 大大提高 猪猪 侠 这里 再 介绍 一下 众 测 刷钱 的 方法 我 得到 最终 的 信息 一个是 用户名 和 密码 指令 好 美杜莎 支持 协议 举个 例子 在 蘑菇 街上 直接 用 美杜莎 暴力 截取 他们 的 邮箱 服务器 整个 过程 都是 自动化 的 猪猪 侠 我们 知道 每个 互联网 多多少少 都有 应用 或 服务 比如 邮箱 博客 或者 企业 应用 如果 当 某个 员工 的 邮箱 或者 密码 泄露 之后 都会 直接 导致 网络 边界 被 突破 可以 看 乌云 上面 的 一些 精彩 案例 第 一个是 我 是 如何 进入 中石油 网络 的 还有 阿里巴巴 信息 泄露 直接 进入 内网 右边 是 优 酷 和 土豆 由于 敏感 信息 泄露 就被 内网 漫游 猪猪 侠 阿里巴巴 的 问题是 由于 员工 安全意识 不足 内网 帐号 挟持 就 变 成了 秘密 访问 后来 你 都懂 的 中石油 是 内部 文档 被 员工 上 传到 百度 文库 这个 文档 里面 还 包 含了 用户名 和 密码 直接 被人 进了 内网 就 买了 那么多 防火墙 其实 有时候 是 没用 的 这是 第三个 小 研究 就是 有时候 你 用心 思考 一些 开发 和 运 维 的 小 习惯 把 他们 的 习惯 写成 检测 规则 你 就 能够 在 互联网 上下 载到 各种各样 的 敏感 信息 惨不忍睹 猪猪 侠 比如 说上 面的 灰色 是 备份文件 的 比如 你 用 vi 编辑 文件 的 时候 如果 忘记 保存 或者 你 在 管理 服务器 的 时候 hs 断了 它会 有 一个 交换 文件 放在 那里 这是 我 能 想到 的 一些 东西 填在 这里 下面 这个 就是 网页 浏览 包 就是 管理 或者 运 维 的 要 发布 一些 新 的 版 本图 方便 会把 原码 打成 一个 包 扔上去 再 解压 有时候 忘记 删 除了 原码 包 就会 造成 更 严重 的 影响 反正 大家 上 乌云 去 搜 各种 案例 吧 猪猪 侠 还是 回到 正题 未来 扫描器 会 更加 智能 会有 更多 的 规则 会有 真 针对性 的 扫描 总之 未来 攻击 会 越来越 野蛮 猪猪 侠 这是 在 未来 要做 的 事 就是在 传统 安全 公司 还在 讲 防火墙 这些 东西 应该 联动 起来 阻拦 攻击 的 时候 我们 已经 实现 了 实时 扫描 就是 里 只需 要在 浏览器 上 设置 一个 代理 你 在 浏览器 上 每次 点击 链接 的 流量 都会 生成 一个 拷贝 服务商 就会 分析 流量 拷贝 中 的 端口 信息 会 自动 传 递给 扫描器 后台 就会 自动 扫描 服务器 存在 哪些 漏洞 这里是 扫描器 插件 你 可以用 扩展 写成 插件 去 分析 当前 网页 中 存在 哪些 url 资源 端口 的 信息 再回 传给 扫描器 后台 会 下载 一个 扫描 任务 然后 扫描 个人 存在 的 漏洞 猪猪 侠 如果 这个 东西 也 可以 用在 移动 客户端 如果 你 要 找 移动 客户端 的 漏洞 你 在上面 播 上 微 片 微 片 会 自动 分 析出 你 每次 点击 的 流量 的 url 资源 后台 会把 这些 当做 扫描 目标 自动 扫描 它 存在 的 漏洞 猪猪 侠 这些 用到 的 代理 服务端 都是 修 改过 的 主要 目的 就是 用来 分 析出 流量 中 包含 的 url 域名 和 端口 给 扫描 器用 我们 这里 流量 控制台 得到 的 分析 url 主机 域名 端口 都会 在这里 然后 会分 发给 扫描 引擎 就是 这样 的话 未来 你 找 漏洞 就 变得 很简单 你 只需 要在 浏览器 设 一个 代理 然后 点点 就可以 找到 漏洞 猪猪 侠 然后 在 移动 app 上 放 一个 微 片 然后 在 移动 app 上面 各种 点 使用 各种 业务 有 能 自动 发现 可能 存在 的 漏洞 这个 工具 近期 会在 乌云 上 上 架 然后 利用 这个 代理 你 可以 很轻 易地 找到 产生 的 漏洞 这是 扫 描到 的 腾讯 的 漏洞 这是 百度 的 这是 微 博 的 就是说 你 找 漏洞 不需要 再像 以前 那样 开一 个 分析 工具 然后 还要 各种 复制粘贴 不停地 来回 地 切换 很 繁琐 现在 的话 找 漏洞 主要 点 点点 就行了 猪猪 侠 有 一天 不小心 扫 到了 阿里 云 的 服务器 agent 又 忘记 删除 然后又 不小心 发现 这里 连 接了 ace 的 数据库 所以说 未来 扫描 工具 并不 可怕 至少有 规 则是 可以 检 测到 扫描 行为 但是 有些 突如其来 的 攻击 是 完全 没有办法 防御 的 猪猪 侠 之前 剑心 跟我 说 筹办 本次 峰会 的 目的 是 想 白 帽子 和 厂商 的 攻防 实践 对 安全 的 认知 让 谈谈 云 计算 大 数据 的 看法 顺带 披露 一些 安全 现状 现在 讲 一下 安全 现状 一个是 互联网 的 攻击 根基 在 动摇 猪猪 侠 看到 这个 图 不知道 有 没有人 知道 这个 事情 就是说 年月 号 的 时候 由于 discuz 和 phpwind 第三方 接口 问 题在 dns 被劫持 这是 新网 的 当时 安全 做的 很差 只是 证明 一 下有 这么 一个 事 猪猪 侠 再看 这个 图 这个 就 更久 远了 旺旺 年 月份 的 时候 因为 旺旺 某个 子目录 下面 使 用了 动议 的 s 版 后来 注 入了 一个 成功 在 它们 网页 上排 窗 也就是说 旺旺 新网 国内 最大 的 厂商 都没 办法 保障 自己 的 安全 猪猪 侠 所以 我们 知道 世界上 可以 总结 出有 三种 人 一种 是 被黑 过 一种 是 不知道 自己 被黑 过 还有 一种 是 不 承认 自己 不 黑 过 后来 我 又 想到 第四种 就是 正在 被黑 猪猪 侠 我们 的 基础 运营商 其实 比 想象 中 要 脆弱 很多 的 就是 从 乌云 上 可以 看到 无数 的 技术 运营商 都在 乌云 上 被人 报 过 漏洞 比如说 第一张 图 这 好像是 中国 铁通 的 信息系统 就可以 入口 进去 这是 中国电信 某 台 服务器 上 保 留了 大量 核心 路由 的 配置文件 看 配置文件 里 是什么 猪猪 侠 配置文件 里 基本上 是 某个 城市 的 核心 路由 的 ip 管理 帐号密码 或者是 root 的 密码 这个 不知道 是 哪家 的 广告 系统 自带 dns 劫持 功能 猪猪 侠 有 一天 我 无意间 发现 某个 运营商 系统 是 可以 查询 所有 手机用户 短信 发送 记录 可以 看到 左边 倒数 第二个 它还 可以 帮助 用户 发短信 有 了 这个 系统 后 发现 手机 二次 验证 安全 怎么办 就是 你 发 一个 短信 然后 别人 就 能从 运营商 系统 查询 到 短信 的 内容 就是 你 要 找回 支付宝 密码 猪猪 侠 输 一个 验证码 就 给你 重置 了 qq 微 信 等 的 密码 更 简单 了 因为 我 发现 微 信 用户 体验 最好 的 就是 它会 自动识别 出 你 手机号码 是什么 按 一个 按 纽 找回 密码 然后 查询 出 验证码 就能 重置 别人 的 微 信 密码 猪猪 侠 中间 的 红框 是 我 在 测试 的 时候 发现 我 只是 修改 一下 手机 的 服务 密码 系统 把 我 的 服务 密码 也 记录 在里面 了 根基 在 动摇 的 一点 就是 你 的 身份证 已 不再是 秘密 猪猪 侠 就是 你 的 出行 记录 你 的 身份证 不再是 秘密 了 因为 整个国家 的 基础 系统 其实 没有 想象 中 那么 安全 然后 这是 我 在 群 里 找 的 图 就是说 别人 要知道 你 的 身份证 其实 很 容易 的 只需 要知道 你 叫什么 名字 你 的 生日 就可以 推算出 你 的 身份证号 有 了 身分证 号 你 在 互联网 要 怎么 玩儿 其实 真是 想 怎么 玩儿 就 怎么 玩儿 猪猪 侠 其实 还有 一点 信息 泄露 比 大家 在 互联 网上 看到 的 要 严重 的 多远 远不止 十亿 条 那么 简单 我们 可以 看到 这张 图 上面 整个 社会 媒体 的 格局 图 上面 大家 知道 有 多少 家 被黑 过 吗 这就 发 一个 图 我 就不 讲了 猪猪 侠 再讲 一个 小 实例 就是 王 思 聪 在网 站上 暴露 某 电 商 送货 太慢 就把 自己 的 订单号 推出 来了 你 看到 他 的 定单号 可以 查到 他 的 电话 地址 邮箱 是什么 然后 可以 间接地 搜集 到 大量 的 关于 他 的 个人信息 猪猪 侠 比如说 有 一天 他 又 晒 图片 这是 晒 他 的 电脑桌 然后 那里 有 一个 小 优盘 其实 价值 一万 多 这是 土豪 的 生活 理解 不 了 的 我 就去 看了 一下 这个 是 真的 他 真的 买了 不是 山寨 的 猪猪 侠 所以 到现在 我 越来 越能 理解 就是 那些 明星 照片 泄露 事件 其 实说 根本 的 都是 因为 他们 自己 的 不小心 自己 也 不知道 怎么 泄 露了 猪猪 侠 就像 今天 你 去 注册 微 博 或者 注册 qq 空间 人人 网 就 各种 网站 当你 填 下 注册 资料 的 时候 你 永远 不知道 qq 会给 你 公开 哪些 信息 在 互联 网上 微 博 会 公开 哪些 信息 在 互联网 上有 一天 你 只需 要把 所有 涉及到 媒体 上面 的 那些 公开 信息 抓下来 再做 一个 差异化 对比 发现 这些 不对称 可以 完全 还原 出 关于 那个人 的 所有 信息 比如说 微 博 有时候 会 显示 一个人 的 生日 人人 网上 不会 但是 它会 显示 某个人 是 哪个 学校 的 你 只要 抓住 这些 差异 就可以 还原 出 你 想要 的 某些人 的 某些 信息 猪猪 侠 现在 很多 订单 会 泄露 你 在 哪里 吃过饭 睡过 觉 这是 某团 可以 查到 任意 用户 信息 你 的 订单 全部 存在 网上 的 比你 想象 的 要 严重 猪猪 侠 随着 移动 互联网 这 几年 的 爆炸性 发展 就 来自 移动 端 就是 手机 端 创造 的 数据 是 传统 pc 时代 的 上百 倍 就在 这样 的 一种 大 数据 时代 里面 越来越多 的 移动用户 移动 设备 无时无刻 不在 工作 随时随地 都在 连接 互联网 前所未有 的 用户 数据 都被 上 传到 云端 用户 变得 越来越 透明 用户 的 安全 也 和 互联网 公司 的 安全 捆 绑在 了 一起 未来 安全问题 不在于 黑客 攻击 那个 电脑 很可 能把 某个 互联网 的 服务器 攻破 就可以 得到 上亿 人 的 个人隐私 信息 猪猪 侠 未来 我们 面对 的 对手 都是 信息 发掘 资源整合 的 高手 我们 不知道 他们 现在 到底 掌握 了 多少 资源 但是 从 我 个人 了解 的 情况 来看 结果 很不 乐观 的 反正 只 要是 一旦 遭受 攻击 结果 都是 灾难性 的 猪猪 侠 对于 处于 防御 场景 的 甲方 来看 有时候 你 只要 被黑 一次 只要 被 黑客 带走 的 信息 足够 多 下次 他 依然 能够 接触 那些 以往 获 取到 的 信息 再次 黑 进来 大家 有 什么问题 可以 提 听众 请问 刚才 扫描器 的 时候 它对 cpn 的 处理 是 怎么 处理 的 猪猪 侠 猪猪 侠 如果有 预 存储 的话 就看 有没有 cn 代码 就好 像你 使用 安全 堡 服务 的 时候 它 必须 指定 你 要 加入 一台 就是 必须 指定 一个 就是 nd 加密 的 域名 给它 就像 前面 讲 的 dns 已经 不安全 你 就想 办法 在 dns 厂商 那里 能不能 搞到 记录 如果 不行 的话 就是 乌云 上 的 案例 你 在上面 找 一些 注册 服务 看 它 的 头 找 它 的 信息 他 刚刚 提 的 问题 更 重要 的 是 你 可以 去 它 的 m 差 记录 入手 就是 邮件 解析 切入 听众 有 提到 目录 测试 方式 还有 高危 的 会 自 扫 我 之前 做过 类似 的 东西 发现 因为 有些 网站 当 互联网 站点 特别 多 的 时候 会有 误报 的 问题 就是 我 可 能让 它 访问 一个 自己 的 数 提出来 然后 做一个 对比 但是 还有 好多 很大 的 误报 程度 比方 不同 的 后缀 扫 的 结果 不一样 还有 一些 文件 还有 一些 目 录下 你 访问 什么 都是 就是 类似 这样 的 误报 情况 你 都有 什么 处理 方法 猪猪 侠 这样 把 判断 规则 写 深 一 点我 用 分布式 引擎 就是说 一 哥 写 的 如果 关于 扫描 引擎 上有 什么问题 可以 问 一 哥 我 主 要是 用 里面 就是 把 它 的 核心 功能 拿过来 然后再 脚 本套 脚本 扩展 扩展 再 扩展 你 刚刚 那个问题 就是说 如果 它 出现 的 就是 同类 的 访问 太多 的话 你 尽量 把 判断 规则 多 写 几层 就是 出现 什么问题 写 一层 有时候 真的 太难 识别 的话 放弃 就 好了 因为 还有 其他 方法 可以 那个 听众 您对 数据 挖掘 这个 东西 具体 是 怎么 定义 的 你 是 如何 去做 的 数据 挖掘 跟 信息 搜集 差不多 就像 通过 搜 搜索引擎 以及 各大 门户 网站 搜集 个人 的 信息 然后 把 信息 整合 在一起 这 就是 所谓 的 数据 挖掘 还是 说 你 有 自己 的 看法 自己 的 其他 方法 之类 的 可以 分享 一下 吗 猪猪 侠 其实 也 没什么 方法 就是 你 看 哪里 提供 了 数据服务 比如 qq 群 上 你 可以 查 看到 一些 信息 你 就想 办法 把 它 全部 扒 下来 还有 微 博 个人资料 里 很多 时候 会 泄露 某个人 的 个人 网站 或者 邮箱 那里 是 泄露 特别 多 的 你 就想 办法 把 它 扒 下来 就是 哪里 泄露 信息 你 把 它 扒 下 来就 完了 最 重要 的 是 有 数据 可分析 听众 刚才 讲 的 都是 攻击 的 问题 但是 企业 方面 更多 的 关注 是 平台 是否 安全 结合 攻击 思路 在 防守 方面 有没有 体系化 的 建议 猪猪 侠 你 这个 问题 太大 了 我 一时半会儿 回答 不 了 但是 我们 可以 线下 交流 主持人 感谢 猪猪 侠 带来 的 精彩 演讲 及 现场 解答 我 就说 猪猪 侠 肯定是 有着 超级 棒棒糖 的 他 今天 让 大家 见识 了 一下 猪猪 侠 经常 说的 一句话 就是 安全 不在于 对方 有多强 大 而是 只要 有 薄弱 地方 就会 导致 功亏一篑 真的 是 这样 的 在座 有 很多 企业 朋友 看到 这么多 案例 你们 可以 回去 思考 一下下 面请 极 路由 副总裁 康 晓 宁 就 只能 路由器 在家 庭 网络 中 的 安全 考量 发言 康 晓 宁 大家 可能 奇怪 我 为什么 会出 现在 这儿 其实 我 也 在想 这个 问题 乌云 邀请 我 讲 这个 的 时候 我 也 想我 去 这不是 羊 入 狼群 吗 乌云 说 你 作为 厂商 的 代表 你 还是 得 出现 一下 这样 的话 让 大家 知道 你们 都 在想 什么 都在 做什么 为什么 会 报出 那么多 奇怪 漏洞 你们 也 不修 什么的 这些 问题 康 晓 宁 所以 我 想了 一下 我 决定 还是 把 自己 洗 的 白白 的 在 这儿 供给 大家 来 那个 吧 康 晓 宁 我 今天 的 题目 是 写了 智能 路由器 在家 庭 网络 中 的 安全 考量 我 觉得 你们 看到 这个 以后 你们 现在 不说 什么 但是 心里 肯定是 要 对我说 三 个字 说 人话 实际上 翻成 人话 就是 家庭 网络 还是 属于 人 傻 钱 一般 多 的 状态 现在 不是 问题 将来 总会 成为 问题 的 康 晓 宁 因为 我们 知道 安全 一般来说 是 主要 防护 采取 的 策略 就是说 你 采用 多少 的 防护 取决 你 这里有 多少 的 价值 在 之前 家庭 网络 它 一般来说 攻击 的 价值 非常 低 的 所以 一直 都没有 形成 非常 普遍 的 攻击 大家 都 觉得 这片 地里 没什么 价值 但是 随着 自动化 的 攻击 以及 将来 物 联网 时代 一 来临 以后 家庭 的 网络 价值 肯定会 大大 地 上升 所以说 有时候 这 也是 我 觉得很 那个 一点 康 晓 宁 就是 一个 东西 在 它 真正 有价值 之前 你 肯定 不 会对 它 投入 很多 力量 但是 等 真正 有 力量 再去 搞 就 晚了 现在 返 回头 来看 我们 这些 安全 的 东西 大部分 都是 走 的 先 污染 后 治理 的 路 所以 今天 我 在 这儿 简单 讲 一讲 可能 也是 说 希望 大家 早一点 先 注意到 这点 虽然 说 先 污染 没什么 但是 别 污染 太过 就好 康 晓 宁 既然 我们 是 做 家庭 路由器 的 我 肯定 得 先从 这 方面 讲 家庭 路由器 是 家庭 网络 的 唯一 入口 如果 这个 被 攻破 损失 就 非常 巨大 了 未来 物 联网 时代 大量 设备 将 通过 wifi 接入 大家 知道 这个 不太 安全 比如说 我 今天 刚来 这儿 打开 手机 一看 能上 的 wifi 没几个 是 真的 康 晓 宁 另外 家庭 局域网 里头 现在 可能 没什么 东西 但是 将来 还是 比较 风险 的 传统 路由器 我 觉得 我 都 不外 说了 央视 已经 报道 好几次 了 虽然 演 传统 路由器 拿 我们 的 产品 拍了 很多 照片 搞 的 大家 好像 以为 我们 有 问题 康 晓 宁 传统 路由器 厂商 一般来说 它 都没有 太多 安全 概念 的 我 觉得 大家 应该 在这 方面 稍微 有点 研究 的 可能 都 看过 dv 的 blog 它 上面 好多 路由器 的 构架 发现 这 里头 或多或少 的 都会 有 后门 就是 为什么 这些 厂商 费劲 的 在 这些 设备 塞上 后门 这个 事 是 有 原因 的 康 晓 宁 但是 传统 路由器 功能 是 有限 的 所以 被 攻破 的 事情 你 也 做 不 了 太多 很多 嵌入式 设备 连 shell 都没有 你 就算 建 成了 又能 怎样 呢 虽然是 这样 路由器 本身 的 设置 还是 能在 家庭 局域网 的 安全 造成 一定 影响 康 晓 宁 一个 就是说 dns 设置 刚才 猪猪 侠 已经 提过 dns 在 大 的 dns 上有 很多 安全问题 在 局域 网上 路由器 就是 更 关键 的 部分 因为 我们 知道 当时 央视 报 的 说 有 很多 路由器 dns 设置 已经 改了 一些 关键 网站 会被 钓鱼 但是 它 没说 受到 多少 影响 康 晓 宁 我们 在 电信 那儿 来 听说在 全国 已经有 百万 的 路由器 被 修 改了 另外 还有 一 些小 的 结 合着 将来 自动 扫描器 的话 是 有 可能 做 出在 路由器 上 利用 端口 转发 功 能将 内网 暴露在 外网 的 可能性 虽然 我 现在 没 见到 这方 面的 成果 但是 这是 一个 可能性 康 晓 宁 什么 是 智能 路由器 呢 我们 的 想法 是 想把 路由器 像 手机 似的 可以 自己 装 app 把 路由器 暴露 出来 操作 路由器 来 修改 它 的 行为 就像 安 卓 一样 但是 这个 说白了 可能 也有 更多 的 安全问题 康 晓 宁 我们 只是 觉得 潘多拉的盒子 总得 有人 打开 我们 今儿 不 搞 明儿 也 会有 别人 搞 我们 毕 竟是 互联网 出身 的 我们 比 传统 路由器 安全意识 好 些个 但是 真正 实施 的 时候 确实 出问题 因为 我们 也是 小本生意 我们 也 雇 不 起 太好 的 程序员 我们 只能 雇 实习 程序员 他们 写 的 代码 你 也 无法控制 康 晓 宁 另外 一点 系统 功能 还是 蛮 多 的 我们 做 智能 路由器 都是 用 的 那个 板 攻破 这个 跟 攻破 一个 主机 是 没有 任何 区别 的 以前 可能 大家 觉得 家庭网 没有意义 但是 现在 这个 东西 攻 破了 以后 可能是 非常好 的 这点 我 想 大家 可能要 这 方面 注意 一点 康 晓 宁 我 刚才 有 一个 问题 丢了 没有 给 大家 讲 就是 为什么 传统 路由器 会有 一些 奇怪 的 漏洞 大家 还都 不修 这个 原因 其实 是因为 任何 做 这种 设备 的 在 出厂 的 时候 都 最终 要 进行 一次 监测 的 就是 你 看到 它 都装 一块 了 肯定 不是 不行 的 我们 攒 电脑 还让 整个 跑 一遍 康 晓 宁 这个 设备 有 一定 的 测试 程序 来 保证 这个 系统 能 正常 运行 的 但是 你 说 默认 都是 有 密码 这些 东西 肯定 也 不太 方便 所以 一般 的 厂商 都会 有 一些 不管 什么样 的 一 定都 会有 后门 而且 这个 后门 功能 还都 比较 强大 的 基本 都 能跑 命令 的 康 晓 宁 至于 这个 后门 做的 好不好 这个 完全是 一个 良心 问题 像 dvtv 报 的 都是 这样 的 漏洞 这个 漏洞 怎么说 呢 康 晓 宁 虽然 大家 看起来 很严重 但是 从 厂商 的 角度 我们 觉得 这是 一个 小问题 就是 这种 漏洞 可利用 价值 一般 都不是 很大 就是 如果 我 要 渗透 当然是 非常好 的 一个 来源 但是 因为 家庭 网络 价值 不大 渗透 的 价值 也 很低 除非 它 能够 被 进行 大规模 的 自动化 利用 就好像 dns 设置 那 可以 就是 通过 跨 站 的 方式 来搞 康 晓 宁 就是 这种 产 测 漏洞 利用价值 因为 方法 不一样 有些 通过 脚 本是 无法 构造 的 其实 我们 也是 有 一个 后门 的 这个 我 可以 直接 说 但是 我 觉得 后门 做的 稍微 有 一点点 良心 命令 都是 通过 isa 签名 的 产 测 软件 是 由 联网 那块 生成 签名 还有 一点 产 测 的 功能 我们 是 在 头一次 完成 设置 以后 我们 会把 它 关了 但是 传统 路由器 厂商 我们 没见 一个 有 做 这样 事 的 康 晓 宁 我们 在 路由 安全 考虑 的 首先是 登录 安全 机制 因为 像 传统 路由器 尤其是 某 最大 的 厂子 我 也 不说 厂 命 了 年 出货量 才 达到 七千万 台 它 上面 有 很明显 的 跨 站 甚至 有的 url 可以 在 用户 没有 密码 完成 操作 这样 简直 太 容易 了 我 只要 随 便在 很多 网站 深 挂 一些 命令 用户 只要 一 访问 立即 就 改掉 康 晓 宁 我们 本身 有 这样 的 机制 但是 密码 这个 事情 说 老实话 非常 难以避免 我们 从 我们 数据 来看 我们 虽然在 安装 的 时候 加了 很多 的 提示 说 你们 做 密码 不安全 什么的 最后 下来 大概 还是 有 三分之一 用户 绝对不 会去 改 默认 密码 的 我 想 传统 的 只 可能会 更多 不可能 更少 康 晓 宁 还有 我们 在 路由器 里 我们 尽量 实现 最小 权限 把 这些 程序 逐渐 都 限制 普通用户 甚至 有些 比如 爱情 还 做 第三方 应用 第三方 应用 一 定要 跑到 砂箱 里 还有 一个 我们 本身 有 一些 管理 功能 这个 必 须得 增强 但是 这 部分 不是 传统 的 互联网 的 安全 范畴 虽然 我们 做的 也 并不好 我们 被人 脱过 裤子 康 晓 宁 稍微 扩展 一点 的话 讲到 家庭 局域网 安全 的 问 题了 路由器 自身 安全 只是 一部分 但是 我们 看到 wifi 本身 安全问题 还有 物 联 设备 安全问题 比较显著 了 还有 你 在 里头 用 的 电脑 什么的 这些 设备 被 攻破 你 的 家庭 局域网 本身 安全 也就 完蛋了 康 晓 宁 因为 安全 和 便利 总是 违背 的 很少 有人 说 我 能 接受 说 我 家里 的 网络 也就是说 像在 外面 一样 步步为营 这样 很多人 都 受不了 所以 家庭 局域网 的 安全 这个 问题 我 觉得 应该是 非常 难解 这不是 一个 技术 的 问题 康 晓 宁 wifi 协议 本身 也是 有 问题 的 就是说 wepwps 这 几个 东西 都是 已经 很 明确 就是 可以 被 搞掉 的 还有 弱 密码 还有 像 wap 即使 它 的 加密 还算 比 较强 一些 了 但是 我 还是 可以 通过 就是说 wifi 协议 设计 不完善 我 可以 在 一开始 的 时候 就是 正在 通信 的 客户端 侵 下去 然后 获取 合理 的 利用 包 再 设置 权限 康 晓 宁 wifi 协议 设计 就是 从 密码 达到 最终 密钥 过程 太短 了 如果 我们 把 这个 计算 量 加大 的话 其实 就 没 那么 容易 被 穷 举了 现在 没办法 因为 我 看这 个 协议 的 时候 我 心里 想我 觉得 搞 比特 币 那些人 把 常用 的 算法 搁 到 比特 币 里 真的 就 完蛋了 康 晓 宁 我们 知道 比特 币 已经 被这 帮人 推到 很 可怕 的 程度 它还 有 一定 的 良知 它 没有 采用 现在 常用 的 加密 的 认证 算法 还有 家里 的 wifi 密码 共享软件 这是 一个 很大 的 风险 这个 事 报 过 几次 但是 我 不知道 厂商 利益 还是 怎么着 大家 都 不说 这个 事 康 晓 宁 还有 物 联 安全设备 我 觉得 这个 都没 办法 了 它们 对 安全意识 非常 非常 薄弱 我们 和 物 联 厂商 有 接触 当时 想要 它 的 控制 协议 它们 不肯 给我 说 看 一眼 发来 一个 word 文本 我 用 一个 多小时 的 电话 跟 他们 讲 明白 这样 做的 危害 如果 真的 这样 的话 真没 办法 康 晓 宁 还有 淘宝 上 的 某 品牌 的 智能 插座 我 看 它是 开 的 直接 就进 去了 我 在 有些 群 里头 看 有些人 说 国内 物 联 厂商 服务器 基本 都被 掏 过 还 有人 说 看到 某家 智能 插座 的 厂商 的 服务器 看到 里头 大概有 几千人 在线 那人 说什么 时候 有 一万 了 我们 就 停 一次 电 康 晓 宁 物 联 安全意识 不强 很多 设备 预算 不足 也 很难 实现 比较复杂 的 认证 协议 什么的 这个 也 确 实是 摆在 它们 面前 的 一个 问题 像 刚才 说 安全 和 便 利是 违背 的 尽量 和稀泥 能 折衷 就 折衷 吧 康 晓 宁 我们 在 能 做到 的 范围内 尽量 做 一点 事 但是 对于 家庭 局域网 大多数 用户 来说 他们 对 安全 完全 没有 任何 概念 所以 跟 他们 讲 这个 就是 我们 这么做 他们 甚至 觉得 不好用 这个 我们 就 真的 没有什么 太好 办法 康 晓 宁 这个 我 觉得 可能是 我 今天 来 这儿 的 最主要 的 目的 就是 我们 还是 希望 作为 厂商 或者 作为 有 一点点 良心 的 厂商 我们 希望 和 安全 社区 保持联系 随时 进行 互动 我 尽 量地 把 我 知道 的 安全 方面 的 比较 牛 的人 就是 我 在 微 博 上 都 发了 就是 你 不经意 的 举手投足 都对 我 的 价值 非常大 康 晓 宁 现在 我们 也 委托 乌云 进行 体检 活动 当然 每期 都 非常 惨 主持人 谢谢 今天 来 的 可能 都是 白 帽子 在 物 联网 方面 研究 可能 欠缺 但是 康 晓 宁 讲了 很多 东西 你们 认真 听 应该能 听到 不少 东西 而且 极 路由 大家 很多 都 在用 的 而且 我们 乌 云集 每次 会上 很多 主持 人极 路由 对 安全 的 态度 我 非常 欣赏 它们 对 安全 的 态度 他们 对 安全 并 不是说 有 了 什么 安全问题 就 隐 瞒着 他们 会说 出来 然 后去 改正 去 修补 那些 漏洞 我 觉得 这 才是 一个 正确 的 态度 再一次 把 掌声 送给 康 晓 宁 主持人 接下来 出场 的 是 一位 重量级 人物 他 就是 百度 的 首席 安全 架构师 他 带来 的 议题 是 站在 厂商 的 角度 怎么想 一些 漏洞 问题 王 宇 大家 下午 好 首先 感谢 大家 来 我 今天 跟 大家 分享 的 是 百度 在 安全 响应 方面 的 经验 以及 一些 事情 的 处理 这 方面 之前 也 没看到 对外 进行 分享 过 但是 这个 对于 大多数 企业 来 来说 我 个人 觉得 这个 还是 蛮 有意义 的 这是 我 讲 的 agende 我 的 网 名叫 小 宇 目前 我 是 百度 云安 全部 安全 架构师 王 宇 什么 是 应急 响应 这 跟 大家 刚才 看 的 猪猪 侠 的 演讲 感同身受 图片 上 的人 是 美国 国土 安全部 部长 他 叫 切 尔 托福 他 讲过 世界 上有 两种人 一种 被黑 过 一种 被 黑了 不知道 的 王 宇 我 想说 的 是 一个 企业 安全 做的 好 安全 事件 处理 的 好 的话 很多 不是 事情 发生 以后 才 处理 的 包括 事前 的 建设 当时 事情 真正 发生 的 时候 我们 才能 有条不紊 地 去处 理好 它 王 宇 先 不说 什么 是 应急 响应 我 站在 这个 角度 说 一下 应急 响应 的 范围 第 一个是 国内 叫 的 src 它 对外 叫 应急 中心 应急 响应 要 干的事 情 王 宇 第一 它 不是 比 谁 找出 的 后门 多 和 黑客 捉迷藏 因为 本身 来说 特别是 刚开始 处理 安全 事件 的 同学 很 容易 陷入 这样 的 矛盾 我 要把 所有 黑客 后门 找出来 第二 不是 把 系统 黑 一遍 然后 说 黑客 就是 这样 入侵 的 王 宇 我 看到 网上 有 很多 分享 关于 应急 响应 的 案子 来说 的话 他 说 我 这个 网站 被 黑了 我 拿 我 的 扫描器 扫 了 一遍 这个 网站 我 发现 漏洞 通过 这个 漏洞 拿 到了 分享 这是 你 的 一个 思路 但是 并不 代表 事实 的 真相 是 这样 王 宇 第三 应急 响 应和 计算机 取证 时 的 关系 其实 计算机 取证 和 应急 响应 有 不同 的 目标 虽然有 很多 技术 重叠 我 这里 强调 慢慢 做 研究 第四 可能 也许 应该 这有 好处 我 认为 攻击者 是 这样 的 但是 真的 是 这样 吗 王 宇 我 说的 是 大胆 猜测 小心 取证 我 列 出了 我们 内部 对 应急 响应 的 定义 范畴 这里 列出 六条 首先 控制 事情 的 影响 范围 我们 保证 线上 业务 正常 运转 是 我们 最终 的 目的 第二 还原 攻击 场景 攻击者 到底 做了 什么事情 包括 他 是 怎么样 进来 的 以及 他 进来 以后 都 做了 哪些 事情 通过 哪些 漏洞 进来 的 第三 明确 攻击 意图 王 宇 就是说 我 一个人 为什么 黑 你 当然 不 排除 我 在 互联网 大网 扫描 黑 一个 机器 这个 站在 我们 角度 我们 并 不太 担心 我们 担心 的 是 针对 企业 的 apt 或者 有 针对性 的 搞 你 的 第四 找到 问题 并 改进 王 宇 就是 为了 避免 错误 一而再再而三 犯 的话 这里 我们 需要 还原 他 进来 的 场景 然后 找到 自己 根本问题 的 第五 反思 自己 不足 我们 现有 的 监控 体系 有 什么 不足 第六 在 中国 情况下 用 的 不多 但是 也是 范围 之内 就是 司法 追究 王 宇 接下来 聊聊 应急 响应 需要 做什么 方面 的 技术储备 应急 响 应是 一个 比 谁 更 全面 系统 的 过程 还有 一些 业务 专业知识 不管怎么说 小说 里 传 的 是 黑客 无所不能 他 甚至 可以 打败 管理员 这个 打败 实际上 是 有 一定 限制 的 我们 至少有 优势 这里 我 列出 两点 王 宇 第一 我们 是 坐 前面 的人 最次 的 是 把 业务 下线 这是 没有办法 的 办法 为了 保住 其他 业务 王 宇 第二 我们 对 业务 的 了解 我们 可能 之前 没有 接触 过 业务 但是 应急 响应 会有 开 发运 维 的 同学 来问 首先 一个 很 重要 的 观点 如果 你 不 了解 业务 和 系统 第一时间 去找 开发 和 运 维 的 同学 了解 王 宇 第三 我们 自己 必须 做 应急 响应 很 广博 的 知识 我们 需要 去 了解 攻击 手法 的 局限性 王 宇 刚才 也 说了 不要 想当然 a 五 可能 被 黑了 他 告诉 运 维 的 说 被 黑了 运 维 的 说 我们 这儿 出现 一个 被黑 事件 他 告诉 上级部门 可能 最后 跨了 几个 级别 到了 处理 安全 的 这对 信息 的 描述 可能 完全 变味 所以 我们 处理问题 一 定要 找到 第一手 的 人员 比如 这个 系统 的 开发人员 或者 这个 系统 运 维 人员 问 清 楚王 宇 大胆 猜测 小心 求证 我 在后 面会 具体 举 例子 说 王 宇 说到 黑客 入侵 会 带来 系统 变化 我 在这里 说一些 tips 大家 可以 看到 这里 unix 的 一个 输出 可以 看到 对于 一个 默认 安装 的 系统 大多数 用 发行版 的 系统 它 的 inode 分布 是 集 簇 化 的 王 宇 还有 安装包 情况 我们 可以 看到 系统 默认 安装 完成后 会有 逆序 的 管理 在 这儿 这样 装 的话 很明显 的 可以 看到 系统 被 更 改了 王 宇 还有 在 系统 中有 一个 很 重要 的 事情 就是 确定 这个 事件 发生 的 时间 这里 的 mac 是 指 的 修改 时间 还有 访问 时间 这不是 文件 的 创建 时间 王 宇 还有 关于 删除 的 比如说 我 在 unix 下 做一个 事情 我 可能 删除 sislog 真 删除 了吗 我 直 接去 访问 它 的 kad 我 看 这里 打开 的 文件 句柄 的话 这是 简单 的 事情 复杂 的 也 不 提了 王 宇 默认 的 tips 还有 很多 像 代码 造成 的 特征 比如 以前 的 驱动 的 引用 可能会 加在 一些 不 常用 的 驱动 必然 会在 log 里 打出来 刚 说到 有些 事情 功夫 在 事 外 了 王 宇 下面 我 分享 一下 案例 应急 响应 对时间 的 要求 非常重要 的 要求 处理 事件 的 同学 在 第一时间 对 事件 进行 一些 定性 和 定量 的 分析 能 做出 判断 比方说 我 要 下线 还是 重装 机器 还是 进一步 观察 入侵者 我 举 的 第一个 案子 这都是 实际 发生 的 王 宇 比如 我们 这里有 运 维 的 同学 自己 系统 的 用户 目录 会 周期性 的 丢 文件 但是 又没有 丢 所有 文件 怀 疑是 有人 故意 破坏 或者 入侵 事件 第一 的 反映 肯定 先给 同学 安全意识 点个 赞 就是 有 什么问题 安全 相关 的 东西 会 提交 到我 这儿 这是 安全 相关 教育 的 是 我们 非常 需要 的 王 宇 第二个 这个 好 嚣张 啊 但是 反过 来想 会有 这么 二 的 吗 然后 沟通 发生 的 时间 我 在这里 进行了 简单 的 操作 我们 看了 一下 用户 的 root 大家 看一下 看到 这个 东西 的话 第一 反映 是什么 王 宇 我 花了 五分钟 把 这个 问题 破了 我 第一时间 看了 一下 crontabapp 这个 它 删 不 了 我们 root 输入 的 东西 紧接着 我 在 crontab 跑 的 东西 搜 前面 是 rm 然后 后面 变成 删除 根目录 的 行为 这个 案子 告诉 我们 企业 日常 报 过来 的 案子 根据 我 的 经验 是 是 带 双引号 的 这 就是 第一个 议题 先 定性 再 干活 王 宇 第二个 案例 某一 日 收到 webshell 报警 也 确 认了 是 一次 入侵 事件 这个 实际上 可以 记 录在 我们 系统 中 执行 的 命令 我们 看了 一下 非常 熟练 可是 这是 台 linux 我们 就 不便 提了 最终 我们 是 盯 下了 这 个人 王 宇 我们 通过 分析 这个 东西 能 得出 一个 结论 当然 这个 结论 可能 需要 你 结合 其他 东西 判断 当然 猛地 一看 正确 评估 你 的 对手 实际上 是 一个 后续 工作 的 指导 当然 我们 这里 相对于 小白 性质 的 入侵者 王 宇 当然 我们 也 遇到 特别 资深 的 黑客 结果是 我们 也是 和 其他 的 厂商 一起 合作 因为 攻击 的 也有 其他 厂商 我们 一块儿 把 这个 同学 处 理了 目前 还没有 结案 所以 具体 细节 也 不便 透露 王 宇 第三个 一个 综合性 的 例子 第二条 说的 是 大家 要 正确 评估 你 的 对手 第三个 是 结合 我们 的 平台 出现 的 异常 给 大家 说 一下 分析 问题 发生 的 思路 也是 某日 编译 平台 接 到了 报告 说 出现 了 异常 王 宇 根据 前面 的 准则 先 定性 真的 像 说的 那样 严重 吗 bae 部分 网站 访问 跳转 第一义 反 应是 被 撞 库 了 bae 负责人 的 网站 也 受影响 调了 密码 帐户 的 近期 登陆 无 记录 无 异常 检查 了 网站 的 配置文件 也没有 被 修改 确 实是 出现问题 了 王 宇 我 去 实际 的 应用 机器 测 了 一下 反馈 如果 知道 的 就 知道了 不知道 的话 我 也 不会 具体 说 这个 网站 是什么 我们 要做 的 就是 像 攻击者 一样 思考 攻击者 处理 我们 的 网站 或者 对 我们 的 劫持 他 的 目的 是什么 王 宇 首先 他 是 跳 转到 这个 网站 比如说 exxxtimes 最主要 导致 的 结果是 bae 整体 被 封禁 这是 触 底线 的 事 攻击者 是 谁 呢 宣传 xx 的 略 傻 的 是不是 炫耀 这也 不是 炫耀 也没有 重定向 到 某个 个人 的 网站 王 宇 那么 我们 确定 问题 到底 发生 在哪儿 了 我们 结合 自己 了解 到 的 bae 整体 框架 这是 我们 引 用了 一些 内部 的 比如 bvs 大家 可以 理解为 附带 均衡 上面 跑 的 cji 后面 挂了 一个 封闭式 系统 在 这儿 王 宇 它 的 报告 问题 全出 现在 python 环境 一个 机器 上有 两个 lightpd 环境 只有 一个 受到影响 即使 受到影响 的 实例 并不是 都 产生 跳转 任意 看了 几个 空间 的 根目录 conf 也无 异常 王 宇 我们 的 目光 转向 了 cgibae 多 租户 特性 同一个 cgi 会 运行 多个 不同 的 网站 代码 我们 做了 sandbox 的 防护 如果 出问题 最大 可能是 phthon 代码 对于 进程 的 运行 状态 进行了 改变 王 宇 python 设计 之初 并不是 作为 web 的 cgi 语言 开发 的 必然 导致 实现 上 针对 cgi 接口 暴露 过多 底层 的 东西 发现了 cgi 的 core 文件 简单 的 strings 了 下 发现了 大量 的 exxxtimes 证实 了 cgi 问题 的 猜想 王 宇 这样 就是 定性 问题 兵分 两路 phthon 环境 是 经过 测试 的 能够 宽 网站 影响 的 接口 应该 就 几个 类型 还有 动态 的 执行 环境 我 会在 代码 中 搜索 另外 一个 层面 上 接着 去 分析 就是说 这种 攻击 实际上 是 不稳定 的 而且 它 影响 其他 网站 正常 的 cgi 网站 都有 运行 maxtime 在 运行 完毕 后 就 会被 清出 内存 攻击者 为了 规避 自身 的 风险 都用 国外 的 我 结合 这 几个 条件 对 日志 进行了 分析 发现了 几个 可疑 的 运 维 当然 前面 说的 我 就 直接 抛 掉了 王 宇 因为 那个 不影响 先看 我 当时 找到 的 这样 的 一个 文件 目前 看 这个 地方 看不出 是什么 东西 当然 这种 正常 的 写 不会 这样 写 那种 写法 其实 很不 单纯 的 我 和 bea 的 沟 通过 这样 的 写 是 某某 同学 所有 的 这个 空间 多次 被封 的 经历 实际上 这与 我们 最初 的 猜想 蛮 像 的 我 调了 一 这个 同学 的 测试 名字 很明显 passtest 王 宇 对 可疑 网站 做 过滤 的话 因为 这个 攻击 是 持续 的 很快 的 我们 通过 流量 系统 把 它 的 一个 包 被劫 出来 了 当然有 一些 解压 的 过程 我们 这里 可以 看到 实际上 是 一个 攻击 代码 了 王 宇 不同 的 网站 用 cgi 的 时候 受到 的 次数 会 很多 通过 案例 三 我们 得到 什么 就是 不要 盯着 技术 特别是 对 攻击 的 细节 完全 没 头绪 的 时候 解决问题 但 不要 局限于 问题 当然 还有 学到 一个 新 的 劫持 技术 王 宇 声明 一下 最后 说 一点 目前 的 bae 架构 早就 已经 更新换代 了 我 这里 只是 介绍 了 当时 问题 处理 的 思路 bae 当前 的 架构 不会 存在 此类 的 问题 王 宇 总结 一下 未知 攻 焉知 防 先 定性 再 干活 正确 的 评估 你 对手 的 水平 大胆 猜测 小心 求证 跳出 纯粹 的 技术 对抗 的 圈子 以 解决问题 优先 现在 很多 事件 处理 过程中 看似 神秘 的 东西 可能 需要 一点 即 破 的 思路 下面 推荐 几本书 我 是 站在 共享 的 角度 不是 卖书 王 宇 恶意 软件 分析 诀窍 与 工具箱 这里 奇 淫 技巧 很多 恶意代码 取证 应急 响应 amp 计算机 司法鉴定 计算机 取证 写 的 比较 文艺 主持人 再次 感谢 王 宇 的 分享 像 百度 这样 的 厂商 它是 对 安全 事件 的 响 应是 有 一定 的 机制 的 当然在 这个 机制 建立 之前 他们 也 踩 了 很多 坑 儿 今天 来了 很多 厂商 朋友 可能 现在 的 安全 制度 还在 建立 中 或者是 还在 完善 中 今天 我 相信 小 宇 带来 的 分享 可以 给 你们 指 很 多路 的 今天 场 里 捞 捞 到了 很多 东西 大家 可以 在 屏幕 上 看一下 主持人 接下 来给 大家 带来 分享 的 是 一个 后 的 ceo 虽然是 ceo 分享 的 也是 与 技术 相关 的 他 就是 lbe 安全 大师 的 开发者 之一 张勇 早晨时 茄子 给 大家 分享 了 一下 关于 安全 攻击 的 思路 安全 就 这个 样子 有 攻 有 防 才有 意思 接下 来请 张 总 给 大家 带来 一段 应用 加固 张勇 非常感谢 利用 这样 的 机会 能够 在 这样 的 会场 跟 大家 来 分享 一些 在 移动 应用 安全 相关 的 议题 我 自我介绍 一下 我 是 张勇 我 是 lbe 安全 大师 的 早期 开发者 也是 创始人 之一 可能 我 现在 挂着 ceo 名头 但是 我 还是 一个 纯粹 的 工程师 也是 一个 技术 爱好者 张勇 关于 这个 主题 其实 也是 有 些小 的 故事 的 在 一个月 以前 乌云 当时 找到 我们 希望 我们 能够 做一个 相关 的 演讲 我们 就 很快 的 想到 这样 一个 话题 是因为 我们 对 这个 很感兴趣 半个 月前 我 完 成了 大纲 大家 看后 觉得 太水 了 所以说 在 一周 以前 我 就 推倒 重 写了 我 写 的 主题 是 单子 上面 面的 主题 前天 晚上 讨论 之后 觉得 还是 太水 了 所以 觉得 干脆 再 推倒 一次 就是 再 重写 一份 熬 了 两夜 给 大家 带来 这样 的 主题 就是 主流 移动 应用 加固 产品 攻防 分析 张勇 这个 议题 包含 两部分 第一 我们 跟 大家 简单 介绍 一下 移动 应用 加固 用户 的 需求 以及 主流 移动 应用 加固 的 方案 和 实现 的 核心 细节 第二 部分 我会 列举 市面上 五款 非常 流行 的 应用 加固 的 产品 来 分析 它 加固 的 原理 和它 实现 的 方法 张勇 同时 我 也 会 给出 这 五款 产品 如何 对 其 进行 破解 和 脱壳 的 核心 的 要点 我 希望 通过 这样 的 ppt 一方面 让 大家 对 移动 应用 加固 有些 更深 的 了解 另一方面 我 也 希望 能够 帮助 一些 或者 能 够为 一些 在 这个 领域内 进行研究 的 安全 工作者 带来 一些 资讯 和 一些 信息 张勇 为什么 需要 应用 加固 这个 问题 很简单 在 pc 上 就有 从 发展 了 很多 代 在 安 卓 上面 从 年 被 大家 提及 年 成为 非常 热 的 热点 应用 加固 如此 火热 的 原因 有 如下 几点 首先 安全 平台 的 应用 核心 代码 都 是以 java 书写 的 我们 知道 它 很 容易 被 反汇编 的 张勇 即便 大部分 开发者 都对 原码 进行 混淆 但是 核心 逻辑 是 可以 通过 一些 函 用 关系 看出来 的 无论是 登录 也好 验证 也好 有 经验 的 工程师 还是 可以 根据 调用 的 关系 来找 到你 的 程序 里面 的 核心 的 点 然后 对 它 进行 破解 和 修改 张勇 第二 安 卓 是 一个 开放 的 系统 如果 我 没 记错 的话 安 卓 平台 逆向 工具 应该是 时代 也 就是 三四 年前 已经 发展 到现在 非常 非常 成熟 张勇 第三 为什么 需要用 加固 因为 安 卓 平台 淡 化了 进程 的 概念 应 用是 基于 消息 和 事件 来 运行 的 基于 这样 的 情况 恶意代码 的 植入 变得 非常 容易 想在 pc 时代 植入 代码 要对 原有 的 代码 进行 反汇编 然后 插入 你 的 入口 点 张勇 在 安 卓 根本 不用 动到 原码 只需 要在 清单 文件 增加 一些 事件 的 响应 像 开机 自启动 然后 你 在你 的 恶意代码 中去 接收 这些 事件 响应 就可以 实现 基本 的 注入 张勇 最后 安 卓 平台 我 相信 特别是在 国内 安 卓 平台 大约 有的 安 卓 手续 已经 获得 入 权限 在 这个 情况下 无论 通过 appi 或者 修改 值 都很 容易 实现 注入 实现 这样 注入 话 这样 的 功能 也 就在 一方 面恶 化了 安 卓 软件 的 生态 的 安全 张勇 正是 有 这样 的 原因 市场上 包括 开发者 都 对于 应用 加固 都 希望 能有 这样 的 一些 产品 来 保证 自己 的 软件 不 会被 轻 易地 重 打包 不 会被 轻 易地 注入 也 不 会被 轻 易地 破解 正是 有 了 这样 的 原因 才有 了 现在 非常 火热 的 应用 加固 市场 张勇 我 在 国内 选 了 五个 比较 主流 的 应用 加固 供应商 基本上 目前国内 主流 的 加固 供应 上有 以下 功能 防止 恶意 篡改 防止 内存 窃取 防止 调试 而且 目前 的 做法 通常是 用户 上传 一份 已经 修 改好 的 apk 然后 重 打包 反 馈给 用户 的 是 已经 加固 过 的 apk 这套 流程 背后 技术 的 原理 和 技术 的 要点 主要有 哪些 呢 张勇 最主要 的 就是 所谓 的 加 壳 技术 可 pc 不太 相同 的 地方 是 安 卓 应用 的 核心 部分 代码 是 java 语言 书写 的 针对 很多 dx 这样 的 加 壳 技术 应运而生 了 在 目前 三种 比较 主流 的 加 壳 技术 张勇 第一 对 dx 完整 的 加密 这种 加密 技术 会在 加固 的 时候 将 dx 文件 给 完整 做 一次 加密 然后 保 存在 apk 中 同时 用 加固 方案 商 动态 声 明来 代替 掉 原始 的 在 应用 启动 的 时候 加固 的 脱壳 代码 就会 自动 运行 起来 它 会对 已经 加密 的 进行 脱壳 并且 加 载到 系统 中 同时 它 还会 修改 一些 东 西来 运行 组件 张勇 随着 攻防 的 增加 第二种 方案 也 开始 出现 我 称为 自 节 码 变形 方案 它 的 原理 其实 也 非常 显而易见 它在 运行时 修改 文件 使得 你 从 记忆 dump 中 盗取 的 文件 是 不合法 或者 不完整 你 无法 对 它 进行 重新 分析 和 重 打包 目前 我们 看到 的 像 腾讯 的 加固 主要 采用 这样 的 方案 张勇 还有 一种 就是 综合 了 加密 和 变形 的 两种 的 方案 就是 百度 应用 加固 方案 这些 加固 方案 它 的 具体 的 实践 原理 和 细节 我会 在后 面的 ppt 中 详细 介绍 张勇 除了 dx 加密 之外 我们 知道 apx 还有 很多 东西 像 我们 写 的 动态 库 还有 像 资源 文件 包括 像 很多 加密 方案 商 提供 的 防止 动态 调试 防止 侏儒 的 功能 这些 功 能把 很多 加密 方案 也 都有 卡尔 张勇 资源 文件 的 防护 通常 针对 apk 中 两个 比较 特殊 的 目录 一个是 res 目录 还有 acs 目录 进行 保护 像 音频视频 还有 图片 及其 他 资源 进行 加密 保存 然后 壳 代码 通常 会去 确保 这些 资源 在 应用 读取 之前 被 解密 这个 过程 是 透明 的 所以 对应 用不 需 要做 额外 的 工作 张勇 但是 这样 的 做法 可能 会有 一些问题 首先 跨 应用 间 跨 进程 可能会 失败 影响 性能 还有 反 二次 打包 加固 时 记录 apk 内容 hash 运行时 由 壳 进行 检验 还有 反 ptrace 防止 注入 多 进程 相互 ptrace 还有 一些 厂商 采用 另外 一个 方法 就是在 运行时 不断地 轮 巡 张勇 安 卓 是 多 进程 系统 你 无法 保护 所有 的 线程 即便 保护 了 一些 线程 其他 线程 也 会被 传上去 这样 的话 都不会 很 完全 所有 安 卓 的 进程 都是 通过 一个 叫做 zygote 进程 报出来 的 对于 注入 者 而言 或者 调试 者 而言 他 根本 不需要 在你 进程 运行 的 时候 才 tress 像 很多 安全 软件 像 腾讯 所谓 的 超强 模式 主动 防御 其实 都是 基于 这样 的 技术 张勇 换句话说 安全 软件 可以 这么做 恶意 软件 也好 修改器 它们 也是 可以 采用 同样 的 做法 所以说 反 tress 基本上 没有 任何 功 能从 现实 中 来讲 张勇 其实在 刚才 我 列举 的 这些 功能 中 最为 核心 的 一点 就是 classesdex 加密 方案 的 实现 首先 我 想 跟 大家 先 介绍 一下 最 标准 的 classesdex 整 包 加密 的 思路 这个 思路 也是 目前 最为 成熟 和 众多 产品 都 应用 的 方式 张勇 这样 的 方式 其实 会分 两步 运行 首先在 加固 的 时候 当 把 apk 传到 服务器 时会 解析 apk 它会 动态地 生成 一个 新 的 classesdex 来 代替 原先 的 原始 的 会 放在 其他 目录 下面 张勇 当 程序 运行 的 时候 因为 在 加固 过程中 壳 已经 替换 掉了 程序 入口 点 当 运行 的 时候 壳 代码 首先 运行 起来 在 几个 函数 中 它会 调起 脱壳 代码 通常是 用 c 来写 的 来 进行 脱壳 操作 张勇 在 脱壳 操作 中 会做 这样 的 事情 首先 它 会把 dex 文件 加入到 内存 中 通过 一些 手段 在 max 中看 不见 这样 可以 避免 一些 非常 简单 的 方法来 定位 到你 脱壳 后 的 classesdex 下 的 dex 的 内存 中 的 地址 张勇 第二 我们 知道 安 卓 平台 有 四大 组件 这些 组件 它 和 pc 是 不一样 的 安 卓 平台 做 应用 你 是 无法 真正 控制 你 的 代码 是什么 时候 运行 的 是 系统 认为 你 需要 你 运行 的 时候 系统 会把 你 启动 起来 张勇 换句话说 系统 负责 来 启动 你 的 代码 但是在 通常情况下 系统 会 假设 所有 代码 都 存在 标准 的 classesdex 文件 中 但是在 加固 中 你 的 代码 已经 挪 到了 另外 一个 包 中 已经 不在 原始 的 里 如果 试图 构建 你 这些 组件 的 时候 不能实现 所以 为了 避免 这个 问题 所有 的 加固 方案 会去 修改 classesolder 来 确保 系统 构造 组件 的 时候 成功 找到 组件 张勇 第二 它 还会 确保 标准 正常 运作 在 执行 完 这些 操作 的话 最后 一步 会做 签名 验证 然后 才会 真正 调起 目标 进程 的 对象 并且 对 它 进行 初始化 最后 完成 脱壳 操作 话 就会 重新 交给 操作系统 对 这样 的 方案 有没有 可 壳 的 可能性 呢 当然是 肯定 的 张勇 因为 我们 知道 安 卓 肯定 不会 支持 任何 的 加密 或者 任何 变 字节 解码 的 它 只能 接受 也 只能 运行 标准 的 解码 换句话说 任何 基于 classesdex 整 包 加密 的 方案 在 程序 运行 之前 必然 会在 内存 中 对 字 解码 进行 解码 然后 才 输入 虚拟机 中 运行 张勇 另外 一个 事实 因为 classesdex 非常 的 大 所以 虚拟 机会 通常 倾向 采用 记忆 dump 方法来 加载 速度 并且 classesdex 也 类似 ers 也 类似 pe 所以 基于 这样 的 一些 方案 就 以下 的 一些 脱壳 的 方案 最 基础 的 方法 就是 去 查看 max 文件 从中 找到 classesdex 的 地址 张勇 去年 的 年底 的 时候 当时 的 加入 方案 还 非常 的 初级 我 记得 有 好 几家 名胜 比较 响亮 的 加密 应用 可以 直接 看到 解密 后 的 dex 的 地址 你 可以 把 它 cap 出来 就可以 解密 了 所以 当时 等于 形同虚设 张勇 随着 技术 的 发展 现在 的 加固 方案 商 都会 采取 一些 手段 来 保护 比 如从 内存 中 直接 加 内存 解码 或者 在 加载 之后 通过 max 调用 把 文件 映 射给 转 化为 文件 共 供 血量 的 过程 在 max 中看 不见 文件 映射 的 信息 很难 找到 max 张勇 即使 做到 这样 还是 有机可乘 的 第一 通常 max 文件 比 较大 需要 连续 的 文件 所以在 max 中 是 能够 找到 一些 蛛丝马迹 的 其次 因为 在 加载 dex 文件 的 时候 会 采取 max 方法 这 决定 了 它是 是 和 页 对齐 的 所以 我们 可以 变异 max 的 表象 读取 它 的 每一个 表象 开头 的 四 字节 判断 它 是否 是 max 字 位 如果是 那它 就是 max 现在 在 网上 也有 类似 的 代码 做 这个 事情 张勇 今年 五月份 的 时候 应该是 百度 的 安全 实验室 的 一个 工程师 他 做了 一个 项目 他 可以 实现 包括 对于 不少 通用 加固 方案 的 脱壳 工作 这 也是 一种 方案 以及 我 今天 跟 大家 介绍 的 如何 通过 反射 的 方法来 获取 dex 的 方案 张勇 下面 我 介绍 一下 五款 常用 加固 产品 的 原理 和 脱壳 的 方法 张勇 首先是 这个 行业 的 创始 人在 国内 就是 梆梆 加固 它 应该是 这个 行业 最早 的 倡导者 我 相信 它也 有 最多 的 用户量 针对 梆梆 的 加固 我 准备 了 两个 案例 第一个 就是 梆梆 的 企业级 用户 就是 国美 在线 第二个 就是 我 自己 的 一个 上传 的 产品 进行了 加密 张勇 梆梆 实际上 对 企业 用户 和 免费 用户 的 提供 的 防护 级别 不同 的 我 稍候 会 向 大家 解释 目前 梆梆 的 代码 是 支持 x 平台 对 梆梆 的 分析 过程中 我 发现 一些问题 首先 就是 stubclasses 并非 必须 张勇 第二 梆梆 为了 支持 art 在内部 装了 一个 东西 这个 文件 是 来自于 安 卓 的 对于 梆梆 这样 的 产品 对 它 如何 能够 实现 脱壳 包括 解密 操作 呢 我们 知道 企业 版本 和 免费 用户 版 本是 有 区别 的 张勇 对于 企业 版本 梆梆 使 用了 内存 加 dex 方法 被 梆梆 加固 的 应用 没有 做 所谓 的 dexopx 操作 的 这样 的话 会 导致 一些 程序 加固 后 的 行为 有 差异 或者 性能 变差 张勇 这时 企业 版本 做了 更多 的 防护 对于 公开 版本 而言 的话 梆梆 使 用了 标准 的 开放 方式 从 文件 中 下载 的 方式 同时 也没有 将 dex 下载 地址 往后 就是 绕 可 四 字节 的 方式 使用 公开 版本 加固 过后 的 产品 是 可以 通过 max 的 方式 找到 加固 后 的 代码 张勇 另外 对 梆梆 分析 过程中 我们 发现 对 应用 的 修改 比较 多 比如 它会 同时 启动 三个 进程 相互之间 tress 其实 这是 一个 伪 命题 所以 我 个人 建议 这个 功能 可以 砍掉 张勇 同时 梆梆 会在 运行 过程 中会 发送 一些 特殊 的 kust 这样 会 降低 代码 的 可靠性 同时 脱壳 后 的话 梆梆 在 加 壳 时 在 原始 的 文件 中 也 插 入了 相应 的 代码 这个 在 脱壳 中 都要 移除 张勇 第二 基于 classesdex 加固 方案 是 来自于 爱 加密 它 的 做法 和 梆梆 大同小异 原始 的 classesdex 会被 加密 后 放在 assets 下 它 的 方案 相对而言 可能 更加 成熟 一些 但是 跟 梆梆 比 也有 劣势 它是 不支持 安 卓 l 的 只 支持 arm 平台 张勇 爱 加密 相对于 梆梆 在 自我 调控 方面 做了 比 较多 的 工作 在 公开 的 版本 它在 下载 dex 时 用了 四个 方法 在 max 中看 不到 任何 痕迹 的 一些 关键 的 指针 被 它 替换成 错误 的 指针 这样 的话 使用 标准 的 脱壳 工具 是 很难 对 其 直接进行 脱壳 的如 何来 解决 脱壳 问题 呢 张勇 其实有 一个 办法 首先 目标 用户 中 选择 随意 的 max 方法 将其 传 递给 gni 获得 内部 的 一个 mas 对象 m mas 有 一个 指针 的 地址 这个 文件 就在 它 所在 的 区 域中 然后 在 promax 中 寻找 这个 地址 的 页 表象 然后 真正 的 dex 就 藏在 这个 地址 中 然 后用 这个 地址 寻找 起始 就能 找到 dex 我们 测试 结果 也是 跟 梆梆 一样 使 用了 将 dex 地址 从 k 对齐 位 向后 偏移 个 字节 这样 就 很好 地 避开 那个 张勇 第三个 产品 就是 现在 应用 中心 推 出了 一款 加固 宝 产品 它 也是 和 梆梆 爱 加密 一样 是 基于 classesdex 加固 的 这样 一款 产品 实验 原理 都是 非常 接近 的 张勇 我们 在 对比 的 时候 发现 我们 将 加固 解包 后 和 原始 的 apk 有 些须 的 差异 我们 认为 这是 对 apk 做了 一些 所谓 的 性能 优化 包括 像 构造 函数 优化 等等 这些 都是 在 标准 的 ods 做的 优化 目前 是 支持 x 也 能在 安 卓 上 运行 张勇 上面 就是 最 传统 的 classesdex 加密 方法 的 案例 和 分析 下面 我 想 跟 大家 介绍 的 是 基于 字节 码 变形 的 实现 会 更加 有趣 一些 这些 方案 的 出现 其实 它们 为了 解决 一个 问题 就是 我 刚才 跟 大家 介绍 的 对于 任何 classesdex 加密 的 产品 一旦 找 到了 地址 之后 所有 的 加密 都 无所遁形 你 可以 轻易 地下 载出来 对 它 为所欲为 这就 有 了 字节 码 变形 加密 方案 它本身 是 一个 执行 机密 的 脚本 张勇 换句话说 虚拟机 只要 完 成了 对 这个 文件 的 加载 文件 中 很多 部分 的 格式 也好 数据 也好 所以 它 只需 要将 这些 格式 破 坏掉 记忆 中 下载 不出来 的 classes 文件 是非 法 文件 失效 文件 为了 实现 这样 的 目的 目前 有 两种 方案 第 一在 加固 的 时候 首 先去 蕴藏 一些 dex 中 一些 关键 的 代码 然后 在 加载 的 时候 再由 程序 修复 张勇 因为 修复 的 过程 不是 发 生在 文件 本身 即便 我们 轻易 找 到了 dex 的 加载 地址 下载 后 还是 不可 执行 的 文件 我们 有 两个 方法 一个是 加密 的 时候 把 java 的 方法 改成 lunix 方法 将 字节 码 进行 隐藏 在 运行 的 时候 再将 字节 码 恢复 这个 是 腾讯 采用 的 方法 张勇 第二 在 加固 的 时候 把 dex 的 badcoad 改了 放在 其他地方 这个 方法 是的 方法 第二种 方案 在 dex 加载 后 破坏 内存 中 dex 镜像 关键 结构 体 使得 你 下载 出来 的 结构 无法 被 静态 分析 工具 或者 其他 工具 来 分析 包括 像 dex 这个 方法 是 目前 百度 采用 的 方法 张勇 如何 对 其 进行 脱壳 呢 首先 单纯 的 记忆 dump 是 无效 的 单纯 的 对 其 脱壳 的话 是 对 破坏 的 一方 进行 修复 对 dexteder 在 运行 的 时候 将其 破坏 值 在 稍候 计算出来 的 对于 像 某些 支持 ark 的 方案 还有 比较 独特 的 方案 就是 劫持 系统 的 dex 的 oat 这样 把 原始 的 偷出来 张勇 第二种 像 腾讯 和 对 max 进行 处理 来 隐藏 其 字节 码 方案 也有 对应 的 方法 就是 修复 max 张勇 下面 我 想 跟 大家 分享 一下 我们 对 市面 几 款 使用 变形 技术 的 加固 产品 的 技术细节 的 分析 首先 就是 腾讯 腾讯 的 加固 产品 应该 说是 我 个人 认为是 最 别出心裁 的 对于 其 他家 的 加固 产品 通常是 对应 一个 pk 上去 加固 一个 回 传过来 但是在 腾讯 中 需要 填写 需要 加固 的 函数 名为 什么 会有 这样 的 情况 这 跟 它 的 做法 是 直接 相关 的 张勇 因为 腾讯 的 应用 加固 方案 在 加固 的 时候 会将 真正 的 函数 的 类型 从 java 函数 改为 linux 函数 将 关键 的 结构 体 给 清空 让 静态 分析 工具 认为 这个 函数 是 没有 任何 字节 码 的 就可以 跳过 对于 未 加固 的 函数 没有 任何 变化 张勇 我们 注意到 腾讯 的 加固 其实 并没有 真正 把 字节 码 藏起 来给 放到 其他地方 字节 码 其实 还在 这个 dex 文件 中 只不过 它 修 改了 函 数到 字节 码 的 指针 让 静态 分析 工具 和 虚拟机 认为 这个 函数 是 不需要 字节 码 的 解密 的 时候 也是 同样 的 做法 找到 函数 和 字节 码 的 对应 恢复 就 好了 张勇 这个 是 打 开了 一个 腾讯 应用 加固 方案 后 的 一个 被 加密 的 伪 函数 这个 函数 里 设置 了 ak 了 它 的 代码 属性 被 设成 no 就是 没有 代码 我们 打开 dex 文件 本身 我们 发现 字节 码 还 保存着 只是 你们 不知道 如何 将它 和 函数 利用 起来 张勇 这个 方案 其实 非常 的 有 开创性 我 个人 觉得 非常 赞 但是 最大 的 问题在于 由于 art 原理 这个 不可能 支持 art 的 因为 在 art 运行 中 因为 art 运行 环境 首 先将 dex 文件 编译成 本地 代码 然后 在 这个 过程中 它 生成 的 并非是 dex 而是 elf 格式 的 一个 本级 代码 腾讯 这种 做法 不可 能在 art 环境 下在 运行时 重新 将 这个 函数 指向 另外 一个 地方 所以 目前 腾讯 的 方案 仍然是 完全 不支持 art 的 我 觉得 未来 这个 方案 可能 也 无法 支持 art 张勇 解密 其实 非常 简单 使用 dvl 的 函数 盖 到 mascoad 的 地址 计算出 这个 偏移量 然后 就可以 修复 这个 函数 的 类型 所以 我 个人认为 这个 方案 是 非常 巧妙 的 当然 就像 我 ppt 中 写 的 这个 字节 码 是 无法 保存 的 安全感 会比 较差 一些 张勇 最后 一个 方案 也 就是 最近 刚刚 百度 发布 的 一个 混合 的 方案 百度 的 方案 是 混合 了 classesdex 加固 以及 classesdex 字节 码 变形 的 两种 方式 的 一个 方案 应该说 在 目前 是 最为 完善 的 张勇 百度 的 方案 对于 dex 加固 这块 它 和和 梆梆 和 爱 加密 是 完全相同 的 也 并无 太多 新意 但是 另外 一边 它是 如 何来 隐藏 dex 的 内容 呢 张勇 当 使用 百度 加固 方案 后 它 会将 很 重要 的 dex 的 头 的 重要 的 位置 给 清空 包括 dextider 当你 下载 不出来 的 时候 这个 文件 实际上 是 无法 识别 也 无法 做 静态 分析 的 地 可以 看到 dex 头 全是 零 包括 后面 的 opt 信息 全是 零 了 怎么样 来 实现 脱壳 张勇 脱壳 方法 相对而言 也 比较简单 既然 百度 将 信息 清 空了 我们 将其 还原 就是了 基于 dex 的 一些 特性 它是 连续 的 并且 不允许 有 空隙 的 我们 是 可以 根据 aseent 的 格式 是 固定 的 而且 百度 没有 将 每个 字段 的 长度 给 清零 所以 我们 只要 算出来 第一个 aseent 的 位置 然后 aseent 加把 每个 数字 填起来 就可以 了 张勇 后面 后 这个 dex 可以 成功地 被 其他 的 静态 工具 分析 了 相对而言 百度 的 加固 我 个人认为 比较完善 的 因为 它 结合 了 现在 的 两种 方式 同时 也有 比 较高 的 dop 难度 还 支持 x 和 安 卓 平台 张勇 但是 百度 加固 会在 原始 dex 文件 中 插入 很多 百度 代码 我 个人 比较 不喜欢 这样 的 行为 这是 从 我们 自己 工具 里 摘取 出来 的 代码 它是 来 重构 dextider 张勇 最后 我 想 提 一下 早期 版本 实际上 最新 版本 中 已经 使 用了 类似 梆梆 和 爱 加密 的 方法 在 它 早期 的 方法 也是 有 创意 的 这种 方法 破解 难度很大 但是 它在 目前 的 版本 上 为什么 没有 延续 我 觉得 还是 跟 兼容性 相关 因为 目前 来看 的话 所有 dex 字节 码 变形 的 方案 和 art 都 存在着 或多或少 接入 性问题 张勇 最后 我 最近 做的 一些 研究 的 总结 首先 我们 认为 应用 加固 的 产品 本身 技术 也好 包括 攻防 也好 是 高速 发展 去年 搜集 这个 关键词 应该 看不到 太多 的 信息 今年 搜 加固 可以 搜到 大量 的 信息 我们 也 看到 随着 早期 的 dex 文件 加密 的 方式 的 成熟 现在 其实 也有 更多 更新 的 方式 在 重现 加 壳 的 强度 也 会 越来越高 据 传言 国内 已经有 一些 厂商 实现 了 类似 pc 上面 的 技术 能够 进一步 提升 加固 强度 但是 目前 没有 看到 在 公开市场 上有 这样 的 案例 张勇 第二 art 是 安 卓 的 未来 从 安 卓 l 开始 art 本质 是 在运 行前 将 字节 码 编 译为 本地 指令 任何 试图 将 这个 解码 隐藏 都会 导 致使 本地 指令 无法 执行 这 也是 目前 和 腾讯 无法 解决 的 未来 可能有 其他 的 方式 像 安 卓 mass 上面 有的人 做的 方案 能够 未来 对 eot 进行 pach 我们 认为 art 在 加固 方面 还有 很多 空间 目前 还 不是 很 成熟 张勇 最后 应用 加固 它 其实 还是 有 很多 兼容 性问题 的 在 实际 测试 过程中 我们 也 注意到 像 不同 的 硬件 平台 像 不同 版本 的 系统 甚至 像 不同 厂商 的 手机 为什么 会有 这样 的 问题 呢 张勇 因为 作 加固 中 很多 操作 是 需要 通过 反 射来 做的 还有 很多 操作 是 许多 对 结构 体 进行 修改 我们 知道 安 卓 是 开放系统 任何 厂家 都可以 修改 这些 结构 体 这就 导致 了 在 某些 手机 上面 这个 结构 体 的 偏移量 或者 位置 地址 是 不同 的 这会 影响 它 同 其他 设备 兼容性 的 问题 张勇 在 最近 一段时间 我 的 很多 朋友 问我 对 坚固 问题 怎么看 从 目前 来看 我 认为 加固 并不是 万能 药 而且 有 很多 脱壳 工具 对 开发者 而言 一个 完整 的 体系 才是 他 所 需要 的 他 需要 多管齐下 才能 真正 解决 apk 安全问题 单纯 加固 肯定是 不 足够 的 主持人 感谢 张 总 最后 还给 大家 提出 一个 建议 张 总 讲 的 很 细致 的 做 这 方面 研究 的 朋友 应该 可以 听得出来 我 想问 张 总 一个 问题 作为 一个 ceo 为什么 你 还 坚持 这么久 做 技术 呢 张勇 我 之前 已经 讲了 其实 我 自己 从 本质上 讲 我 还是 一个 工程师 而且 到现在 我 还 坚持 写 代码 我 觉得 对 创业 公司 来讲 的话 我 认为 保持 一个 写 代码 的 习惯 能够 让 我 跟进 时代 潮流 技术 潮流 能 更好 地 把 控 产品 主持人 感谢 张 总 所以 奋斗 在 一线 的 工程师 们 不要 灰心 接下来 进入 下一个 议题 下一个 议题 是 关于 比特 币 的 最近 它 的 事故 不少 今年 乌云 知识库 上 也有 一篇 关于 比特 币 分析 的 文章 今天 请 到了 快 钱包 的 创始人 这个 内行人 带 大家 了解 一下 关于 比特 币 的 安全 张 健 大家好 我 的 标题 是 比特 币 网络 交易 及 存储 安全 议程 上 说是 金融 安全 我 没 改过 我 不知道 标题 怎么 变了 不知道 是不是 比特 币 比较 敏感 张 健 谈到 比特 币 我 为什么 站在 这里 首先 大家 认为 比特 币 是 货币 或者 说是 互联网 金融 的 一个 范畴 为什么 和 安全 会有 如此 大 的 关系 呢 其实 我 想说 比特 币 的 诞生 可能是 属于 安全 的 范畴 有 属于 互联网 金融 的 范畴 我 第一章 从 比特 币 本质 讲起 张 健 我 现在 想做 一个 小 的 调查 就是 台下 的 各位 有没有 没听说过 比特 币 的人 应该是 没有 第二个 调查 谈 一 下有 多少人 现在 不去 查 知道 现在 比特 币 大概在 什么 价格 第三个 问题 有 几个人 知道 驱 快 店 这个词 张 健 这样 的话 我 就 第一章 讲 长 一点 但是 如果 大家 不知道 比特 币 是什么 的话 这个 安全 就 无从谈起 第一点 数字 货币化 和 数字 货币 其实 数字 的 货币化 不是 一个 将要 发生 的 事 它是 一个 已经 进展 很 深入 的 事 就是 我们 现在 所用 的 大部分 的 交易 特别是 大 的 交易 其实 很少 用到 现金 我们 用 的 都是 银行 转帐 或者 信用卡 合适 这些 根 本不 涉及到 真正 的 实物 的 就是 钞票 的 交流 就是 数字 张 健 比如 我 转帐 给你 只 不过是 在 我 的 银行户头 上 减了 这个 数字 在你 的 银行户头 上 加了 这个 数字 而已 这个 现在是 非常大 的 趋势 但是 为什么 还要 提 数字 货币 这个 概念 就 目前 的 数字 货币化 其实 非常 不 彻底 它是 支 付上 的 而 不是 本质上 的 数字化 其实 这个 问 题在 很久以前 在上 世纪 七十年代 八十年代 就 有人 不断地 提出 是否 货币 可以 数字化 为什么 呢 因为 货币 从 本质上 讲 它 就是 起 到了 信息 的 中介 可以 这么 认为 吧 所谓 的 一般 等价物 它 本质上 其实是 中介 它本身 不需 要有 任何 价值 张 健 比如说 你 现在 拿 的 一百 块钱 钞票 它本身 就是 印刷 价值 这个 成本 可能 非常 少 是 谁 赋予 它 的 价值 这是 很 深刻 的 问题 人类社会 经历 了 太多 经济危机 经历 了 太多 波动 但是 它 的 根源 跟 货币 都有 绕 不开 的 关系 因为 没有人 知道 现实 社会中 究竟 需要 多少钱 我们 先 不去 揣测 发钞 者 他 可能 会有 一些 恶意 的 成分 比如 某些 国家 的 政府 它有 可能会 超 发 的 情况 即使 它是 想 让 整个 货币 体系 和 金融 运行 的 更加 稳定 它也 不能够 知道 究竟 需要 多少 货币 张 健 这个 其实在 经济界 就有 很大 的 争论 不知道 货币 战争 这 本书 大家 看到过 没有 里面 提 到了 金本位 就是 它要 回 归到 金本位 因为 现在 的 钞票 可 可以 随便 印 的 这个 思想 其实是 完全 不可行 的 因为 黄金 有 一个 最大 的 问题 就是 它 根本 不能够 用于 现代 的 支付 我 不可 能说 我 买东西 切块 黄金 给你 这是 已经 早 已被 淘汰 的 东西 张 健 我 顺着 刚才 的 话题 讲 其实 货币 数字化 的 根基 是 帐单 我 刚才 举 的 例子 我 给你 转帐 一万 块钱 其实 只是 银行 系统 的 数字 改 变了 一 下在 我 的 帐单 上 减 去了 这一 万 块钱 在你 的 帐单 上 加了 一万 块钱 所以说 比特 币 其实 本质上 就是 一个 帐单 但是 想 实现 这样 的 帐单 有 很多 困难 下一 章 我会 讲到 就是 如何 实现 全球 唯 一无 中心 节点 的 数字化 帐 单张 健 当然 中心 节点 这个 问题 可以 稍微 提 一下 就是 如果有 任何 一个 服务器 或者 组织 或者 个人 或者 政府 它 拥有 这样 中心 化 的 权利 那 它就 违背 了 我们 发行 的 公平 等一会儿 我会 讲到 张 健 第二个 全球 唯一 这点 也 非常 难 大家 可以 想像 一个 数字 或者 一段 数字 如何 能够 成为 货币 因为 数字 是 可以 任意 复制 的 所以说 这个 是 一个 下面 要 解决 的 就是 比特 币 要 解决 的 核心问题 或者说 数字 货币 要 成功 要 具备 的 基本条件 第一 发行 问题 如何 发行 和 如何 保证 公平 张 健 第二 造假 问题 如何 解决 重复 花费 的 问题 和 如何 保证 帐单 不可 篡改 这个 问题 比特 币 是 通过 驱 快 店 完美地 解决 了 上述 两个 问题解决 的 方法 就是 驱 快 店 是什么 我 花 几分钟 讲 一下 驱 快 是什么 概念 如果把 驱 快 理解为 全网 的 帐单 驱 快 就是 这 帐单 的 一页 这一 页 不停 的 往上 加 它为 什么 会 成为 链条 张 健 这要 谈到 密码学 下面 我 会讲 但是 驱 快 的 谁来 增加 一页 帐单 谁能 够为 这个 帐单 记上 一笔 记录 这个 是 要 通过 算 例 来 竞争 的 这是 比特 币 最初 的 设定 也就是说 如果是 比如说 你 是 一个 村子 你 要 发行 一个 我们 随便 举 一个 例子 一个 组织 要 发行 内部 的 货币 系统 如果 这个 组织 的 负责人 可以 记 这个 帐 他 就有 动机 篡改 这个 帐单 所以 无法 保证 发行 公平 的 问题 张 健 所以 我 说 为什么 区 快 店 完美 解决 了 两大 问题 第一 你 要 取得 记帐 权 就要 通过 算 例 来 竞争 第二 如果 你 竞争 到 这个 区 快 的 记帐 权 你 就可以 获得 一定 比例 的 奖励 这 就是 货币 的 发行 所以说 它把 记帐 和 货币 的 发行 完美地 通过 区 快 店 的 方式 集成 在一起 这是 比特 币 能 成功 的 基本保障 张 健 谈到 密码学 第一 就是 公 钥 密码学 前几天 的 有人 黑了 宗 本 聪 邮箱 但是 现在 身份 没有 暴露 可以 肯定 他 在 密码学 方面 造诣 非常 深 的人 当然 不仅仅是 密码学 还有 金融学 他 完美 通过 数字 的 方式 模 拟了 黄金 的 属性 又 避免了 黄金 的 最大 的 缺点 我 刚才 讲到 的 就是 支付 根本 不方便 公 钥 密码学 是 这样 比特 币 采用 的 是 公 钥 密码学 中 的 算法 就是 你 通过 私钥 的 方法 公 钥 可以 验证 但是 公 钥 不能 签 这个 名 张 健 这是 一个 数字签名 算法 的 一个 特性 所以 它能 保证 pb 中 交易 的 真实性 就是 我 能 完全 确定 你 这个 交易 是 拥有 cell 的人 签名 发出来 的 如果 没有 签名 马上 会被 比特 币 网络 拒绝 第二个 特性 就是 通过 公 钥 推算出 私钥 这个 在 理论上 是 可行 的 但是在 计 算上 是 不可行 的 比如 要花 人类 一万年 甚至 十万 年 时间 这个 其实 可以 认为 计 算上 是 不可行 的 这是 公 钥 密码学 它是 比特 币 的 根基 之一 张 健 还有 哈希 算法 就是 这个 链条 是 如何 形成 的 其实 每一个 区 快 它 的 发行 值 是 有 记忆 的 它 记忆 了 从 比特 币 区 快 店 诞生 就是 第一笔 交易 到现在 所有 的 信息 都在 那一个 值 里 体现 出来 这个 就是 通过 不断地 哈希 所以 它 不会 漏掉 任何 一个 信息 你 试图 去 更改 一个 帐单 不管是 一个 月前 甚至 几 前年 任何 一个 字节 都会 导致 整个 区 快 店 的 失效 张 健 第二 生成 新 区块 的 工作 证明 这个 值 是 比特 币 非常 创新 的 一个 概念 刚才 我 提到 的 如何 能够 就是 谁有 这个 权利 记 这个 帐单 特别 最 货币 来说 这是 一个 至高无上 的 权利 但是 如何 不让 这个 权利 被 滥用 宗 本 聪 发 明了 一个 方法 就是 工作量 证明 张 健 就是 这个 方法 最初 源于 垃圾邮件 的 防范 当时 垃圾邮件 是 长期存在 的 问题 后来 有 一个人 提出 了 解决方案 让 发送 正规 邮件 的人 要 计算 一个 数字 比如说 计算 一个 哈希 值 其实 对 普通 的 pc 机 计算 这个 值 非常快 你 感受 不到 但是 对 滥发 邮件 的人 这个 运算量 是 很大 的 张 健 所以 这个 想法 是 源于 垃圾 防范 它 非常 完整 的 保证 了 比特 币 的 公 平和 安全 公平 可以 很好 理解 因为 谁 提供 的 算 例 最多 谁 就能 优先 算出 这个 值 这个 值 哈希 函数 一个 特点 就是 正着 算 很简单 倒 着 算 不可能 所以说 打包 区块 或者说 竞争 新 区块 的 算法 是什么 呢 张 健 就是 暴力破解 一个 值 这个 值 只是 我 规定 的 一个 特定 的 值 比如 小于 某个 值 你 只要 试出 来了 你 就 拥有 这次 记帐 权 你 就可以 赢得 一个 区块 打包 一个 比特 币 现在 比特 币 算 例 非常 非常 强大 特别是 经历 了 去年 价格 暴涨 之后 现在 它 的 算 例 应该在 的 pp 的 概念 我 不知道 大家 熟 不熟悉 张 健 就是 每秒钟 大 概要 运算 的 p 的 sh 哈希 运算 这个 算 例 其实是 一个 天文数字 大家 有 兴趣 的话 可以 算 一下 这个 数字 有 多 大张 健 下面 回顾 一下 比特 币 发生 的 安全 事件 其实 比特 币 虽然 诞 生于 安全 诞 生于 密码学 但是 同样在 那方面 非常 非常 脆弱 这 里面 丢失 的 比特 币 数量 应该 都是 上万 的 还有 上 十万 的 在 我 展示 的 七八 笔 事件 中 丢失 的 比特 币 数量 就 高达 一百 多 万 我 没有 仔 细算 大概有 万 左右 现在 比特 币 发行 的 数量 是 万 就是 我 记录 的 这 几个 事件 占了 全网 比特 币 事件 的 张 健 但是 真实 的 丢失 虽然 这 上面 有 一些 不一定 真实 但是 真实 的 丢失 应该 远远 不止 如此 我 估计 在 以上 包括 丢掉 包括 被盗 所以 这 反映 了 一个 非常 严重 的 问题 就是 比特 币 很难 伪造 却 不难 窃取 可能 这个 话题 大家 比较 感兴趣 张 健 就是 比特 币 非常 难于 伪造 不仅仅是 我 刚才 讲到 的 两个 一个是 公 钥 的 数字签名 算法 还有 哈希 值 在 保证 从公 钥 推算 私钥 不可行 但是 一旦 泄露 你 的 比特 币 就 会被 一扫而光 也就是说 你 存在 银行 的 钱 可能 没 这么 容易 丢失 但是 你 放在 机器 上 的 比特 币 有 可能 在你 不经意 间 就 丢 掉了 张 健 不知道 大家 看到 这个 图 有没有 什么 特别 的 想法 虽然 这是 一个 窃取 的 图 但是 我 想说 的 是 这是 一个 新闻 这个 新闻 说的 是 美国 的 一个 大学 安全 方面 的 教师 发现有 一些 黑客 黑 掉了 很多 类似于 这样 的 摄象头 用于 比特 币 的 挖矿 这个 事 挺多 逗 的 摄象头 能 挖 多少 矿 张 健 现在 进入 案例 的 分享 第一 自己 弄丢 这是 一个 最 简单 的 丢 的 方式 但是 这种 方式 占 的 比例 相当 大我 没有 一个 具体 的 统计 比如说 这个 交易所 在年 的 时候 它 由于 升级 自己 的 就是 它把 服务器 放在 亚马逊 由于 提示 资源 不够 它 升级 自己 的 系统 结果 不知道 因为 什么 方式 设置 被 改了 造成 文件 全部 丢失 而且 它还 没有 备份 结果 损失 了 比特 币 导致 这个 交易所 直接 关门 造成 这些 比特 币 直接 出售 张 健 可能有 一些人 已经 知道 这个 事情 就是 最后 这一 条 一个 公司 破产 的 时候 它 宣称 丢 掉了 万个 用户 的 比特 币 和 万个 自己 的 比特 币 加起来 超过 亿 美金 这是 一个 非常 惊人 的 数字 张 健 第二 黑客 攻击 这个 案例 挺有 意思 这个 交易 所在 一年 四个月 的 时间内 被人 黑了 三次 每一次 黑 的 数量 都 挺大 第一次 是 万个 第二次 是 万千 个 第三次 是 万个 加起来 差不多 有 万个 而且 每次 黑 的 方式 不同 第一次 黑 的 托管商 第二次 闯入 帐户 通过 电子邮件 第三次 稍候 我 会讲 一下 张 健 刚才 我 问 大家 比特 币 价格 的 时候 不知道 有 几个人 查 了 它 价格 现在 人民币 不到 三千元 这个 交易所 很有 意思 它 第三次 被盗 的 时候 在 它 被盗 的 前一天 这个 交易所 创始 人在 qq 群 里 大量 出售 他 的 lr 和 bcorn 而 且说 要 多少 有 多少 张 健 所以说 很多人 怀疑 这是 监守自盗 因为 被 黑了 很 多次 不在乎 自 黑 一次 然后 彻底 关门 因为 我 一个 朋友 在 这个 事件 中 丢失 了 个 比特 币 所以 他 要求 我 一定 提下 这 个人 这个 人叫 周 彤 张 健 案例 三 攻击 服务 托管商 刚才 那个 交易所 第一次 被黑 是 黑了 它 的 托管商 这个 托管商 出 的 事 太多 其中 一个 跟 比特 币 有关 就是 超级 管理员 密码 泄露 因为 不费 工夫 就可以 更改 用户 的 密码 因为 他 是 一个 相当于 后台 客户 服务 的 帐号 被 泄露 这个 黑客 拿 到了 超级 管理员 权限 之后 就 扫描 所有 程序 最后 只 选择 了 攻陷 八台 张 健 就是 因为 这 八 台上 运 行了 比特 币 程序 也就是说 这个 黑客 就是 冲着 比特 币 来 的 这 八 台中 出现 了 这三个 人 就是 刚才 的 那家 交易所 还有 一个 矿石 它 应该是 排 第三 第四 的 还有 一个 比特 币 当时 的 首席 科学家 这个 人 居然 也 丢失 了 个 比特 币 所以 这个 事件 给 我们 的 启示 千万 不 要把 私钥 放在 云 平台 即使 你 没有问题 他 可能 黑 掉 你 的 上级 张 健 域名 劫持 这 也是 一个 挺 典型 的 案件 黑客 利用 公开 的 信息 获得了 这个 拥有 者 的 出生地点 和 母亲 婚前 姓名 说服 注册 商 交 出了 域名 和 控制权 进 而又 控制 了 他 的 电子邮件 最后 进入 他 在 一个 交易平台 的 帐户 然后 把 这个 交易平台 全部 侵 了 张 健 虽然 得逞 的 原因 因为 公开 的 这些 情况 可能 跟他 并没有 直接关系 但是 他 没有 开启 双边 验证 这是 一个 安全 上 的 漏洞 但是 这个 公司 也 挺有 故事 的 其实 这 里面 每个 公司 都 挺有 故事 的 这些 公司 的 创始人 也是 在 今年初 因为 洗钱 被 fbi 逮捕 了 现在 应该 还在 fbi 那儿 张 健 这个 事件 是 今年 六月份 一个 挺有 意思 的 事情 因为 今年 六月份 美国 发行 局 组 织了 对 丝绸之路 的 比特 币 拍卖 丝绸之路 是 当时 一个 非常大 的 比特 币 卖东西 的 应该是 电 商 网站 但是 它 卖 的 东西 都是 毒品 之类 的 所以 最后 通过 fbi 的 钓鱼 把 这 个人 抓了 扣押 了 它所 有的 比特 币 有 一个人 有 万个 当时 是 余额 最大 的 比特 币 地址 就是 fbi 扣 的 丝绸之路 地址 张 健美 国 发行 局 不慎 泄 露了 拍卖 的 名单 这个 攻击者 就 伪造 的 也 不是 伪造 就是 发 一个 采访 的 文件 只是 带了 一个 木马 而已 发给 了 一个 竞 拍 的 公司 这家 公司 是 澳大利亚 的 一家 比特 币 的 公司 这个 剩下 的 事情 就 比较简单 了 张 健 这个 案例 体现在 安全 上 的 问题 就是 即使 他 侵 入了 你 的 系统 并不一定 拿走 你 的 比特 币 所以 刚才 猪猪 侠 提到 的 一个 事情 就是 很多 安全 方面 的 大 漏洞 不在于 你 在后 的 方法 做了 多少 而在于 里 最薄 的 方面 是不是 犯了 非常 愚蠢 的 错误 所以说 其实 你 只要 不犯 错误 可能 就不会 出现 这样 的 问题 张 健 下个 案例 是 最新 刚刚 发生 的 一个 案例 就在 上个月 国内 的 一家 平台 这个 不是 比特 币 但是 也是 比特 币 的 衍生 货币 我们 统 称为 山寨 币 这个 币 也 值 点钱 被盗 了 万个 张 健 被盗 的 过程 几乎是 全 公开 的 可能 黑客 不愿意 暴露 自己 的 地址 直接 在 他们 的 地址 上 谈判 这是 我 贴出来 的 黑客 在 论坛 里 说 的话 他 说 ceo 的 服务 用了 同一个 密码 所以 这是 一个 挺有 意思 的 事 如果 大家 没有 了解 的话 可以 去看 一看 因为 这个 事件 完 整地 曝 光了 张 健 也就是说 开始 谈判 过程中 比特 儿 可以 强硬 的 取款 但是 后来 因为 种种 的 担心 其实 他 内心 比较 心虚 的 后来 逐渐 被 黑客 掌握 了 谈判 的 主动权 所以 这个 nxt 事件 还有 另外 一个 原因 就是 这个 山寨 币 不 能做 冷 钱包 冷 钱包 是什么 意思 就是 把 私钥 可以 放在 自己 家里 这样 的话 黑客 就 无法 侵入 张 健 下面 我 总结 一下 比特 币 在 交易 和 存储 方面 面临 的 安全 风险 第一 存储 的 风险 这 分 两大块 第一 私钥 文件 损坏 或者 比特 币 丢失 就是 私钥 直接 丢失 了 张 健 合适 这个 刚才 我 也 提 到了 这个 造成 的 丢失 不在少数 包括 最大 的 一个 丢失 事件 门头沟 那个 事件 万个 比特 币 有 部分 人 怀疑 私钥 是 管理 不善 就是 没有 备份 的 后果 是 灾难性 的 应该有 三四 个人 找过 我 其中 一个人 相当 典型 他 属于 本地 的 私钥 损 坏了 把 钱包 发给 我 问 能不能 恢复 说 恢复 的 钱 分 我 一 半张 健 我 经过 很 多次 尝 尝试 后 真的 不能 恢复 所以 这样 的 情况 下不 管你 有 多少 资产 很快 就 丢 掉了 就是说 没人 能 花 这笔 钱 就是 它 永远 的 丢 掉了 其实 丢掉 这些 钱 让 比特 币 整体 的 数量 稍微 减 少了 一些 张 健 第二种 情况 就是 私钥 被盗 这个 也是 非常 普遍 的 可能 每个月 甚至 每周 都在 发生 这个 对 安全 性要求 非常 高 包括 企业 我们 公司 也 会 采用 冷 钱包 的 存储 架构 去做 这样 的 安全 防范 张 健 也就是说 因为 你 要用 比特 币 进行 支付 所以 你 必须 在 业务 的 层面 保证 有 一定 的 私钥 或者 有 一定 的 逼债 所以 你 不能 百分之百 冷 存储 所以 现在 很多 交易所 将 大部分 币 冷 存储 一旦 黑客 侵入 而且 侵入 的 级别 比 较深 拿到 这些 私钥 也 不会 损失 在 线下 冷 钱包 的 钱 这是 一个 现在 普遍 的 一个 架构 张 健 其实 交易 安全 风险 比特 币 还是 做的 非常好 这 也是 比特 币 安全性 一方面 叫 双 发 攻击 因为 比特 币 是 pp 的 架构 什么意思 呢 就是 每 花 一笔 钱 这笔 交易 是 通过 这个 结点 性质 广播 给 全网 就是说 全网 不同 节点 接受 这个 交易 的 节点 时间 是 不同 的 所以有 可能 你 可能 同时 广播 两个 交易 一个 交易 是 发给 交易 的 商家 另一个 交易 是 发给 自己 通过 不同 的 节点 广播 一旦 出现 了 假如说 你 又 同时 掌握 了 比 较大 的 算 例 张 健 你 就可以 通过 自己 的 算 例 优先 确认 你 广播 发给 自己 的 这笔 交易 而 推翻 发给 商家 的 那笔 交易 所以 商家 会 误认为 收到 这笔 钱 但是 后来 事实上 这笔 钱 消失 了 这 就是 双 发 攻击 避免 这个 攻击 的 方法 非常 非常 简 单张 健 因为 这个 攻击 的 成本 非常 之高 所以说 只 要在 发送 大额 交易 的 时候 比如说 几千个 或者 上万 个 等待 足 够多 的 确认 数量 就可以 避免 这个 攻击 因为 攻击 程度 概率 随 确认 数量 的 增加 呈 指数 级 下降 的 张 健 谈到 比特 币 私钥 容易 被盗 它 的 脆弱 性问题 其实 所有人 都 认识到 这个 问题 包括 比特 币 核心 开发 团队 所以 在年 采访 中 比特 币 首席 科学家 说 正在 添加 一个 新 的 特性 这个 特性 可以 降低 比特 币 钱包 受到 攻击 后 的 脆弱性 这个 特性 叫 多重 签名 交易 张 健 什么意思 呢 简单 讲 一下 就是 传统 的 私钥 被盗 相当于 这个 地址 商 的 钱 全部 被人 拿走 但是 通过 多重 签名 交易 生成 就是 多个 私钥 共同 生成 这个 地址 然后 有 m 个 私钥 签名 这个 地址 上 的 交易 然后 m 和 n 都可以 自定义 只要 m 小于 n 就可以 这就 造成了 安全 方面 的 特性 张 健 不仅 仅对 存储 还有 交易 就是 对 不同 的 角色 赋予 不同 的 私钥 保证 比特 币 本身 的 安全性 比特 币 第一次 从 技术 层 面上 实现 了 真正 的 可执行 的 担保 交易 比如说 支付宝 的 担保 交易 它是 用 支付宝 信誉 担保 的 买卖双方 都 相信 支付宝 平台 但是 通过 多重 签名 技术 步入 说 三把 私钥 生成 一个 地址 只要 其中 两把 私钥 同意 才 能动 这个 私钥 的 钱 张 健 我们 有 一个 买方 卖方 和 担保 方 平常 正常 的 交易 就是 我们 可以 把 币 打到 这样 多重 签名 的 地址 如果 买方 卖方 都 同时 同意 这笔 交易 完成 这笔 交易 就不 需要 中间方 或者 仲裁方 介入 一旦 出现 纠纷 仲裁方 可以 决定 这笔 钱 归 给谁 但是 仲裁方 没有可能 能把 这笔 钱 拿给 自己 张 健 所以说 买方 和 卖方 也 不能 单 方向 把 钱 拿给 自己 这就 造成了 一个 从 技术 层 面上 杜 绝了 担保 交易 互相 不 可信 的 问题 张 健 最后 做 一下 广告 快 钱包 是 国内 第一家 采用 多重 签名 的 比特 币 钱包 我们 采 用了 两把 私钥 一把 私钥 是 保 存在 我们 的 服务器 上 另一 把 保存 在 用户 本地 从 本地 生成 我们 也 不存 这样 任何 一笔 交易 都要 有 两 私钥 签名 才能 发出去 这种 情况下 是 彻底 避免了 单点 的 风险 张 健 也就是说 其实 你 很难 保证 一个 系统 是 没有 任何 漏洞 的 所以说 我们 希望 做到 在 严重 的 情况 发生 的 前提下 我们 仍然 能 保证 资产 安全 当然 不 代表 我们 做 就是 降低 我们 服务器 的 安全 只是 说 我们 在 根本上 杜 绝了 单点 的 风险 张 健 所以说 我们 的 安全 方案 是 远远 优于 本地 的 钱包 和 普通 的 在线 钱包 的 企业级 就是 我 刚才 讲 的 我们 可 以为 不同 的 角色 因为 企业级 我们 可以 分配 更多 的 角色 包括 审核员 管理员 发起者 所以 可以 定制 更加 安全 的 钱包 解决方案 主持 人下 面请 梆梆 安全 cto 陈 彪 谈 一下 移动 金融 客户端 安全 风险 分析 陈 彪 今天 时间比 较紧 我 重点 介绍 一下 我们 提供 的 解决方案 主要 就是 梆梆 加固 的 技术 梆梆 有 两代 技术 和 安全 评估 大家 都 知道了 就是 安全 分析 人员 模拟 黑客 行为 对 你 的 系统 进行 模拟 入侵 陈 彪 带 手机 端 的话 基本 有 一个 规范 就是 中国人民银行 的 客户端 软件 的 支付 规范 这个 里面 就 规定 了 客户 软件 应该 怎么做 然后 我们 现在 基本 按照 这个 软件 来 做 相应 的 安全 评估 这里 的话 主 要是 用到 的 一些 工具 如果 做 安 卓 开发 的 就 非常 清楚 了 陈 彪 可能 提 一下 xpos 这个 是 当 我们 能够 就是 装载 这个 框架 之后 我们 只 要写 一个 插件 这个 方法 能 注入 到 任何 web 的 程序 里 比如 一个 银行 给你 一个 login 我 就能 够用 这个 方法 写个 插件 直接 截 取到 用户名 和 密码 陈 彪 根据 这个 我们 做了 安全 评估 基本 从这 几个 方面 做的 第一 方面 程序 安全 这个 方面 来 做的 包括 它 一些 安装 卸载 这 部分 另外 一个 就是 从 代码 安全 就是 它是 不是 具备 一定 的 防 侏儒 这些 能力 另外 我们 检查 所有 数据 的 输入 到 数据 的 存储 以及 传输 过程中 是否 存在 安全 风险 实际 这块 银行 比较 关注 的 陈 彪 另外 我们 在 安 卓 上会 暴露 很多 的 组件 这些 都会 形成 一些 风险 当你 弹出 一个 界面 的 时候 后台 木马 会 弹出 一个 假 的 把 当前 的 覆 盖掉 你 在 这个 界 面上 输入 的 就 会被 后台 的 木马 拿 走了 陈 彪 我们 可以 检查 通信 安全 和 业务 安全 我们 现在 做的 poc 基本能 实现 转帐 大部分 银行 客户端 转帐 过程 都能 篡 改掉 通过 侏儒 代码 方式 直接 把 客户端 转帐 的 过程 的 交易 修 改掉 我们 可以 检查 系统安全 这块 就是说 如果 后台 有 一个 木马 你 的 程序 输入 用户 密码 的 时候 会被 它 直接 拿到 陈 彪 下面 我们 做 一些 基本 的 测试 第一个 就是 反编译 基本 来说 这块 就是 我们 的 强项 了 就是 我们 后面 解决方案 重点是 针对 安 卓 反编译 来 做的 后面 没有 加固 的话 通过 反编译 这个 能 拿到 前部 的 原码 最后 拿到 服务器 等 算法 都能 拿到 的 陈 彪 比 如对 某个 金融 客户端 重 打包 基本 这种 情况 加上 任意 coad 都可以 加入 的 我们 这个 图里 只是 添 加了 一些 广告 的 代码 还有 一种 我们 通过 代码 注入 方式 注入 新 的 coad 注入 进去 之后 能把 这个 客户端 里 所有 敏感数据 我们 想要 拦截 哪些 敏感数据 全部 都能 拿到 陈 彪 基本上 来说 如果说 一般 金融 应用 开发 客户端 来说 它们 没有 做 一些 保护 的话 在这 几项 上 基本 可以 做到 很 容易 攻击 的 陈 彪 下面 看一下 它可 能 面临 的 风险 我 归纳 了 几类 用户 信息 安全 交易 的 安全 二次 打包 的 风险 有 可能 通过 逆向 发现 移动 端 和 服务器端 的 漏洞 像 我们 通常 用 手机 银行 的话 会用 软键盘 输入 密码 的 时候 很多 时候 软键 盘在 开发 的 时候 做的 事情 会 发现 软键 盘上 只不过 把 界面 掩 盖了 但是在 内存 里 你 输入 的 用户 密码 一直 存在 的 陈 彪 简单 的 hook 掉 一些 之后 就能 拿到 用户名 和 密码 金融 的 客户端 因为 很多 情况下 是 外包 的 就是 程序员 开发 的 水平 是 有 一些 弱 的 就是 很多 本地 存储 上 根本就是 会有 很多 问题 我们 发现 很多 客户端 在 下面 一些 数据 都是 没有 经过 加密 存储 的 陈 彪 这个 地方 会有 非常 多 的 方式 了 除了 刚才 那 两种 还会 有 像 界面 劫持 二次 打包 这个 就是 重新 打 一个 apk 比如说 在你 点 确定 的 时候 我 把 你 的 密码 拿到 另外 通过 键盘 劫持 这个 比较 有趣 的 就是说 我们 发现 某一个 密码 直接 做 输入法 这样 的话 你 输入 任何东西 它 都可以 拿到 的 陈 彪 另外 当 用户 做 交易 的 时候 实际上 也 可以 被 攻击 道 这个 例子 就是 我们 做的 简单 的 poc 左边 这边 是 试图 转给 张三 这 个人 但是 我们 通过 注入 之后 直接 修改 网络函数 这样 的话 他 在 服务器 中 就是 把 他 的 包 改 掉在 服务器端 收到 的 就是 要 转给 另外 一个 人在 这种 情况下 能够 直接 实现 把 他 的 真个 业务 交易 转帐 的 过程 修 改掉 当然 这些 东西 还是 有 很多 其他 方面 都 可能 存在 攻击 的 风险 陈 彪 第三个 风险 就是 二次 打包 就是说 二次 打包 把 原来 的 程序 重新 分装 一下 发布 到 市场 目前 来看 游戏 这个 领域 当然是 受 二次 打包 比较严重 的 像 银行 的话 我 这里 列出 两个 银行 有些 银行 基本 的 盗版 率 陈 彪 二次 打包 以后 通常 会加 一些 恶意代码 比如 加 一些 用户名 窃 取掉 的 代码 或者 加 一些 恶意 的 病毒 我们 知道 在 安 卓 上 插 一个 包 这些 病毒 的 可以 通过 其他 的 机子 你 不需要 点击 你 的 app 有 可能 这个 病毒 也 可以 工 作了 陈 彪 另外 我们 跟 一些 金融 客户 评估 它们 客户端 发现 他们 很多 的 漏洞 这是 乌云 上报 的 漏洞 后面 是 我们 发现 的 客户端 代码 的 一些 逻辑 上 的 漏洞 就是说 这个 漏洞 我们 分析 它 的 逆向 代码 以后 发现 它 的 代码 url 带 一个 参数 这个 参数 明显 是 一个 数值 直接 把 这个 数值 往上 加 就可以 提到 其他用户 的 信息 陈 彪 还有 一些 漏洞 这可 能 有点 小 右边 的 这个 漏洞 就是说 这个 客户端 做的 比较 奇怪 转站 的 时候 一般 用 双通道 来 通 线 通过 短信 发 一个 平台 密码 给你 但是 这个 客户端 还把 这个 密码 发给 了 自己 的 客户端 程序 就 意味着 只要 截获 网络 的 流量 我 就 知道 你 的 动态 密码 是什么 了 陈 彪 上面 主 要讲 的 几个 金融 的 风险 下面 其实 我 重点 想讲 一下 这方 面的 解决方案 我们 认为 如果 你 要 开发 一个 真正 相对来说 安全 的 客户端 可能要 做好 几件 事情 第一 你 的 开发人员 应该 遵循 针对 移动 应用 的 规范 比如 我们 刚才 讲 的 只要 我 hook 进去 搜查 内存 就可以 搜到 所有 用户 密码 就是 因为 他 存 了 用户 密码 陈 彪 这个 可以 采用 一些 安全 的 组件 比如 我们 接触 的 一些 客户 他们 里 面会 采购 一些 软件 ask 会 清场 通过 做 关键 交易 之前 进行 扫描 看 机器 上有 没有 安装 相应 的 木马 可能 还需要 定期 找 一些 专业公司 跟 客户端 做 一些 安全 评估 陈 彪 第二 我 今天 重点 讲 的 应用 加固 程序 经过 加固 以后 要 上线 到 渠道 但是 这个 时候 其实 你 也 需要 监测 看 市面上 有没有 出现 对 你 这个 包 破解 钓鱼 或者 山寨 的 应用 安全 加固 应用 刚才 lbe 张勇 提到 挺多 刚才 跟他 在 私下里 也 交 流了 一下 他 没有 拿到 我们 第二代 样本 第一代 讲 的 跟 张勇 很 想象 的 就是 我们 拿到 apk 加固 的 时候 把 它 加密 然后 放到 apk 的 资源 中去 通过 运行 的 时候 修改 这个 程序 的 入口 让 程序 的 入口 先 执行 脱壳 代码 脱壳 代码 执行 完 以后 交给 真 正解 完密 的 代码 陈 彪 我们 在里 面会 增加 一个 文件 有 一个人 对 我们 进行了 分析 他 也 指 出了 一个 弱点 我们 在 内存 里面 是 有 一个 明文 的 区域 的 刚才 张勇 帮我 介绍 很多 第一代 的 问题 不论 你 怎么 做你 很难 组成 大团 我 知道 爱 加密 之前 会 抹掉 adesk 然后 针对 最近 的 我们 最近 拿到 的 一些 样本 我们 发现 加固 的 时候 因为 有 百度 脱壳 工具 检查 了 spose 存 不存在 如果 存在 这个 程序 就不 运行 陈 彪 这个 方法 有 很 多了 从 我们 角度 来看 这些 方法 都是 治标不治本 的 措施 就是 你 永远 无法 从 本质上 解决 内存 的 下载 我们 现 在给 金融 客户 包括 一些 银行 的 他们 在 采用 还有 游戏 客户 在 采用 真正 使用 的 是 第二代 的 加固 技术 这块 技术 利 用了 java 里 有 一个 特性 java 语言 在 执行 的 时候 并 不像 c 我们 可以 对比 c 和 java 加固 的 应用 像 苹果 的 也 做了 加密 但是 c 程序 直接 跳 转到 那个 地址 去 执行 代码 所以 很多 的 像 c 的 加 壳 或者 针对 非 编 语言 加 壳 的话 要把 所有 语言 解开 然后 跳过去 执行 陈 彪 我们 知道 java 有 一个 特点 它 执行 某个 方法 的 时候 你 这个 方法 可以 现在 暂时 不存在 它 可以 通过 cload 去找 这个 方法 法 找到 以后 做 去 执行 我们 第二代 是 从 整个 desk 级别 降到 方法 级别 也 就是 每个 方法 我们 是 单独 加密 的当 这个 方法 被 虚拟机 调 用到 的 时候 我们 才会 按需 地 去 解密 同时 我们 会 保证 这个 虚拟机 在 内存 这个 解密 后 的 coad 在 内存 里 是 不 连续 的 陈 彪 另外 我们 目前 正在 加 的 一些 相关 的 安全措施 比如说 会加 一些 因为 你 可以说是 我 试图 重新 再 内存 再 构造 这个 东西 但是 这个 方法 是 没有 解密 的 你 只有 强制 的 办法 去 让 我 把 你 所有 的 方法 都 解出来 或者 修改 虚拟机 无非 就是 加 一些 方法 去 处理 这些 东西 这种 我 称为 方法 替换 方式 陈 彪 当 虚拟机 执行 某个 方法 的 时候 这个 引擎 我们 的 加固 引擎 只 解 这个 方法 只有 的话 比如说 在 我们 这个 基础上 加固 起来 以后 在 内存 里面 有 可能 只有 不到 四分之一 的 代码 被 解 开了 还有 四分之三 的 代码 实际上 是 没有 不 解开 的 你 只有 点点 到了 全部 路径 后 才 可能 被 解开 我 想 这也 比较 困难 陈 彪 这是 我们 现在 推出 的 就是 给 客户 用 的 我们 现在 还 在做 第三代 的 技术 这是 基于 代码 指令 的 替换 就是 带 内存 跑 的 方法 的 代码 实际上 是 被我 替 换过 的 而 不是 真正 的 原始 的 代码 你 拿到 这个 代码 以后 你 还得 需要 知道 我 怎么 映射 这些 opcoad 陈 彪 你们 发现 某个 apk 里面 看到 里面 全是 空 窗 版 的 基本上 是 经过 我们 处 理过 的 架构 这个 方法 也 不需 要有 什么 dex 就是 所有 的 启 动到 正常 运行 的 过程中 你 通过 dex 下载 永远 跟你 在 adk 拿到 的 classesdex 是 一样 的 因为 我们 做的 比 较早 所以 有些 客户 并不是 对 java 保护 很 k 因为 我们 知道 很多 的 编程 框架 像 游戏 厂商 代码 都 放在 一个 里面 我们 对 这些 代码 都可以 做 相关 的 保护 陈 彪 这个 用法 是 一般 的 厂商 告诉 我们 你 要 加密 哪些 文件 apk 有 哪些 文件 我们 可以 给他 做 apk 文件 所有 密钥 的 就是 布局 文件 全部都 加密 了 也就是说 这个 的 防御 比如 这种 包 你 单纯 拿 到了 classesdex 你 是 拼 不 回去 的 因为 那些 资源 全部 经过 加密 所以 你 拿到 java 层面 是 没有 太大 用处 的 陈 彪 这块 是 我们 现 在给 企业 基本上 都是 采用 这套 方案 的 我们 也 做 企业 的 so 库 我们 也有 比较 成熟 的 方案 这块 如果说 你 想做 apk 特别 强劲 的话 我们 基本上 可以 把 这个 apk 所有 文件 做 加密 除了 系统 原来 的 图标 现在 我们 给 一些 银行 如果 它 采 用了 atm 的 框架 我们 都会 做成 atm 加密 陈 彪 提 一下 渠道 监控 对 银行 我们 也 可以 提供 这样 的 服务 这个 服务 我们 会 提供 一个 爬虫 这是 到 市场上 抓 第三方 的 应用程序 通过 加速度 的 分析 引擎 这个 能够 分 析出 两个 apk 之间 是否 相似 我们 现在 有 几个 大 的 引擎 就是说 基本信息 像 图标 或者 你 的 名字 因为 我们 知道 有 很多 的 应用 它就 纯粹 钓鱼 的 我们 甚至有 一个 银行 的 客户 出现 过 这种 情况 它 的 app 还没 开 发完 也没有 上线 但是 市面上 已经有 叫 这个 名字 的 app 存在 了 陈 彪 所以 基本信息 比较 我们 就能 发现出 相似 的 山寨 后 的 直接 是 钓鱼 的 app 另外 它在 你 包 的 基础上 修改 的话 它 大部分 的 资源 跟你 是 基本 接近 的 也就是说 我们 通过 资源 也 能够 比较 出 两个 apk 是否 相似 的 陈 彪 最后 就是 代码 纯粹 的 比较 因为 相信 代码 破解 的话 也 就是 往里面 加 一个 包 真正 修改 或者 在 入口 的 地方 修改 一下 然后 通过 代码 相似 度 也 能够 比较 出来 通过 这个 引擎 我们 也 可以 及时 关注 银行 或者 金融 的 程序 是否 有 山寨 或者 盗版 陈 彪 总结 一下 目前 对像 手机 银行 可能 面临 的 这些 安全 风险 所以 我们 一般 跟 客户 谈 的 时候 首先 加强 客户端 开发人员 的 培训 就是 开发 的 时候 考虑到 很多 安全 的 问题 然后 我们 可能会 跟 一些 合作 厂商 定期 的 对 这些 移动 的 客户端 进行 评估 评估 完了 以后 我们 希望 他们 使用 一些 加固 这样 的话 阻止 别人 山寨 上线 之后 我们 还要 实现 监控 看 是否 出现 山寨 钓鱼 或者 直接 盗版 的 情况 主持人 谢谢 陈 总 接下 来请 剑心 对 今天 的 峰会 做一个 简单 的 总结 剑心 总结 起来 我们 知道 国内安全 最大 的 问题 不是说 我们 技术 有 多 差 或者 什么 是 环境 问题 环境 问题 总结 起来 就是 封闭 的 问题 所以 在座 的 了解 到 说 这个 技术 我 不能说 那个 企业 说 这个 事 不能 对外 说 说了 怎么样 这 才是 真正 阻止 我们 的 安全 环境 的 一个 根本问题 乌云 一直以来 大概 四年 以来 一直 以 开放 的 思路 做 安全 核心 的 法 就是说 让 社区 能够 通过 开放 的 方式 成长 也 很 高兴 今天 看到了 岁 的 白 帽子 得有 一个 好 的 社区 让 他 学习 引导 他 剑心 我 觉得 是 用 开放 的 思路 做 社区 还有 我 觉得 很多 企业 企业 是 最让人 头疼 以前 大家 认为 第一时间 不 会说 为什么 不 会说 因为 一个 企业 如果 出了 安全问题 一 定是 安全 工程师 最先 知道 他 不会 反 馈给 领导 他 的 领导 不会 反 馈给 公司 决策层 所以 整个 企业 看起来 一片 太平 但是 我们 知道 安全 包括 今天 这么多 议题 我们 可以 看到 我们 的 安全 滥 到 什么 程度 剑心 对 用户 也 一样 我们 希望 以 开放 的 思路 在 安全 上好 好做 一做 今天 峰会 也是 这个 思路 峰会 上午 是 白 帽子 的 专场 下午 是 企业 我们 也 看出 这 很 符合实际 上午 大家 很 自由 下午 慢慢 有点 拘泥 了 就是 总是 不 止痒 的 感觉 如果 乌云 通过 这个 峰会 有 一个 改变 看到 下午 有 很多 人在 这儿 挖 人我 挺 反感 这个 事情 的 我 看到 很 多好 的人 去了 阿里巴巴 在 网上 不说话 了 这个 id 不 活跃 了 一到 企业 里 去 可能 被 非技术 人员 就 给 限制 了 我 觉得 这是 很 不好 的 而且 企业 分享 的 时候 会有 一些 当然 这 不能 怪 企业 本身 它 的 立场 是 对 的 但是 我们 不 希望 这样 的 方式 出现 即使 出现 大家 也是 买过 票 的 剑心 核心 的 意思 希望 大家 一起 包括 社区 白 帽子 乌云 企业 一起 把 这个 事情 做的 更 开放 一些 长久 一些 而 不是 把 两边 人 挖走 同时 我们 想法 很 活跃 我们 做了 一个 乌云 的 俱乐部 之前 运营 了 一段时间 现在 在 那儿 晚上 的话 有 酒会 大家 可以 过去 聊 一 聊 将来 的话 我们 还是 会 以 开放 的 思路 做 这个 俱乐部 每个月 我们 乌云 可能 会有 一个 定期 的 安全 方面 的 开放 的 东西 就是 除了 挖 人 的 都可以 过去 多 聊聊 多 学学 hr 挖 人 的 就 不要 过去了 跟 极 客 相关 的 跟 俱乐部 相关 的 都可以 去 我们 那儿 分享 转 载于 