基于 javascript canvas 的 植物 大战 僵尸 周末 爆 肝 之作 请 点个 赞 再走 引言 前两天 看到 小朋友 在 玩 植物 大战 僵尸 想起来 多年 以前 自己 也 经常 玩 这个 游 戏是 比较 经典 的 一款 休闲 游戏 然后就 心血来潮 就 周末 写了 一个 花了 不少 时间 去找 素材 和 编写 代码 感觉 上 基本 的 功能 是 做 好了 要 上班 没 那么多 时间 搞 写出来 大家 看看 确实 有点 爆 肝 效果图 实现 思路 用 两张 画布 来 实现 第一个 画布 绘制 不用 更新 的 东西 比如 背景图 按钮 积分 图 卡 牌 图 等第 二个 画布 绘制 经常 更新 的 东西 比如 僵尸 的 走动 僵尸 吃 植物 僵尸 死亡 植物 的 摇摆 豌豆苗 发射 豌豆 子弹 的 运动 阳光 的 产生 阳光 的 收集 等等 动画 的 实现 通过 图片 的 不停 切 换来 实现 的 开启 一个 总 定时 任务 毫秒 重新 绘制 画布 当然 其他 的 每个 动画 都会 重新 开启 定时 任务 我 称 他们 为 子 任务 它们 不 负责 绘制 只 负责 改变 对应 的 参数 绘制 都是 由 总任务 来 完成 的 比如 僵尸 走动 动画 开 启子 任务 毫秒 执行 一次 图片 切换 切换 到最后 一张 的 时候 返 回到 第一张 如果 要 走动 的话 同时 改变 图片 的 位置 就好 子 任务 修改 完成后 总任务 自然会 绘制 出来 卡 牌 的 实现 目前 就 写了 张 卡 牌 向日葵 豌豆苗 给 卡 牌 绘制 了 相同 大小 的 方形 来 控制 鼠标 点击 事件 当 点击 卡 牌 的 时候 会 创建 对应 的 植物 并且 跟随 鼠标 移动 移动 鼠标 到 合适 的 位置 后 点击 田里 面 对应 的 方块 会在 对应 的 位置 种植 田 位置 的 控制 以 方形 来 划分 每 一块 可以 种 植物 的 区域 都用 一个 小方块 来 控制 植物 就 种 在 对应 的 方块 内 当 选择 一个 卡 牌 后 鼠标 移 动到 田 里面 就会 标示 出来 一个 方形 的 区域 标示 植物 种植 在 这块 区域 里面 豌豆苗 被 种植 后会 定时 的 发射 子弹 当 子弹 的 位置 和 僵尸 的 位置 交汇 的 时候 就 判断 为 击中 处理 子弹 击中 动画 子弹 消失 僵尸 扣除 相应 血量 击中 的 音效 等 僵尸 血量 归零 后会 停止 走动 的 动画 开启 新 的 倒地 动画 倒地 完成后 删除 僵尸 同时 累计 得到 的 分数 当 僵尸 的 位置 和 植物 的 位置 交汇 的 时候 僵尸 会 停止 行走 的 动画 开启 吃 的 动画 植物 被 扣除 血量 僵尸 吃 的 音效 植物 血量 归零 后 植物 对象 会被 清理 阳光 有 两种 产生 方式 定时 产生 和 向日葵 产生 产生 后会 开启 往下 飘 的 动画 飘到 一定 范围 后 停止 动画 开启 计数器 目前 设 定为 秒 计数 归零 没 有此 阳光 依然 未被 点击 收集 的话 就会 消失 在 指定 时间内 点击 了 该 阳光 音效 则会 开启 往左 上角 飞行 的 动 画到 终点 后 阳光 消失 阳光 分 增加 音效 结束 条件 僵尸 触及 田 的 最 左边 判 定为 失败 得分 判 定为 胜利 实现 绘制 背景 绘制 背景 背景 img 绘制 上方 的卡 牌 区域 积分 区域 相关 按钮 绘制 游戏 上方 的 相关 图片 卡片 等 方形 卡 片盘 img 积分 img 方形 卡片 太阳 花 imgsuncost 生产 一个 苗 需要 阳光 imgtypesun 植物 类型 img thiscardarrpush img 方形 卡片 豌豆 imgsuncost 生产 一个 苗 需要 阳光 imgtypewandou 植物 类型 img thiscardarrpush img 开始 按钮 图片 img 创建 僵尸 图片 img 点击 开始 的 逻辑 点击 开始 就是 游戏 的 入口 游戏 的 大部分 功能 都是 在 这个 逻辑 里面 实现 包含 展示 开始 图片 开启 背景音乐 阳光 计分 显示 积分 显示 创建 田 的 背景 方形 创 建卡 牌 的 背景 方形 开启 总任务 定时 创建 太阳光 定时 创建 僵尸 展示 开始 图片 展示 开始 图片 img function thatclear img 这里 设置 一个 延时 秒 后 自动 清 除掉 这个 图片 阳光 计分 显示 创建 阳光 分 text 积分 显示 创建 积分 text 创 建卡 牌 的 背景 方形 用于 监听 鼠标 点击 卡 牌 根据 卡 牌 数组 来 创建 循环 这个 数组 方形 的 坐标 和 宽 高 与 卡 牌 数组 元素 相 对应 并且 方形 的 fillstyle 采用 rgba 来 处理 如 rgba rgba 当 最后 一个 数字 是的 时候 卡 牌 可用 当 为 的 时候 卡 牌 会被 遮罩 起来 不可用 不可 用是 在 鼠标 点击 的 时候 控制 这里 只是 一个 遮罩 的 效果 当然 这里会 设置 一个 参数 alive 当 它为 true 表示 可用 false 则 点击 无效 鼠标 点击 的 时候 就是 根据 这个 参 数来 控制 的 创建 卡片 背景 方形 rgba 设定 需要 花费 的 阳光 数值 rect rect 创建 田 的 背景 方形 用于 监听 植物 的 种植 根据 背景 上 田 的 规格 来 设置 好 xy 坐标 以及 宽 高 这样 创建 的 方形 就会 和 背景 相 对应 种 植物 的 时候 就 比较好 控制 了 解释 如下 上图 是 我 自己 随便 画 的 也没有 画好 没画 全 实际上 每个 里面 都有 并且 比较 整齐 我 把 代码 稍微 修改 一下 截图 最终 的 代码 肯定 不是 这样 的 哦 这样 就把 田 的 区域 一块块 的 覆盖 起来 但 我们 这里 也是 要用 rgba 的 方式 来 种 植物 的 时候 才会 突出 显示 创建 植物 田 背景 方形 varxyrectfor variilti 行 y i for varjjltj 列 x j rectnewrect fillstylergba rectindexi 标记 行数 rect rect 创建 阳光 向日葵 植物 创建 阳 光和 定时 创建 阳光 都 放到 这里 了 他们 的 区 别是 定时 创建 的 x 坐标 随机 产生 而 向日葵 创建 的 阳光 xy 坐标 是 根据 向日葵 的 位置 来 的 设定 阳光 的 分值 阳光 的 血量 阳光 默认 运动 的 终点 位置 这个 位置 可以 自己 定 我 定义 y 坐标 的 是 阳光 为什么 有 血量 呢 这个 血量 是 用来 控制 消失 时间 的 比如 我 设定 血量 为 当阳 光运动 到 底部 停止 运动 后 就会 开启 计算 血量 的 任务 每 毫秒 执行 一次 让 血量 因 毫秒 执行 次 是 秒 秒 后 血量 就 变成 了当 血量 归零 后 如若 依然 没有 去 收集 这个 阳光 需 要让 阳光 消失 同时 关闭 此 定时器 当 点击 阳光 后 就把 计算 血量 的 定时器 关闭 开启 向左 上角 运动 的 动画 当然 这里 要 用到 mathatan 根据 阳光 点击 的 位置 和 做 上角 的 位置 计算出 角度 然后 根据 角度 利用 mathcosmathsin 计算出 运动 的 xy 的 数值 定时器 将 根据 这个 数值 来 运动 运动 指定 的 位置 后 要做 以下 动作 清除 运动 定时器 阳光 积分 累加 与 显示 收集 音效 开启 阳光 消失 卡 牌 可用 状态 的 更新 创建 阳光 plant plant 这种 是 植物 创建 的 太阳 x 方形 随机 绘制 时 的 图片 下标 方形 卡 片盘 执行 动画 更新 的 下标 sunkeystartkey 原始 下标 sunvalue 收集 一个 分 sunblood 默认 点 血量 秒 消失 因为 我 给 太阳 设置 的 是 毫秒 执行 一次 所以 这个 blood 设置 为 每次 秒 就 刚好 sunfloor 到底 的 位置 sun thissunspush sun animatebind thissun functionanimate z 一个 循环 了 重新 回到 初始 位置 if zimagekeygt zdygtzfloor consolelog 太阳 到 位置 了 clearinterval ztimmer 开启 定时 任务 多少 秒 以后 消失 timebind thissun 太阳 计时 functiontime z 一个 循环 了 重新 回到 初始 位置 if zimagekeygt 计算 消失 时间 zbloodif zbloodlt clearinterval ztimmer consolelog 太阳 到 时间 了 fadecall thisz 执行 消失 太阳 消失 functionfade z thisclear z consolelog 太阳 消失 了 thisclearassign thissunsz 清楚 指定 对象 znull 太阳 被 点击 z consolelog 太阳 被 点击 了 clearinterval ztimmer 清楚 之前 的 定时器 varcxcy 收集 点 的 xy 坐标 zdycy zdxcx 弧度 计算出 xy 每 一帧 移动 的 距离 angle mymathsin angle zmxmxzmymy 开启 移动 定时器 suncollectbind thisz 收集 太阳 动画 z 一个 循环 了 重新 回到 初始 位置 if zimagekeygt zdyltzdxlt consolelog 太阳 收集 完成 clearinterval ztimmer fadecall thisz 执行 消失 计数 累加 更新 卡片 是否 可用 情况 更新 阳光 数值 thissun 给 这个 sun 对象 绑定 点击 函数 创建 僵尸 创建 僵尸 定时 秒 随机 数量 只 随机 行行 这里 表示 出现在 地图 的 哪一 行 设定 僵尸 的 血量 僵尸 所处 的 行数 僵尸 的 状态 runeatdead 状态 是 用来 控制 切换 图片 的 下标 的 不然 动画 会 出错 行走 动画 依赖于 图片 的 切换 和 x 坐标 的 改变 每 一帧 x 坐标 减少 即可 每 一帧 都要 判断 x 坐标 与 植物 的 坐标 是否 交汇 如果是 先 关闭 行走 的 动画 更新 状态 为 eat 开启 吃 的 动画 切换 图片 的 下标 每一次 吃 的 时候 递减 植物 的 血量 判断 植物 的 血量 如果 血量 归零 则 表示 吃 完了 此时 要 清理 掉 植物 僵尸 回归 行走 的 动画 状态 改为 run 若 没 吃完 则 继续 吃 每 一帧 也要 判断 僵尸 的 x 坐标 是否 到了 最 左边 如果是 游戏 结束 创建 创建 僵尸 随机 获取 行数 if index dyelseif index dyelseif index dyelseif index dyelseif index dy 绘制 时 的 图片 下标 方形 卡 片盘 执行 动画 更新 的 下标 原始 下标 zombleblood 默认 点 血量 设定 僵尸 的 行数 zomble thiszombiespush zomble this zomblerun functionrun animatebind thiszomble functionanimate z 一个 循环 了 重新 回到 初始 位置 if zimagekeygt 判断 有没有 接触到 植物 如果有 开始 吃 植物 thateat zomble if zdxlt consolelog 结束 了 thatend 僵尸 吃 僵尸 吃 zomble 先 判断 当前 僵尸 有没有 到达 吃 的 位置 有 的话 就 开始 吃 关闭 掉 之前 的 僵尸 动画 开始 吃 的 动画 被 捕获 的 植物 for if 判断 为 吃 plant clearinterval zombletimmer 清除 移动 动画 设定 animatebind thiszombleplant functionanimate zp 一个 循环 了 重新 回到 初始 位置 if zimagekeygt 植物 血量 的 处理 if pbloodlt consolelog 植物 被 吃了 clearinterval ztimmer 清除 植物 thisdelplant p 设定 key 继续 移动 zrun 删除 植物 删 除掉 植物 planttype if type 还没有 创建 的 植物 不需要 清除 这两个 任务 停止 植物 自身 的 动画 clearinterval planttimmerself 停止 植物 发射 子弹 的 动画 clearinterval planttimmer 渲染 中 删除 thisclear plant plants 数组 中 删除 thisclearassign thisplantsplant 植物 对应 的 背景 处理 if plantbgrect 创建 向日葵 点击 卡 牌 后 的 创建 所以 肯定是 要 传入 鼠标 的 位置 创建 的 跟随 鼠标 移动 此时 向日葵 已经 创建 设定 alive 函数 当在 田 里面 选中 位置 后 执行 此 函数 进行 种植 操作 扣除 阳光 花费 更新 卡 牌 是否 可用 开启 定时 产生 阳光 的 任务 创建 太阳 植物 positem 设定 初始 位置 为 鼠标 的 位置 绘制 时 的 图片 下标 方形 卡 片盘 执行 动画 更新 的 下标 原始 下标 阳光 花费 值 plantblood 设 定为 血量 实际 是 秒 吃完 因为 毫秒 计算 一次 吃 plant thisplantspush plant 标记 正在 创建 的 植物 this functionalive bgrect 设置 背景 对象 扣除 阳光 花费 更新 卡片 是否 可用 情况 更新 阳光 数值 每秒 发射 一个 阳光 shootbind this 音乐 functionshoot thiscreatesun plant 植物 本身 的 动画 animatebind thisplant functionanimate p 一个 循环 了 重新 回到 初始 位置 if pimagekeygt 点击 卡 牌 后 移动 鼠标 向日葵 会 跟随 鼠标 移动 移 动到 田 的 方形 位置 则 此 块 方形 的 颜色 会 突出 点击 它 则会 种植 下去 创建 豌豆 植物 与 向日葵 的 创建 很 相似 就 不同 的 时候 向日葵 创建 的 是 阳光 豌豆 植物 创建 的 是 小 豌豆 可以 攻击 僵尸 的 子弹 在 运动 的 时候 判断 是否 与 僵尸 接触 如果 接触 则 执行 击中 的 动画 删除 这个 子弹 减去 僵尸 的 血量 如果 僵尸 死亡 则 开启 僵尸 死亡 动画 增加 积分 创建 创建 豌豆 plant 绘制 时 的 图片 下标 varstartkey 方形 卡 片盘 wandou 给 子弹 设定 行数 标示 射击 音乐 wandoumovebind thiswandou wandou wandoudx 判断 击中 僵尸 varflagthishit wandou if flagwandoudxgt 击中 目标 或者 超出 边界 clearinterval wandoutimmer if flag 击中 目标 创建 子弹 击中 的 图片 thishitanimate wandou 击中 音乐 清除 这个 子弹 thisclear wandou wandounull 击中 目标 击中 obj 僵尸 对象 for varitemarriif 子弹 的 函数 标示 与 僵尸 的 行数 标示 也要 相等 itembloodif itemblood 消灭 这个 僵尸 clearinterval itemtimmer if itemstaterun 设置 死亡 图片 下标 elseif itemstateeat 设置 死亡 图片 下标 增加 积分 thisdead item 死亡 动画 arrsplice i returntrue 加入 事件 控制 给 canvas 画布 添加 鼠标 移动 事件 因为 画布 在上面 this 给 canvas 画布 添加 鼠标 点击 事件 因为 画布 在上面 this 给 canvas 画布 添加 鼠标 右键 事件 因为 画布 在上面 this 鼠标 移动 事件 鼠标 移动 事件 e varthatthisif thatgameover return 目前 设定 的 是 结束 后 要 刷新 页面 才 可以 开始 if thisstartimage return 防止 没 加载 完成 报错 varposgetoffset e 获取 鼠标 位置 pos 鼠标 捕捉 if pos 鼠标 捕捉 if iscatch if 游戏 开始 并且 没有 正在 创建 的 植物 的 时候 可以 执行 循环 卡片 背景 数组 for itemispoint pos ampampitemalive 鼠标 捕捉 iscatch 循环 太阳 数组 for itemispoint pos 鼠标 捕捉 iscatch if plant 创建 植物 的 时候 才 出现 填入 背景 框 循环 田 背景 数组 for itemispoint pos ampampitemplant 鼠标 捕捉 并且 当前 没有 植物 if iscatch 改为 手 状 形态 表示 当前 正在 创建 植物 if plant 鼠标 点击 事件 鼠标 点击 事件 e if thisgameover return 目前 设定 的 是 结束 后 要 刷新 页面 才 可以 开始 e 获取 鼠标 位置 pos 鼠标 捕捉 if iscatch thatstart if pos 鼠标 捕捉 if iscatch if iscatch if 游戏 开始 并且 没有 正在 创建 的 植物 的 时候 可以 执行 循环 卡片 数组 for itemispoint pos ampampitemalive 鼠标 捕捉 iscatchtrue 生成 一个 新 的 豌豆苗 跟随 鼠标 移动 thiscreateplant positem 创建 植物 breakif iscatch 循环 太阳 数组 for itemispoint pos 鼠标 捕捉 breakif iscatch plant 正在 创建 植物 循环 田 背景 数组 for itemplant continue 如果 当前 有 植物 则 跳过 if itemispoint pos 鼠标 捕捉 给 plant 设置 行数 plantalive item 植物 生效 itemplanttrue 表示 有 植物 鼠标 右键 事件 右键 事件 e 取消 右键 默认 事件 if thisgameover return 目前 设定 的 是 结束 后 要 刷新 页面 才 可以 开始 if thisstartimage return 防止 没 加载 完成 报错 if thisgamealive oncontextmenu 正在 创建 的 植物 删除 thisdelplant thiscurrplant 循环 田 背景 数组 for 总结 基本 的 功能 实现 了 但是有 很多 没有 实现 的 功能 这里 交代 一下 确实 没有 时间 去 搞了 要 上班 不能 像 在座 赚了 几个 亿 的 大佬 一样 逍遥自在 结束 后 必须 刷新 页面 才能 重新开始 点击 开始 按钮 卡 牌 支持 的 作物 也 比 较少 作物 也 不 能用 铲子 替换 没有 过关 的 感觉 没有 车子 压 僵尸 的 场景 等等 不 说了 还有 好多 如果 作为 完整 的 游戏 来说 肯定 还有 很多 功能 要做 很多 地方 要 完善 其中 相当 的 代码 也 可以 重构 但是 如果 作为 一个 练手 学习 思路 的 分享 我 觉得 是 足 够了 昨天 做好 的 东西 今天 晚上 写出来 也 花了 不少 时间 能 看到 这里 的 都是 大佬 欢迎 各位 大佬 点 赞 评论 关注 谢谢 源码 下载方式 少量 积分 下载 代码 方式 关注 下方 公众 号 回复 下载 代码 更多 源码 基于 canvas 的 九宫格 抽奖 特效 附 源码 基于 canvas 的 手风琴 特效 附 源码 抖 音 很 火 的 华为 太空人 表盘 附 源码 基于 javascript 页面 动态 验证码 附 源码 基于 javascript 的 拖动 滑块 拼图 验证 附 源码 基于 javascript 的 幸运 大转盘 附 源码 抖 音 很 火 的 罗盘 时钟 附 源码 基于 javascript 的 俄罗斯方块 小游戏 附 源码 基于 javascript 的 贪吃蛇 游戏 附 源码 基于 javascript 的 拼图游戏 附 源码 用 javascript 给 女儿 做的 烟花 特效 附 源码 老父亲 给 女儿 做的 下雪 特效 满足 女儿 看 雪 的 愿望 附 源码 雷达 扫描 特效 附 源码 香港黄金 配角 吴孟达 去世 后 程序员 以 轮播 图 来 悼念 达 叔 达 叔 一路 走好 附 源码 仿 抖 音 刷新 进度条 附 源码 仿 头条 方形 刷新 进度条 附 源码 仿 加速 球 水波 评分 特效 附 源码 基于 canvas 的 刮刮卡 附 源码 原生 js 写 的 左侧 飞入 拼图 特效 你 是 喜欢 美女 单飞 还是 双飞 附 源码 用 js 写 的 旋转 木马 在 新年 献给 各位 刚 登基 的 皇帝 让 你 的 后宫 转起来 程序员 就是 可以 为所欲为 附 源码 用 js 写 的 轮播 图 八位 女明星 你 翻 谁 的 牌 程序员 就是 可以 为所欲为 附 源码 原生 js 实现 美女 拼图 把 美女 老婆 抱 回家 个 美女 够不够 程序员 就是 可以 为所欲为 附 源码 用 js 仿 探探 拖拽 卡片 的 效果 飞 卡片 的 效果 感觉 挺 酷 最后 有 美女 看 哦 附 源码 老婆 说 程序员 不懂 浪漫 程序员 默默 拿 起了 键盘 这就 亲手 带你 去看 流星雨 女人 真的 会 影响 男人 拔刀 的 速度 附 源码 学生 成绩 管理 系统 有 源码 你 的 毕 设 我 的 心 附 源码 