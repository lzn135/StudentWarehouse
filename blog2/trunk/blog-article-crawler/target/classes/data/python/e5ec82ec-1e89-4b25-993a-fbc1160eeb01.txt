译 apt 分析 报告 03.opblueraven 揭露 apt 组织 fin7 carbanak 上 tirion 恶意 软件 这是 作者 新开 的 一个 专栏 主要 翻译 国外 知名 的 安全 厂商 apt 报告 文章 了解 它们 的 安全 技术 学习 它们 溯源 apt 组织 的 方法 希望 对 您 有所 帮助 前文 分享 了 钓鱼 邮件 网址 混淆 url 逃避 检测 这篇 文章 将 介绍 apt 组织 fincarbanak 的 tirion 恶意 软件 包括 opblueraven 行动 原文 标题 原文 链接 作者 时间 文章 来源 文章 目录 一 fin 简介 二 关于 fin 和 carbanak 三 carbanak 后门 键盘记录 插件 过程 监控器 插件 四 后门 的 未来 文件 结构 readmetxtloader 组件 pswinfograbber 五 opblueraven 第一 部分 结尾 一 fin 简介 fin 组织 的 攻击 目标 是 金融机构 尤其 美国 金融 公司 以 钓鱼 邮件 为 主要 攻击 渠道 常见 攻击 手法 包括 使用 精密 的 鱼叉 式 网络 钓鱼 邮箱 来 说服 目标 对象 下载 附件 然后 透过 附件 让 其 公司 网络 遭到 恶意 软件 的 感染 擅长 使用 非 pe 文件 进行 攻击 在 攻击 过程中 很少 有 pe 文件 落地 主要 的 攻击 载荷 都是 基于 js 脚本 和 powershell 脚本 进行 这在 一定 程 度上 躲避 安全 软件 的 查杀 在 fin 所 使用 的 恶意 软件 中最 常见 的 是 carbanak 恶意 软件 的 特制 版本 已 在对 银行 的 多次 攻击 中使 用过 常规 攻击 流程 如 下图 所示 攻击者 以 钓鱼 邮件 为 进入 渠道 在 恶意 文档 中 嵌入 vbs 脚本 vbs 脚本 运行 后 解密 后门 程序 写入 注册表 中 同时 将 调用 后门 程序 的 脚 本以 ads 隐 藏在 磁盘 文件 中 在 后门 运行 后 使用 dnstxt 做为 campc 通信 方式 在 邮件附件 文档 中使 用了 恶意 宏代码 不同 钓鱼 文档 的 界面 大体 如下 值 的 一提 的 是 使用 汉堡 图片 做为 诱饵 文档 时 的 攻击 目标 是 一家 国外 的 食品公司 遭到 fin 入侵 的 公司 包括 chipotlechillis 和 arbys 等 知名品牌 该 组织 被 认为 已 入侵 数千 个 业务 据点 并且 已 窃取 数百万 个 信用卡 号码 随着 技术 深入 该 组织 部署 了 新 的 战术 类似于 网站 发现 fin 通过 美国 邮政 服务 usps 给 目标 企业 的 人力资源 信息技术 或 执行 管理部门 的 员工 邮寄 包裹 包含 usb 设备 礼品 卡 等 当 员工 将 usb 设备 插入 计算机 时会 注入 命令 以 下载 并 执行 以 griffon 跟踪 的 javascript 后门 这样 的 包裹 被发 送给 多家 企业 包括 零售业 餐饮 酒店 武器 化 的 usb 设备 模仿 用户 击键 特征 启动 powershell 命令 从 远程 服务器 检索 恶意 软件 专家 们 观察到 恶意代码 联络 域名 与 ip 地址 位于 俄罗斯 该 usb 设备 使用 arduino 微控制器 atmegau 并 编程 模拟 usb 键盘 由于 pc 默认 情况下 信任 键盘 usb 设备 一旦 插入 键盘 模拟器 就会 自动 插入 恶意 命令 然后 powershell 脚本 运行 第三阶段 javascript 收集 系统 信息 并 删除 其他 恶意 软件 根据 fbi 的 警告 一旦 收集到 目标 的 信息 fin 组 织就 开始 横向 移动 以 获取 管理权限 在 收集到 的 信息 发送到 campc 服务器 之 后主 js 代码 会 进入 一个 无限 循环 在 每个 循环 迭代 中 睡眠 分钟 然后 从 命令 和 控件 获取 一个 新 命令 总之 一旦 usb 控制器 芯片 被 重新 编程 用于 其他 用途 如 模拟 usb 键盘 这些 设备 就可以 被 用来 发动 攻击 并在 用户 不知情 的 情况下 感染 他们 的 计算机 再加上 这些 设备 非常 便宜 任何人 都可以 随时 使用 这也 意味着 攻击者 更 深入 地 利用 这些 技术 和 设备 只是 时间问题 参考资料 二 关于 fin 和 carbanak 本文 旨 在为 读者 提供 有关 prodaft 瑞士 invictus 欧洲 威胁 情报 pti 团队 针对 不同 威胁 参与者 的 最新 操作 的 详细信息 并 发现 与 臭名昭著 的 finapt 组织 相 关在 文章 中所 有 信息 都 源自 威胁 参与者 的 一次 opsec 故障 我们 将 尝试 逐步 扩展 主 题在 不断 发现 的 基础上 扩大范围 在 年月 至 月 之间 prodaft 威胁 情报 团队 的 四名 成员 进行了 blueraven 行动 案例 研究 源于 发现 一组 看似 不重要 的 轻微 opsec 故障 当然 后来 发现 这些 威胁 因素 与 臭名昭著 的 fincarbanak 威胁 因素 有 关联 pti 的 opptisop 源于 攻击者 一方 的 opsec 故障 与 先前 发现 和 发布 的 数据 不同 使 此 op 如此 与众不同 的 是 我们 设法 发现了 大量 有关 攻击者 工具 集 的 未 发布 信息 这些 信息 揭示 了 攻击者 的 于 年 首次 被发 现是 世界上 最著名 的 apt 组 之一 并且是 最早 曝光 的 apt 组 之一 该 组织 被 认为 在 全球 范围内 造成 超过 亿 美元 的 损失 我们 的 op 结果 发现了 有关 这些 威胁 参与者 的 以下 关键 信息 获得 fin 中 某些 攻击者 的 真实 身份 有关 fin 的 工具 和 攻击 方法 的 详细 证据 已经 被 发现 fin 和 revil 勒索 软件 组 将在 后面 的 阶段 中 详细 介绍 之间 的 关系 已经 被 发现 撰写 此 报告 旨在 提高 认识 并 协助 网络安全 专家 进行 分析 当然 prodaft 的 一些 发现 已被 删除 因此 授权 机构 可以 与 prodaft 或 invictus 联系 以 进行 进一步 的 披露 每篇 文章 都将 讨论 操作 的 特定 方面 不仅仅 包括 攻击 方法 组织 和 攻击者 的 身份 我们 的 团队 还 设法 窃听 攻击者 之间 的 各种 对话 这些 对话 中 的 大多数 也 将在 整个 系列 中 发布 三 carbanak 后门 是 我们 小组 获得 的 第一批 发现 之一 当前 版本 的 carbanak 后门 程序 该 团队 中最 知名 的 工具 即 carbanak 组 的 名字 是 引起 我们 团队 关注 的 第一个 工具 根据 pe 文件 标题 在 年月 编译 的 版 本是 后门 命令 和 控制 服务器 最新 检 测到 的 版本 下面 的 屏幕 快照 提供 了 版 carbanak 后门 管理 面板 的 屏幕 截图 我们 将 获得 的 最新 版本 与 年 virustotal 中 的 命令 管理器 版本 进行了 比较 并 对此 工具 进行了 评估 下图 反映 了 上述 两个 版本 反编译 获得 的 源代码 之间 的 差异 图中 仅 列 出了 两个 版本 之间 的 源代码 左 列 属于 年 上 传到 virustotal 的 文件 右 列 属于 我们 团队 获得 的 版本 蓝线 表示 不同 的 文件 而 绿 线 表示 新文件 通过 对 命令 和 控制 服务器 软件 的 检查 可以 看出 gui 界 面对 插件 进行了 基本 更 改以 创建 更 详细 的 错误 日志 并 添 加了 新 的 语言 编码 确定 了 年 编译 的 个 版本 的 恶意 软件 命令 管理器 工具 下图 给 出了 检 测到 的 版本 的 时间 戳 在 旧版本 的 botdll 中 它是 在 受害 设备 上 运行 的 恶意 软件 的 组件 在 反汇编 中 检 测到 个 函数 而在 同一 软件 的 新版本 中 检 测到 个 函数 使用 diaphora 二进制 比较 工具 有 个 函数 获得 最佳 匹配 分数 而有 个 函数 获得 部分 匹配 此外 与 virustotal 中 的 旧版本 相比 新 的 bot 文件 的 文件 大小 小于 kb 在 检查 新 的 bot 文件 时 可以 看到 旧版本 中 除 基本 函数 以外 的 函数 都是 作为 插件 实现 的 这些 新 插件 可以 执行 诸如 按键 记录 过程 监视 之类 的 操作 并且 可以 通过 反射 加载 方法 无 文件 执行 结果 恶意 软件 的 文件 大小 减 小了 从 而为 鉴识 基于 签名 的 安全 软件 解决方案 留下了 更少 的 痕迹 在 本 小节 中将 检查 先前 发现 的 文件 中 not 的 一些 插件 由于 这些 是 工具包 中 前所未有 的 函数 因此 我们 认为 以下内容 对于 进一步 分析 该 组织 的 ttp 至关重要 键盘记录 插件 keylogdll 插件 使用 捕获 用户 击键 为了 确定 在 哪个 上下文 中使 用了 击键 前台 进程 的 可执行文件 路径 文本 windowstext 和 时间 戳 timestamp 信息 将与 击键 一起 记录下来 键盘记录 插件 使用 windowsgdiapi 将 收集 的 数据 转 换为 bitmap 并 将其 写入 用户 temp 目录 名为 saetmp 的 文件夹 中 下图 显示 了 恶意 软件 用来 存储 数据 的 函数 下图 给 出了 所 获得 日志 示例 的 屏幕 截图 过程 监控器 插件 该 插件 可以 跟踪 在 目标 系统 中 运行 的 进程 并 用于 获取 有关 所需 进程 的 开始 和 终止 时间 的 信息 下图 给 出了 收集 有关 正在 运行 进程 的 信息 的 函数 屏幕 快照 四 后门 的 未来 fin 组织 的 新 加载 程序 工具 是 名为 tirion 的 恶意 软件 该软件 被 认为是 替代 carbanak 后门 程序 而 开发 的 它 包含 许多 功能 用于 信息 收集 代码 执行 侦察 和 横向 移动 与 上 一节 中 检 查过 的 最新 版本 的 carbanak 后门 程序 一样 该 恶意 软件 执行 的 许多 功能 已 作为 独立 的 插件 开发 使用 反射 性 加载 方法 将 它们 加 载到 目标 系统 中 并以 无 文件 方式 执行 公开 数据 显示 carbanak 后门 的 开发 目前 已 停止 并且 同一 团队 正在 tirionloader 上 进行 开发 和 测试 攻击者 之间 的 通信 日志 表明 此 新 工具 旨在 替代 carbanak 后门 tirion 恶意 软件 的 功能 如下 信息 收集 截 屏 列出 运行 进程 命令 代码 执行 进程 迁移 执行 密码 获取 激活 目录 及 网络 侦听 检 测到 的 最新 tirionloader 版本 属于 年月日 编译 的 版本 下图 显示 了 攻击者 可以 在 机器人 设备 上 执行 的 操作 版 本是 最早 检 测到 的 版本 被 认为是 最早 使用 的 版本 已在 年月日 上进 行了 编译 攻击者 编写 的 readmetxt 文件 中 清楚地 说 明了 恶意 软件 的 基本 组件 相关 翻译 如下 该 系统 包 包含 个 组件 服务器 server 客户端 client 加载 器 loader 这些 组件 的 相关性 如下 加载 器 定期 连 接到 服务器 客户端 通过 永久 连接 连 接到 服务器 加载 器 执行 来自 服务器 的 命令 并向 服务器 发送 响应 通过 客户端 用户 通过 服务器 向 加载 器 发出 命令 接收 到 来自 加载 器 的 响应 后 服务器 将其 传 输到 cl 文件 结构 恶意 软件 的 文件 组织 如下 文件 中 某些 重要项目 的 英文翻译 说明 如下 该 文件 指示 从 恶意 软件 的 第一 版本 到 版本 的 更改 并 包含 构建 说明 省略 俄语 原文 loader 组件 该 恶意 软件 的 这一 组件 将在 受害 系统 上 运行 大小 约为 kb 并从 服务器 运行 命令 当 攻击者 想 要在 受害者 的 设备 上 运行 某个 功能 时 包含 该 功能 的 相关 插件 文件 会 以 反射 方式 加 载到 受害者 的 设备 上 并以 无 文件 方式 执行 服务器 和 加载 器 之间 的 网络流量 使 用在 构建 阶段 确定 的 密钥 进行 加密 下图 包含 相关 的 加密算法 pswinfograbber 它是 一个 dll 文件 负责 从 目标 系统 中 窃取 和 报告 敏感 信息 尤其是 浏览器 和 邮件 密码 确定 攻击者 也 独 立于 tirionloader 使 用了 此 工具 在下 图中 包含 由 恶意 软件 收集 的 日志 的 屏幕 截图 五 opblueraven 第一 部分 结尾 在 这些 系列 的 第一版 中 我们 希望 通过 将 pti 发现 的 最新 carbanak 工具包 与 可 公开 访问 的 较 旧版本 进行 比较 以 介绍 我们 的 分析 报告 在下 一篇 文章 中 我们 还将 通过 提供 攻击者 之间 实际 对话 的 参考 来 更 深入 地 研究 攻击者 的 ttp 除此之外 我们 还将 提供 直接 从 威胁 参与者 的 计算机 获取 的 屏幕 截图 最后 希望 这篇 文章 对 您 有所 帮助 中秋节 和 国庆节 快乐 某人 照 顾好 自己 喔 前文 分享 译 apt 分析 报告 linux 系统 下 针对性 的 apt 攻击 概述 译 apt 分析 报告 钓鱼 邮件 网址 混淆 url 逃避 检测 年月 新开 的 娜 璋 ai 安全 之家 主要 围绕 python 大数 据分析 网络空间 安全 逆向 分析 apt 分析 报告 人工智能 web 渗透 及 攻防 技术 进行 讲解 同时 分享 ccfsci 南 核 北 核 论文 的 算法 实现 娜 璋 之家 会 更加 系统 并 重构 作者 的 所有 文章 从 零 讲解 python 和 安全 写了 近十年 文章 真心 想把 自己 所学 所 感 所做 分享 出来 还请 各位 多多指教 真诚 邀 请您 的 关注 谢谢 byeastmount 星期天 晚 上点 写 于 武汉 附录 yara 签名 xadand allof a peexports orpeexports xadand allof a xadand allof a xadand allof a xadand allof a xadand allof a xadand allof a xadand allof a xadand allof a xadand allof a andfilesizelt 