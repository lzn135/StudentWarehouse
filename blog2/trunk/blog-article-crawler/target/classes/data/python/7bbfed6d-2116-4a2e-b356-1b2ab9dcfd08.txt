智能化 漏洞 挖掘 技术 总结 全文 基于 从 自动化 到 智能化 软件 漏洞 挖掘 技术 进展 进行 提炼 总结 修改 静态 漏洞 挖掘 技术 面向 源代码 面向 源代码 的 漏洞 挖掘 主要 采用 基于 中间 表示 的 分析 和 基于 逻辑推理 的 分析 技术 基于 中间 表示 的 分析 技术 主要 包括 数据流 分析 控制 流 分析 污点 分析 符号执行 等 pixy 采 用了 取值 分析 污点 分析 指针 别名 分析 等 静态 分析 技术 实现 对 php 源码 中 的 sql 注入 和 跨 站 脚本 等 漏洞 的 检测 prefix 采 用了 静态 符号执行 技术 模拟 执行 cc 源码 程序 并 采用 约束 求解 对 程序 中 的 部分 路径 进行 检测 melange 采用 数据流 分析 的 框架 通过 对 程序 进行 数据流 控制 流 等 复杂 分析 检测 安全 相关 的 漏洞 并 支持 对 大型 cc 源码 程序 的 分析 基于 逻辑推理 的 分析 技术 主 要是 指 模型 检测 如 mopsblastslam 是 典型 的 面向 c 程序 的 模型 检测工具 其 基本思路 是 将 程序结构 抽象 为 状态机 布尔 程序 然后 基于 归纳 的 安全 属性 对 状态机 进行 遍历 检测 其中 存在 的 漏洞 面向 二进制 面向 二进制 程序 的 静态 漏洞 的 挖掘 技术 由于 缺少 源代码 中 的 结构化 信息 面临着 值 集 分析 与 控制 流 恢复 不精确 的 问题 当前 二进制 静态 漏洞 挖掘 技术 主要 包括 基于 模式 匹配 和 基于 补丁 比对 的 技术 在 基于 模式 匹配 的 漏洞 挖掘 技术 方面 gueb 提 出了 二进制 程序 中 uaf 漏洞 模式 首先 抽象 出 二进制 函数 中 的 内存 模型 然后 采用 vsa 分析 技术 追踪 堆 分配 和 释放 指令 相关 的 操作 变量 并 基 于此 建立 uaf 模式 loongchecker 使 用了 称为 半 仿真 的 二进制 静态 漏洞 挖掘 技术 通过 vsa 分析 和 数据 依赖 分析 技术 实现 对 变量 地址 的 追踪 和 数据流 依赖 分析 并 采用 污点 分析 技术 检测 潜在 的 漏洞 saluki 使 用了 路径 敏感 和 上下文 敏感 的 数据 依赖 分析 并 采用 完备 的 逻辑系统 推理 检测 程序 中 的 漏洞 在 基于 补丁 比对 的 漏洞 挖掘 技术 方面 pvdf 以 二进制 漏洞 程序 带有 权限 提升 漏洞 和 补丁 作为 输入 从 比对 中 提取 多维 属性 描述 的 漏洞 语义 信息 并 应用于 后续 的 模糊 测试 中 binhunt 通过 对 二进制 程序 和 带 补丁 的 二进制 程序 间 的 比对 提取 漏洞 相关 的 语义 信息 具体 而言 就是 把 二进制 程序 翻译成 中间 表示 并 在此基础上 构建 控制 流 图 基于 控制 流 图 对比 程序 间 的 差异 提取 相关 的 约束 然后 采用 符号执行 技术 进行 验证 以此 找出 补丁 对应 的 漏洞 动态 漏洞 挖掘 技术 常用 的 动态 漏洞 挖掘 技术 包括 模糊 测试 符号执行 等 模糊 测试 fuzzing 是 一种 自动化 或者 半自动化 的 软件 测试 技术 通过 构造 随机 的 非 预期 的 畸形 数据 作为 程序 的 输入 并 监控 程序 执行 过程中 可能 产生 的 异常 之后 将 这些 异常 作为 分析 的 起点 确定 漏洞 的 可利用 性 根据 程序 内部结构 分析 的 量级 轻重 程度 分 模糊 测试 技术 主要 可以 分为 白 盒 黑盒 灰 盒 模糊 测试 其中 白 盒 模糊 测试 是 在对 被 测试 程 程序 内部结构 逻辑 进行 系统性 分析 的 基础上 进行 测试 黑盒 模糊 测试 把 程序 当成 黑盒 处理 不对 程序 内部 进行 分析 灰 盒 模糊 测试 介于 黑盒 和 白 盒 模糊 测试 之间 在对 程序 进行 轻量级 分析 的 基础上 进行 测试 按 样本 生成 方式 划分 模糊 测试 的 测试 输入 可分为 基于 变异 和 基于 生成 种 方式 其中 基于 变异 的 模糊 测试 在 修改 已知 测试 输入 的 基础上 生成 新 的 测 试用 例 而 基于 生成 的 模糊 测试 则是 直 接在 已知 输入 样本 格式 的 基础上 生成 新 的 测试 输入 下面 介绍 基于 变异 的 模糊 测试 基于 生成 的 模糊 测试 和 其他 优化 策略 基于 变异 的 模糊 测试 在 基于 变异 的 模糊 测试 方面 研究人员 借助 程序 执行 环境 信息 和 程序 分析 技术 有 导向 性地 辅助 引导 模糊 测试 的 变异 具有 代表性 的 工作 有 等 afl 官 网 源码 源码 源码 源码 源码 源码 源码 代码 覆盖率 制导 afl 使用 进化 算法 生成 测试 输入 在 正常 输入 的 基础上 通过 简单 的 反馈 回路 的 方式 评估 测试 输入 的 质量 afl 会 保留 任 何能 触发 新 路径 的 测试 输入 并 对 其 进行 变异 及 检查 能否 触发 崩溃 afl 通过 哈希 函数 检测 分支 覆盖 筛选 种子 的 方式 具有 较高 的 误报率 其 哈希 位图 bitmap 只有 kb 大小 导致 普遍存在 哈希 碰撞 的 情况 进而 导致 其 分支 覆盖 统计 存在 漏报 进而 影响 种子 筛选 间接 影 响了 代码 覆盖率 的 增长 collfuzz 采用 静态 控制 流 图 信息 作为 辅助 并 设计 了 能 避免 哈希 碰撞 的 基本块 id 分配 策略 从而 实现 比 afl 更 精确 的 分支 覆盖 检测 污点 分析 辅助 buzzfuzz 使用 动态 污点 分析 技术 自动 定位 影响 程序 脆 弱点 的 测试 输入 中 的 字段 然后 保留 其他 语法 部分内容 只对 这些 字段 进行 变异 这样 既能 通过 语法 检查 也 能有 针对 性地 进行 变异 提高 漏洞 挖掘 的 效率 taintscope 使用 污点 分析 技术 推断 程序 中 与 校验 和 处理 相关 的 代码 以此 帮助 模糊 测试 工具 绕过 校验 和 检查 符号执行 制导 driller 采用 模糊 测试 和 符号执行 交替 探索 程序 执行 路径 解决 模糊 测试 陷入 代码 覆盖率 增长 慢 的 情况 这样 能 引导 模糊 测试 探索 到 程序 更深 层次 的 节点 也 能 直接 避免 符号执行 可能 带来 的 路径 爆炸 问题 不过 基于 符号执行 增强 的 模糊 测试 技术 仍然会 受限于 符号执行 中 的 约束 求解 问题 符号执行 的 引入 可能会 弱化 模糊 测试 本身 的 可 扩展性 控制 流 和 数据流 信息 制导 vuzzer 在 轻量级 的 动 静态 分析 基础上 提 取了 程序 的 控制 流 和 数据流 信息 引导 变异 具体 而言 vuzzer 先在 静态 控制 流 分析 基础上 计算 基本块 的 权重 然后 在 动态 执 行时 筛选 权重 更高 即 路径 更深 的 执行 路径 对应 的 测试 输入 为 种子 文件 并用 动态 污点 分析 定位 变异 点 相比 有 更好 的 种子 筛选 路径 探索 策略 以及 污染 点 定位 变异 策略 能 定向 引导 探索 更深 的 执行 路径 并 定点 变异 基于 生成 的 模糊 测试 基于 生成 的 模糊 测试 主要 基于 模型 或者 语法 生成 能 满足 程序 语法 和 语义 检查 的 测试 输入 常 用于 高度 结构化 的 测试 输入 生成 基于 模型 的 模糊 测试 peachspike 是 典型 的 基于 模型 的 模糊 测试 工具 通过 对 输入 格式 定制 编写 数据模型 datamodel 和 状态 模型 statemodel 的 方式 指定 输入 数据 的 类型 和 依赖 关系 并 结合 变异 策略 生成 测试 输入 其中 peach 通过 编写 配置文件 实现 对 样本 格式 的 约束 而 spike 需要 利用 提供 的 编程 接口 来 对 样本 格式 进行 约束 pham 等 结合 输入 模型 和 符号执行 技术 生成 测试 输入 使用 符号执行 鉴别 输入 格式 约束 能 有效 保证 输入 的 合法性 peach 官 网 基于 语法 的 模糊 测试 csmith 根据 c 语言 语法 生成 c 程序 源码 实现 对 c 编译器 的 模糊 测试 在 c 源码 生成 方面 csmith 随机 选取 符合 生成 规则 和 语法 规则 的 c 程序 这种 方法 能 避免 因 未定义 和 未声明 而 导致 编译 报错 的 情况 出现 langfuzz 基于 语法 学习 测试 集中 的 代码 片段 并 进行 片段 重组 生成 新 的 测试 输入 在 测试 输入 集 选择 上 langfuzz 假设 基于 问题 测试 集 重组 生成 的 测试 输入 比 随机 收集 的 测试 输入 更有 可能 触发 程序 缺陷 ifuzzer 使用 上下文 无关 的 语言 语法 作为 输入 并 使用 语法 生成 解析 树 然后 从 测试 集中 抽取 代码 片段 并 使用 遗传 进化 算法 对 代码 片段 重组 生成 新 的 测试 输入 jsfunfuzz 使 用了 历史 漏洞 知识 和 硬 编码 规则 生成 测试 输入 以 mozilla 浏览器 中 的 javascript 解释 器 为 测试 目标 发现了 多个 缺陷 dewey 等 使 用了 称为 约束 逻辑 编程 的 技术 生成 测试 输入 通过 指定 句法 特征 和 语义 行为 clp 能 生成 满足 语法 和 语义 合法性 的 测试 输入 csmith 官 网 源码 源码 其他 优化 策略 除了 上述 进展 外 还有 一些 重要 研究 侧重于 种子 筛选 策略 优化 和 调度 策略 优化 rebert 等 把 种子 筛选 问题 转化成 整数线性规划 问题 并以 挖掘 更多 漏洞 为 目标 提 出了 多种 种子 筛选 策略 aflfast 采 用了 把 模糊 测试 问题 建模 为 markov 模型 并 采用 特定 的 策略 引导 afl 优先选择 低频 路径 和 变异 频率 较低 的 文件 作为 种子 文件 进行 变异 以此 在 相同 的 测试 时间内 探索 更多 的 路径 aflgo 采 用了 模拟退火 算法 对 能 逼近 特定 目标 位置 的 测试 输入 分配 更高 的 能量 并 优先 选取 高能量 种子 文件 进行 变异 aflgo 的 实验 结果表明 这种 导向 型 灰 盒 模糊 测试 比 符号执行 引导 的 白 盒 模糊 测试 和 非 导向 型 模糊 测试 具有 更好 的 性能 更高 的 代码 覆盖率 并可 挖掘出 更多 的 漏洞 符号执行 代表性 工具 有 等 se 源码 官 网 源码 源码 符号执行 需要 解决 几个问题 路径 爆炸 问题 解决方案 启发式 搜索 这是 一种 以 特定 目标 优先 的 路径 搜索 策略 符号执行 过程中 对 路径 的 探索 可以 看成是 对 符号执行 树 的 探索 在 执 行树 中 从 根 节 点到 叶子 节点 的 一条 路径 代表 程序 实际 执行 中 的 一条 路径 而 其中 的 分支 节点 则 表示 程序 实际 执行 中 的 分支 条件 大部分 启发式 技术 都 专注 于 避免 因 陷入 某部 分 相似 路径 而 导致 代码 覆盖率 低 增长 的 情况 以期 获得 更高 的 代码 和 路径 覆盖 klee 中 提出 结合 随机 路径 选择 和 覆盖 优化 搜索 的 混合 搜索算法 种 路径 选择 方法 交叉 使用 探索 执行 路径 既能 达到 高 代码 覆盖率 的 目的 又能 防止 某种 算法 陷入困境 导致 路径 探索 无法 进行 ma 等 提 出了 以 指定 行 代码 可达性 为 目标 的 搜索 策略 以 程序 中 某行 或 多行 代码 为 目标 找出 能够 驱动程序 执行 这些 代码 的 实际 输入 问题 称为 代码 行 可达 性问题 godefroid 等 提 出了 代 搜索 算法 在 每 一代 新 生成 的 路径 约束 中 对 所有 分支 条件 取反 然后 能 选择 覆盖 新 代码 块 最多 的 测试 输入 作为 新 的 种子 输入 状态 空间 简化 通过 相似 路径 合并 冗余 路径 删减 的 方式 达到 减少 路径 探测 的 目的 利用 程序 分析 和 软件 验证 等 技术 减少 精简 路径 的 措施 来 缓解 路径 爆炸 问题 godefroid 等 采 用了 函数 摘要 的 方式 对 重用 的 函数 提取 约束 组合 摘要 实现 对 函数 路径 的 组合 执行 避免了 多次 重复 符号执行 带来 的 开销 ramos 等 提出 的 限定 约束 的 符号执行 采 用了 直接 面向 独立 函数 的 符号执行 技术 此 技术 限定 了 符号执行 的 范围 用 精确度 换取 可 扩展性 的 方式 来 提升 符号执行 的 性能 veritesting 采 用了 静态 符号执行 技术 增强 动态 符号执行 技术 实现 路径 合 并和 冗余 路径 删减 boonstoppel 等 提 出了 rwset 从 状态变量 的 相似性 鉴别 冗余 性 如果 当前 状态 的 变量 跟 之前 的 路径 变量 一样 则会 停止 对 当前 状态 的 探索 约束 求解 问题 约束 求解 问题是 动态 符号执行 遇到 的 另一个 瓶颈 问 题在 动态 符号执行 中 对 路径 约束条件 可达性 的 判定 以及 相应 测试 输入 生 成都 需要 频繁 地 调用 smt 求解 器 进行 求解 而 约束 求解 本身 又是 一个 np 完全 npcomplete 问 题在 最差 的 情况下 求解 np 完全问题 的 复杂度 为 指数 级 频繁 调用 加 上高 的 求解 难度 直接 导致 约束 求解 消耗 了 符号执行 系统 中 的 大部分 资源 当前 约束 求解 问题 可以 归结为 求解 能力 和 求解 效率 问题 求解 能力 问题是 指 当前 求解 器 对 复杂 约束条件 处理 能力 的 不足 例如 对于 浮点数 运算 非线性 运算 等 一些 复杂 运算 的 约束 求解 器 都不能 很好 地 处理 求解 效率 问题是 指 对于 含有 大量 的 约束条件 的 路径 约束 求解 器 的 性能 会 随着 约束条件 数量 的 增长 而 逐渐 下降 这 使得 符号执行 对 大型 程序 进行 分析 时 整体 性能 下降 从而 影响 其 可 扩展性 针对 约束 求解 的 两大 问题 研究人员 提 出了 很多 约束 求解 性能 优化 措施 主要 可分为 内部 优化 和 外部 优化 解决方案 求解 器 内部 优化 是 指 通过 优化 求解 器 本身 对 约束条件 处理 能力 和 效率 来 提高 符号执行 的 性能 虽然 近年来 这方 面的 研究 已经 取得了 比 较大 的 突破 但仍然 严重 依赖于 可 满足 模 理论 以及 np 完全问题 的 研究进展 求解 器 外部 优化 主 要是 指在 调用 约束 求解 器 对 路径 约束 求解 之前 的 优化 是 通过 减少 甚至 避免 符号 查询 的 工作 来 增加 符号执行 性能 的 措施 例如 cute 和 klee 采用 了如 表达式 重写 符号 值 的 实际 替换 不相关 约束 的 删除 以及 约束 缓存 等 一系列 措施 对 路径 约束 进行 精简 和 结果 重用 而 近年来 在这 方面 的 研究 又有 了 不小 的 突破 包括 等 这些 工具 的 提出 主要 侧重于 解决 优化 符号执行 结果 切分 标准化 命名 约束 式 逻辑 转化 求解 结果 的 缓存 搜索 和 重用 的 效率 问题 有关 这些 工具 的 实验 结果表明 路径 约束 的 精简 能 减轻 约束 求解 的 负担 而 约束 求解 结果 的 缓存 和 重复使用 能在 同一 程序 的 不同 路径 以及 不同 程序 的 不同 路径 间 的 约束 求解 问 题上 极 大地 减少 对 求解 器 的 调用 漏洞 可利用 性 分析 漏洞 可利用 性 判定 该 方面 现有 的 一些 工具 如 等 已经 可 以对 漏洞 挖掘 过程中 的 异常 或 崩溃 的 可利用 性 进行 初步 分类 例如 exploitable 对 崩溃 按 可利用 exploitable 高 可利用 不可 利用 未知 unknown 进行 评级 划分 并 提供 了 哈希 去 重 功能 但 上述 工具 具有 误报率 高 的 缺陷 实际 验证 的 时候 仍然 需要 具有 丰富 漏洞 挖掘 和 分析 经验 的 专家 进行 手工 逆向 分析 调试 进行 审核 确认 并 编写 利用 漏洞 的 验证 程序 在 崩溃 样本 量 较大 时 这种 方式 低效 而且 对 分析 人员 具有 较高 要求 自动化 漏洞 利用 生成 该 方面 有 代表性 的 相关 工作 如 下图 所示 在年 的 ieeesampp 会议 上 dbrumley 等人 首次 提 出了 基于 二进制 补丁 比较 的 漏洞 利用 自动 生成 方法 apeg 其 核心 思路 是 基于 以下 的 假设 条件 即 补丁 程序 中 增加了 对 触发 原程序 崩溃 的 过滤 条件 因此 只要 能够 找到 补丁 程序 中 添加 过滤 条件 的 位置 同时 构造 不满足 过滤 条件 的 违规 输入 即可 认为是 原始 程序 的 一个 可利用 的 输入 候 选项 根据 其 具体 介绍 内容 可知 该 工作 主要 分为 三个 步骤 首先 利用 二进制 差异 比较 工具 例如 bindiff 与 ebds 等 找到 补丁 存在 的 位置 即 补丁 程序 的 检测 点 其次 找出 不满足 补丁 程序 检测 点 的 输入 数据 作为 原始 程序 的 利用 候 选项 最后 利用 污点 传播 等 监控 方法 筛选 所有 能够 对 原始 程序 造成 溢出 或者 控制 流 劫持 等 崩溃 发生 的 有效 利用 年 的 ndss 会议 上 tavgerinos 等人 首次 提 出了 一种 有效 的 漏洞 自动 挖掘 和 利用 方法 aeg 该 方法 的 核心 思想 是 借助 程序验证 技术 找出 能够 满足 使得 程序 进入 非 安全 状态 且 可被 利用 的 输入 其中非 安全 状态 包括 内存 越界 写 恶意 的 格式化 字符串 等 可被 利用 主 要是 指 程序 的 eip 被 任意 操纵 其 具体 流程 为首 先在 预处理 阶段 利用 gnuc 编译器 构建 二进制 程序 以及 通过 llvm 生成 所需 的 字节 码 信息 其次 在 实际 分析 的 过程中 aeg 首先 通过 源码 分析 以及 符号执行 找出 存在 错误 的 位置 并 通过 路径 约束条件 生成 相应 的 输入 之后 aeg 利用 动态 分析 方法 提取 程序 运行时 的 各类 信息 例如 栈 上 脆弱 缓冲区 的 地址 脆弱 函数 的 返回 地址 以及 在 漏洞 触发 之前 的 其他 环境 数据 等 随后 综合 漏洞 利用 约束条件 以及 动态 运行时 环境 信息 最终 构建 可利用 样本 aeg 集 成了 优化 后 的 符号执行 和 动态 指令 插 装 技术 实现 了 从 软件 漏洞 自动 挖掘 到 软件 漏洞 自动 利用 的 整个 过程 并且 生成 的 利用 样本 直接 具备 控制 流 劫持 能力 是 第一个 真正 意义上 的 面向 控制 流 漏洞 利用 的 自动化 构建 方案 为了 摆脱 对 源代码 的 依赖 以及 保证 系统 适用 场景 的 广泛性 skcha 等人 在年 的 ieeesampp 会议 上 提 出了 基于 二进制 程序 的 漏洞 利用 自动 生成 方法 mayhem 该 方法 通过 综合利用 在线 式 符号执行 的 速度 优势 和 离线 式 符号执行 的 内存 低消耗 特点 并 通过 基于 索引 的 内存 模型 构建 进而 实现 较为 实用化 的 漏洞 挖掘 与 利用 自动 生成 方法 其 具体 流程 如下 首先 通过 构建 两个 并行 的 符号执行 子系统 具体 执行 和 符号执行 子系统 其次 对于 具体 执行 子系统 通过 引入 污点 传播 技术 寻找 程序 执行 过程中 由 用户 输入 所能 控制 的 所有 jmp 指令 或者 call 指令 并 将其 作为 bug 候 选项 交给 符号执行 子系统 之后 符号执行 系统 将 所有 接 收到 的 污点 指令 转 化为 中间 指令 并 进行 执行 路径 约束 构 建和 可利用 约束 构建 最后 符号执行 系统 通过 约束 求解 器 来 寻找 满足 路径 可达 条件 和 漏洞 可利用 条件 的 利用 样本 由于 高质量 多样性 的 漏洞 利用 样本 对 漏洞 危害 评估 具有 重要 的 意义 因此 在年 securecomm 会议 上 mhwang 等人 针对 控制 流 劫持 类 漏洞 提 出了 一套 多样性 利用 样本 自动 生成 方法 polyaeg 该 方法 的 核心 思想 是 通过 动态 污点 分析 找出 程序 所有 控制 流 劫持 点 通过 构建 不同 的 控制 流 转移 模式 完成 漏洞 利用 样本 的 多样性 构造 其 具体 流程 为 首先 通过 扩展 硬件 虚拟 化 平台 qemu 实现 程序 动态 监控 并 提取 程序 执行 的 相关 信息 其次 在 动态 获取 信息 的 基础上 构建 指令 级 污点 传播 流 图 itpg 以及 全局 污点 状态 记录 gtsr 并以 此为 基础 获取 程序 中所 有 可能 的 控制 流 劫持 点 可利用 的 跳板 指令 以及 可 存放 攻击 代码 的 污点 内存 区域 等 内容 最后 通过 构建 不同 的 跳转 指令 链 以及 不同 污点 内存 区域 的 攻击 代码 并 通过 路径 约束条件 求解 生成 具有 多样性 的 利用 样本 集合 为了 解决 数据 执行 保护 和 地址 随机化 给 控制 流 劫持 类 漏洞 利用 带来 的 困扰 在年 的 usenixsecurity 会议 上 ejschwartz 等人 实现 了 一套 面向 高可靠性 漏洞 利用 的 rop 代码 自动 生成 方法 q 其 核心 思想 是 收集 目标 程序 中 的 gadget 并 通过 面向 gadget 的 编程 语言 自动 构建 rop 具体 的 流程 主要 如下 首 先向 q 提供 未 随机化 的 脆弱 程序 或者 其他 二进制 库 并由 q 找出 具备 特定 功能 的 gadget 集合 其次 利用 q 提供 的 编程 语言 qool 实现 满足 特定 语义 功能 的 目标 代码 并 通过 q 将 目标 代码 编 译为 面向 gadget 的 指令 序列 随后 通过 利用 已 获取 的 gadget 集合 填充 上 一步 得到 的 指令 序列 从而 形成 最终 的 rop 代码 在 数据 执行 保护 地址 随机化 以及 控制 流 完整性 防护 手段 大范围 部署 的 情况下 大多数 攻击者 已经 从 面向 控制 流 劫持 的 漏洞 利用 攻击 转向 面向 数据流 利用 的 攻击 正是 在 这样 的 背景 下 hhu 等人 在年 usenixsecurity 会议 上 首次 提 出了 一种 面向 数据流 利用 的 自动化 构造 方法 flowstitch 该 方法 的 核心 思想 是 在 不 改变 程序控制 流 的 前提下 利用 已知 的 内存 错误 直接 或者 间接 篡改 程序 原有 数据流 中 关键 位置 上 的 变量 进而 完成 利用 的 自动化 构造 根据 文章 介绍 其 具体 过程 分为 以下 几个 步骤 首 先以 含有 内存 错误 的 程序 触发 内存 错误 的 输入 以及 特殊 的 正常 输入 作为 整个 自动 利用 系统 的 三个 前提条件 其中 特殊 的 正常 输入 是 指在 程序 错误 发生 之前 其 执行 路径 必须 和 触发 内存 错误 的 执行 路径 相同 其次 分别 以 错误 输入 和 正常 输入 获 取其 对应 的 错误 执行 记录 和 正常 执行 记录 并以 此为 基础 分别 进一步 提取 内存 错误 影响 的 范围 以及 正常 数据流 中 的 敏感数据 最后 通过 比对 错误 执行 记录 和 正常 执行 记录 的 方式 确定 内存 错误 影响 范围 中 可能 涉及到 的 敏感数据 最终 筛选 所有 可能 被 篡改 的 敏感数据 并 完成 面向 数据流 的 利用 自动化 构建 过程 flowstich 是 第一个 面向 数据流 的 漏洞 自动 利用 方案 尽管 其 构造 的 利用 样本 无法 直接 运行 任意 的 恶意代码 但由于 可以 泄露 目标 主 机上 的 敏感数据 因此 仍然 具有 很强 的 实用价值 ai 赋 能 近年来 已经有 智能化 漏洞 挖掘 技术研究 基于 机器 学习 深度 学习 技术 展开 如 下表 所示 从 应用 场景 看 涉及 了 二进制 程序 函数 识别 函数 相似性 检测 测试 输入 生成 测试 输入 筛选 路径 约束 求解 等 领域 从 使用 的 机器 学习 算法 看 这些 工作中 分别 采 用了 逻辑 回归 随机 森林 长 短时记忆 网络 lstm 强化 学习 等 多种 机器 学习 深度 学习 的 算法 从 发表 年份 看这 方面 的 研究成果 从 年 开始 发表 在 信息 安全 顶级 会议 上自 年 以来 其 数量 逐渐 上升 并 已经成为 当前 信息 安全 研究 领域 的 热点 二进制 程序 函数 识别 二进制 程序 函数 识 别是 二进制 分析 的 基础 对于 软件 漏洞 分析 与 修复 甚至 恶意 软件 检测 协议 逆向 等 都 至关重要 由于 二进制 代码 缺少 高级 语言 程序 中 的 信息 函数 的 识别 往往 比较 困难 现有 的 反汇编 分析 工具 具有 识别 正确率 低 的 缺陷 bao 等 提 出了 byteweight 方案 采用 机器 学习 算法 实现 对 二进制 程序 函数 的 识别 具体 而言 首先 采用 加权 前缀 树 学习 函数 的 签名 并 通过 签名 匹配 二进制 片段 的 方式 识别 函数 其中 树 中 每个 节点 与 二进制 中 的 字节 或 指令 相 对应 而 从 根 节 点到 某个 既定 节点 的 路径 代表 了 可能 的 字节 或 指令 序列 权 重则 表示 了 对 数据 集 采用 简单 线性 扫描 算法 学习 到 的 字节 或 指令 序列 的 置 信度 在 鉴别 函数 的 同时 byteweight 采用 值 集 分析 和 增量 控制 流 恢复 算法 实现 对 函数 边界 的 识别 此种 方案 可以获得 比 idapro 和 bap 工具 更高 的 准确率 shin 等 用 循环 神经网络 算法 改 进了 byteweight 的 性 能在 模型 训练 时间 上有 了 数量级 上 的 提升 并 取得了 更高 的 准确率 函数 相似性 检测 现代 应用程序 中 直接 调用 第三方 函数 可以 节约 开发 成本 提高 开发 效率 是 被 广泛 接受 的 开发 惯例 但 这种 方式 容易 导致 供应链 安全 风险 一旦 被 调用 函数 存在 漏洞 则 调用 这一 函数 的 程序 也 可能 存在 漏洞 通过 函数 相似性 检测 技术 可以 实现 对 不同 程序 间 的 同源性 漏洞 的 检测 但 当前 基于 图 的 相似 度 匹配 的 方法 具有 计算 量大 准确率 低 的 缺陷 xu 等 提 出了 gemini 方案 gemini 把 函数 控制 流 图 cfg 简 化为 带 节点 属性 数字 特征 的 控制 流 图 acfg 然 后用 structurevec 算法 转 化为 数字 向量 使用 siamese 网络 架构 训练 实现 相似 的 函数 距离 近 的 目标 最后 通过 计算 函数 向量 距离 实现 函数 相似性 的 检测 gemini 能 应用到 跨 平台 的 二进制 函数 相似性 检测 并 取得了 比 其他 基于 图 相似性 匹配 的 工具 如 genius 更高 的 准确率 和 检测 效率 测试 输入 生成 在 软件 漏洞 挖掘 中 构造 代码 覆盖率 高 或 脆弱性 导向 型 的 测试 输入 能 提高 漏洞 挖掘 的 效率 和 针对性 利用 机器 学习 技术 可 以对 海量 测试 样本 进行 分析 学习 并 利用 生成 模型 指导 生成 更高 质量 的 测试 输入 样本 godefroid 等 首次 把 模糊 测试 中 的 高 结构化 样本 生成 问题 转换 成了 nlp 领域 的 文本 生成 问题 采 用了 charrnn 模型 实现 对 pdf 文件 格式 中 的 obj 语法 的 学习 并用 训 练好 的 模型 生成 具有 多样性 的 obj 对象 和 pdf 文件 she 等 提 出了 采用 深度 神经网络 指导 模糊 测试 输入 生成 的 方案 neuzzneuzz 采 用了 cnn 学习 连续 可 微 的 神经 程序 neuralprogram 用来 近似 模拟 目标 程序 中 的 实际 逻辑 然后 通过 对 学 习好 的 神经 程序 求 梯度 的 方式 指导 测试 输入 生成 以此 取得 对 目标 程序 更高 的 分支 覆盖 与 afl 相比 neuzz 在 个 不同 的 常用 程序 中 多 发现了 倍 的 分支 并 多 发现了 个 缺陷 bottinger 等 提 出了 深度 强化 学习 增强 的 模糊 测试 技术 借助 markov 模型 把 模糊 测试 问题 转化成 强化 学习 问题 并 利用 qlearning 算法 优化 预 定义 的 奖励 函数 实验 结果表明 使用 深度 强化 学习 增强 的 模糊 测试 技术 比 随机 变异 能 取得 更高 的 代码 覆盖率 nichols 等 提 出了 生成 对抗 网络 gan 增强 模糊 测试 技术 该 方案 不依 赖于 大 数据量 的 样本 训练 并能 比 afl 的 随机 变异 和 基于 lstm 模型 引导 的 变异 更 高效 地 发现 更多 的 路径 neuzz 源码 测试 输入 筛选 测试 样本 筛选 的 目的 是 从 海量 样本 中 选择 更有 可能 触发 新 路径 或 触发 漏洞 的 测试 输入 使用 机器 学习 技术 通过 对 大量 的 测试 样本 进行 处理 从而 决定 哪些 应 该被 进一步 分析 尽可能 准确 地 对 样本 进行 标记 然后再 用于 寻找 安全漏洞 rajpal 等 使用 lstm 序 列到 序列 seqseq 等 神经网络 学习 模糊 测试 过程中 的 历史 变异 样本 及 代码 覆盖率 等 数据 训 练出 能 指导 对 输入 文件 进行 定向 变异 的 模型 此外 spieker 还提 出了 采用 强化 学习 的 算法 优先 筛选 漏洞 导向 型 的 测 试用 例 应用在 持续 集成 及 回归 测试 regressiontest 中 路径 约束 求解 模糊 测试 特别是 代码 覆盖率 制导 的 模糊 测试 如 afl 侧重于 筛选 可以 覆盖 新 路径 的 样本 为 种子 文件 但对 种子 文件 变异 时 并没有 充分利用 程序 数据流 等 信息 指导 变异 这 使得 变异 盲目 低效 生成 样本 冗余 现有 的 一些 启发式 优化 工作 如 steelix 能够 对 魔术 字节 跟踪 定位 但 无法 对 其他 路径 约束 求解 具备 路径 约束 求解 能力 是 符号执行 比 模糊 测试 等 漏洞 挖掘 技术 更 先进 的 体现 也 使得 符号执行 在 理论上 具备 了 系统性 探索 程序 执行 路径 的 能力 但 复杂 程序 中 的 路径 爆炸 问题 带来 的 对 smt 求解 器 的 频繁 调用 以及 smt 求解 器 本身 的 能力 和 效率 的 不足 使得 约束 求解 占 用了 符号执行 中 主要 的 性能 开销 约束 求解 问题 也 成为 符号执行 中 面临 的 主要 瓶颈 问题 之一 angora 采用 污点 追踪 测试 输入 中 影响 条件 分支 的 字节 然后 使用 梯度 下降 的 方式 对 变异 后 生成 的 路径 约束 进行 求解 这种 方式 避免了 符号执行 调用 smt 求解 器 可能 带来 的 开销 以及 复杂 约束 不可 解 的 问题 但 梯度 下降 对 目标 函数 不可 导 或 存在 不可 导 点 时 仍然会 出现 求解 困难 的 问题 angora 源码 漏洞 程序 筛选 传统 的 漏洞 挖掘 技术 如 模糊 测试 符号执行 等 已经 成功地 从 各类 软件 中 发现了 大量 的 漏洞 但 当 被 测试 程序 复杂 且 数量 庞大 的 时候 使用 这些 技术 挖掘 漏洞 显得 效率 低下 vdiscover 采用 机器 学习 技术 从 大量 的 程序 中 快速 筛选 更有 可能 带有 漏洞 的 程序 具体 而言 vdiscover 收集 程序 中 的 标准 c 库函数 调用 序列 及其 参数 的 动态 值 作为 静态 和 动态 特征 并 对 其 做 标注 然后 采用 带 监督 的 机器 学习 算法 如 随机 森林 逻辑 回归 等 训练 模型 当 有 新 的 被 测试 程序 需要 分类 的 时候 训 练好 的 模型 可以 直接 对 提取 的 相应 特征 进行 预 判 和 标注 vdiscover 首次 验证 了 采用 机器 学习 技术 筛选 漏洞 程序 的 可行性 但 其 采用 人工 定义 和 提取 特征 的 方法 具有 较大 的 局限性 漏洞 成因 复杂 vdiscover 提取 的 程序 静态 特征 和 动态 特征 并不能 精确地 表征 各种类型 的 漏洞 这 可能 造成 较高 的 误报 和 漏报 另外 采用 机器 学习 直接 对 漏洞 程序 进行 预测 的 方式 无法 生成 测 试用 例 来 动态 验证 漏洞 vdiscover 官 网 源代码 漏洞 点 预测 传统 静态 漏洞 挖掘 技术 中 依赖于 人工 定义 漏洞 模式 的 检测 方式 经 常会 导致 较高 的 漏报 率 lizhen 提 出了 vuldeepecker 方案 采用 blstm 算法 对 cc 源代码 中 的 漏洞 点 进行 预测 鉴于 传统 的 漏洞 分类 过细 导致 难以 抽象 提取 为 特征 的 问题 其 设计 了 能 覆盖 多种 漏洞 类型 的 特征 这种 方式 不以 函数 为 粒度 只 考虑 数据流 保留 语义上 关联 的 代码 行 作为 代码 小 部件 codegadgets 对 程序 进行 表征 然后 转换成 向量 作为 深度 学习 的 输入 但 vuldeepecker 方案 中 代码 小 部件 转换成 向量 的 过程 存在 较大 的 信息 丢失 问题 另外 该 方案 只 支持 对 缓冲区 溢出 和 资源管理 相关 的 漏洞 的 检测 补充 污点 分析 污点 分析 是 一种 跟踪 并 分析 污点 信息 在 程序 中 流动 的 技术 其 分析 对 象是 污点 信息流 污点 指的是 受到 污染 的 信息 在 程序 分析 中将 来自 程序 之外 并且 进入 程序 的 信息 当做 污点 信息 根据 分析 的 需要 程序 内部 使用 的 数据 也 可 作为 污点 信息 并 分析 其 对应 的 信息 的 流向 根据 污点 分析 时 是否 运行 程序 可以 将其 分为 静态 污点 分析 和 动态 污点 分析 污点 分析 的 过程 包括 识别 污点 信息 在 程序 中 的 产 生点 并 对 污点 信息 进行 标记 利用 特定 的 规则 跟踪 分析 污点 信息 在 程序 中 的 传播 过程 在 一些 关键 的 程序 点 检查 关键 的 操作 是否 会 受到 污点 信息 的 影响 污点 信息 的 产 生点 称为 source 点 污点 信息 的 检查点 称为 sink 点 以下 图为 例 来 说明 污点 分析 过程 将 scanf 所在 的 程序 点 作为 source 点将 通过 scanf 接收 的 用户 输入 数据 标 记为 污点 信息 并且 认为 存放 它 的 变量 x 是 被 污染 的如 果在 污点 传播 规则 中 规定 如果 二元 操作 的 操作数 是 污染 的 那么 二元 操作 的 结果 也是 污染 的 则 对于 yxk 由于 x 是 污染 的 因此 y 也 被 认为是 污染 的 一个 被 污染 的 变量 如果 被 赋值 为 一个 常数 它 将被 认为是 未 污染 的 对于 x 将 x 从 污染 状态 转变为 未 污染 对于 while ilty 这句 所在 的 程序 点在 这里 被 认为是 一个 sink 点 如果 污点 分析 规则 规定 循环 的 次数 不能 受 程序 输入 的 控制 那么 在这里 就需要 检查 变量 y 是否 是 被 污染 的 污点 分析 代表性 工具 有 年 的 工作 作者 之 一是 互联网 安全 教母 dawnsong 也是 清华 张超 老师 在 伯克利 做 博士后 时 的 合作 导师 没找到 源码 源码 符号执行 符号执行 是 一种 用 符号 值 代替 数字 值 执行 程序 的 技术 符号 是 表示 一个 取值 集合 的 记号 使用 符号执行 分析 程 序时 对于 某个 表示 程序 输入 的 变量 通常 使用 一个 符号 表示 它 的 取值 这个 符号 可以 表示 程序 在 此处 接收 的 所有 可能 的 输入 此 外在 符号执行 的 分析 过程中 那些 不易 或者 无法 确定 取值 的 变量 也 常常 使用 符号 表示 的 方式 进行 分析 符号执行 的 分析 过程 大致 如下 首 先将 程序 中 的 一些 需要 关注 但是 又不能 直接 确定 其 取值 的 变量 用 符号 表示 其 取值 然后 通过 逐步 分析 程序 可能 的 执行 流程 将 程序 中 变量 的 取值 表示 为 符号 和 常量 的 计算 表达式 程序 的 正常 执行 和 符号执行 的 主 要去 呗 呗 是 正常 执 行时 程序 中 的 变量 可以 看做 被 赋予 了 具体 的 值 而 符号执行 时 变量 的 值 既可 以是 具体 的 值 也 可 以是 符号 和 常量 的 运算 表达式 以 下图 的 符号执行 源代码 为 例 函数 中 的 参数 xy 分 别用 符号 ab 表示 基于 上图 的 代码 可以 得到 下图 所示 的 程序 流程图 可以 看到 共有 三条 执行 路径 每条 路径 都对 应着 一个 路径 约束 pathconstrainpc 其中 返回 true 的 路径 有 一条 带入 符号 后 对应 的 路径 约束 为 agtamp b 返回 false 的 路径 有 两条 对应 的 路径 约束 为 alt agtamp b 这个 例子 表明 使用 符号执行 技术 分析 程序 对于 分析 过程中 遇到 的 程序 中 带有 条件 的 控制 转移 语句 条件 分支 语句 循环 语句 等 可以 利用 变量 的 符号 表达式 将 控制 转移 语 句中 的 条件 转 化为 对 符号 取值 的 约束 通过 分析 约束 是否 可以 满足 判断 程序 的 哪条 路径 是 可行 的 这一 部分 是 符号执行 分析 的 关键 部分 由此 将 判断 路径 条件 是否 可 满足 的 问题 转 化为 判断 符号 取值 的 约束 是否 可 满足 的 问题 而 对于 约束 是否 可 满足 的 判断 通常 使用 约束 求解 的 方法 该 过程 由 约束 求解 器 完成 约束 求解 器 是 对 特定 形式 的 约束 表示 进行 求解 的 工具 在 符号执行 的 分析 过程 中常 使用 可 满足 性 模 理论 求解 器 对 约束 进行 求解 为此 需 要将 符号 取值 约束 的 求解 问题 转为 smt 问题 即 一阶 逻辑 的 可 满足 性 判断 问题 常用 的 smt 求解 器 有 源码 源码 插 桩 插 桩 技术 是 将 额外 的 代码 注入 程序 中 以 收集 运行时 的 信息 可分为 两种 源代码 插 桩 sci 额外 代码 注入 到 程序 源代码 中 原始 程序 插 桩 后 的 程序 二进制 插 桩 bi 额外 代码 注入 到 二进制 可执行文件 中 静态 二进制 插 桩 在 程序 执 行前 插入 额外 的 代码 和 数据 生成 一个 永久 改变 的 可执行文件 动态 二进制 插 桩 在 程序 运行时 实时 地 插入 额外 代码 和 数据 对 可执行文件 没有 任何 永久 改变 目前 应用 广泛 的 动态 二进制 分析 工具 有 pin 源码 官 网 官 网 官 网 valgrindorg 