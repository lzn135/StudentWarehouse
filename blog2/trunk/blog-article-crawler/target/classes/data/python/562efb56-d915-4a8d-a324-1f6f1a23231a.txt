安全 攻防 进阶篇 一 什么 是 逆向 分析 逆向 分析 应用 及 经典 扫雷 游戏 逆向 从 年月 开始 我 来 到了 一个 陌生 的 专业 网络空间 安全 初 入 安全 领域 是 非常 痛苦 和 难受 的 要 学 的 东西 太多 涉及面 太 广 但 好在 自己 通过 分享 篇 网络安全 自学 系列 文章 艰难 前行 着 感恩 这一 年 相识 相知 相 趣 的 安全 大佬 和 朋友们 如果 写得 不好 或 不足之处 还请 大家 海涵 接下来 我 将 开启 新 的 安全 系列 叫 安全 攻防 进阶篇 也是 免费 的 篇文章 作者 将 更加 深入 的 去 研究 恶意 样本 分析 逆向 分析 内网 渗透 网络 攻防 实战 等 也 将 通过 在线 笔记 和 实践 操作 的 形式 分享 与 博 友 们 学习 希望 能与 您 一起 进步 加油 推荐 前文 网络安全 自学 篇 系列 篇 第一 篇文章 先 带领 大家 学习 什么 是 逆向 分析 然后 详细 讲解 逆向 分析 的 典型 应用 接着 通过 ollydbg 工具 逆向 分析 经典 的 游戏 扫雷 再 通过 cheatengine 工具 复制 内存地址 获取 实现 一个 自动 扫雷 程序 该 篇文章 也是 作者 学习 科 锐 钱 林 松 老师 在华 中 科技大学 的 分享 视频 这里 非常 推荐 大家 去 看看 话 不 多说 让我们 开始 新 的 征程 吧 您 的 点 赞 评论 收藏 将是 对 我 最大 的 支持 感恩 安全 路上 一路 前行 如果有 写得 不好 或 侵权 的 地方 可以 联系 我 删除 基础性 文章 希望 对 您 有所 帮助 作者 的 目的 是 与 安 全人 共同进步 加油 文章 目录 一 什么 是 逆向 分析 逆向 工程 逆向 分析 的 典型 应用 二 扫雷 游戏 逆向 分析 游戏 介绍 ollydbg 动态 分析 三 扫雷 游戏 检测工具 cheatengine 确定 起始 位置 cheatengine 确定 边界 c 编写 鼠标 坐标 获取 案例 c 编写 自动 扫雷 程序 四 总结 作者 的 github 资源 软件 安全 其他 工具 声明 本人 坚决 反对 利用 教学方法 进行 犯罪 的 行为 一切 犯罪行为 必将 受到 严惩 绿色 网络 需要 我们 共同 维护 更 推荐 大家 了解 它们 背后 的 原理 更好 地 进行 防护 参考文献 见 后 一 什么 是 逆向 分析 逆向 工程 科 锐 钱 老师 真的 是 大佬 拥有 十 余年 的 逆向 工作经验 专注 于 先进技术 的 算法 还原 及 逆向 实 训 作者 从中 学习 到 很多 知识 本次 课程 分享 的 是 逆向 分析 技术 的 引导 课程目标 是 带领 大家 了 解下 逆向 分析 是 干什么 的 在 安全 领 域中 是什么 地位 并且 穿插 各种 实战 示例 尽量 提高 大家 的 兴趣 逆向 分析 是 安全 的 基础行业 喜欢 的人 觉得很 好玩 不喜欢 的人 觉得 很苦 逼 在 讲 逆向 分析 前 大家 思考 下 你 有没有 把 别人 的 产品 或 demo 还原 出 源代码 来过 呢 而且 就是 作者 的 源代码 包括 里面 的 bug 反汇编 一次 编译 技术 阅读 汇编 代码 反 推出 对应 的 高级 代码 比如 vcgccdelphi 等 反编译 通常在 cjavanet 框架 等 因为 它 可以 直接 把 元 数据 还原成 高级 代码 反编译 其实 更难 但是 对 使用 的人 更 简单 比如 android 的 apk 反 编译成 java 源代码 下面 开始 吧 第一个 大家 需要 知道 的 是什么 是 逆向 工程 什么 是 逆向 工程 简单 而言 一切 从 产品 中 提取 原理 及 设计 信息 并 应用于 再造 及 改进 的 行为 都是 逆向 工程 在 信息 安全 中 更多 的 是 调查取证 恶意 软件 分析 等 不管 你 用 什么 工具 或 手段 能 达到 其 目的 就算 逆向 分析 下图 是 变形金刚 里 面对 它 的 描述 年 的 时候 国内 对 信息 安全 重视 程度 也 不高 对 逆向 分析 也没有 什么 概念 真正 重视 是 从 老大 提出 没有 网络安全 就 没有 国家安全 之后 而那 时候 的 国外 电影 就 已经 用 到了 说明 国外 导 员 对 这个 技术 及 应用 场景 都是 了解 的 逆向 工程 最早 是 在 二 z 时 的 船舶工业 分析 船 的 弱点 通过 外形 反推 内部结构 其中 粉红色 是 amuno 黄色 是 引擎 室 蓝色 是 龙骨 绿色 是 推进器 等等 只有 知道 怎么 造 一个 船 后 才能 进行 逆向 分析 当然 还有 模具 逆向 材料 逆向 软件 逆向 在 我们 的 软件 行业 就 称为 软件 逆向 同样在 网络 攻防 中 你 不可能 先 给出 源码 再 进行 攻击 通常在 安全 对抗 中 第一步 要做 的 就是 逆向 分析 不管 你 用 什么 方式 进行 逆向 分析 你 都 需要 搞清楚 它是 什么 样本 是什么 良性 的 还是 恶意 的 它 干了 什么 样本 做了 哪些 事情 我们 怎么办 知道 做了 什么 才能 进行 反制 如 删除 注册表 启动项 清理 感染 的 勒索 病毒 等 逆向 分析 的 典型 应用软件 逆向 有 很多 实现 办法 达到 我们 的 目标 典型 的 应用 包括 软件工程 网络安全 司法 取证 商业 保护 等 逆向 应用 病毒 分析 对于 逆向 分析 最大 的 行当 就是 病毒 分析 对于 一个 安全 企业 来说 比如 它 的 病毒 分析 团队 属于 它 的 主业 包括 金山毒霸 腾讯 医生 等 它们 主要 业务 就是 根据 一些 恶意 样本 的 行为 给出 解决方案 专业 查杀 完善 引擎 应急 响应 比如 wannacry 爆发 时 立刻 分析 其 原因 和 传播 漏洞 分析 其 影响 程度 及 给出 解决方案 所以 研究 逆向 病毒 的人 很多 当然 坏 的 行 当做 游戏 wg 也 很多 它们 的 对抗 也是 没有 源码 的 游戏 安全 人员 会 分析 wg 样本 进行 完善 及 修补 年 早期 制作 病毒 的人 都 比较 单纯 写 病毒 是为了 技术 炫耀 或 开玩笑 典型 的 比如 乒乓球 病毒 每个 周末 都 爆发 开启 计算机 后 就有 个 乒乓球 在 电脑 上弹 导致 电脑 不 能用 而 周 一到 周五 恢复 正常 可能是 讨厌 加班 此时 的 病毒 没有 获取 用户 隐私 删除 数据 等 行为 逆向 利用 游戏 保 护从 年 开始 随着 网游 普及 和 网络 虚拟 财产 游戏 装备 出现 大家 也没有 安全意识 出现 了 很多 恶意程序 和 病毒 比如 熊猫 烧香 它是 由 李 俊 制作 并 肆虐 网络 的 一款 电脑病毒 是 一款 拥有 自动 传播 自动 感染 硬盘 能力 和 强大 的 破坏 能力 的 病毒 它不 但能 感染 系统 中 等 文件 它 还能 中止 大量 的 反病毒软件 进程 并且会 删除 扩展 名为 gho 的 系统 备份文件 同时 游戏 wg 也 开始 增多 并 形 成了 包括 私服 生产 pjdh 等功能 的 生产线 通过 分析 游戏 的 关键 数据结构 找到 关键 数据 并 对 数据 做 修 改以 达到 提升 的 效果 比如 吃 鸡 游戏 如果 你 通过 逆向 分析 找到 每个 玩家 的 坐标 位置 了 你 是不是 可以 写 一个 透视 g 前提 是 你 知道 其 数 据以 什么 形式 存放在 哪里 这就 属于 pj 挂 你 甚至 还 可以 修改 攻击力 防御 值 游戏 的 碰撞检测 两者 间 距离 小于 某个 值 也 可以 取消 实现 飞天 穿墙 等 当然 我们 的 信息 安 全是 正 能量 的 逆向 分析 主 要是 剖析 病毒 包括 逆向 病毒 获取 病毒 传播 方法 可以 遏制 病毒 传播 逆向 病毒 获取 病毒 隐藏 手段 可以 根除 病毒 逆向 分析 病毒 获取 功能 目的 可以 溯源 定位 攻击者 逆向 应用 漏洞 挖掘 逆向 应用 还 包括 漏洞 挖掘 和 漏洞 利用 其中 黑客 挖掘 漏洞 的 常用 方法 为 通过 分析 开源 软件 的 源代码 获取 漏洞 通过 分析 产品 本身 获取 漏洞 通过 分析 可以 利用 漏洞 的 软件 样本 通过 比较 软件 前后 补丁 的 差异 大家 是否 有 研究 过 shellcode 缓冲区 溢出 漏洞 利用 溢出 缓冲区 首先 要把 关键 内存 关键 代码 定位 出来 这就 属于 逆向 分析 在 漏洞 利用 过程中 只有 你 越 熟悉 周围环境 则可 利用 的 漏洞 就越 多 比如 逆向 服务端 调用 shell 创建 新用户 功能 这个 时候 是 没有 源代码 的 所以 需要 利用 漏洞 分析 逆向 分析 是 信息 安全 行业 的 基础 技术 必须 技术 和 重要 技术 只有 你 功力 越 深厚 则 做的 事情 就 越多 漏洞 利用 比较 补丁 下图 展示 了 比较 补丁 前后 差异 的 工具 比如 官方 软件 在网 上有 安全 更新 关注 安全 行情 和 漏洞 公告 的 行当 或 企业 会 对比 官方 的 补丁 在 拿到 官方 升级 后 的 软件 他们 会对 两个 流程 做 比较 其中 左边 流程 多了 一个 节点 说明 升级 就是 这个 位置 再 详细分析 为什么 多了 这 个个 检测 注意 官方 公告 通常会 非常 简略 补丁 号 造成 后果 影响 范围 比如 某个 mp 播放器 在 播放 某个 冷门 格式 的 音频文件 时会 触发 一个 远程 溢出 问题 接下来 我们 就需要 去做 逆向 分析 下载 升级 前 和 升级 后 的 版本 做 流程 对比 逆向 应用 电子 取证 通过 样本 追踪 地理位置 的 实例 后续 会 给出 一个 实战 案例 漏洞 利用 无 文档 学习 表示 没有 源码 的 情况下 获取 程序 信息 称为 竞 品 分析 假设 某个 公司 对 同行 的 产品 很感兴趣 想知道 为什么 它们 的 算法 比 我们 的 好 然后 需 要去 分析 和 算法 还原 这 也是 逆向 分析 的 主要 应用 最好 的 竞 品 分析 是 能够 将 算法 完美 还原 两个 代码 再次 编译 后 除了 地址 不一样 其他 都 一样 ida 查看 注意 看懂 代码 完善 程序 并 换 另一种 程序语言 复现 算 学习 而 如果 直接 copy 别人 的 二进制 或 二进制 序列 这 算 抄袭 二 扫雷 游戏 逆向 分析 游戏 介绍 下面 通过 扫雷 游戏 进行 逆向 分析 讲解 下载 地址 此时 我们 打开 一个 工具 会 提示 危险 操作 点击 允许 本次 操作 即可 此时 就 能够 判断 某个 点 是不是 雷 从而 方便 我们 点击 完成 扫雷 游戏 o o 接着 进行 逆向 分析 扫雷 中肯 定有 雷区 的 定义 作为 程序员 你 会 怎么 定义 有 雷 或 没有 雷 或者 插 个 旗子 的 状态 呢 我们 会 使用 一个 二维 数组 来 存储 那么 什么时候 肯定会 访问 这个 二维 数组 呢 在 绘制 整个 游戏 区 点击 方格 的 时候 都会 访问 在 绘制 游戏 区 时 windows 编程 有 个 关键 函数 叫做 函数 为 指定 窗口 进行 绘图 工作 的 准备 并用 将 和 绘图 有关 的 信息 填 充到 一个 paintstruct 结构 中 所以 它 将是 个 突破口 ollydbg 动态 分析 接着 我们 使用 ollydbg 打 开在 逆向 分析 中 动态 分析 od 和 静态 分析 ida 非常 多 动静 结合 也是 常用 的 分析 手段 推荐 作者 上一个 系列 的 两篇 入门 文章 网络安全 自学 篇 五 idapro 反汇编 工具 初识 及 逆向 工程 解密 实战 网络安全 自学 篇 六 ollydbg 动态 分析 工具 基础 用法 及 crakeme 逆向 静态 分析 程序 并未 运行 通过 分析 文件 的 结构 格式 获取 其 内部 原理 动态 分析 在 程序 的 运行 过程中 分析 其 内部 原理 灰 盒 分析 既不 静态 也 不 调试 通过 一堆 监控 软件 注册表 监控 文件 监控 进程 监控 敏感 api 监控 在 虚拟机 中 跑 程序 再 分析 恶意 软件 的 大体 行为 并 形成 病毒 分析 报告 至于 哪种 方法 更好 我们 需要 具体问题具体分析 如果是 分析 扫雷 游戏 因为 没有 危害 可以 动态 调试 分析 但 如果是 wannacry 蠕虫 你 就不 能在 真 机上 动态 分析 同时 很多 安全 公司 为了 及时 响应 各种 安全 事件 会把 样本 自动 上 传到 服务器 中 它们 每天 会 收到 成千上万 的 恶意 样本 但 可能 存在 某些 未知 样本 只 上传 部分 的 原因 比如 某个 未知 样 本是 个 动态 链接库 此时 没有 运行 条件 只能 进行 静态 分析 或者 模拟 接口分析 软件 静态 分析 包括 分析 文件 格式 分析 网络 协议 分析 软件 日志 修改 存档 文件 等 下图 展示 了 通过 修改 文件 游戏 作弊 的 示例 软件 动态 调试 可以 用于 hh 翻译 比如 仙剑奇侠传 ollydbg 是 一个 新 的 动态 追踪 工具 将 ida 与 softice 结合起来 的 思想 ring 级 调试器 非常 容易 上手 是 当今 最为 流行 的 调试 解密 工具 之一 它还 支持 插件 扩展 功能 是 目前 最 强大 的 调试 工具 之一 ollydbg 打开 如 下图 所示 包括 反汇编 窗口 寄存器 窗口 信息 窗口 数据 窗口 堆栈 窗口 反汇编 窗口 显示 被 调试程序 的 反汇编 编 代码 包括 地址 hex 数据 反汇编 注释 寄存器 窗口 显示 当前 所选 线程 的 cpu 寄存器 内容 点击 标签 可 切换 显示 寄存器 的 方式 信息 窗口 显示 反汇编 窗口 中 选中 的 第一个 命令 的 参数 及 跳转 目标 地址 字符 等 数据 窗口 显示 内存 或 文件 的 内容 右键 菜单 可 切换 显示 方式 堆栈 窗口 显示 当前 线程 的 堆栈 下图 是 打开 exe 后 显示 的 界面 od 常用 的 快捷键 调试 方式 包括 f 设置 断点 如 下图 所示 的 红色 位置 程序 运行 到 此处 会 暂停 再按 一次 f 键 会 删除 断点 f 按 下 这个 键 运行 程序 如果 没有 设置 相应 的 点 被 调试 的 程序 直接 开始 运行 f 单 步步 过 每 按 一次 这个 按键 将 执行 反汇编 窗 口中 的 一条 指令 遇到 call 等子 程序 不 进入 其 代码 f 单步 步入 功能 通 单 步步 过 f 类似 区 别是 遇到 call 等子 程序 时会 进入 其中 进入 后 首先 停留在 子程序 的 第一条 指令 上 如 下图 进入 call 子程序 f 运行 到 选定 位置 即 运行 到 光标 所在位置 处 暂停 ctrlf 执行 到 返回 按 下 此键 会 执行 到 一个 返回 指令 时 暂停 常 用于 从 系统 领空 返回 到 我们 调试 的 程序 领空 altf 执行 到 用户 代码 从 系统 领空 快速 返回 我们 调试 的 程序 领空 接着 正式 分析 扫雷 程序 第一步 启动 ollydbg 软件 选择 菜单 文件 打开 winmineexe 文件 这里 我们 猜测 游 戏中 存在 一个 二维 数组 当 我们 显示 界面 时会 访问 这个 二维 数组 并且 调用 beginpaint 函 数来 显示 界面 所以 接下来 需要 找到 调用 beginpain 的 位置 第二步 在 反汇编 窗口 右键 鼠标 选择 查找 gt 当前 模块 中 的 名称 当 我们 在 键 盘上 输入 beginpaint 时 能够 迅速 找到 对应 的 函数 第三步 点击 右键 选择 在 每个 参 考上 设置 断点 接着 点击 下图 所示 的 b 进行 断点 设置 界面 双击 该 断点 会 进入到 反汇编 窗口 beginpaint 对应 位置 第四步 按 下 f 运行 程序 可以 看到 在 beginpaint 和 endpaint 之前 有 一个 call 函数 选中 该行 右键 跟随 之后 去到 xac 位置 发 现又 存在 很 多个 call 函数 一种 方法 是 一个一个 函数 分析 这里 使用 另一 种方法 当 我们 在 使用 扫雷 时 发现 它 的 界面 并没有 闪烁 所以 怀疑 使 用了 双 缓存 技术 这是 我们 的 突破口 双 缓存 是 在 缓存 中 一次性 绘制 再把 绘制 的 结果 返回 在 界 面上 比如 你 要在 屏幕 上 绘制 一个 圆 正方形 直线 需要 调用 gdi 的 显示 函数 操作 显卡 画一 个 圆 再 画一 个 正方形 和 直线 它 需要 访问 硬件 三次 此时 依赖 硬件 的 访问 速度 而且 如果 绘制 错误 擦除 再 绘制 需要 反复 的 访问 硬件 为了 减少 硬件 操作 我们 在 内存 中 把 需要 绘制 的 图像 准备好 然后 一切 妥当 之后 提 交给 硬件 显示 ps 当然 为什么 是 双 缓存 技术 呢 目前 的 我 也无 法 理解 只有 当 我们 做了 大量 的 逆向 分析 后 才会 养成 一定 的 经验 来 帮助 我们 判断 任何 行业 和 技术 都是 这样 的 包括 作者 自己 目前 也是 一步一个脚印 的 去 学习 去 总结 去 进步 期待 与 您 前行 加油 第五步 继续 在 反汇编 窗口 右键 鼠标 选择 查找 gt 当前 模块 中 的 名称 找到 双 缓存 技术 的 核心 函数 bitbltbitblt 是 将 内存 中 的 数据 提 交到 显示器 上 该 函数 对 指定 的 源 设备 环境 区 域中 的 像素 进行 位 块 bitblock 转换 以 传 送到 目标 设备 环境 点击 右键 选择 在 每个 参 考上 设置 断点 如 下图 所示 此时 绘制 了 两个 断点 第六步 运行 程序 去到 第二个 断点 bitblt 位置 注意 此时 显示 了 两层 循环 刚好 符合 我们 二维 数组 的 遍历 按 f 单 步步 过 可以 动态 调试 观察 其 效果 第七步 在 x 位置 按 下 f 取消 断点 并在 该 函数 的 起始 位置 xa 设置 断点 接下来 需要 详细分析 这个 双 缓存 函数 绘制 过程 代码 中 esi 首先 通过 xor 进行 清零 然后 再加 接着 esi 会 调用 cmp 进行 比较 说明 esi 是 循环 变量 接下来 表示 将 ebx 和 esi 相加 赋值 给 al 然后 al 判断 一个 值 再做 其他 的 这 有点像 访问 数据 后面 的 显示 特性 随着 al 做 改动 即 al 影响 后面 显示 的 内容 mov 指令 是 数据 传送 指令 也是 最基本 的 编程 指令 用于 将 一个 数据 从 源地址 传 送到 目标 地址 寄存器 间 的 数据 传送 本质上 也是 一样 的 第八 步 下面 看看 寄存器 其中 ebx 是 基址 寄存器 esi 是 它 的 偏移量 猜测 这个 ebx 基址 寄存器 和 关键 数据 有关 选择 ebx 基址 寄存器 然后 选择 数据 窗口 中 跟随 显示 如 下图 所示 的 数据 数据 窗口 显示 如下 我们 发现 f 出现 较多 猜测 多 的 这个 可能是 空 的 少 的 那个 是 雷 f 第九步 数据 区 详细分析 我们 选择 xa 位置 然后按 下 f 取消 断点 然后 继续 运行 程序 此时 弹出 扫雷 主 界面 游 戏中 通常会 存在 边界 围墙 这里 应该是 边界 位置 而 x 则为 起始 位置 如果 第一个 不是 雷 第二个 不是 雷 第三个 不是 雷 第四个 才是 雷 我们 f 是 空格 f 是 雷 的 猜测 则 正确 我们 取消 x 位置 的 断点 然后 运行 程序 弹出 扫雷 界面 根据 下面 的 二维 矩阵 进行 扫雷 如 下图 所示 前面 个 果然 时 空格 而 第四个 则 时 雷 a 是 雷 f 是 空格 实 锤 而且 点过 的 地方 会 变成 数字 比如 等第 十步 写个 程序 进行 扫雷 数据 区 详细分析 我们 重新 运行 程序 选择 查找 gt 当前 模块 中 的 名称 找到 双 缓存 技术 的 核心 函数 bitblt 然后 重新 找一下 找到 代码 位置 如 下图 所示 ebx 就是 雷区 的 起始 位置 我们 要想 办法 把 它 读取 出来 再 往前 movebx 代码 看到了 ebx 的 赋值 定义 接着 我们 输入 f 单步 调试 执行 完 xc 赋值 语句 后 我们 在 数据 窗口 中 跟随 ebx 寄存器 显示 如 下图 所示 前面 个 均为 f 表示 空格 第 个 为 雷 再 验证 一次 位置 就 开始 准备 写 程序 了 验证 成功 开始 写 程序 吧 第 十 一步 扫雷 辅助 程序 我们 编 写了 这样 一个 程序 当 它 开启 后 我们 鼠标 移 动到 方格 如果是 雷 它 的 标题 会 变成 扫雪 xue 然后 我们 不 点击 它就 可以 了 哈哈 正 常是 扫雷 雷区 显示 为 扫雪 当然 你 也 可以 写得 更 隐蔽 些 比如 和 苹果 电话 手表 建立 连接 如果是 雷 让 手表 震动 一下 否则 正常 注意 基本原理 知道 后 就需要 开发 解决问题 了 对于 安全 行业 来说 不管是 做 病毒 还是 研究 漏洞 利用 或 游戏 防护 的 逆向 分析 都是 基础 开发 解决问题 才是 关键 比如 某个 病毒 样本 的 行为 已经 分析 清楚 了 这个 病毒 在 哪里 创建 系统 文件 修改 哪个 系统 文件 注入 到 哪个 进程 动了 哪个 注册表 等等 逆向 分析 第一步 完成 但 更 重要 的 是 怎么 解决问题 创建 注册表 就需要 删除 注册表 修改 系统 文件 就要 还原 文件 我们 在 网上 搜索 某些 病毒 资料 时 有些 逆向 工程师 会给 出 手工 修复 方案 比如 关闭 哪个 服务 删除 哪个 隐藏 文件 手工 清除 注册表 哪一 项 等 但是 对于 安全 公司 来说 比如 公司 你 安全 扫描 完成 之后 不可能 弹 框 提示 用户 手工 修复 而是 需要 提供 自动化 方案 一键 修复 最终 结果是 需要 修改 杀毒软件 的 引擎 代码 或者 提供 专杀 工具 给 用户 这个 时候 工具 需要 自动化 完成 相关 操作 很多 新手 会 看不起 开发 觉得 搞 逆向 搞 网 安 的 是 王道 不用 学 开发 这是 不对 的 针对 上面 的 实战 我们 就 发现 逆向 是 站在 开发 基础上 反向 推导 作者 是 怎么 做的 比如 扫雷 需要 思考 作者 会用 什么 方式 表示 雷区 然后 怎么 用 ui 体现 出来 以及 调用 什么 函数 实现 所以 逆向 分析 之前 都要 教 开发 类 的 课程 数据结构 操作系统 计算机 组成 原理 编译 原理 等 课程 掌握 越 深入 越好 三 扫雷 游戏 检测工具 通过 第二 部分 我们 知道 以下 信息 扫雷 的 首 地址 为 x 显示 f 表示 空格 显示 f 表示 雷 雷区 的 边界 为 x 原理 是 找到 雷 在 内存 中 的 值 只要 不是 雷 值 我们 把 它 点击 开来 接下来 作者 再 补充 一个 逆向 辅助工具 通过 cheatengine 实现 雷区 检测 cheatengine 又称 ce 修改器 是 一款 内存 修改 编辑 工具 你 可以 通过 cheatengine 软件 来 修改 游 戏中 的 内存 数据 人物属性 金币 数值 等等 功能强大 且 操作 简单 可 以为 你 带来 良好 的 更好 的 体验 游戏 cheatengine 确定 起始 位置 第一步 打开 cheatengine 软件 点击 选择 打开 一个 程序 按钮 如 下图 所示 打开 扫雷 软件 设置 为 初级 第二步 选择 扫描 类型 为 未知 的 初始 数值 选择 数值 类型 为 字节 然后 点击 首次 扫描 此时 显示 个 数据 如 下图 所示 第三步 接着 我们 点击 扫雷 然后 在 扫描 类型 中 选择 变动 的 数值 点击 再次 扫描 此时 返回 结果 个 最终 通过 反复 的 筛选 找到 首 地址 继续 点击 扫描 如 下图 所示 第四步 如果 出现 地雷 则 选择 未 变动 的 数值 点击 再次 扫描 接着 继续 新一轮 的 扫雷 游戏 始终 以 第一个 方格 的 状态 为 目标 进行 重复 的 操作 开始 扫描 设置 未知 的 初始 数值 扫描 第一个 格子 设置 变动 的 值 继续 扫描 结果是 雷 设置 未 变动 的 值 继续 扫描 结果 非 雷 设置 未 变动 的 值 重新开始 设置 变动 的 值 重新开始 如果 第一个 格子 和 上 一次 一样 则 设置 未 变动 的 值 否则 变动 的 值 下图 展示 了 最后 个 结果 接着 继续 反复 筛选 最终 获取 如 下图 所示 的 结果 其 初始 地址 为 x 和 前面 od 软件 分析 的 一样 第五步 双击 该行 移动 至 底部 然后 右键 选择 浏览 相关 内存 区域 选项 显示 内容 如 下图 所示 它 同样 和 我们 前面 od 分析 的 内容 一致 其中 f 表示 雷 表示 空格 到 表示 数字 表示 边界 同时 f 表示 隔 一行 如 下图 所示 成功 完 成了 扫雷 游戏 o ocheatengine 确定 边界 第一步 我们 查看 扫雷 初级 的 高度 是 然后 重新 打开 建 立新 的 扫描 输入 数字 再 点击 首次 扫描 返 回个 结果 第二步 选择 中级 难度 对应 的 高度 是 然后 重新 打开 建立 再次 扫描 仅 剩个 结果 第三步 选择 高级 难度 设置 高度 最高 即 然后 重新 打开 建立 再次 扫描 最终 剩个 结果 高度 可能是 xxa 第四步 使用 同样 的 方法 找到 宽度 宽度 返回 两个 结果 xxacc 编写 鼠标 坐标 获取 案例 接下来 我们 开始 编写 代码 首 先给 大家 看看 鼠标 坐标 获取 的 一段 代码 我们 鼠标 通常是 xy 的 形式 第一步 创建 空 项目名称 为 mousemsg 第二步 为 该 工程 添加 一个 maincpp 文件 并且 添加 启动项 第三步 配置 graphicsh 文件 graphicsh 是 一个 针对 windows 的 c 语言 图形 库 分为 像素 函数 直线 和 线型 函数 多边形 函数 填充 函数 等 在 学习 c 游戏 编程 时 通常会 发现 vs 中 没有 graphicsh 头文件 因此 需要 配置 先从 作者 github 中 下载 好 所 需要 的 文件 如下 所示 下载 完 后 打开 下载 好 的 inlcude 文件 夹里 面有 两个 头文件 将 里面 的 两个 文件 进行 复制 然后 粘 贴到 vs 安装 目录 的 include 文件夹 中 cprogramfiles x 打开 下载 好 的 文件夹 中 的 lib 子 文件夹 将 里面 的 东西 全部 选中 复制粘贴 到 vs 安装 目录 的 lib 文件夹 中 cprogramfiles x x 接下来 就可以 在 vs 中 添加 graphicsh 头文件 了 里面 有 很 丰富 的 绘图 函数 可供 我们 使用 引用 图形 库 头文件 initgraph 创建 绘图 窗口 大小 为 x 像素 setlinecolor rgb 设置 当前 线条 颜色 setfillcolor rgb 设置 当前 填充 颜色 fillcircle 画圆 圆心 半径 getch 按 任意键 继续 closegraph 关闭 图形 环境 第四步 编写 鼠标 事件 代码 引用 图形 库 头文件 定义 鼠标 mousemsgm 初始化 窗口 宽度 高度 initgraph while 获取 鼠标 消息 mgetmousemsg charbuff 鼠标 左键 按 下 if 清空 数组 memset buff sprintfs buffx 坐标 dy 坐标 dmxmy messagebox nullbuff 坐标 mbok return 运 行前 需要 设置 编码 方式 为 使用 多 直接 字符集 否则 会 报错 运行 结果 如 下图 所示 可以 看到 鼠标 点击 会 显示 对应 的 坐标 位置 其中 getmousemsg 函数 表示 获取 鼠标 消息 通过 spy 可以 看到 很多 windows 系统 自带 的 鼠标 操作 键盘 操作 消息 操作 等 同时 能 获取 鼠标 是 左键 或 右键 按 下 以及 对应 坐标 c 编写 自动 扫雷 程序 接下来 是 通过 c 实现 一键 扫雷 功能 主 要是 模拟 鼠标 在 雷区 的 点击 操作 并且 按 下 所有 非 雷 区域 从而 实现 一键 扫雷 利用 的 是 windows 应用程序 的 消息 机制 通过 sendmessage 函数 向 指定 窗口 发送 消息 也 就是在 获 取到 扫雷 的 窗口 句柄 后 利用 这个 函数 向 该 窗口 发送 鼠标 按键 消息 从而 实现 模拟 鼠标 的 操作 该 部分 参考 ioiojy 老师 的 文章 逆向 工程 第 篇 扫雷 辅助 的 研究 秒 实现 一键 自动 扫雷 第一步 创建 一个 应用程序 名叫 saoleihelp 并 添加 主 函数 第二步 分析 扫雷 的 区域 及 坐标 定义 坐标 是 基于 客户 区 的 左上角 但是 这个 客户 区 是 怎么 定义 的 呢 如 下图 所示 究竟 a 点 是 客户 区 的 左上角 还是 说 b 点 才是 呢 如果 a 点 为 坐标 原点 那么 第一 块 雷区 的 坐标 就 应为 acce 如果 b 点 为 坐标 原点 那么 第一 块 雷区 的 坐标 就 应为 bdde 经过 实际 测试 msdn 中 所谓 的 客户 区 其实 是以 b 点 作为 起点 的 位置 即 原点 坐标 而 雷区 中心 即 e 点 的 坐标 为 每个 雷区 小方块 的 大小 为 于是 可以 知道 这里 需要 循环 计算出 雷区 每一个 小方块 的 坐标 这个 坐标 与 保存 有 雷区 的 二维 数组 下标 紧密 相关 假设 这个 二维 数组 是 mineyx 其中 y 表示 的 是 雷区 有 多少 行 x 表示 雷区 的 列 数 那么 每个 雷区 方块 的 坐标 为 xxyy 在 获得了 坐标 以后 就可以 通过 如下 语句 来 模拟 鼠标 的 点击 操 作了 sendmessage xy sendmessage xy 第三步 分析 扫雷 游戏 的 雷区 长宽 数据 结合 之前 宽度 高度 的 分析 发现 高度 位置 为 x 宽度 位置 为 x 我们 进一步 推断 从 x 开始 这里 的 一行 绿色 数据包 含有 xax 以及 x 这三个 数值 很明显 这三个 数据 正是 当前 雷区 的 地雷 数量 以及 宽 高等 信息 雷 数 x 宽度 x 高度 x 同时 我们 上面 的 逆向 分析 已经 知道 雷区 分布 的 信息 f 表示 地雷 e 表示 旗子 表示 空格 到 表示 数字 表示 边界 f 表示 隔 一行 还有 一个 重要 信息 是 雷区 的 分布 起始 地址 即 x 但 如果 计算 含有 边界 的 情况 雷区 的 分布 情况 则为 起始 地址 x 结束 地址 xf 完整 代码 如下 获取 扫雷 游戏 对应 的 窗口 句柄 nulll 扫雷 if hwnd 获取 扫雷 进程 hwndamppid 打开 扫雷 游戏 获 取其 句柄 if hprocess printf return 存放 雷区 的 起始 地址 雷区 的 最大值 包含 边界 pbyte malloc dwsize 读取 整个 雷区 的 数据 hprocess lpvoid 读取 雷区 的 长 和 宽 hprocess lpvoid dwinfo dword 宽度 hprocess lpvoid dwinfo dword 高度 雷区 转换 去掉 雷区 多余 的 数据 pbyte malloc dwheightdwwidth while iltdwsize 边界 判断 if pbyteix for jjltdwwidthj h breaki 获取 雷区 方块 的 坐标 然后 模拟 鼠标 进行 点击 intxyintxyfor if ptmpbyteixf 雷 xy 鼠标 按 下 sendmessage xy 鼠标 抬起 free pbyte closehandle hprocess elseprintf gethwndfailed return 运行 结果 如 下图 所示 一秒 实现 扫雷 四 总结 写到 这里 这篇 文章 就 介绍 完毕 希望 对 您 有所 帮助 最后 进行 简单 的 总结 下一 什么 是 逆向 分析 逆向 工程 逆向 分析 的 典型 应用 二 扫雷 游戏 逆向 分析 游戏 介绍 ollydbg 动态 分析 三 扫雷 游戏 检测工具 cheatengine 确定 起始 位置 cheatengine 确定 边界 c 编写 鼠标 坐标 获取 案例 c 编写 自动 扫雷 程序 学 安全 一年 认识了 很多 安全 大佬 和 朋友 希望 大家 一起 进步 这篇 文章 中 如果 存在 一些 不足 还请 海涵 作者 作为 网络安全 初学者 的 慢慢 成长 路 吧 希望 未来 能 更 透彻 撰写 相关 文章 同时 非常感谢 参考文献 中 的 安全 大佬 们 的 文章 分享 深知 自己 很菜 得 努力 前行 珈 国情 明月 千里 两 相思 清风 缕缕 寄 离愁 燕 归 珞 珈 花 已 谢 情 满 景 逸 映 深秋 最 感恩 的 永远是 家人 的 支持 知道 为啥 而来 知道 要做 啥 知道 努力 才能 回去 夜 已 深 虽然 笨 但 还得 奋斗 byeastmount 星期 一晚 上点 写 于 武汉 年月 新开 的 娜 璋 ai 安全 之家 主要 围绕 python 大数 据分析 网络空间 安全 人工智能 web 渗透 及 攻防 技术 进行 讲解 同时 分享 ccfsci 南 核 北 核 论文 的 算法 实现 娜 璋 之家 会 更加 系统 并 重构 作者 的 所有 文章 从 零 讲解 python 和 安全 写了 近十年 文章 真心 想把 自己 所学 所 感 所做 分享 出来 还请 各位 多多指教 真诚 邀 请您 的 关注 谢谢 参考文献 真心 推荐 大家好 好看 看 这些 视频 和 文章 感恩 这些 大佬 科 锐 逆向 的 钱 林 松 老师 受 华中 科技大学 邀请 逆向 分析 计算 引导 c 学习 笔记 vs 中 添加 graphicsh 头文件 行 歌 er 逆向 工程 第 篇 扫雷 辅助 的 研究 秒 实现 一键 自动 扫雷 网络安全 自学 篇 五 idapro 反汇编 工具 初识 及 逆向 工程 解密 实战 网络安全 自学 篇 六 ollydbg 动态 分析 工具 基础 用法 及 crakeme 逆向 