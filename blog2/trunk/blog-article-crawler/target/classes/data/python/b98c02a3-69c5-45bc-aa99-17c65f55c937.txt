python 和 excel 的 完美 结合 常用 操作 汇总 案例 详 析 在 以前 商业 分析 对应 的 英文单词 是 大家用 的 分析 工具 是 excel 后来 数据 量大 了 excel 应付 不过 来了 excel 最大 支持 行数 为 行 人们 开始 转向 python 和 r 这样 的 分析 工具 了 这时候 商业 分析 对应 的 单词 是 其实 python 和 excel 的 使用 准则 一样 都是 都是 尽可 能用 更 方便 的 操作 替代 机械 操 作和 纯 体力劳动 用 python 做 数据 分析 离不开 著名 的 pandas 包 经 过了 很多 版本 的 迭代 优化 pandas 现在 的 生态圈 已经 相当 完 整了 官 网 还给 出了 它 和 其他 分析 工具 的 对比 本文 用 的 主要 也是 pandas 绘图 用 的 库 是 plotly 实现 的 excel 的 常用 功能 有 python 和 excel 的 交互 vlookup 函数 数据 透视 表 绘图 以后 如果 发掘 了 更多 excel 的 功能 会 回来 继续 更 新和 补充 开始 之前 首先 按照 惯例 加载 pandas 包 maxcolumns pdsetoption maxrows pdsetoption 禁用 科学 计数 法 python 和 excel 的 交互 pandas 里 最 常用 的 和 excelio 有关 的 四个 函数 是 它们 都有 特定 的 参数设置 可以 定制 想要 的 读取 和 导出 效果 比如说 想要 读取 这样 一张 表 的 左上 部分 可以用 pdreadexcel 返回 结果 dfout 工 号 姓名 性别 部门 a 张伟 男 工程 a 王 秀 英 女 人事 a 王 芳 女 行政 a 郑 勇 男 市场 a 张 丽 女 研发 a 王 艳 女 后勤 a 李 勇 男 市场 a 李 娟 女 工程 a 张 静 女 人事 a 王 磊 男 行政 a 李娜 女 市场 a 刘 诗 雯 女 研发 a 王 刚 男 后勤 a 叶 倩女 后勤 a 金 雯 雯 女 市场 a 王 超 杰 男 工程 a 李 军 男 人事 输出 函数 也 同理 使用 多 少列 要不要 index 标题 怎么 放 都可以 控制 vlookup 函数 vlookup 号 称是 excel 里 的 神器 之一 用途 很 广泛 下面 的 例子 来自 豆瓣 vlookup 函数 最 常用 的 种 用法 你 会 几种 案例 一 问题 ab 单元格 区域 为 字母 等级 查询 表 表示 分以下 为 e 级 分为 d 级 分为 c 级 分为 b 级 分以上 为 a 级 dg 列为 初二 年级 班 语文 测验 成绩表 如何 根据 语文 成绩 返回 其 字母 等级 方法 在 hh 单元格 区 域中 输入 实现 dfpdreadexcel defgradetopoint x 等级 df 语文 apply gradetopoint dfout 学号 姓名 性别 语文 等级 王 小 丽 女 d 王 宝 勤 男 b 杨 玉 萍 女 e 田东 会 女 a 陈 雪 蛟 女 c 杨 建 丰 男 e 黎 梅 佳 女 c 张 兴 男 a 马 进 春 女 e 魏 改 娟 女 a 王 冰 研 女 d 案例 二 问 题在 sheet 里面 如何 查找 折旧 明细表 中 对应 编号 下 的 月 折旧 额 跨 表 查询方法 在 sheet 里面 的 cc 单元格 输入 vlookup a 折旧 明细表 ag python 实现 使用 merge 将 两个 表 按照 编号 连接起来 就行 dfpdreadexcel 折旧 明细表 dfpdreadexcel 题目 里 的 sheetdfmerge df 编号 月 折旧 额 howlefton 编号 out 编号 资产 名称 月 折旧 额 yt 电动门 yt 桑塔纳 轿车 yt 打印机 案例 三 问题 类似于 案例 二 但 此时 需要 使用 近似 查找 方法 在 bb 区 域中 输入 公式 vlookup aamp 折旧 明细表 bg python 实现 这个 比起 上一个 要 麻烦 一些 需要 用到 一些 pandas 的 使用 技巧 dfpdreadexcel 折旧 明细表 dfpdreadexcel 含有 资产 名称 简写 的 表 df 月 折旧 额 foriinrange len df 资产 名称 df 月 折旧 额 idfdf 资产 名称 map lambdaxdf 资产 名称 iinx 月 折旧 额 dfout 资产 名称 月 折旧 额 电动 货车 惠普 交联 桑塔纳 春兰 案例 四 问 题在 excel 中 录入 数据 信息 时 为了 提高 工作效率 用户 希望 通过 输入 数据 的 关键 字后 自动 显示 该 记录 的 其余 信息 例如 输入 员工 工 号 自动 显示 该 员工 的 信 命 输入 物料 号 就能 自动 显示 该 物料 的 品名 单价 等 如图所示 为 某 单位 所有 员工 基本信息 的 数据源 表 在 年月 员工 请假 统计表 工作 表 中 当在 a 列 输入 员工 工 号 时 如何 实现 对应 员工 的 姓名 身份证号 部门 职务 入 职 日期 等 信息 的 自动 录入 方法 使用 vlookupmatch 函数 在 年月 员工 请假 统计表 工作 表 中 选择 bf 单元格 区域 输入 下列 公式 if avlookup avlookup avlookup a 员工 基本信息 aaahmatch b 员工 基本信息 按 下 ctrlenter 组合键 结束 python 实现 上面 的 excel 的 方法 用 得很 灵活 但是 pandas 的 想法 和 操作 更 简单 方便 些 dfpdreadexcel 员工 基本信息 表 dfpdreadexcel 请假 统计表 dfmerge df 工 号 姓名 部门 职务 入 职 日期 on 工 号 out 工 号 姓名 部门 职务 入 职 日期 a 龚 梦 娟 后勤 主管 a 赵敏 行政 文员 a 黄 凌 研发 工程师 a 王维 人事 经理 a 张君宝 市场 工程师 a 秦 羽 人事 副经理 案例 五 问题 用 vlookup 函数 实现 批量 查找 vlookup 函数 一般 情况下 只能 查找 一个 那么 多项 应该 怎么 查找 呢 如 下图 如何 把 张 一 的 消费额 全部 列出 方法 在 cc 单元格 里面 输入 公式 vlookup bamprow a if bbampcountif indirect bbamprow b cc 按 shiftctrlenter 键 结束 python 实现 vlookup 函数 有 两个 不足 或者 算是 特点 吧 一个是 被 查找 的 值 一定 要在 区域 里 的 第一 列 另 一个是 只能 查找 一个 值 剩余 的 即 便能 匹配 也 不去 查 找了 这两点 都能 通过 灵活 应用 if 和 indirect 函 数来 解决 不过 pandas 能 做得 更 直白 一些 dfpdreadexcel 消费额 dfdf 姓名 张 一 姓名 消费额 out 姓名 消费额 张 一张 一张 一 数据 透视 表 数据 透视 表 是 excel 的 另一个 神器 本质上 是 一系列 的 表格 重组 整合 的 过程 这里 用 的 案例 来 自知 乎 excel 数据 透视 表 有 什么 用途 问题 需要 汇总 各个 区域 每个月 的 销售额 与 成本 总计 并 同时 算出 利润 通过 excel 的 数据 透视 表 的 操作 最终 实现 了 下面 这样 的 效果 python 实现 对于 这样 的 分组 的 任务 首先 想到 的 就是 pandas 的 groupby 代码 写起来 也 简单 思路 就是 把 刚才 excel 的 点 鼠标 的 操作 反映 到 代码 命令 上 dfpdreadexcel 销售 统计表 df 订购 月份 df 订购 日期 apply lambdaxxmonth dfdfgroupby 订购 月份 所属 区域 销售额 成本 agg sum df 利润 df 销售额 df 成本 dfout 销售额 成本 利润 订购 月份 所属 区域 南京 常熟 无锡 昆山 苏州 南京 常熟 无锡 昆山 苏州 南京 常熟 无锡 昆山 苏州 南京 常熟 无锡 昆山 苏州 rowsxcolumns 也 可以 使用 pandas 里 的 pivottable 函 数来 实现 dfpdpivottable dfvalues 销售额 成本 index 订购 月份 所属 区域 aggfuncsum df 利润 df 销售额 df 成本 dfout 成本 销售额 利润 订购 月份 所属 区域 南京 常熟 无锡 昆山 苏州 南京 常熟 无锡 昆山 苏州 南京 常熟 无锡 昆山 苏州 南京 常熟 无锡 昆山 苏州 的 pivottable 的 参数 和 excel 里 的 参数 是 对应 上 的 当然 我 这话 说了 等于 没说 数据 透视 表里 不就是 行列 值 吗 还能 有 啥 但是 我 个人 还是 更 喜欢 用 groupby 因为 它 运算 速度 非常快 我 在打 kaggle 比赛 的 时候 有 一张 表 是 贷款人 的 行为 信息 大概有 万行 用 groupby 算了 几个 聚合 函数 几秒钟 就 完 成了 groupby 的 功能 很 全面 内置 了 很多 aggregate 函数 能够 满足 大部分 的 基本 需求 如果 你 需要 一些 其他 的 函数 可以 搭配 使用 apply 和 lambda 不过 pandas 的 官方 文档 说了 groupby 之 后用 apply 速度 非常 慢 aggregate 内部 做过 优化 所以 很快 apply 是 没有 优化 的 所以 建议 有 问题 先 想想 别的 方法 实在 不行 的 时候 再用 apply 我 打 比赛 的 时候 为了 生成 一个 新 变量 用了 groupby 的 apply 写了 这么 一句 skidprev apply lambdaxabs x xsum abs iloc 万行 的 数据 足足 算了 十多 分钟 等得 我 心力交瘁 绘图 因为 excel 画出来 的 图 能够 交互 能够 在 图上 进行 一些 简单 操作 所以 这里 用 的 python 的 可视化 库 是 plotly 案例 就用 我 这个 学期 发展 经济学 课上 的 作业 吧 当时 的 图 都是 用 excel 画 的 现 在用 python 再 画一 遍 开始 之前 首先 加载 plotly 包 柱状图 当时 用 excel 画了 很多 的 柱状图 其中 的 一幅 图 是 下面 用 plotly 来 画一 下 dfpdreadexcel 高等教育 入学率 tracegobar xdf 国家 colorpowderblue tracegobar xdf 国家 coloraliceblue tracegobar xdf 国家 colorroyalblue layoutgolayout barmodegroup datalayout offplot fig 雷达 图 用 excel 画 的 用 python 画 的 dfpdreadexcel 政治 治理 thetaappend theta df polardict radialaxisdict showlegendtrue figgofigure datalayout offplot fig 画起 来比 excel 要 麻烦 得多 总体 而言 如果 画 简单 基本 的 图形 用 excel 是 最 方便 的 如果 要 画 高级 一些 的 或者是 需要 更多 定制 化 的 图形 使用 python 更 合适 作者 廖 致 君 链接 文 源 网络 仅供 学习 之用 如有 侵权 请 联系 删除 在 学习 python 的 道路上 肯定会 遇见 困难 别 慌 我 这里有 一套 学习 资料 包含 本 电子书 个 教学 视频 涉及 python 基础 爬虫 框架 数据 分析 机器 学习 等 不怕 你 学不会 学习 资料 关注 公众 号 python 圈子 优质 文章 每日 送达 