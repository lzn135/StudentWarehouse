python 黑 帽 二 python 能做 什么 攻击 正则表达式 网络 爬虫 和 套接 字 通信 入门 python 黑 帽 第二 篇文章 将 分享 python 网络 攻防 基础知识 看看 python 能做 什么 以及 正则表达式 网络 爬虫 和 套接 字 通信 入门 基础 本文 参考 了 i 春秋 ado 老师 的 课程内容 这里 真心 推荐 大家 去 学习 ichunqiu 的 课程 同时 也 结合 作者 的 经验 进行 讲解 希望 这篇 基础 文章 对 您 有所 帮助 更 希望 大家 提高 安全意识 也 欢迎 大家 讨论 娜 璋 ai 安全 之家 于 年月日 开通 将 专注 于 python 和 安全 技术 主要 分享 web 渗透 系统安全 cve 复现 威胁 情报分析 人工智能 大数 据分析 恶意代码 检测 等 文章 真心 想把 自己 近十年 的 所学 所做 所 感 分享 出来 与 大家 一起 进步 声明 本人 坚决 反对 利用 教学方法 进行 恶意 攻击 的 行为 一切 错误 的 行为 必将 受到 严惩 绿色 网络 需要 我们 共同 维护 更 推荐 大家 了解 技术 背后 的 原理 更好 地 进行 安全 防护 虽然 作者 是 一名 安全 小白 但会 保证 每 一篇 文章 都会 很 用 心地 撰写 希望 这些 基础性 文章 对 你 有所 帮助 在 安全 路上 一起 前行 文章 目录 一 为什么 使用 python 做 网络 攻防 二 python 正则表达式 一 正则表达式 基础 二 常用 正则表达式 规则 三 pythonweb 编程 一 urlliburllib 二 requests 三 网络 爬虫 案例 四 python 套接 字 通信 一 什么 是 cs 架构 呢 二 什么 是 套接 字 三 面向 连接 与 无 连接 四 socket 模块 函数 五 tcp 通信 实例 五 总结 一 为什么 使用 python 做 网络 攻防 首先 你 需要 了解 网络 攻防 的 七个 基础 步骤 侦查 漏洞 挖掘 武器 制作 攻击 载荷 分发 垃圾邮件 等 利用 漏洞 利用 安装 恶意代码 网页 远程 控制 僵尸 网络 行动 窃密 破坏 跳板 下图 是 attampck 框架 包括 个 步骤 其次 为 什 选择 python 作为 开发工具 呢 真正 厉害 的 安全 工程师 都会 自己 去 制作所 需要 的 工具 包括 修改 开源 代码 而 python 语言 就是 这样 一个 利器 python 开发 的 平台 包括 等 在 广 度上 python 可以 进行 蜜罐 部署 沙 盒 wifi 中间人 scrapy 网络 爬虫 漏洞 编写 常用 小工具 等 在 深 度上 python 可以 实现 sqlmap 这样 一款 强大 的 sql 注入 工具 实现 mitmproxy 中间人 攻击 神器 等 由于 python 具有 简单 易 学习 免费 开源 高级 语言 可 移植 可 扩展 丰富 的 第三方 库函数 特点 python 几行 代码 就能 实现 java 需要 大量 代码 的 功能 并且 python 是 跨 平台 的 linux 和 windows 都能 使用 它能 快速 实现 并 验证 我们 的 网络 攻防 想法 所以 选择 它 作为 我们 的 开发工具 那么 我们 又 可以用 python 做什么 呢 目录 扫描 web 多线程 后台 敏感 文件 svnupload 敏感 目录 phpmyadmin 信息 搜集 web 数据库 中间件 tomcatjbossc 段 web 信息 搜集 特点 程序 例如 搜索 某个 论坛 上 的 所有 邮箱 再 进行 攻击 信息 匹配 ampsql 注入 web 正则 抓取 信息 用户名 邮箱 sql 注入 反弹 shell 通过 添加 代码 获取 shell 及 网络 信息 最后 建议 读者 做好 以下 准备 选择 一个 自己 喜欢 顺手 的 编辑器 至 少看 一本 关于 python 的 书籍 会 使用 python 自带 的 一些 功能 学习 阅读 开源 代码 阅读 官方 文档 尤其是 常用 的 库 多 练习 多 实战 下面 举个 简单 python 示例 通过 import 导入 扩展 包 base 它是 将 字符串 base 加 解码 的 模块 通过 printdir base help base 可以 查看 相关 功能 base eastmount 输出 结果 如 下图 所示 包括 查看 源代码 文件 位置 和 eastmount 转码 接下来 我们 开始 学习 python 正则表达式 pythonweb 编程 和 python 网络 编程 二 python 正则表达式 一 正则表达式 基础 在 使用 正则表达式 之前 我们 需要 基本 了解 python 基础知识 http 协议 熟悉 使用 burpsuitesqlmap 工具 python 正则表达式 被 广泛 应用在 爬虫 开发 多线程 网络 编程 中 而 hacker 应用 也 会 涉及到 正则 表示 式 相关 知识 比如 扫描 爆破 poc 等 正则表达式 regex 使用 单个 字符串 来 描述 匹配 一系列 符合 某个 句法 规则 的 字符串 例如 如果 想 获取 里面 的 ip 地址 就需要 使用 正则表达式 实现 python 通过 re 模块 提供 正则表达式 的 支持 其 基本 步骤 如下 先将 正则表达式 的 字符串 形式 编译 我 pattern 实例 compile 使用 pattern 实例 处理 文本 并 获得 匹配 结果 使用 实例 获得 信息 进行 其他 的 操作 匹配 结果 举 一个 简单 例子 east eastmount print matchgroup wordrefindall easteastmount print word 输出 结果 为 easteast 点 表示 匹配 任意 换行符 n 以外 的 字符 tword printkey 输出 结果 为 tttmtth 依次 匹配 t 加 任意 字符 的 两个 字符 斜杠 表示 匹配 转义 字符 如果 需要 匹配 点 的话 必 须要 转义 字符 word printkey 输出 结果 为 中 括号 是 对应 位置 可 以是 字符 集中 任意 字符 字符 集中 的 字符 可以 逐个 列出 也 可以 给出 范围 如 abc 或 ac 第一 个字符 如果是 表示 取反 如 abc 表示 不是 abc 的 其他 字符 例如 abcde 能 匹 配到 abeaceade 匹配 数字 和 非 数字 案例 匹配 数字 dddword printkey 匹配 非 数字 keyrefindall dword printkey 输出 结果 如 下图 所示 正则表达式 较 为难 理解 更 推荐 读者 真正 使用 的 时候 学 会去 百度 相关 的 规则 会 使用 即可 同时 更多 正则表达式 的 使用方法 建议 读者 下来 之后 自行 学习 常 见表 如 下图 所示 二 常用 正则表达式 规则 下面 讲解 比较 常见 的 正则表达式 规则 这些 规则 可能 会对 我们 的 网络 攻防 有 一定 帮助 获取 数字 rdd print regexfindall string 输出 结果 为 抓取 标签 间 的 内容 欢迎 走进 python 攻防 系列 专栏 rlttitlegt lttitlegthtml i 输出 结果 为 抓取 超链接 标签 间 的 内容 url read print content 获取 完整 超链接 utf foruinurlsprint u 获取 超链接 ltagt 和 ltagt 之间 内容 resrltagt utf resrem t 输出 结果 部分内容 如下 所示 中文 编码 是 常见 的 问题 我们 需要 注 意下 比如 utf 编码 抓取 超链接 标签 的 新闻 地图 视频 ltagtresr lthref lthref urlsrefindall url 获取 的 超链接 输出 结果 如 下图 所示 抓取 图片 超链接 标签 的 url 和 图片 名称 在 html 中 我们 可以 看到 各式各样 的 图片 其 图片 标签 的 基本 格式 为 ltimgsrc 图片 地址 gt 只有 通过 抓 取了 这些 图片 的 原 地址 才能 下载 对应 的 图片 至 本地 那么 究竟 怎么 获取 图片 标签 中 的 原图 地址 呢 下面 这段 代码 就是 获取 图片链接 地址 的 方法 src print urls 其中 图片 对应 的 原图 地址 为 它 对应 一张 图片 该 图片 是 存储 在 wwwxxxcom 网站 服务器端 的 最后 一个 后面 的 字段 为 图片 名称 即为 eastmountjpg 那么 如何 获取 url 中 最后 一个 参数 呢 print name eastmountjpg 更多 正则表达式 的 用法 读者 结合 实际情况 进行 复现 三 pythonweb 编程 这里 的 web 编程 并不是 利用 python 开发 web 程序 而是 用 python 与 web 交互 获取 web 信息 主要内容 包括 爬虫 介绍 利用 python 开发 一个 简单 的 爬虫 一 是 python 用于 获取 统一 资源 定址 器 的 库函数 可以 用来 抓取 远程 数据 并 保存 甚至 可以 设置 消息 头 header 代理 超时 认证 等 urllib 模块 提供 的 上层 接口 让我们 像 读取 本地 文件 一样 读取 www 或 ftp 上 的 数据 它比 cc 等 其他 编程 语言 使用 起来 更 方便 其 常用 的 方法 如下 urlopen 该 方法 用于 创建 一个 远程 url 的 类 文件 对象 然后 像 本地 文件 一样 操作 这个 类 文件 对象 来 获取 远程 数据 参数 url 表示 远程 数据 的 路径 一般 是 网址 参数 data 表示 以 post 方式 提 交到 url 的 数据 参数 proxies 用于 设置 代理 urlopen 返回 一个 类 文件 对象 url print contentinfo 头 信息 print contentgeturl 请求 urlprint contentgetcode http 状态 码 该段 调用 调用 urlliburlopen url 函数 打开 百度 链接 并 输出 消息 头 urlhttp 状态 码 等 信息 如 下图 所示 urlretrieve urlretrieve 方法 是 将 远程 数据 下 载到 本地 参数 filename 指定 了 保 存到 本地 的 路径 如果 省略 该 参数 urllib 会 自动 生成 一个 临时文件 来 保存 数据 参数 reporthook 是 一个 回 调 函数 当 连 接上 服务器 相应 的 数据 块 传输 完毕 时会 触发 该回 调 通常 使用 该回 调 函 数来 显示 当前 的 下载 进度 参数 data 指 传递 到 服务器 的 数据 urlpath 它将 百度 logo 图片下载 至 本地 注意 python 和 python 代码 有 少许 区别 python 直接 调用 urlliburlopen 二 模块 是 用 python 语言 编写 的 基于 urllib 的 第三方 库 采用 apachelicensed 开源 协议 的 http 库 它比 urllib 更加 方便 既可以 节约 大量 的 工作 又 完全 满足 http 测试 需求 requests 是 一个 很 实用 的 pythonhttp 客户端 库 编写 爬虫 和 测试 服务器 响应 数据 时经 常会 用到 推荐 大家 从 requests 官方网站 进行 学习 这里 只 做 简单 介绍 假设 读者 已经 使用 安 装了 requests 模块 下面 讲解 该 模块 的 基本 用法 发送 网络 请求 rrequestsget rrequestspost rrequestsput rrequestsdelete rrequestshead 为 url 传递 参数 print rurl 输出 结果 如 下图 所示 将 参数 进行了 拼接 响应 内容 print rtext print rencoding 二进制 响应 内容 rrequestsget print rcontent 定制 请求 头 注意 headers 中 可以 加入 cookies 复杂 的 post 请求 响应 状态 码 和 响应 头 rrequestsget 超时 requestsget 错误 和 异常 遇到 网络 问题 如 dns 查询 失败 拒绝 链接 等 时 requests 会 抛出 一个 connectionerror 异常 遇到 罕见 的 无效 http 响应 式 时 requests 则会 抛出 一个 httperror 异常 若 请求 超 时会 抛出 一个 timeout 异常 三 网络 爬虫 案例 网络 爬虫 又 称为 网页 蜘蛛 网络 机器人 网页 追逐 者 是 按照 一定 规则 自动 抓取 万维网 信息 的 程序 或 脚本 最大 好处 是 批量 且 自动化 获得 和 处理 信息 对于 宏观 或 微观 的 情况 都可以 多 一个 侧面 去 了解 在 安全 领域 爬虫 能做 目录 扫描 搜索 测试 页面 样本 文档 管理员 登录 页面 等 很多 公司 如 绿 盟 的 web 漏洞 扫描 也 通过 python 来 自动识别 漏洞 下面 两个 案例 虽然 简单 却能 解决 很多人 的 问题 希望 读者 可以 独立 完成 设置 消息 头 请求 流量 分析 相关 假设 我们 需要 抓取 百科 的 乔布斯 信息 如 下图 所示 传统 的 爬虫 代码 会被 网站 拦截 从而 无法 获取 相关 信息 print contenttext 右键 审查 元素 按 f 在 network 中 获取 headers 值 headers 中有 很多 内容 主要 常用 的 就是 useragent 和 host 它们 是 以键 对 的 形式 展现 出来 如果 useragent 以 字典 键 对 形式 作为 headers 的 内容 就可以 反 爬 成功 代码 如下 添加 请求 头 windowsntwinx applewebkit khtmllikegecko contenttext 输出 结果 如 下图 所示 有 部分 网站 会 返回 json 格式 的 数据 我们 可以 通过 json 模块 进行 处理 核心 代码 如下 datajsonloads rtext print dataresult namelenlen dataresult forirange namelen print 提交 数据 请求 盲 注 相关 部分 网站 如果 涉及到 翻页 需要 获取 所有 页码 的 信息 最 传统 的 方法 是 定义 一个 函数 然后 设计 一个 循环 一次 遍历 不同 页面 的 内容 实现 核心 代码 如下 url foriinrange urlurlstartstr i urlendlesson url 但 如果 url 始终保持 不变 就需要 我们 深入 地 分析 或 通过 selenium 模拟 浏览器 抓取 这里 提供 一个 技巧性 比 较强 的 方法 假设 我们 想 爬 取 某 网站 的 公开 信息 但 通过 翻页 发现 这个 页面 的 url 地址 是 不变 的 我们 大致 就可以 判断 出 中间 表格 的 数据 是 通过 js 动态 加载 的 我们 可以 通过 分析 抓 包 找到 真实 的 请求 地址 目标 网址 如下 通过 审查 元素 可以 发现有 个 pagesnum 变量 它 标 记为 我们 的 页码 所以 这里 需要 通过 requests 提交 变量 数据 就能 实现 翻页 核心 代码 如下 timetime print datetime data urldatatimeout contenttext 四 python 套接 字 通信 一 什么 是 cs 架构 呢 python 网络通讯 主 要是 cs 架构 的 采用 套接 字 实现 cs 架构 是 客户端 client 和 服务端 server 架构 server 唯一 的 目的 就是 等待 client 的 请求 client 连上 server 发送 必要 的 数据 然后 等待 server 端 完成 请求 的 反馈 cs 网络 编程 server 端 进行 设置 首先 创建 一个 通信 端点 让 server 端 能够 监听 请求 之后 就 进入 等待 和 处理 client 请求 的 无限 循 环中 client 编程 相对 server 端 编程 简单 只要 创建 一个 通信 端点 建立 到 服务器 的 链接 就可以 提出 请求 了 二 什么 是 套接 字 套接 字 是 一种 具有 之前 所说 的 通信 端点 概念 的 计算 网络 数据结构 网络化 的 应用程序 在 开始 任何 通信 都必须 创建 套接 字 相当于 电话 插口 没 它 无法 通信 这个 比喻 非常 形象 python 支持 其中 afinet 是 基于 网络 的 套接 字 套接 字 起源于 世纪 年代 加州 伯克利 分校 版本 的 unix 即 bsdunix 又 称为 伯克利 套接 字 或 bsd 套接 字 最初 套接 字 被 设计 用在 同一 台 主 机上 多个 应用程序 之间 的 通讯 这 被称为 进程 间 通讯 或 ipc 套接 字 分 两种 基于 文件 型 和 基于 网络 第一个 套接 字 家族 为 afunix 表示 地址 家族 unix 包括 pyt thon 在内 的 大多数 流行 平 台上 都 使用 术语 地址 家族 及其 缩写 af 由于 两个 进程 都 运 行在 同一 台 机器 上 而且 这些 套接 字 是 基于 文件 的 所以 它们 的 底层 结构 是 由 文件 系统 来 支持 的 可以 理解为 同一 台 电脑 上 文件 系统 确 实是 不同 的 进程 都能 进行 访问 的 第二个 套接 字 家族 为 afinet 表示 地址 家族 internet 还有 一种 地址 家族 afinet 被 用于 网际协议 ipv 寻址 python 中加 入了 一种 linux 套接 字 的 支持 afnetlink 无 连接 套接 字 家族 让 用户 代码 与 内核 代码 之间 的 ipc 可以 使用 标准 bsd 套接 字 接口 这种 方法 更为 精巧 和 安全 如果把 套接 字 比作 电话 的 查看 即 通信 的 最底层 结构 那 主机 与 端口 就 相当于 区号 和 电话号码 的 一对 组合 一个 因特网 地址 由 网络通信 必须 的 主机 与 端口 组成 而且 另一端 一 定要 有人 接听 才 行否 则会 提示 对不起 您 拨打 的 电话 是 空号 请 查询 后 再 拨 同样 你 也 可能会 遇到 如 不能 连接 该 服务器 服务器 无法 响应 等 合法 的 端口 范围 是 其中 小于 端口 号为 系统 保留 端口 三 面向 连接 与 无 连接 面向 连接 tcp 通信 之前 一 定要 建立 一条 连接 这种 通信 方式 也 被 成为 虚 电路 或 流 套接 字 面向 连接 的 通信 方式 提供 了 顺序 的 可靠地 不会 重复 的 数据传输 而且 也 不 会被 加上 数据 边界 这 意味着 每 发送 一份 信息 可能 会被 拆 分成 多 份 每份 都会 不多不少 地 正确 到达 目的地 然后 重新 按 顺序 拼装 起来 传给 正等待 的 应用程序 实现 这种 连接 的 主要 协议 就是 传输 控制 协议 tcp 要 创建 tcp 套接 字 就得 创建 时 指定 套接 字 类型 为 sockstreamtcp 套接 字 这个 类型 表示 它 作为 流 套接 字 的 特点 由于 这些 套接 字 使用 网际协议 ip 来 查找 网络 中 的 主机 所以 这样 形成 的 整个 系统 一般 会由 这两个 协议 tcp 和 ip 组合 描述 即 tcpip 无 连接 udp 无需 建立 连接 就可以 通讯 但 此时 数据 到达 的 顺序 可靠性 及 不重 复性 就 无法 保障 了 数 据报 会 保留 数据 边界 这就 表示 数据 是 整个 发送 的 不会 像 面向 连接 的 协议 先 拆 分成 小块 它就 相当于 邮政 服务 一样 邮件 和 包裹 不一定 按照 发送 顺序 达到 有的 甚至 可能 根本 到达 不到 而且 网络 中 的 报文 可能会 重复 发送 那么 这么多 缺点 为什么 还要 使 用它 呢 由于 面向 连接 套接 字 要 提供 一些 保证需要 维护 虚 电路 连接 这都是 严重 的 额外负担 数 据报 没有 这些 负担 所有 它会 更 便宜 通常 能 提供 更好 的 性能 更适合 某些 场合 如 现场直播 要求 的 实时 数据 讲究 快 等 实现 这种 连接 的 主要 协议 是 用户数 据报 协议 udp 要 创建 udp 套接 字 就得 创建 时 指定 套接 字 类型 为 sockdgram 这个 名字 源于 datagram 数 据报 这些 套接 字 使用 网际协议 来 查找 网络 主机 整个 系统 叫 udpip 四 socket 模块 函数 使用 socket 模块 的 socket 函 数来 创建 套接 字 语法 如下 其中 socketfamily 不是 afvnix 就是 可 以是 sockstream 或者 一般 不 填 默认值 是 socket 创建 一个 tcpip 套接 字 的 语法 如下 同样 创建 一个 udpip 套接 字 的 语法 如下 由于 socket 模块 中有 太多 属性 所以 使用 语句 把 socket 模块 里面 的 所有 属性 都 带到 命名 空间 中 大幅 缩短 代码 调用 如下 tcpsocksocket 下面 是 最 常用 的 套接 字 对象 方法 提示 在 运行 网络 应用程序 时 如果 能够 使 用在 不同 的 电脑 上 运行 服务器 和 客户端 最好 不过 它 能让 你 更好 理解 通信 过程 而 更多 的 是 localhost 或 五 tcp 通信 实例 服务器 tcpsersockpy 核心 操作 如下 主机名 port 端口号 bufsize 缓冲区 大小 kaddr hostport tcpsersockbind addr 绑定 地址 到 套接 字 监听 最多 同时 个 连接 进来 whiletrue 无限 循环 等待 连接 到来 tryprint 被动 接受 客户端 连接 print bufsize 接受 数据 clientdata info ss ctime data infobytes infoencodingutf tcpclisocksend info 时间 戳 errore tcpsersockclose 关闭 服务器 tcpclisockclose 客户端 tcpclisockpy 核心 操作 如下 主机名 port 端口号 与 服务器 一致 bufsize 缓冲区 大小 kaddr hostport addr 连接 服务器 whiletrue 无限 循环 等待 连接 到来 trydatainput gt databytes dataencodingutf print datatype data data 发送 数据 bufsize 接受 数据 serverdata errore tcpclisockclose 关闭 客户端 由于 服务器 被 动地 无限 循环 等待 连接 所以 需要 先 运行 服务器 再 开 客户端 又 因为 我 的 python 总会 无法 响应 所以 采用 cmd 运行 服务器 server 程序 pythonidle 运行 客户端 进行 通信 运行 结果 如 下图 所示 另一 种方法 同时 打开 python 和 python 进行 通信 如 下图 所示 建议 创建 线程 来 处理 客户端 请求 socketserver 模块 是 一个 基于 socket 模块 的 高级 别的 套接 字 通信 模块 支持 新 的 线程 或 进程 中 处理 客户端 请求 同时 建议 在 退出 和 调用 服务器 close 函数 时 使用 tryexcept 语句 那么 如何 反弹 shell 程序 呢 使用 导 入库 调用 系统 命令 实现 核心 代码 如下 后续 windows 漏洞 复现 深入 讲解 后 你 就 更好 理解 这 部分 代码 了 五 总结 希望 这篇 文章 对 你 有所 帮助 这是 python 黑 帽 第二篇 博客 后续 作者 也 将 继续 深入 学习 制作 一些 常用 的 小工具 供 大家 交流 最后 真诚地 感谢您 关注 娜 璋 之家 公众 号 也 希望 我 的 文章 能 陪伴 你 成长 希望 在 技术 路上 不断 前行 文章 如果 对 你 有 帮助 有 感悟 就是 对 我 最好 的 回报 且看 且 珍惜 再次 感谢您 的 关注 也 请 帮忙 宣 传下 娜 璋 之家 哈哈 初来乍到 还请 多多指教 前文 python 黑 帽 一 获取 windows 主机 信息 注册表 u盘 历史 痕迹 和 回收站 文件 三尺 讲台 三寸 笔 三千 桃李 十年树木 十年 风 十万 栋 梁祝 天下 所有 老师 节日快乐 也是 自己 第五个 教师节 从 我们家 女神 年 去 山村 支教 到我 年 走上 支教 的 讲台 再到 年 真正 成为 大学老师 感恩 这一 路 走来 也 祝 女神 和我 节日快乐 感谢 所有人 的 祝 福和 帮助 无论 未来 是否 继续 当 老师 秀 璋 都会 一直 牢记 当 老师 的 那份 美好 记住 分享 知识 的 魅力 记住 你们 脸上 洋溢着 灿烂 的 笑容 我 也 会 线上 分享 更好 的 文章 真心 希望 帮助 更 多人 把 这些年 所学 所做 分享 出来 不忘 初心 感恩 前行 真是 奇幻 师范 出身 的 她 没 成为 老师 程序 猿 却 去 教书 了 哈哈 by 娜 璋 ai 安全 之家 eastmount 夜 于 武汉 参考文献 安全 之路 web 渗透 技术 及 实战 案例 解析 陈 小兵 老师 wireshark 数据包 分析 实战 第二 版 