python 项目 实战 一 python 编程 从 入门 到 实践 项目 一 外星人 入侵 使用 python 开发 游戏 一 武装 飞船 规划 项目 开发 大型项目 时 制 定好 规划 后 再 动手 编写 代码 很 重要 规划 可 确保 你 不偏 离 轨道 从而 提高 项目 成功 的 可能性 外星人 入侵 游戏 的 描述 在 游戏 外星人 入侵 中 玩家 控制 一艘 最初 出现在 屏幕 底部 中央 的 飞船 玩家 可以 使用 箭头键 左右 移动 飞船 还可 使用 空格键 射击 游戏 开始时 一群 外星人 出现在 天空中 并向 屏幕 下方 移动 玩家 的 任务 是 射杀 这些 外星人 玩家 将 所有 外星人 都 消灭 干净 后 将 出现 一群 新 的 外星人 其 移动 速度 更快 只要 有 外星人 撞到 玩家 的 飞船 或 到达 屏幕 底部 玩家 就 损失 一艘 飞船 玩家 损失 三艘 飞船 后 游戏 结束 开发 的 第一个 阶段 就是 船舰 一艘 飞船 它可 左右 移动 并且 能在 用户 按 空格键 时 开火 开始 游戏 项目 已经 安 装了 pygame 创建 pygame 窗口 及 响应 用户 输入 self 管理 游戏 资源 和 行为 的 类 pygameinit 创建 游戏 窗口 指定 窗口 尺寸 为 x 像素 并将 显示 窗口 赋 给 属性 alieninvasion defrungame self 开始 游戏 的 主 循环 whiletrue 监视 键盘 和 鼠标 事件 让 最近 绘制 的 屏幕 可见 ifnamemain 创建 游戏 实例 并 运行 游戏 aialieninvasion airungame 首先 导入 模块 sys 和 pygame 模块 pygame 包含 开发 游戏 所需 的 功能 玩家 退出 时 使用 工具 sys 来 退出 游戏 赋 给 属性 selfscreen 的 对 象是 一个 surface 在 pygame 中 surface 是 屏幕 的 一部分 用于 显示 游戏 元素 在 这个 游 戏中 每个 元素 如 外星人 或 飞船 都是 一个 返回 的 surface 表示 整个 游戏 的 窗口 激活 游戏 动画 循环 后 每 经过 一次 循环 都将 自动 重 绘 这个 surface 将 用户 触发 的 所有 变化 都 反映 出来 这个 游戏 由 方法 rungame 控制 该 方法 包含 一个 不断 运行 的 while 循环 而 这个 循环 包含 一个 事件 循环 以及 管理 屏幕 更新 的 代码 事件 是 用户 玩游戏 时 执行 的 操作 如 按键 或 移动 鼠标 为 程序 响应 事件 可 编写 一个 事件 循环 以 侦听 事件 并 根据 发生 的 事件 类型 执行 合适 的 任务 函数 pygameeventget 用于 访问 pygame 检 测到 的 事件 这个 函数 返回 一个 列表 其中 包含 它 在上 一次 被 调 用后 发生 的 所有 之间 所有 键盘 或 鼠标 事件 都将 导致 这个 for 循环 运行 函数 命令 pygame 让 最近 绘制 的 屏幕 可见 它在 每次 执行 while 循环 时 都 绘制 一个 空 屏幕 并 擦 去就 屏幕 使得 只有 新 屏幕 可见 设置 背景色 在 alieninvasionpy 中 设置 背景色 创建 设置 类 setting 类 用于 将 所有 设置 都 存储 在 一个 地方 以免 在 代码 中 到处 添加 设置 这样 每当 需要 访问 设置 时 只需 使用 一个 设置 对象 另 外在 项目 增大 时 这 使得 修改 优秀 的 外观 和 行为 更 容易 要 修改 游戏 只需要 修改 settingspy 中 的 一些 值 classsettings 存储 游戏 外星人 入侵 中所 有 设置 的 类 definit self 初始化 游戏 的 设置 屏幕 设置 修改 self 管理 游戏 资源 和 行为 的 类 pygameinit alieninvasion defrungame self 开始 游戏 的 主 循环 whiletrue 监视 键盘 和 鼠标 事件 每次 循环 时 都 重 绘 屏幕 fill 方法 使用 背景色 填充 屏幕 用于 处理 surface 只 接受 一种 颜色 selfscreenfill 让 最近 绘制 的 屏幕 可见 ifnamemain 创建 游戏 实例 并 运行 游戏 aialieninvasion airungame 添加 飞船 图像 为了 在 屏幕 上 绘制 玩家 的 飞船 我们 将 加载 一幅 图像 再 使用 pygame 方法 blit 绘制 它可 以 使用 pixabay 网站 提供 的 免费 图形 无需 授权 许可 即可 使用 并 修 改在 游 戏中 机会 可以 使用 任何 类型 的 图像文件 但 使用 位图 bmp 文件 最为 简单 因为 pygame 默认 加载 位图 选择 图像 时 要 特别注意 背景色 尽可能 选择 背景 与 透明 或 纯色 的 图像 便于 使用 图像 编辑器 将其 背景 替 换为 任意 颜色 图像 的 背景色 与 游戏 的 背景色 匹配 时 游戏 看起来 最 漂亮 创建 ship 类 负责 管理 飞船 的 大部分 行为 管理 飞船 的 类 aigame 是 当前 alieninvasion 的 实例 的 引用 definit selfaigame 初始化 飞船 并 设置 其 初始 位置 加载 飞船 图像 并 获取 其 外接 矩形 pygameimageload 加载 图像 并将 飞船 图像 的 位置 传递 给它 该 函数 返回 一个 表示 飞船 的 imagesshipbmp 使用 getrect 函数 获取 相应 surface 的 属性 rect 以便 后面 能够 使 用它 来 指定 飞船 的 位置 对于 每 艘 新 飞船 都 将其 放在 屏幕 底部 的 中央 self 在 指定 位置 绘制 飞船 selfscreenblit pygame 之所以 高效 是因为 它 让你能 够 像 处理 矩形 rect 对象 一样 处理 所有 的 游戏 元素 即便 其 形状 并非 矩 形像 处理 矩形 一样 处理 游戏 元素 之所以 高效 是因为 矩形 是 简单 的 几何 形状 例如 将 游戏 元素 视为 矩形 pygame 能够 更 快地 判断 出 它们 是否 发 生了 碰撞 这种 做法 的 效果 通常 很好 游戏 玩家 机会 注意 不到 我们 处理 的 并不是 游戏 元素 的 实际 形状 在 这个 类 中 我们 将把 飞船 和 屏幕 作为 矩形 进行 处理 处理 rect 对象 时 可 使用 矩形 四角 和 中心 的 x 坐标 和 y 坐标 可以 通过 设置 这些 值 来 指定 矩形 的 位置 要让 游戏 元素 居中 可 设置 相应 的 rect 对象 的 属性 centercenterx 或 centery 要让 游戏 元素 与 屏幕 边缘 对齐 可 使用 属性 topbottomleft 或 right 除此之外 还有 一些 组合 属性 如 和 midright 要 调整 游戏 元素 的 水平 或 垂直 位置 可 使用 属性 x 和 y 分别 时 相应 矩形 左上角 的 x 坐标 和 y 坐标 notice 在 pygame 中 原点 位于 屏幕 左上角 向右 下方 移动 时 坐标值 将 增大 在 x 的 屏幕 上 原点 位于 左上角 而 右下角 的 坐标 为 这些 坐标 对应 的 是 游戏 窗口 而 不是 物理 屏幕 在 屏幕 上 绘制 飞船 self 管理 游戏 资源 和 行为 的 类 pygameinit alieninvasion selfshipship self defrungame self 开始 游戏 的 主 循环 whiletrue 监视 键盘 和 鼠标 事件 每次 循环 时 都 重 绘 屏幕 fill 方法 使用 背景色 填充 屏幕 用于 处理 surface 只 接受 一种 颜色 selfscreenfill selfshipblitme 让 最近 绘制 的 屏幕 可见 ifnamemain 创建 游戏 实例 并 运行 游戏 aialieninvasion airungame 导入 ship 类 并在 创建 屏 幕后 创建 一个 ship 实例 调用 ship 时 必须 提供 一个 参数 一个 alieninvasion 实例 这里 self 指向 的 是 当前 alieninvasion 实例 这个 参数 让 ship 能够 访问 游戏 资源 如 对象 screen 重构 方法 checkevents 和 updatescreen 在 大型项目 中 经常 需 要在 添加 新 代码 前 重构 既有 代码 重构 旨在 简化 既有 代码 的 结构 使其 更 容易 拓展 将 越来 越长 的 方法 rungame 拆 分成 两个 辅助 方法 helpermethod 辅助 方法 在 类 中 执行任务 但 并非是 通过 实例 调用 的 在 python 中 辅助 方法 的 名称 以 单个 下划线 打头 方法 checkevents 将 管理 事件 的 代码 移到 名为 checkevents 的 方法 中 以 简化 rungame 并 隔离 事件 管理 循环 通过 隔离 事件 循环 可将 事件 管理 与 游戏 的 其他 方 面如 更新 屏幕 分离 增加 checkevents 并 更改 rungame 的 代码 后 如下 defrungame self 开始 游戏 的 主 循环 每次 循环 时 都 重 绘 屏幕 fill 方法 使用 背景色 填充 屏幕 用于 处理 surface 只 接受 一种 颜色 selfscreenfill selfshipblitme 让 最近 绘制 的 屏幕 可见 defcheckevents self 监视 键盘 和 鼠标 事件 方法 updatescreen 为 进一步 简化 rungame 将 更新 屏幕 的 代码 移到 一个 名为 updatescreen 的 方法 中 defrungame self 开始 游戏 的 主 循环 defupdatescreen self 每次 循环 时 都 重 绘 屏幕 fill 方法 使用 背景色 填充 屏幕 用于 处理 surface 只 接受 一种 颜色 selfscreenfill selfshipblitme 让 最近 绘制 的 屏幕 可见 此时 已将 绘制 背景 和 飞船 以及 切换 屏幕 的 代码 移 到了 方法 updatescreen 中 现在 很 容易 看 出在 每次 循环 中都 检测 到了 新 发生 的 事件 并 更新 了 屏幕 新手 可以 先 编写 尽可能 简单 的 代码 等 项目 越来 约 复杂 后 对 其 进行 重构 驾驶 飞船 编写 代码 在 用户 按 左 或 右 箭头 时 做出 相应 响应 按键 每当 用户 按键 时 都 将在 pygame 中 注册 一个 事件 事件 都是 通过 方法 pygameeventget 获取 的 因此 需 要在 方法 checkevents 中指 定要 检查 哪些 类型 的 事件 每次 按键 都被 注册 为 一个 keydown 事件 pygame 检 测到 keydown 事件 时 需要 检查 按 下 的 是否 是 触发 行动 的 键 defcheckevents self 监视 键盘 和 鼠标 事件 向右 移动 飞船 selfshiprectx 允许 持续 移动 玩家 按住 右 箭头 键不放 时 我们 希望 飞船 不断 向右 移动 直到 玩家 松开 为止 结合 使用 keydown 和 keyup 以及 一个 名为 movingright 的 标志 来 实现 持续 移动 当 标志 movingright 为 false 时 飞船 不会 移动 玩家 按 下 右 箭头 时 将该 标志 设为 true 在 玩家 松开 时 将该 标志 重新 设置 为 false 飞船 的 属性 都由 ship 类 控制 因此 给 这个 类 添加 一个 名为 movingright 的 属性 和 一个 update 的 方法 管理 飞船 的 类 definit selfaigame 初始化 飞船 并 设置 其 初始 位置 加载 飞船 图像 并 获取 其 外接 矩形 imagesshipbmp 对于 每 艘 新 飞船 都 将其 放在 屏幕 底部 的 中央 移动 标志 self self 在 指定 位置 绘制 飞船 selfscreenblit 同时 修改 checkevents 以及 self 开始 游戏 的 主 循环 selfshipupdate defcheckevents self 监视 键盘 和 鼠标 事件 向右 移动 飞船 玩家 松开 右 箭头 左右 移动 与 右移 类似 添加 左移 逻辑 调整 飞船 速度 在 settings 类 中 添加 属性 shipspeed 用于 控制 飞船 速度限制 飞船 的 活动范围 飞船 不能 飞出 屏幕 之外 screenrectright 重构 checkevents 随着 游戏 的 开发 checkevents 方法 将 越来 越长 因此 将其 部分 达 目 放在 两个 方法 中一 个 处理 keydown 事件 一个 处理 keyup 事件 defcheckevents self 监视 键盘 和 鼠标 事件 event event selfevent 玩家 按 下 箭头 向右 移动 飞船 向左 移动 飞船 selfevent 玩家 松开 箭头 按 q 键 退 出在 中 添加 一个 代码 块 用于 在 玩家 按 q 键 时 结束 游戏 selfevent 玩家 按 下 箭头 向右 移动 飞船 向左 移动 飞船 在 全屏 模式 下 运行 游戏 更改 init 函数 如下 definit self 管理 游戏 资源 和 行为 的 类 pygameinit 在 全屏 模式 下 运行 游戏 alieninvasion selfshipship self notice 在 全屏 模式 下 运行 这款 游戏 之前 请 确认 能够 按 q 键 退出 因为 pygame 默认 不提 供在 全屏 模式 下 退出 游戏 的 方式 射击 射击 功 能在 玩家 按 空格键 时 发射 子弹 用 小 矩形 表示 子弹 将在 屏幕 中 向上 飞行 抵达 屏幕 边缘 后 消失 添加 子弹 设置 更新 settings 类 子弹 设置 创建 bullet 类 sprite 管理 飞船 所 发射 子弹 的 类 definit selfaigame 在 飞船 当前 位置 创建 一个 子弹 对象 super init 在 处 创建 一个 表示 子弹 的 矩形 再 设置 正确 的 位置 将 子弹 的 初始 位置 设置 为 飞船 的 初始 位置 这样 子弹 就是 从 飞船 顶部 出发 的 存储 用 小数 表示 的 子弹 位置 selfyfloat selfrecty 继承 了 从 模块 pygamesprite 导入 的 sprite 类 通过 使用 精灵 sprite 可将 游 戏中 相关 的 元素 编组 进而 同时 操作 编组 中 的 所有 元素 为 创建 子弹 实例 init 还需要 当前 的 alieninvasion 实例 还调 用了 super 来 继承 sprite 接下来 写好 管理 子弹 位置 以及 绘制 子弹 的 方法 defupdate self self pygamedrawrect 将 子弹 存储 到 编组 中 定义 bullet 类 和 必要 的 设置 后 便可 编 写在 玩家 每次 按 空格键 时 都 射出 一发 子 弹了 在 alieninvasion 中 创建 一个 编组 group 用于 存储 所有 有效 的 子弹 以便 管理 发射 出去 的 所有 子弹 这个 编组 是 的 一个 实例 它 类似于 列表 但 提供 了 有助于 开发 游戏 的 额外 功 能在 主 循环 中将 使用 这个 编组 在 屏幕 上 绘制 子弹 以及 更新 每颗 子弹 的 位置 在 alieninvasion 中 为 子弹 创建 编组 并在 rungame 的 循 环中 更新 子弹 的 位置 当 编组 调用 update 时 编组 自动 对 其中 的 每个 精灵 调用 update 开火 在 alieninvasion 中 需要 修改 以便 玩家 按 空格键 时 发射 一颗 子弹 删除 消失 的 子弹 检测 子弹 的 bottom 属性 是否 为 零 如果是 则 表明 子弹 已 飞过 屏幕 顶端 将其 删除 限制 子弹 的 数量 为了 鼓励 玩家 有 目标 地 进行 设计 可以 限制 屏幕 上 子弹 出现 的 数量 创建 方法 updatebullets 编写 并 检查 子弹 管理 代码 后 将其 移 动到 一个 独立 的 方法 中二 外星人 来了 开发 大型项目 时 要在 进入 每个 阶段 之前 回顾 以下 开发 计划 搞清楚 接下来 要 通过 代码 来 完成 哪些 任务 在 项 目中 添加 新功能 还应 审核 既有 代码 每 进入 一个 新阶段 项目 通常会 更 复杂 因此 最好 对 混乱 或 低效 的 代码 进行 清理 重构 创建 第一个 外星 人像 创建 ship 类 那样 创建 alien 类 出于 简化 考虑 也 将 使用 位图 来 表示 外星人 sprite definit selfaigame 初始 化为 行人 并 设置 其 起始 位置 super init 加载 外星人 图像 并 设置 其 rect 属性 imagesalienbmp 每个 外星人 最初 都在 屏幕 左上角 附近 存储 外星人 的 精确 水平 位置 selfxfloat selfrectx 创建 alien 实例 为了 让 第一个 外星 人在 屏幕 上 现身 需要 创建 一个 alien 实例 这 属于 设置 工作 因此 将把 这些 代码 放在 alieninvasion 类 的 方法 init 末尾 最 终会 创建 一群 外星人 涉及 的 工作量 不少 因此 将 新建 一个 名为 createfleet 的 辅助 方法 defcreatefleet self 创建 外星 人群 首先 创建 一个 外星人 alienalien self selfaliensadd alien 创建 一群 外星人 要 绘制 一群 外星人 需要 确定 一行 能 容纳 多少 外星人 以及 要 绘制 多少 行 首先 计算 外星人 的 水平 间距 并 创建 一行 外星人 再 确定 可用 的 垂直 空间 并 创建 一群 外星人 确定 一行 可 容纳 多少 外星人 屏幕 两边 要 有边 距 外星人 的 宽度 外星人 之间 的 间距 也是 外星人 的 宽度 为 整除 运算符 结果 得到 整数 alienwidth alienwidth 创建 一行 外星人 重写 createfleet 函数 